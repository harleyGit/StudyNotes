>## <h2 id=""></h2>
- [è¯»å†™é”å®ç°](#è¯»å†™é”å®ç°)
- **å‚è€ƒèµ„æ–™ï¼š**
	
	



<br/>

***
<br/>


># <h1 id="è¯»å†™é”å®ç°">è¯»å†™é”å®ç°</h1>

- **è¯»å†™é”åœºæ™¯ï¼š**
     
	-  åŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰1ä¸ªçº¿ç¨‹è¿›è¡Œå†™çš„æ“ä½œ

	-  åŒä¸€æ—¶é—´ï¼Œå…è®¸æœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»çš„æ“ä½œ

	-  åŒä¸€æ—¶é—´ï¼Œä¸å…è®¸æ—¢æœ‰å†™çš„æ“ä½œï¼Œåˆæœ‰è¯»çš„æ“ä½œ


<br/>

ä¸Šé¢çš„åœºæ™¯å°±æ˜¯å…¸å‹çš„â€œå¤šè¯»å•å†™â€ï¼Œç»å¸¸ç”¨äºæ–‡ä»¶ç­‰æ•°æ®çš„è¯»å†™æ“ä½œï¼ŒiOSä¸­çš„å®ç°æ–¹æ¡ˆç”¨**â€Œdispatch_barrier_async**ï¼š

```

@property (nonatomic, copy) NSString *text;
@property (nonatomic, strong) dispatch_queue_t concurrentQueue;



- (void) testAction {
    
    [self testMethod2];
    
}


//è¯»å†™é”æµ‹è¯•
- (void) testMethod2 {
    NSLog(@"è¯»å†™é”æµ‹è¯•------------------------------------>");
    
    /**
     è¯»å†™é”åœºæ™¯ï¼š
     
     åŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰1ä¸ªçº¿ç¨‹è¿›è¡Œå†™çš„æ“ä½œ
     
     åŒä¸€æ—¶é—´ï¼Œå…è®¸æœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»çš„æ“ä½œ
     
     åŒä¸€æ—¶é—´ï¼Œä¸å…è®¸æ—¢æœ‰å†™çš„æ“ä½œï¼Œåˆæœ‰è¯»çš„æ“ä½œ
     ä¸Šé¢çš„åœºæ™¯å°±æ˜¯å…¸å‹çš„â€œå¤šè¯»å•å†™â€ï¼Œç»å¸¸ç”¨äºæ–‡ä»¶ç­‰æ•°æ®çš„è¯»å†™æ“ä½œï¼ŒiOSä¸­çš„å®ç°æ–¹æ¡ˆæœ‰ï¼š
     */
    
    self.concurrentQueue = dispatch_queue_create("aaa", DISPATCH_QUEUE_CONCURRENT);
    // æµ‹è¯•ä»£ç ,æ¨¡æ‹Ÿå¤šçº¿ç¨‹æƒ…å†µä¸‹çš„è¯»å†™
    for (int i = 0; i<10; i++) {
        NSLog(@"ğŸ ğŸ ğŸ å†™æ“ä½œ1");
        dispatch_async(dispatch_get_global_queue(0, 0), ^{
            self.text = [NSString stringWithFormat:@"å™¼é‡Œå•ªå•¦--%d",i];
        });
        
    }
    
    for (int i = 0; i<50; i++) {

        dispatch_async(dispatch_get_global_queue(0, 0), ^{
            NSLog(@"è¯» %@ %@",[self text],[NSThread currentThread]);
        });
        
    }
    
    
    for (int i = 10; i<20; i++) {
        NSLog(@"ğŸ ğŸ ğŸ å†™æ“ä½œ2");

        dispatch_async(dispatch_get_global_queue(0, 0), ^{
            self.text = [NSString stringWithFormat:@"å™¼é‡Œå•ªå•¦--%d",i];
        });
        
    }
}

// å†™æ“ä½œ,æ …æ å‡½æ•°æ˜¯ä¸å…è®¸å¹¶å‘çš„,æ‰€ä»¥"å†™æ“ä½œ"æ˜¯å•çº¿ç¨‹è¿›å…¥çš„,æ ¹æ®logå¯ä»¥çœ‹å‡ºæ¥
- (void)setText:(NSString *)text {
    
    __weak typeof(self) weakSelf = self;
    NSLog(@"ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ");

    dispatch_barrier_sync(self.concurrentQueue, ^{
        __strong typeof(weakSelf) strongSelf = weakSelf;
        strongSelf->_text = text;
        NSLog(@"å†™æ“ä½œ %@ %@",text,[NSThread currentThread]);
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ,1ä¸ª1ä¸ªæ‰§è¡Œ,æ²¡æœ‰å¹¶å‘
        sleep(1);
    });
}
// è¯»æ“ä½œ,è¿™ä¸ªæ˜¯å¯ä»¥å¹¶å‘çš„,logåœ¨å¾ˆå¿«æ—¶é—´æ‰“å°å®Œ
- (NSString *)text {
    
    __block NSString * t = nil ;
    __weak typeof(self) weakSelf = self;
    NSLog(@"ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1");

    dispatch_sync(self.concurrentQueue, ^{
        __strong typeof(weakSelf) strongSelf = weakSelf;
        NSLog(@"ğŸ ğŸ ğŸ è¯»æ“ä½œ1");

        t = strongSelf->_text;
        // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ,ç¬é—´æ‰§è¡Œå®Œ,è¯´æ˜æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„è¿›å…¥çš„
        sleep(1);
        
    });
    return t;
    
}


```

æ‰“å°ï¼š

```
2021-06-01 21:23:42.050578+0800 OCTest[49150:1874181] è¯»å†™é”æµ‹è¯•------------------------------------>
2021-06-01 21:23:42.050872+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.051131+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.051168+0800 OCTest[49150:1875102] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.051374+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.051447+0800 OCTest[49150:1875240] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.051493+0800 OCTest[49150:1875102] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--0 <NSThread: 0x600002005680>{number = 4, name = (null)}
2021-06-01 21:23:42.051602+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.051671+0800 OCTest[49150:1875241] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.052223+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.052290+0800 OCTest[49150:1875242] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.052553+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.052642+0800 OCTest[49150:1875243] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.052926+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.052992+0800 OCTest[49150:1875244] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.053249+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.053349+0800 OCTest[49150:1875245] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.059369+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.059459+0800 OCTest[49150:1875246] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.059518+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ1
2021-06-01 21:23:42.059570+0800 OCTest[49150:1875247] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.059764+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.059770+0800 OCTest[49150:1875248] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.059808+0800 OCTest[49150:1875249] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.059899+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.059919+0800 OCTest[49150:1875251] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.059938+0800 OCTest[49150:1875250] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.059977+0800 OCTest[49150:1875252] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060023+0800 OCTest[49150:1875253] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060034+0800 OCTest[49150:1875254] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060085+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.060098+0800 OCTest[49150:1875255] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060133+0800 OCTest[49150:1875256] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060181+0800 OCTest[49150:1875257] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060220+0800 OCTest[49150:1875258] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060282+0800 OCTest[49150:1875259] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060295+0800 OCTest[49150:1875260] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060346+0800 OCTest[49150:1875261] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060403+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.060405+0800 OCTest[49150:1875263] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060413+0800 OCTest[49150:1875262] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060456+0800 OCTest[49150:1875264] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060489+0800 OCTest[49150:1875265] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060584+0800 OCTest[49150:1875266] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060644+0800 OCTest[49150:1875267] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060683+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.060689+0800 OCTest[49150:1875268] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060719+0800 OCTest[49150:1875269] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060760+0800 OCTest[49150:1875270] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060799+0800 OCTest[49150:1875271] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060826+0800 OCTest[49150:1875272] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060879+0800 OCTest[49150:1875273] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060910+0800 OCTest[49150:1875274] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.060941+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.060959+0800 OCTest[49150:1875275] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061002+0800 OCTest[49150:1875276] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061048+0800 OCTest[49150:1875277] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061077+0800 OCTest[49150:1875278] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061115+0800 OCTest[49150:1875279] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061187+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.061221+0800 OCTest[49150:1875281] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061320+0800 OCTest[49150:1875282] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061327+0800 OCTest[49150:1875283] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061156+0800 OCTest[49150:1875280] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061346+0800 OCTest[49150:1875284] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061405+0800 OCTest[49150:1875285] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061434+0800 OCTest[49150:1875286] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061474+0800 OCTest[49150:1875287] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061510+0800 OCTest[49150:1875288] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061574+0800 OCTest[49150:1875290] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061547+0800 OCTest[49150:1875289] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061636+0800 OCTest[49150:1875291] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061671+0800 OCTest[49150:1875292] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061755+0800 OCTest[49150:1875293] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061819+0800 OCTest[49150:1875294] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061645+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.061802+0800 OCTest[49150:1875295] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061935+0800 OCTest[49150:1875297] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.061899+0800 OCTest[49150:1875296] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.062126+0800 OCTest[49150:1875298] ğŸŠ ğŸŠ ğŸŠ è¯»æ“ä½œ1
2021-06-01 21:23:42.062160+0800 OCTest[49150:1875299] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.062192+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:42.062200+0800 OCTest[49150:1875300] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.062247+0800 OCTest[49150:1875301] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.062274+0800 OCTest[49150:1875302] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:42.062444+0800 OCTest[49150:1874181] ğŸ ğŸ ğŸ å†™æ“ä½œ2
2021-06-01 21:23:43.055129+0800 OCTest[49150:1875102] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:43.055269+0800 OCTest[49150:1875240] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--1 <NSThread: 0x600002042a80>{number = 7, name = (null)}
2021-06-01 21:23:44.059101+0800 OCTest[49150:1875240] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:44.059136+0800 OCTest[49150:1875244] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--5 <NSThread: 0x600002000e80>{number = 8, name = (null)}
2021-06-01 21:23:45.062779+0800 OCTest[49150:1875244] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:45.062808+0800 OCTest[49150:1875243] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--4 <NSThread: 0x60000200aa40>{number = 9, name = (null)}
2021-06-01 21:23:46.066867+0800 OCTest[49150:1875243] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:46.066941+0800 OCTest[49150:1875241] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--2 <NSThread: 0x60000201ba80>{number = 10, name = (null)}
2021-06-01 21:23:47.072205+0800 OCTest[49150:1875241] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:47.072235+0800 OCTest[49150:1875242] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--3 <NSThread: 0x600002052400>{number = 11, name = (null)}
2021-06-01 21:23:48.075550+0800 OCTest[49150:1875242] ğŸŒ° ğŸŒ° ğŸŒ° ------ã€‹ã€‰å†™æ“ä½œ
2021-06-01 21:23:48.075615+0800 OCTest[49150:1875245] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--6 <NSThread: 0x60000200d840>{number = 12, name = (null)}
2021-06-01 21:23:49.079437+0800 OCTest[49150:1875246] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--7 <NSThread: 0x60000200ad40>{number = 13, name = (null)}
2021-06-01 21:23:50.083392+0800 OCTest[49150:1875247] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--8 <NSThread: 0x60000200d840>{number = 14, name = (null)}
2021-06-01 21:23:51.084361+0800 OCTest[49150:1875268] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:52.085362+0800 OCTest[49150:1875268] è¯» å™¼é‡Œå•ªå•¦--8 <NSThread: 0x60000200ab40>{number = 15, name = (null)}
2021-06-01 21:23:52.085422+0800 OCTest[49150:1875301] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--12 <NSThread: 0x60000200d040>{number = 16, name = (null)}
2021-06-01 21:23:53.086301+0800 OCTest[49150:1875302] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--13 <NSThread: 0x600002051e00>{number = 17, name = (null)}
2021-06-01 21:23:54.087017+0800 OCTest[49150:1875253] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:54.087032+0800 OCTest[49150:1875251] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:55.092658+0800 OCTest[49150:1875251] è¯» å™¼é‡Œå•ªå•¦--13 <NSThread: 0x6000020533c0>{number = 18, name = (null)}
2021-06-01 21:23:55.092658+0800 OCTest[49150:1875253] è¯» å™¼é‡Œå•ªå•¦--13 <NSThread: 0x60000200d8c0>{number = 19, name = (null)}
2021-06-01 21:23:55.092684+0800 OCTest[49150:1875248] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--9 <NSThread: 0x60000200acc0>{number = 20, name = (null)}
2021-06-01 21:23:56.096441+0800 OCTest[49150:1875276] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:56.096442+0800 OCTest[49150:1875278] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:56.096441+0800 OCTest[49150:1875275] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:56.096438+0800 OCTest[49150:1875249] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:57.101096+0800 OCTest[49150:1875276] è¯» å™¼é‡Œå•ªå•¦--9 <NSThread: 0x60000207a100>{number = 23, name = (null)}
2021-06-01 21:23:57.101100+0800 OCTest[49150:1875249] è¯» å™¼é‡Œå•ªå•¦--9 <NSThread: 0x600002043900>{number = 22, name = (null)}
2021-06-01 21:23:57.101108+0800 OCTest[49150:1875278] è¯» å™¼é‡Œå•ªå•¦--9 <NSThread: 0x60000201b580>{number = 24, name = (null)}
2021-06-01 21:23:57.101100+0800 OCTest[49150:1875275] è¯» å™¼é‡Œå•ªå•¦--9 <NSThread: 0x60000200acc0>{number = 21, name = (null)}
2021-06-01 21:23:57.101141+0800 OCTest[49150:1875300] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--11 <NSThread: 0x60000200d880>{number = 25, name = (null)}
2021-06-01 21:23:58.102176+0800 OCTest[49150:1875299] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201a540>{number = 26, name = (null)}
2021-06-01 21:23:59.104168+0800 OCTest[49150:1875292] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104179+0800 OCTest[49150:1875274] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104169+0800 OCTest[49150:1875277] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104234+0800 OCTest[49150:1875293] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104235+0800 OCTest[49150:1875294] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104239+0800 OCTest[49150:1875295] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104240+0800 OCTest[49150:1875259] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104251+0800 OCTest[49150:1875298] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104262+0800 OCTest[49150:1875260] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104280+0800 OCTest[49150:1875267] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104294+0800 OCTest[49150:1875258] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104301+0800 OCTest[49150:1875266] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104313+0800 OCTest[49150:1875291] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104171+0800 OCTest[49150:1875261] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104345+0800 OCTest[49150:1875289] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104348+0800 OCTest[49150:1875265] ğŸ ğŸ 2021-06-01 21:23:59.104423+0800 OCTest[49150:1875257] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104382+0800 OCTest[49150:1875272] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104388+0800 OCTest[49150:1875263] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104427+0800 OCTest[49150:1875262] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104427+0800 OCTest[49150:1875296] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104435+0800 OCTest[49150:1875288] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104464+0800 OCTest[49150:1875264] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104497+0800 OCTest[49150:1875297] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104504+0800 OCTest[49150:1875256] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104507+0800 OCTest[49150:1875255] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104510+0800 OCTest[49150:1875269] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104551+0800 OCTest[49150:1875273] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104569+0800 OCTest[49150:1875250] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104573+0800 OCTest[49150:1875287] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104572+0800 OCTest[49150:1875252] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104584+0800 OCTest[49150:1875270] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104607+0800 OCTest[49150:1875254] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104608+0800 OCTest[49150:1875285] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104619+0800 OCTest[49150:1875286] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104664+0800 OCTest[49150:1875280] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104619+0800 OCTest[49150:1875282] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104675+0800 OCTest[49150:1875271] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104667+0800 OCTest[49150:1875283] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104732+0800 OCTest[49150:1875279] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104683+0800 OCTest[49150:1875281] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104712+0800 OCTest[49150:1875284] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:23:59.104682+0800 OCTest[49150:1875290] ğŸ ğŸ ğŸ è¯»æ“ä½œ1
2021-06-01 21:24:00.105580+0800 OCTest[49150:1875293] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x6000020075c0>{number = 28, name = (null)}
2021-06-01 21:24:00.105592+0800 OCTest[49150:1875292] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201c680>{number = 27, name = (null)}
2021-06-01 21:24:00.105594+0800 OCTest[49150:1875294] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002053ec0>{number = 29, name = (null)}
2021-06-01 21:24:00.105626+0800 OCTest[49150:1875259] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d8c0>{number = 30, name = (null)}
2021-06-01 21:24:00.105657+0800 OCTest[49150:1875295] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201e380>{number = 31, name = (null)}
2021-06-01 21:24:00.105678+0800 OCTest[49150:1875277] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002078a00>{number = 32, name = (null)}
2021-06-01 21:24:00.105699+0800 OCTest[49150:1875274] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002000e40>{number = 33, name = (null)}
2021-06-01 21:24:00.106405+0800 OCTest[49150:1875298] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201e240>{number = 34, name = (null)}
2021-06-01 21:24:00.106839+0800 OCTest[49150:1875260] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d5c0>{number = 35, name = (null)}
2021-06-01 21:24:00.107150+0800 OCTest[49150:1875258] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201aa00>{number = 36, name = (null)}
2021-06-01 21:24:00.107471+0800 OCTest[49150:1875289] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002007a00>{number = 37, name = (null)}
2021-06-01 21:24:00.107824+0800 OCTest[49150:1875291] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002007800>{number = 38, name = (null)}
2021-06-01 21:24:00.107992+0800 OCTest[49150:1875261] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201abc0>{number = 39, name = (null)}
2021-06-01 21:24:00.108320+0800 OCTest[49150:1875252] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201be80>{number = 40, name = (null)}
2021-06-01 21:24:00.108564+0800 OCTest[49150:1875287] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002007a00>{number = 41, name = (null)}
2021-06-01 21:24:00.109351+0800 OCTest[49150:1875266] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200c400>{number = 44, name = (null)}
2021-06-01 21:24:00.109350+0800 OCTest[49150:1875256] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002000cc0>{number = 42, name = (null)}
2021-06-01 21:24:00.109361+0800 OCTest[49150:1875269] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201b340>{number = 43, name = (null)}
2021-06-01 21:24:00.109727+0800 OCTest[49150:1875297] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201b0c0>{number = 45, name = (null)}
2021-06-01 21:24:00.110234+0800 OCTest[49150:1875288] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d600>{number = 48, name = (null)}
2021-06-01 21:24:00.109838+0800 OCTest[49150:1875264] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002007640>{number = 46, name = (null)}
2021-06-01 21:24:00.110236+0800 OCTest[49150:1875296] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201bcc0>{number = 47, name = (null)}
2021-06-01 21:24:00.110339+0800 OCTest[49150:1875255] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d780>{number = 49, name = (null)}
2021-06-01 21:24:00.110921+0800 OCTest[49150:1875273] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002000dc0>{number = 51, name = (null)}
2021-06-01 21:24:00.110915+0800 OCTest[49150:1875250] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002051fc0>{number = 50, name = (null)}
2021-06-01 21:24:00.110934+0800 OCTest[49150:1875257] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x6000020077c0>{number = 52, name = (null)}
2021-06-01 21:24:00.113876+0800 OCTest[49150:1875263] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x6000020074c0>{number = 55, name = (null)}
2021-06-01 21:24:00.113849+0800 OCTest[49150:1875265] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002052940>{number = 54, name = (null)}
2021-06-01 21:24:00.113963+0800 OCTest[49150:1875272] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002000d40>{number = 57, name = (null)}
2021-06-01 21:24:00.113920+0800 OCTest[49150:1875262] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002079f40>{number = 56, name = (null)}
2021-06-01 21:24:00.113849+0800 OCTest[49150:1875267] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000207a6c0>{number = 53, name = (null)}
2021-06-01 21:24:00.119015+0800 OCTest[49150:1875285] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201e480>{number = 59, name = (null)}
2021-06-01 21:24:00.119016+0800 OCTest[49150:1875271] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d740>{number = 60, name = (null)}
2021-06-01 21:24:00.119015+0800 OCTest[49150:1875286] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002051d00>{number = 58, name = (null)}
2021-06-01 21:24:00.119033+0800 OCTest[49150:1875280] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002079f80>{number = 61, name = (null)}
2021-06-01 21:24:00.119056+0800 OCTest[49150:1875270] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002001540>{number = 62, name = (null)}
2021-06-01 21:24:00.119073+0800 OCTest[49150:1875282] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000200d800>{number = 63, name = (null)}
2021-06-01 21:24:00.119088+0800 OCTest[49150:1875254] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000207a0c0>{number = 64, name = (null)}
2021-06-01 21:24:00.119491+0800 OCTest[49150:1875283] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201c6c0>{number = 65, name = (null)}
2021-06-01 21:24:00.119494+0800 OCTest[49150:1875281] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002000dc0>{number = 66, name = (null)}
2021-06-01 21:24:00.119555+0800 OCTest[49150:1875290] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201ad00>{number = 67, name = (null)}
2021-06-01 21:24:00.119707+0800 OCTest[49150:1875279] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x600002002040>{number = 68, name = (null)}
2021-06-01 21:24:00.119911+0800 OCTest[49150:1875102] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--14 <NSThread: 0x600002005680>{number = 4, name = (null)}
2021-06-01 21:24:00.119914+0800 OCTest[49150:1875284] è¯» å™¼é‡Œå•ªå•¦--10 <NSThread: 0x60000201b580>{number = 69, name = (null)}
2021-06-01 21:24:01.121618+0800 OCTest[49150:1875240] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--15 <NSThread: 0x600002042a80>{number = 7, name = (null)}
2021-06-01 21:24:02.122389+0800 OCTest[49150:1875244] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--16 <NSThread: 0x600002000e80>{number = 8, name = (null)}
2021-06-01 21:24:03.124373+0800 OCTest[49150:1875243] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--17 <NSThread: 0x60000200aa40>{number = 9, name = (null)}
2021-06-01 21:24:04.125953+0800 OCTest[49150:1875241] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--18 <NSThread: 0x60000201ba80>{number = 10, name = (null)}
2021-06-01 21:24:05.131037+0800 OCTest[49150:1875242] å†™æ“ä½œ å™¼é‡Œå•ªå•¦--19 <NSThread: 0x600002052400>{number = 11, name = (null)}


```

![è¯»å†™åºåˆ—å›¾](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/multithread1.png)


æ ¹æ®ä¸Šé¢çš„æ‰“å°ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨å†™çš„æ‰“å°ï¼šå†™æ“ä½œ å™¼é‡Œå•ªå•¦--1 å’Œ ğŸ å­—æ ·ï¼Œå…¶ä»–çš„éƒ½æ˜¯çƒŸé›¾å¼¹ã€‚æˆ‘ä»¬å†ç»“åˆä¸Šé¢çš„çº¿ç¨‹æ—¶åºå›¾å¯ä»¥çœ‹åˆ°ï¼Œä¸€èˆ¬éƒ½æ˜¯ç­‰åˆ°æ …æ éƒ½å®Œæˆåå†æ‰§è¡Œå…¶ä»–çš„ã€‚æ‰€ä»¥ä¸€èˆ¬éƒ½æ˜¯å…ˆå†™å‰10ä¸ªï¼Œå†æ˜¯è¯»ï¼Œç„¶åæ¥ç€å†™ã€‚


<br/>

ä¸‹é¢è´´ä¸Šä¸€ä¸ªAFNçš„å®ç° , requestHeaderModificationQueueæ˜¯ä¸€ä¸ªç”±AFHTTPRequestSerializeråˆ›å»ºçš„å¹¶å‘é˜Ÿåˆ—, ä½¿ç”¨è¿™ä¸ªå¹¶å‘é˜Ÿåˆ—å¯¹ä¸€ä¸ªNSMutableDictionaryå®ç°äº†å¤šè¯»å•å†™çš„é”.



```
self.requestHeaderModificationQueue = dispatch_queue_create("requestHeaderModificationQueue", DISPATCH_QUEUE_CONCURRENT);

```

![](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/multithread0.png)



<br/>

**ä½¿ç”¨pthread_rwlock äº’æ–¥é”ï¼ˆä¼šä¼‘çœ ï¼‰**

![](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/multithread2.png)

<br/>

```
#import <pthread.h>

@property (assign, nonatomic) pthread_rwlock_t lock;


- (void) testAction {
    
    [self testMethod3];
    
}


//è¯»å†™äº’æ–¥é”æµ‹è¯•
- (void) testMethod3 {
    // åˆå§‹åŒ–é”
        pthread_rwlock_init(&_lock, NULL);
        
        dispatch_queue_t queue = dispatch_get_global_queue(0, 0);
        
        for (int i = 0; i < 5; i++) {
            dispatch_async(queue, ^{
                [self read];
            });
            dispatch_async(queue, ^{
                [self write];
            });
        }
}

- (void)read {
    //è¯»é”
    pthread_rwlock_rdlock(&_lock);
    
    sleep(1);
    NSLog(@"ğŸ ğŸ %s", __func__);
    
    pthread_rwlock_unlock(&_lock);
}

- (void)write
{
    //å†™é”
    pthread_rwlock_wrlock(&_lock);
    
    sleep(1);
    NSLog(@"ğŸŠ ğŸŠ %s", __func__);
    
    pthread_rwlock_unlock(&_lock);
}
```

æ‰“å°ï¼š

```
021-06-01 22:30:57.268204+0800 OCTest[50381:1928202] ğŸ ğŸ -[ViewController read]
2021-06-01 22:30:58.272268+0800 OCTest[50381:1928423] ğŸŠ ğŸŠ -[ViewController write]
2021-06-01 22:30:59.275954+0800 OCTest[50381:1928424] ğŸ ğŸ -[ViewController read]
2021-06-01 22:31:00.280702+0800 OCTest[50381:1928425] ğŸŠ ğŸŠ -[ViewController write]
2021-06-01 22:31:01.283694+0800 OCTest[50381:1928426] ğŸ ğŸ -[ViewController read]
2021-06-01 22:31:02.284539+0800 OCTest[50381:1928427] ğŸŠ ğŸŠ -[ViewController write]
2021-06-01 22:31:03.285518+0800 OCTest[50381:1928428] ğŸ ğŸ -[ViewController read]
2021-06-01 22:31:04.286463+0800 OCTest[50381:1928429] ğŸŠ ğŸŠ -[ViewController write]
2021-06-01 22:31:05.287468+0800 OCTest[50381:1928430] ğŸ ğŸ -[ViewController read]
2021-06-01 22:31:06.288403+0800 OCTest[50381:1928431] ğŸŠ ğŸŠ -[ViewController write]
```



<br/>

***
<br/>