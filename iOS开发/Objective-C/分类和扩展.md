
- **分类**
- **扩展**
	- **Demo**
	- **NSString分类Demo**
- **NSProxy(伪多继承)**



<br/>

***
<br/>



># 分类



```
objc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key, id _Nullable value, objc_AssociationPolicy policy)

```

- id object ：关联的源对象
- const void *key：关联的key
- id value：关联对象，通过将此个值置成nil来清除关联。
- objc_AssociationPolicy policy：关联的策略
	关键策略是一个enum值
	- 	OBJC_ASSOCIATION_ASSIGN = 0,      <指定一个弱引用关联的对象>
	- 	OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,<指定一个强引用关联的对象>
	- 	OBJC_ASSOCIATION_COPY_NONATOMIC = 3,  <指定相关的对象复制>
	- 	OBJC_ASSOCIATION_RETAIN = 01401,      <指定强参考>
	- 	OBJC_ASSOCIATION_COPY = 01403    <指定相关的对象复制>


<br/>

> **Demo**

```
- (void) personTest {
    
    
    static char overviewKey;
    NSArray *array = [[NSArray alloc] initWithObjects:@"one", @"two", nil];
    NSString * overview = [[NSString alloc] initWithFormat:@"%@",@"First three numbers"];
    objc_setAssociatedObject(array, &overviewKey, overview, OBJC_ASSOCIATION_RETAIN);
    NSString *associatedObject = (NSString *)objc_getAssociatedObject(array, &overviewKey);
    NSLog(@"🍎 associatedObject:%@", associatedObject);
    
    objc_setAssociatedObject(array, &overviewKey, nil, OBJC_ASSOCIATION_ASSIGN);
    NSString *associatedObject2 = (NSString *)objc_getAssociatedObject(array, &overviewKey);

    NSLog(@"🍊 associatedObject:%@", associatedObject2);
}
```

打印：

```
 🍎 associatedObject:First three numbers
 🍊 associatedObject:(null)

```


<br/>

> **NSString分类Demo**

`NSString分类.h文件`

```
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface NSString (Tool)


/// 分类添加属性(使用运行时)
@property(nonatomic, copy)NSString *name;

@end
```
<br/>

`.m文件`

```
#import "NSString+Tool.h"
#import <objc/runtime.h>

static const void *nameKey = &nameKey;

@implementation NSString (Tool)


- (void)setName:(NSString *)name {
    
    
   /**
    *  根据某个对象，还有key，还有对应的策略(copy,strong等) 动态的将值设置到这个对象的key上
    *
    *  @param object 某个对象
    *  @param key    属性名,根据key去获取关联的对象, 是一个字符串常量，是一个地址(这里注意，地址必须是不变的，地址不同但是内容相同的也不算同一个key)
    *  @param value  要设置的值
    *  @param policy 策略(copy,strong，assign等)
    */
    objc_setAssociatedObject(self, &nameKey, name, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

- (NSString *)name {
    return objc_getAssociatedObject(self, nameKey);
}

@end



//调用
 NSString *test = @"大头爸爸";
 test.name = @"张光北";
 NSLog(@"字符串分类属性name值： %@", test.name);
```
打印：

`2019-11-16 19:36:41.693406+0800 HGSWB[19518:789236] 字符串分类属性name值： 张光北
`





<br/>

***
<br/>


># 扩展




<br/>

***
<br/>


># NSProxy(伪多继承)

[NSProxy](https://www.jianshu.com/p/923f119333d8)


<br/>

***
<br/>

参考资料：

[iOS分类不能添加属性原因的探索](https://blog.csdn.net/u012409247/article/details/80206229)
