-  **[Interview(II)](https://github.com/harleyGit/StudyNotes/blob/master/iOS/ProjectDesc/Interview(II).md)** 
-  [**iOSé¢è¯•é›†é”¦**](https://github.com/ChenYilong/iOSInterviewQuestions)

<br/>

***
<br/>

> <h2 id=""></h2>
- [**çº¿ä¸Šé¢è¯•æ§åˆ¶å¹³å°**](https://www.showmebug.com/pads)
- **[OCåŸºç¡€](#ocåŸºç¡€)**
	- [UILabelå¤šé€‚åº”](#UILabelå¤šé€‚åº”)
	- [ä¸åŒè´¦å·å†…è´­åå´©æºƒå¤„ç†å¼‚å¸¸](#ä¸åŒè´¦å·å†…è´­åå´©æºƒå¤„ç†å¼‚å¸¸)
	- [é€‚é…å™¨ã€å“åº”å…ƒæ˜¯ä»€ä¹ˆ](#é€‚é…å™¨å“åº”å…ƒæ˜¯ä»€ä¹ˆ)
	- [çƒ­æ›´æ–°](#çƒ­æ›´æ–°)
	- [retainå’ŒstrongåŒºåˆ«](#retainå’ŒstrongåŒºåˆ«)
	- [loadå’ŒinitializeåŒºåˆ«](#loadå’ŒinitializeåŒºåˆ«)
	- [ä¸ºä»€ä¹ˆè¯´atomicä¸æ˜¯å®‰å…¨çš„](#ä¸ºä»€ä¹ˆè¯´atomicä¸æ˜¯å®‰å…¨çš„)
	- [ä»£ç ç®¡ç†](#ä»£ç ç®¡ç†)
	- [æ•°æ®æœ¬åœ°æŒä¹…åŒ–](#æ•°æ®æœ¬åœ°æŒä¹…åŒ–)
	- [@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ](#ä½¿ç”¨copyå…³é”®å­—ä¸ºä»€ä¹ˆ)
- [**æ€§èƒ½ä¼˜åŒ–**](#æ€§èƒ½ä¼˜åŒ–)
	- [æ€§èƒ½ä¼˜åŒ–æ€»ç»“](#æ€§èƒ½ä¼˜åŒ–æ€»ç»“)
	- [å¾ªç¯å¼•ç”¨è§£å†³](#å¾ªç¯å¼•ç”¨è§£å†³)
	- [NSTimerå¾ªç¯å¼•ç”¨è§£å†³](#NSTimerå¾ªç¯å¼•ç”¨è§£å†³)
	- [NSTimerè®¡æ—¶ä¸å‡†ç¡®æ€ä¹ˆåŠ](#NSTimerè®¡æ—¶ä¸å‡†ç¡®æ€ä¹ˆåŠ)
	- [å›¾ç‰‡ä¼˜åŒ–](#å›¾ç‰‡ä¼˜åŒ–)
		 - [å›¾ç‰‡çš„å¤„ç†](#å›¾ç‰‡çš„å¤„ç†)
			 - [å›¾ç‰‡å¼‚æ­¥ç»˜åˆ¶](#å›¾ç‰‡å¼‚æ­¥ç»˜åˆ¶)
			 - [å›¾ç‰‡æ ¼å¼åˆ¤æ–­](#å›¾ç‰‡æ ¼å¼åˆ¤æ–­) 
			 - [ImageIOå›¾ç‰‡ç¼©æ”¾](#ImageIOå›¾ç‰‡ç¼©æ”¾)
	- [å›¾ç‰‡ä¸Šä¼ ](#å›¾ç‰‡ä¸Šä¼ )
	- [ç•Œé¢ä¿æŒæµç•…](#ç•Œé¢ä¿æŒæµç•…)
	- [UIå¡é¡¿ä¼˜åŒ–](#UIå¡é¡¿ä¼˜åŒ–)
	- [å†…å­˜ä¼˜åŒ–(å¾®ç›Ÿã€è´§æ‹‰æ‹‰é—®åˆ°)](#å†…å­˜ä¼˜åŒ–)
	- [å¯åŠ¨ä¼˜åŒ–(å¾®ç›Ÿã€è´§æ‹‰æ‹‰é—®åˆ°)](#å¯åŠ¨ä¼˜åŒ–)
	- 	[åŒ…ä½“ç§¯ä¼˜åŒ–](#åŒ…ä½“ç§¯ä¼˜åŒ–)
	- [å†…å­˜æš´æ¶¨è§£å†³](#å†…å­˜æš´æ¶¨è§£å†³)
	- [æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–](#æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–)
- [**æ¶æ„ä¸è®¾è®¡æ¨¡å¼**](#æ¶æ„ä¸è®¾è®¡æ¨¡å¼)
	- [MVCå’ŒMVVM](#MVCå’ŒMVVM)
	- [å•ä¾‹ç±»](#å•ä¾‹ç±»)
	- [åè®®ä»£ç†](#åè®®ä»£ç†)
	- [KVCå’ŒKVO](#KVCå’ŒKVO)
- [**åº•å±‚**](#åº•å±‚)
	- [Runloop](#Runloop)
		- [Runloopåº•å±‚åŸç†](#Runloopåº•å±‚åŸç†)
		- [Runloopæœ‰å‡ ç§è¿è¡ŒçŠ¶æ€](#Runloopæœ‰å‡ ç§è¿è¡ŒçŠ¶æ€)
		- [RunLoopä¸è‡ªåŠ¨é‡Šæ”¾æ± å…³ç³»ï¼Œä»€ä¹ˆæ—¶ä¾¯é‡Šæ”¾](#runloopä¸è‡ªåŠ¨é‡Šæ”¾æ± å…³ç³»ä»€ä¹ˆæ—¶ä¾¯é‡Šæ”¾)
		- [RunLoopåŸç†å’Œä¸çº¿ç¨‹çš„è”ç³»](#RunLoopåŸç†å’Œä¸çº¿ç¨‹çš„è”ç³»)
	- [è‡ªåŠ¨é‡Šæ”¾æ± ](#è‡ªåŠ¨é‡Šæ”¾æ± )
		- [è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†](#è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†)
	- [APP](#APP)
		- [appå¯åŠ¨æµç¨‹(è´§æ‹‰æ‹‰ã€å¾®ç›Ÿé¢è¯•é—®åˆ°)](#appå¯åŠ¨æµç¨‹) 
		- [appå¯åŠ¨ä¼˜åŒ–](#å¯åŠ¨ä¼˜åŒ–)
		- [appç”Ÿå‘½å‘¨æœŸ](#appç”Ÿå‘½å‘¨æœŸ)
	- [mainå‡½æ•°ä¹‹å‰ä¼šåšä»€ä¹ˆ](#mainå‡½æ•°ä¹‹å‰ä¼šåšä»€ä¹ˆ)
	- [Runtimeçš„æ¶ˆæ¯è½¬å‘](#Runtimeçš„æ¶ˆæ¯è½¬å‘)
	- [å“åº”è€…é“¾](#å“åº”è€…é“¾)
	- [OCçš„å¼•ç”¨è®¡æ•°æ˜¯å­˜æ”¾](#OCçš„å¼•ç”¨è®¡æ•°æ˜¯å­˜æ”¾)
	- [ç±»åº“æ²¡æœ‰å¯¼å…¥](#ç±»åº“æ²¡æœ‰å¯¼å…¥)
	- [OCçš„åˆ†ç±»Category](#OCçš„åˆ†ç±»Category)
	- [Blockæ·±å…¥æ¢ç©¶](#Blockæ·±å…¥æ¢ç©¶)
		- [blokcåˆ†ç±»](#blokcåˆ†ç±»)
		- [blockåŸç†](#blockåŸç†)
		- [blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—](#blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—)
	- [KVOçš„åŸç†](#KVOçš„åŸç†)
	- [APNSåº•å±‚åŸç†](#APNSåº•å±‚åŸç†)
	- [NSDictionaryã€NSArrayåŸç†](#NSDictionaryNSArrayåŸç†)
	- [selfå’Œsuperå®ç°çš„åŸç†](#selfå’Œsuperå®ç°çš„åŸç†)
	- [å†…å­˜ç®¡ç†](#å†…å­˜ç®¡ç†)
		- [isaæŒ‡é’ˆåŒ…å«äº†ä»€ä¹ˆï¼ˆè´§æ‹‰æ‹‰é¢è¯•ï¼‰](#isaæŒ‡é’ˆåŒ…å«äº†ä»€ä¹ˆ)
		- [weakåŸç†ï¼ˆè´§æ‹‰æ‹‰ï¼‰](#weakåŸç†)
	- [Categoryå±æ€§æ”¾åœ¨å“ª(è´§æ‹‰æ‹‰)](#Categoryå±æ€§æ”¾åœ¨å“ª)
- [**ç½‘ç»œ**](#ç½‘ç»œ)
	- [NSURLSessionä¸RunLoopçš„è”ç³»](#NSURLSessionä¸RunLoopçš„è”ç³»)
	- [ç½‘ç»œæ€§èƒ½ä¼˜åŒ–](#ç½‘ç»œæ€§èƒ½ä¼˜åŒ–)
	- [TCPå’ŒUDPåŒºåˆ«](#TCPå’ŒUDPåŒºåˆ«)
	- [Socketé€šä¿¡](#Socketé€šä¿¡)
		- [Socketå°åŒ…ã€æ‹†åŒ…](#Socketå°åŒ…æ‹†åŒ…)
- [**ç±»åº“** ](#ç±»åº“)
	- [FishHook](#fishhook) 
	- [SDWebImage](#SDWebImage)
	- [AFNetworking](#AFNetworking)
	- [é™æ€åº“å’ŒåŠ¨æ€åº“](#é™æ€åº“å’ŒåŠ¨æ€åº“)
		- [åº“å¼•ç”¨é”™è¯¯è§£æ](#åº“å¼•ç”¨é”™è¯¯è§£æ)
- [**Quesion(I)**](https://rencheng.cc/2020/04/30/ios/general/iOSé«˜çº§é¢è¯•é¢˜/) 




<br/>

***
<br/>

># <h1 id="OCåŸºç¡€">[OCåŸºç¡€](https://my.oschina.net/antsky/blog/1475173)</h1>

<br/>

> <h2 id="UILabelå¤šé€‚åº”">UILabelå¤šé€‚åº”?</h2>

Labelè‡ªé€‚åº”å®½åº¦

```
+ (float)widthAuto:(NSString *)content fontSize:(CGFloat)fontSize contentheight:(CGFloat)height{

		// åˆ—å¯¬
		//Â  Â  CGFloat contentHeight = height;
		
		// ç”¨ä½•ç¨®å­—é«”é€²è¡Œé¡¯ç¤º
		UIFont *font = [UIFont systemFontOfSize:fontSize];
		
		// è¨ˆç®—å‡ºé¡¯ç¤ºå®Œå…§å®¹éœ€è¦çš„æœ€å°å°ºå¯¸
		CGSize size = CGSizeMake(100, 100);
		
		// è¨ˆç®—å‡ºé¡¯ç¤ºå®Œå…§å®¹éœ€è¦çš„æœ€å°å°ºå¯¸
		NSDictionary * tdic = [NSDictionary dictionaryWithObjectsAndKeys:font,NSFontAttributeName,nil];
		
		//ios7æ–¹æ³•ï¼Œè·å–æ–‡æœ¬éœ€è¦çš„sizeï¼Œé™åˆ¶å®½åº¦
		CGSizeÂ  actualsize =[content boundingRectWithSize:size options:NSStringDrawingUsesLineFragmentOrigin |NSStringDrawingUsesFontLeading attributes:tdic context:nil].size;
		
		return actualsize.width;

}

```


<br/>
<br/>


> <h3 id= "ä¸åŒè´¦å·å†…è´­åå´©æºƒå¤„ç†å¼‚å¸¸">ä¸åŒè´¦å·å†…è´­åå´©æºƒå¤„ç†å¼‚å¸¸<h3>
 

IAPæ”¯ä»˜çš„è¿‡ç¨‹ï¼š

- è°ƒç”¨IAPæ¥å£å‘èµ·æ”¯ä»˜
- æ”¯ä»˜æˆåŠŸï¼Œè·å–App Receiptç¥¨æ®ï¼Œè°ƒç”¨å……å€¼æ¥å£éªŒè¯
- éªŒè¯é€šè¿‡ï¼Œç»™ç”¨æˆ·å……å€¼è™šæ‹Ÿè´§å¸å¹¶å›è°ƒç»™ App

&emsp; è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹IAPæ”¯ä»˜çš„æœºåˆ¶ï¼Œæ¯æ¬¡æ”¯ä»˜è¡Œä¸ºæˆ–æ¯ç¬”äº¤æ˜“è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªSKPaymentTransationï¼Œåªæœ‰å½“SKPaymentTransationè¢«finishTransaction:ï¼Œè¿™æ¬¡æ”¯ä»˜ï¼ˆäº¤æ˜“ï¼‰è¡Œä¸ºæ‰ç®—æ˜¯æ­£å¸¸ç»“æŸäº†ã€‚å³ä½¿è¿™æ¬¡æ”¯ä»˜é€”ä¸­è¢«ä¸­æ–­ï¼Œå…¶å®ä¹Ÿå¹¶æ²¡æœ‰ä¸¢å¤±ã€‚å‡è®¾æ”¯ä»˜æ²¡æœ‰å®Œæˆ App å°±é€€å‡ºäº†ï¼ˆæ¯”å¦‚å´©æºƒï¼‰ï¼Œé‚£ä¹ˆå½“ä¸‹æ¬¡ App é‡å¯ä¹‹åï¼Œåªè¦è®¾ç½®äº†ç›‘å¬addTransactionObserver:ï¼Œä¹‹å‰è¢«ä¸­æ–­çš„æ”¯ä»˜å°±ä¼šæ¥ç€è¿›è¡Œã€‚

**æ‰å•**å¯èƒ½ä¼šå‡ºç°åœ¨å“ªäº›ç¯èŠ‚ï¼š
- ç¬¬1æ­¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ App è¿›ç¨‹å› ä¸ºæŸç§åŸå› è¢« kill äº†ï¼Œå…¶å®æ”¯ä»˜è¡Œä¸ºè¿˜åœ¨ç³»ç»Ÿåå°è¿›è¡Œç€ï¼Œè‹¹æœè‡ªå·±åšçš„ï¼Œå¾ˆæœ‰å¯èƒ½æ‰£æ¬¾æˆåŠŸã€‚ä½†æ˜¯è¿™æ—¶å€™æ²¡æ³•ä¸ºç”¨æˆ·å……å€¼è™šæ‹Ÿè´§å¸ã€‚
- ç¬¬2æ­¥ï¼ŒApp ç«¯ä¸è‡ªå·±æœåŠ¡å™¨ç«¯é€šä¿¡å¤±è´¥ï¼›è‡ªå·±æœåŠ¡å™¨ç«¯ä¸ AppStore æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å¤±è´¥ã€‚

&emsp; é’ˆå¯¹ç¬¬ä¸€ç§æƒ…å†µï¼Œå¯ä»¥åœ¨ App ä¸€å¯åŠ¨å°±è®¾ç½®ç›‘å¬ï¼Œå¦‚æœæœ‰æœªå®Œæˆçš„æ”¯ä»˜ï¼Œåˆ™ä¼šå›è°ƒ`- (void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions;`è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨æ¥å£å……å€¼ã€‚
è‡³äºç¬¬äºŒç§æƒ…å†µï¼ŒApp ç«¯éœ€è¦åšæ¥å£é‡è¯•ï¼Œè®¾ç½®ä¸€ä¸ªé‡è¯•çš„é€»è¾‘ã€‚

&emsp; ä¸‹é¢æ¥æè¿°ä¸€ä¸‹æˆ‘çš„å…·ä½“åšæ³•ã€‚

&emsp; æˆ‘ä½¿ç”¨äº†RMStoreï¼Œç¨ä½œäº†ä¸€äº›ä¿®æ”¹ã€‚æ–°å»ºä¸€ä¸ªæ•°æ®è¡¨ï¼ˆå­—æ®µæœ‰ï¼š`transactionIdentifierã€productIdentifierã€uidã€transactionDate(æ”¯ä»˜æ—¶é—´)ã€rechargeDate(å……å€¼åˆ°è´¦æ—¶é—´)ã€state`(ã€Œå·²æ”¯ä»˜ã€å’Œã€Œå·²å……å€¼ã€)ï¼‰ï¼Œå­˜æ¯ä¸€ç¬”äº¤æ˜“ã€‚

&emsp; åœ¨`- (void)paymentQueue:(SKPaymentQueue *)queue updatedTransactions:(NSArray *)transactions;`è¿™ä¸ªæ–¹æ³•é‡Œï¼Œé¦–å…ˆæ ¹æ®`SKPaymentTransactionçš„transactionIdentifier`å»æœ¬åœ°æ•°æ®è¡¨ä¸­åˆ¤æ–­è¿™æ¡äº¤æ˜“ï¼š

- å¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨æ•°æ®è¡¨ä¸­åˆ›å»ºä¸€æ¡äº¤æ˜“ï¼ŒçŠ¶æ€ä¸ºã€Œå·²æ”¯ä»˜ã€ï¼Œæ¥ç€å»è°ƒç”¨å……å€¼æ¥å£ï¼›
- å¦‚æœæœ‰è¿™æ¡äº¤æ˜“ï¼Œå¹¶ä¸”çŠ¶æ€ä¸ºã€Œå·²æ”¯ä»˜ã€ï¼Œåˆ™ä¸éœ€è¦åˆ›å»ºè¯¥æ¡äº¤æ˜“ï¼Œåªéœ€è¦å»è°ƒç”¨å……å€¼æ¥å£ï¼›
- å¦‚æœæœ‰è¿™æ¡äº¤æ˜“ï¼Œå¹¶ä¸”çŠ¶æ€ä¸ºã€Œå·²å……å€¼ã€ï¼ˆè™šæ‹Ÿè´§å¸åˆ°äº†ç”¨æˆ·è´¦ä¸Šï¼‰ï¼Œåˆ™ä¸éœ€è¦åˆ›å»ºï¼Œä¹Ÿä¸éœ€è¦å»å……å€¼ï¼Œç›´æ¥ç»“æŸäº¤æ˜“ï¼ˆfinishTransaction:ï¼‰ã€‚

&emsp; å……å€¼æ¥å£çš„è®¾ç½®ï¼ŒApp ç«¯éœ€è¦ä¼ è¿™äº›å‚æ•°ï¼šäº¤æ˜“idã€å•†å“idã€ç”¨æˆ·uidã€ç¥¨æ®ï¼Œè¯¥æ¥å£åœ¨æœåŠ¡å™¨ç«¯éœ€è¦åšä¸€äº›æ“ä½œï¼štransactionIdentifieréœ€è¦å…¥åº“ï¼Œå’ŒApp Receiptå¯¹åº”èµ·æ¥ï¼Œæ¯æ¬¡è®¿é—®æ¥å£éƒ½è¦å…ˆåšå»é‡åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å·²ç»éªŒè¯é€šè¿‡çš„transactionIdentifierï¼Œä¹Ÿè¿”å›æˆåŠŸã€‚åªè¦æ˜¯è®¿é—®æˆåŠŸï¼Œè¯¥æ¥å£éƒ½éœ€è¦å¸¦ä¸ŠtransactionIdentifierè¿”å›ç»™ App ç«¯ï¼Œå¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œå› ä¸ºä¸€ä¸ªApp Receiptç¥¨æ®éªŒè¯æˆåŠŸåè¿”å›çš„äº¤æ˜“åˆ—è¡¨å¯èƒ½æœ‰å¤šä¸ª

<br/>

**æ¼å•ï¼š**

&emsp; ä»¥ä¸Šæµç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°æ¼å•çš„æƒ…å†µï¼šå½“å®¢æˆ·ç«¯å‘è‹¹æœæ”¯ä»˜æˆåŠŸåï¼Œå‡†å¤‡å‘æœåŠ¡ç«¯å‘èµ·éªŒè¯ï¼Œæ­¤æ—¶è‹¥ç½‘ç»œå‘ç”ŸæŠ–åŠ¨æˆ–è€…äººä¸ºé€€å‡ºappç­‰æƒ…å†µï¼Œå°±ä¼šå‡ºç°ç”¨æˆ·å……å€¼æˆåŠŸï¼Œä½†æ˜¯æ²¡åŠ é‡‘å¸çš„æƒ…å†µã€‚
è§£å†³æ–¹æ¡ˆï¼šåœ¨paymentQueue:updatedTransactions:ä»£ç†æ–¹æ³•ä¸­è·å–åˆ°æ”¯ä»˜æˆåŠŸçš„å›è°ƒï¼Œæ­¤æ—¶é©¬ä¸Šç¼“å­˜è®¢å•ä¿¡æ¯ï¼ˆ`åŒ…æ‹¬æ”¯ä»˜å‡­è¯ã€è®¢å•å·ã€ç”¨æˆ·idç­‰ï¼›æ‹…å¿ƒç”¨æˆ·å¸è½½appçš„ï¼Œå¯ä»¥ç›´æ¥ç¼“å­˜åˆ°é’¥åŒ™ä¸²`ï¼‰ï¼Œç„¶åå†å‘æœåŠ¡ç«¯éªŒè¯è®¢å•ã€‚è‹¥è®¢å•éªŒè¯æˆåŠŸï¼Œåˆ™åˆ é™¤è¯¥é¡¹è®¢å•ç¼“å­˜ï¼›å¦åˆ™ä¸åšå¤„ç†ã€‚å¦å¤–ï¼Œæ¯æ¬¡appå¯åŠ¨çš„æ—¶å€™ï¼Œå¯ä»¥å»¶æ—¶å‡ ç§’é’Ÿï¼Œå»æ£€æµ‹æœ¬åœ°æ˜¯å¦æœ‰æœªéªŒè¯æˆåŠŸçš„è‹¹æœè®¢å•ï¼›å¦‚æœæœ‰ï¼Œå°±ä¸€ä¸ªä¸ªé‡æ–°éªŒè¯ã€‚

<br/>

**åˆ·å•ï¼š**

&emsp; æˆ‘ä»¬å…¬å¸çš„appæœ€æ—©çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯è¿˜æ˜¯ç”¨çš„Httpè¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘åˆ°åˆ·å•è¿™ä¸€å—ï¼Œç„¶åè¢«æŸäº›ç”¨æˆ·é’»äº†ç©ºå­ï¼›ä»–ä»¬å…ˆå‘èµ·è‹¹æœæ”¯ä»˜ï¼Œè·å–ä¸€ä¸ªè®¢å•å·ï¼Œç„¶åæ‹¿è¿™ä¸ªè®¢å•å·å’Œä¹‹å‰æ”¯ä»˜æˆåŠŸçš„å‡­è¯ï¼Œå‘æœåŠ¡ç«¯å‘èµ·éªŒè¯ï¼›ç„¶åæœåŠ¡ç«¯å‘ç°è®¢å•å·ä¹Ÿå¯¹å¾—ä¸Šï¼Œå‡­è¯ä¹ŸéªŒè¯æœ‰æ•ˆï¼Œå°±ç»™ç”¨æˆ·åŠ é‡‘å¸äº†ï¼›ç”¨æˆ·ç”¨åŒä¸€ä¸ªå‡­è¯ä¸æ–­çš„æ¢è®¢å•å·ã€‚ã€‚ã€‚ã€‚ã€‚
è§£å†³æ–¹æ¡ˆï¼šé¦–å…ˆæœåŠ¡ç«¯æ¯æ¬¡ç”Ÿæˆçš„è®¢å•å·éƒ½ç¼“å­˜èµ·æ¥ï¼Œå®¢æˆ·ç«¯åœ¨è¯·æ±‚å®Œè®¢å•å·åï¼Œå°†è¯¥è®¢å•å·è®°å½•åœ¨å†…è´­è®¢å•å¯¹è±¡é‡Œï¼ˆèµ‹å€¼ç»™SKPaymentçš„applicationUsernameå±æ€§ï¼‰ï¼›ç„¶åå½“å®¢æˆ·ç«¯æ”¯ä»˜æˆåŠŸåï¼ŒæŠŠè®¢å•idå’Œæ”¯ä»˜å‡­è¯ä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å…ˆæ‹¿å‡­è¯å»è‹¹æœæ ¡éªŒï¼Œè‹¹æœè¿”å›çš„ç»“æœä¸­æœ‰ä¸€ä¸ªtransactionIdï¼ˆè·Ÿå‰é¢è®°å½•çš„applicationUsernameæ˜¯ä¸€è‡´çš„ï¼‰ ï¼Œè¿™æ—¶å€™æœåŠ¡ç«¯åˆ¤æ–­è¯¥transactionIdå’Œè®¢å•idæ˜¯å¦ä¸€è‡´ï¼Œè‹¥ä¸€è‡´ï¼Œä¸”è¯¥è®¢å•idæ˜¯ä¸€ä¸ªæ–°idï¼Œä¹‹å‰æ²¡æœ‰ç¼“å­˜è¿‡ï¼›æ‰ç®—æ˜¯å®Œå…¨çš„æ ¡éªŒæˆåŠŸã€‚


<br/>

**è®¢å•é‡å¤ï¼š**

&emsp; è®¢å•é‡å¤çš„æƒ…å†µå°±æ˜¯æ”¯ä»˜æˆåŠŸåï¼Œä»æœ¬åœ°æ‹¿åˆ°äº†é”™è¯¯çš„æ”¯ä»˜å‡­è¯ï¼ˆä¹‹å‰çš„å‡­è¯ï¼‰ï¼Œå»æ ¡éªŒçš„æ—¶å€™ï¼Œä¼šå‘ç°è¯¥è®¢å•å·²ç»å®Œæˆäº†ã€‚
æˆ‘è¿™è¾¹å‘ç°è¿™ä¸ªé—®é¢˜çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼šå®¢æˆ·ç«¯å‘èµ·è‹¹æœæ”¯ä»˜çš„æ—¶å€™è°ƒç”¨addPaymentæ–¹æ³•ï¼Œåœ¨paymentQueue:updatedTransactions:å›è°ƒä¸­è·å–æ”¯ä»˜çš„çŠ¶æ€ï¼Œæ”¯ä»˜æˆåŠŸã€æ”¯ä»˜å¤±è´¥å’Œé‡å¤è´­ä¹°çš„çŠ¶æ€ä¸‹è¦ç»“æŸè®¢å•finishTransactionã€‚æˆ‘å½“æ—¶æ˜¯æ”¯ä»˜å¤±è´¥çš„æƒ…å†µï¼Œæ²¡æœ‰ç»“æŸè®¢å•ï¼Œç„¶åä¸‹æ¬¡æ”¯ä»˜æˆåŠŸçš„æ—¶å€™ï¼Œè·å–çš„æ”¯ä»˜å‡­è¯æ˜¯ä¸Šæ¬¡å¤±è´¥çš„å‡­è¯ï¼Œç„¶åä¸ä»…æ ¡éªŒä¼šå¤±è´¥ï¼Œè®¢å•ä¹Ÿæ˜¯é‡å¤çš„ã€‚

<br/>

[**å†…è´­å…¨é¢å®æˆ˜**](https://www.jianshu.com/p/2f98b7937b6f)





<br/>

> <h3 id ="é€‚é…å™¨å“åº”å…ƒæ˜¯ä»€ä¹ˆ">é€‚é…å™¨ã€å“åº”å…ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3>

- **[é€‚é…å™¨](https://www.jianshu.com/p/61ade7936c93)**
	- [**é€‚é…å™¨Demo**](https://github.com/idage/iOSAdapterDemo)
	- [**é€‚é…å™¨æ¨¡å¼å®æˆ˜**](https://www.jianshu.com/p/5a45fe49f8b6)




**å®šä¹‰ï¼š** å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚Adapteræ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥åœ¨ä¸€èµ·å·¥ä½œã€‚

&emsp; é€‚é…å™¨å…¶å®å°±æ˜¯åœ¨è§†å›¾æ§åˆ¶å™¨å’Œå­è§†å›¾ä¹‹é—´çš„ä¸€ä¸ªåª’ä»‹ï¼Œè¿™ä¸ªåª’ä»‹å…¶å®ç”¨æ¥è§£è€¦ä¸¤è€…ä¹‹é—´çš„è€¦åˆåº¦çš„ã€‚
å½“ç„¶è¿™ä¸ªå­è§†å›¾æ§ä»¶æ˜¯è¢«å°è£…å¥½çš„ä¸€ä¸ªå…¬æœ‰è§†å›¾ç±»ï¼Œæ¯”å¦‚ä¸€ä¸ªç‰¹æœ‰é£æ ¼çš„æŒ‰é’®ã€tabelViewCellç­‰ï¼Œè™½ç„¶è¿™ä¸ªæ§ä»¶åªæ˜¯ä¸€ä¸ªå±•ç¤ºç±»ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆäº¤äº’ã€‚ä½†æ˜¯åœ¨é¡¹ç›®å¥½å‡ ä¸ªåœ°æ–¹éƒ½ç”¨åˆ°äº†è¿™ä¸ªæ§ä»¶äº†ï¼Œä½ åœ¨ç»™è¿™ä¸ªè§†å›¾æ§ä»¶è´Ÿå€¼çš„æ—¶å€™æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ

è¿™ä¸ªæ—¶å€™å°±éœ€è¦å»ºç«‹ä¸€ä¸ªé€‚é…å™¨äº†ã€‚

é€‚é…å™¨ä½¿ç”¨åœºæ™¯ï¼š
- å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚Adapter æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼›
- å¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹çš„ç»Ÿè®¡åˆ†æã€é”™è¯¯æ”¶é›†ç­‰SDKåº”è¯¥éƒ½ä¸é™Œç”Ÿã€‚å°±ç›®å‰è€Œè¨€å¸‚é¢ä¸Šä¹Ÿæœ‰è®¸å¤šç›¸åŒåŠŸèƒ½çš„äº§å“ï¼Œçœ¼èŠ±ç¼­ä¹±ï¼Œè®©äººæ— æ³•æŠ‰æ‹©é€‰å“ªä¸€æ¬¾SDKæ‰æ˜¯æœ€é è°±çš„ï¼›
- å·²ç»å­˜åœ¨çš„ç±»çš„æ¥å£ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼›
- åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œä½¿å¾—è¯¥ç±»å¯ä»¥ä¸å…¶ä»–ä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ï¼ˆå³é‚£äº›æ¥å£å¯èƒ½ä¸ä¸€å®šå…¼å®¹çš„ç±»ï¼‰ååŒå·¥ä½œï¼›
- åœ¨ä¸å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸€äº›å·²ç»å­˜åœ¨çš„å­ç±»ã€‚

**ä¼˜ç‚¹ï¼š**è§£è€¦åˆï¼Œè®©è§†å›¾ç±»ä¸åˆæ•°æ®ç±»äº§ç”Ÿè€¦åˆï¼Œä½¿è§†å›¾ç±»æ›´åŠ ç‹¬ç«‹ã€‚ æ–°å¢åŠ æ•°æ®ç±»çš„æ—¶å€™ä¸éœ€è¦ä¿®æ”¹è§†å›¾ç±»ï¼›
**ç¼ºç‚¹ï¼š**ä¼šæ–°å¢åŠ å¾ˆå¤šç±»ï¼Œä½¿ç³»ç»Ÿæ›´å‡Œä¹±ï¼Œä»£ç å¯è¯»æ€§æ›´å¼±äº†ã€‚



<br/>

- **å“åº”å…ƒ**



<br/>
<br/>

>## <h2 id="çƒ­æ›´æ–°">[çƒ­æ›´æ–°](https://juejin.cn/post/6844904144411574285)</h2>


<br/>
<br/>



> <h2 id="retainå’ŒstrongåŒºåˆ«">retainå’ŒstrongåŒºåˆ«</h2>

- **retainå’Œstrongéƒ½æ˜¯å¼ºå¼•ç”¨**ï¼Œé™¤äº†æŸäº›æƒ…å†µä¸‹ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ä¿®é¥°blockï¼Œå…¶ä»–çš„æ—¶å€™ä¹Ÿæ˜¯å¯ä»¥é€šç”¨çš„ã€‚
	- [ä¸åŒç‚¹](https://www.jianshu.com/p/19a7c049ab3d)ï¼šå¼•å…¥external(å¤–éƒ¨)å˜é‡æ—¶ï¼Œretainå’Œstrongï¼ˆcopyï¼‰æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ
		- åœ¨MRC(æ‰‹åŠ¨ç®¡ç†å¼•ç”¨è®¡æ•°)æ—¶ï¼Œblockå­˜åœ¨æ ˆåŒºï¼ˆstackï¼‰çš„ï¼Œå› æ­¤ä½¿ç”¨çš„æ—¶å€™è¦æ³¨æ„æ­¤æ—¶çš„blockæ˜¯å¦è¿˜å­˜åœ¨ï¼Œä»¥å…æ“ä½œäº†é‡æŒ‡é’ˆè€Œé—ªé€€ã€‚
		- åœ¨ARC(è‡ªåŠ¨å¼•ç”¨è®¡æ•°)æ—¶ï¼Œblockæ˜¯å­˜åœ¨å †åŒºï¼ˆheapï¼‰çš„ã€‚
		- blockçš„ä¿®é¥°ç¬¦å¯ä»¥ç”¨storngã€copyã€retainè¿›è¡Œä¿®é¥°ï¼Œä½†æ˜¯è¦æ³¨æ„åœ¨MRCç¯å¢ƒä¸è¦ç”¨retain



<br/>
<br/>


> <h2 id="loadå’ŒinitializeåŒºåˆ«">loadå’ŒinitializeåŒºåˆ«</h2>

- **è°ƒç”¨é¡ºåº**
	- ä»¥mainä¸ºåˆ†ç•Œï¼Œloadæ–¹æ³•åœ¨mainå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œinitializeåœ¨mainå‡½æ•°ä¹‹åæ‰§è¡Œ

- **ç›¸åŒç‚¹**
	- loadå’Œinitializeä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä¸èƒ½æ‰‹åŠ¨è°ƒç”¨å®ƒä»¬ã€‚
	- å­ç±»å®ç°äº†loadå’Œinitializeçš„è¯ï¼Œä¼šéšå¼è°ƒç”¨çˆ¶ç±»çš„loadå’Œinitializeæ–¹æ³•
	- loadå’Œinitializeæ–¹æ³•å†…éƒ¨ä½¿ç”¨äº†é”ï¼Œå› æ­¤å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
	
- **ä¸åŒç‚¹**
	- å­ç±»ä¸­æ²¡æœ‰å®ç°loadæ–¹æ³•çš„è¯ï¼Œä¼šè°ƒç”¨çˆ¶ç±»çš„loadæ–¹æ³•(**äº²è‡ªå†™ä»£ç è¯å®äº†**)ï¼›è€Œå­ç±»å¦‚æœæ²¡æœ‰å®ç°initializeæ–¹æ³•çš„è¯ï¼Œä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ã€‚
	- å½“ç±»è¢«å¼•ç”¨è¿›é¡¹ç›®çš„æ—¶å€™å°±ä¼šæ‰§è¡Œloadå‡½æ•°(åœ¨mainå‡½æ•°å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼‰,ä¸è¿™ä¸ªç±»æ˜¯å¦è¢«ç”¨åˆ°æ— å…³,æ¯ä¸ªç±»çš„loadå‡½æ•°åªä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡.ç”±äºloadå‡½æ•°æ˜¯ç³»ç»Ÿè‡ªåŠ¨åŠ è½½çš„ï¼Œå› æ­¤ä¸éœ€è¦è°ƒç”¨çˆ¶ç±»çš„loadå‡½æ•°ï¼Œå¦åˆ™çˆ¶ç±»çš„loadå‡½æ•°ä¼šå¤šæ¬¡æ‰§è¡Œã€‚
	- initializeåœ¨ç¬¬ä¸€æ¬¡ç»™æŸä¸ªç±»å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨ï¼ˆæ¯”å¦‚å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”åªä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œæ˜¯æ‡’åŠ è½½æ¨¡å¼ï¼Œå¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰ä½¿ç”¨ï¼Œå°±ä¸å›è°ƒç”¨åˆ°initializeæ–¹æ³•ã€‚


<br/>

**load**

&emsp; æé—®ï¼šå½“æœ‰FatherClassã€FatherClass (fatherCategory)ã€SubClassã€SubClass (subCategory)å››ä¸ªç±»ï¼Œå½“å®ƒä»¬éƒ½å®ç°äº†loadæ–¹æ³•æ—¶ï¼Œå®ƒä»¬çš„è°ƒç”¨é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„(å¾—ç‰©(æ¯’)é¢è¯•æé—®)ï¼Ÿ

è‡ªå·±å®é™…æ“ä½œäº†ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬åœ¨loadæ–¹æ³•ä¸­ï¼ŒåŠ å…¥äº†è¿™æ®µä»£ç `[super load]`ä¼šå‡ºç°ä¸‹é¢çš„æ‰“å°ï¼Œè°ƒç”¨é¡ºåºå¦‚ä¸‹ï¼š

```
2021-05-19 12:21:01.565405+0800 OCTest[5522:237002] FatherClass çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:21:01.565927+0800 OCTest[5522:237002] -----ã€‹FatherClass Categoryçš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:21:01.566003+0800 OCTest[5522:237002] SubClass çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:21:01.566087+0800 OCTest[5522:237002] -----ã€‹FatherClass Categoryçš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:21:01.566152+0800 OCTest[5522:237002] ++++++ >>> SubClass Category çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:21:01.566205+0800 OCTest[5522:237002] -----ã€‹FatherClass Categoryçš„ load æ–¹æ³•è°ƒç”¨äº†

```


å½“æˆ‘ä»¬åœ¨loadæ–¹æ³•ä¸­å»é™¤`[super load]`æ–¹æ³•æ—¶æ˜¯ä»¥ä¸‹æ‰“å°ï¼š

```
2021-05-19 12:53:11.038671+0800 OCTest[6107:261238] FatherClass çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:53:11.039148+0800 OCTest[6107:261238] SubClass çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:53:11.039231+0800 OCTest[6107:261238] ++++++ >>> SubClass Category çš„ load æ–¹æ³•è°ƒç”¨äº†
2021-05-19 12:53:11.039354+0800 OCTest[6107:261238] -----ã€‹FatherClass Categoryçš„ load æ–¹æ³•è°ƒç”¨äº†

```

&emsp; è¿™æ‰æ˜¯æ­£ç¡®çš„è°ƒç”¨é¡ºåºï¼Œå…ˆ**è°ƒç”¨çˆ¶ç±»loadæ–¹æ³•->å­ç±»loadæ–¹æ³•->å­ç±»ç±»åˆ«loadæ–¹æ³•->çˆ¶ç±»ç±»åˆ«æ–¹æ³•**ã€‚




<br/>


**initialize:**

- **æè¿°ï¼š**
	- åœ¨è¿™ä¸ªç±»æ¥æ”¶ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹å‰è°ƒç”¨,æ˜¯ç³»ç»Ÿè°ƒç”¨ä¸éœ€è¦è°ƒç”¨ **[super initialize]**ï¼Œå¦åˆ™çˆ¶ç±»çš„initializeä¼šè¢«å¤šæ¬¡æ‰§è¡Œ ã€‚
	- Runtimeåœ¨ä¸€ä¸ªç¨‹åºä¸­æ¯ä¸€ä¸ªç±»çš„ä¸€ä¸ªç¨‹åºä¸­å‘é€ä¸€ä¸ªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œæˆ–æ˜¯ä»å®ƒç»§æ‰¿çš„ä»»ä½•ç±»ä¸­ï¼Œéƒ½æ˜¯åœ¨ç¨‹åºä¸­å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ã€‚ï¼ˆå› æ­¤ï¼Œå½“è¯¥ç±»ä¸ä½¿ç”¨æ—¶ï¼Œè¯¥æ–¹æ³•å¯èƒ½æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ï¼‰è¿è¡Œæ—¶å‘é€ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ–¹å¼åˆå§‹åŒ–æ¶ˆæ¯ã€‚çˆ¶ç±»çš„è°ƒç”¨ä¸€å®šåœ¨å­ç±»ä¹‹å‰ã€‚

- **è°ƒç”¨ç‰¹ç‚¹**
	- çˆ¶ç±»çš„initializeæ–¹æ³•ä¼šæ¯”å­ç±»å…ˆæ‰§è¡Œï¼›
	- å½“å­ç±»æœªå®ç°initializeæ–¹æ³•æ—¶,ä¼šè°ƒç”¨çˆ¶ç±»initializeæ–¹æ³•;
	- å½“å­ç±»å®ç°initializeæ–¹æ³•æ—¶,çˆ¶ç±»ã€å­ç±»çš„initializeæ–¹æ³•éƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯çˆ¶ç±»å…ˆæ‰§è¡Œ;

	```
	2021-05-19 19:36:02.439298+0800 OCTest[12800:544647] FatherClass çš„ initialize æ–¹æ³•è°ƒç”¨äº†
	2021-05-19 19:36:02.439464+0800 OCTest[12800:544647] SubClass çš„ initialize æ–¹æ³•è°ƒç”¨äº†
	```

	- å½“æœ‰çˆ¶ç±»ã€çˆ¶ç±»Categoreã€å­ç±»ã€å­ç±»Categoryéƒ½å®ç°äº†initializeæ—¶ï¼Œå…ˆè°ƒç”¨çˆ¶ç±»Categore -> å­ç±»Categoryã€‚ä¹Ÿå°±æ˜¯æœ‰Categoryçš„å…ˆæ‰§è¡Œé‡Œé¢çš„æ–¹æ³•ã€‚
	- å½“æœ‰å¤šä¸ªCategoryéƒ½å®ç°äº†initializeæ–¹æ³•,ä¼šè¦†ç›–ç±»ä¸­çš„æ–¹æ³•,åªæ‰§è¡Œä¸€ä¸ª(ä¼šæ‰§è¡ŒCompile Sources åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªCategory çš„initializeæ–¹æ³•)


<br/>

- **æƒ…å†µä¸‹ä½¿ç”¨:**
	- load
		- ç”±äºè°ƒç”¨loadæ–¹æ³•æ—¶çš„ç¯å¢ƒå¾ˆä¸å®‰å…¨ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘loadæ–¹æ³•çš„é€»è¾‘ã€‚å¦ä¸€ä¸ªåŸå› æ˜¯loadæ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨äº†é”ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥é¿å…çº¿ç¨‹é˜»å¡åœ¨loadæ–¹æ³•ä¸­
		- loadå¾ˆå¸¸è§çš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯,äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å®ç°

		```
		//æ‘˜è‡ªMJRefresh
		+ (void)load
		{
		    [self exchangeInstanceMethod1:@selector(reloadData) method2:@selector(mj_reloadData)];
		    [self exchangeInstanceMethod1:@selector(reloadRowsAtIndexPaths:withRowAnimation:) method2:@selector(mj_reloadRowsAtIndexPaths:withRowAnimation:)];
		    [self exchangeInstanceMethod1:@selector(deleteRowsAtIndexPaths:withRowAnimation:) method2:@selector(mj_deleteRowsAtIndexPaths:withRowAnimation:)];
		    [self exchangeInstanceMethod1:@selector(insertRowsAtIndexPaths:withRowAnimation:) method2:@selector(mj_insertRowsAtIndexPaths:withRowAnimation:)];
		    [self exchangeInstanceMethod1:@selector(reloadSections:withRowAnimation:) method2:@selector(mj_reloadSections:withRowAnimation:)];
		    [self exchangeInstanceMethod1:@selector(deleteSections:withRowAnimation:) method2:@selector(mj_deleteSections:withRowAnimation:)];
		    [self exchangeInstanceMethod1:@selector(insertSections:withRowAnimation:) method2:@selector(mj_insertSections:withRowAnimation:)];
		}
		
		+ (void)exchangeInstanceMethod1:(SEL)method1 method2:(SEL)method2
		{
		    method_exchangeImplementations(class_getInstanceMethod(self, method1), class_getInstanceMethod(self, method2));
		}
		
		
		```
		

<br/>

- **+initialize**
	-  initializeæ–¹æ³•ä¸»è¦ç”¨æ¥å¯¹ä¸€äº›ä¸æ–¹ä¾¿åœ¨ç¼–è¯‘æœŸåˆå§‹åŒ–çš„å¯¹è±¡è¿›è¡Œèµ‹å€¼ã€‚æ¯”å¦‚:NSMutableArrayè¿™ç§ç±»å‹çš„å®ä¾‹åŒ–ä¾èµ–äºruntimeçš„æ¶ˆæ¯å‘é€ï¼Œæ‰€ä»¥æ˜¾ç„¶æ— æ³•åœ¨ç¼–è¯‘å™¨åˆå§‹åŒ–ï¼š
		```
			
		// In Person.m
		// intç±»å‹å¯ä»¥åœ¨ç¼–è¯‘æœŸèµ‹å€¼
		static int someNumber = 0; 
		static NSMutableArray *someArray;
		+ (void)initialize {
		    if (self == [Person class]) {
		        // ä¸æ–¹ä¾¿ç¼–è¯‘æœŸå¤åˆ¶çš„å¯¹è±¡åœ¨è¿™é‡Œèµ‹å€¼
		        someArray = [[NSMutableArray alloc] init];
		    }
		}
		
		```




<br/>
<br/>



> <h2 id="ä¸ºä»€ä¹ˆè¯´atomicä¸æ˜¯å®‰å…¨çš„">ä¸ºä»€ä¹ˆè¯´atomicä¸æ˜¯å®‰å…¨çš„</h2>

**å…ˆè¯´æˆ‘çš„ç»“è®ºï¼š** ç”¨atomicä¿®é¥°åï¼Œè¿™ä¸ªå±æ€§çš„setterã€getteræ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯¹äºæ•´ä¸ªå¯¹è±¡æ¥è¯´ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

1).ä¸ºä»€ä¹ˆsetterã€getteræ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ

å› ä¸ºåœ¨setterå’Œgetterèµ‹å€¼å–å€¼çš„æ—¶å€™æ·»åŠ äº†è‡ªæ—‹é”ï¼Œä¸æ‡‚çœ‹è¿™[ã€Šocä¸­çš„çº¿ç¨‹é”ã€‹](https://www.jianshu.com/p/36bb249d4512)

```
// getter
id objc_getProperty(id self, SEL _cmd, ptrdiff_t offset, BOOL atomic) {
   // ...
   if (!atomic) return *slot;

   // Atomic retain release world
   spinlock_t& slotlock = PropertyLocks[slot];
   slotlock.lock();
   id value = objc_retain(*slot);
   slotlock.unlock();
   // ...
}

// setter
static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy)
{
   // ...
   if (!atomic) {
       oldValue = *slot;
       *slot = newValue;
   } else {
       spinlock_t& slotlock = PropertyLocks[slot];
       slotlock.lock();
       oldValue = *slot;
       *slot = newValue;        
       slotlock.unlock();
   }
   // ...
}

```


<br/>

2).ä¸ºä»€ä¹ˆè¯´atomicæ²¡åŠæ³•ä¿è¯æ•´ä¸ªå¯¹è±¡çš„çº¿ç¨‹å®‰å…¨ï¼Œè¿™é‡Œä¸»è¦çœ‹ä¸€ä¸‹ç½‘ä¸Šä¸»æµçš„ç­”æ¡ˆï¼Ÿ

> 1.å¯¹äºNSArrayç±»å‹ @property(atomic)NSArray *arrayæˆ‘ä»¬ç”¨atomicä¿®é¥°ï¼Œæ•°ç»„çš„æ·»åŠ å’Œåˆ é™¤å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ˜¯å› ä¸ºæ•°ç»„æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬è¦åˆ†æˆä¸¤éƒ¨åˆ†è€ƒè™‘ï¼Œä¸€éƒ¨åˆ†æ˜¯&arrayä¹Ÿå°±æ˜¯è¿™ä¸ªæ•°ç»„æœ¬èº«ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ä»–æ‰€æŒ‡å‘çš„å†…å­˜éƒ¨åˆ†ã€‚atomicé™åˆ¶çš„åªæ˜¯&arrayéƒ¨åˆ†ï¼Œå¯¹äºå®ƒæŒ‡å‘çš„å¯¹è±¡æ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚
atomicè¡¨ç¤ºï¼Œæˆ‘TMä¹Ÿå¾ˆå†¤å•Šï¼ï¼ï¼ï¼


> 2.å½“çº¿ç¨‹Aè¿›è¡Œå†™æ“ä½œï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹çš„è¯»æˆ–è€…å†™æ“ä½œä¼šå› ä¸ºè¯¥æ“ä½œè€Œç­‰å¾…ã€‚å½“Açº¿ç¨‹çš„å†™æ“ä½œç»“æŸåï¼ŒBçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œç„¶åå½“Açº¿ç¨‹éœ€è¦è¯»æ“ä½œæ—¶ï¼Œå´è·å¾—äº†åœ¨Bçº¿ç¨‹ä¸­çš„å€¼ï¼Œè¿™å°±ç ´åäº†çº¿ç¨‹å®‰å…¨ï¼Œå¦‚æœæœ‰çº¿ç¨‹Cåœ¨Açº¿ç¨‹è¯»æ“ä½œå‰releaseäº†è¯¥å±æ€§ï¼Œé‚£ä¹ˆè¿˜ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚æ‰€ä»¥ä»…ä»…ä½¿ç”¨atomicå¹¶ä¸ä¼šä½¿å¾—çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬è¿˜è¦ä¸ºçº¿ç¨‹æ·»åŠ lockæ¥ç¡®ä¿çº¿ç¨‹çš„å®‰å…¨ã€‚
ä¸ªäººè§‰å¾—è¿™ä¸ªå°±æœ‰ç‚¹æ ç²¾çš„æ„å‘³äº†ï¼Œatomicè¿˜è¦ç®¡åˆ°ä½ æ–¹æ³•å¤–é¢å»äº†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸è¿‡é¢è¯•äººå®¶é—®ä½ è¿˜è¦è¿™ä¹ˆç­”ï¼Œè¦ä¸¥è°¨ï¼ï¼ğŸ˜„å“ˆå“ˆ




<br/>
<br/>

> <h2 id="NSArrayå’ŒNSMutableArrayä¿®é¥°ç¬¦">NSArrayå’ŒNSMutableArrayä¿®é¥°ç¬¦</h2>
[NSArrayå’ŒNSMutableArrayå…³é”®å­—ä¿®é¥°](https://www.jianshu.com/p/0fa2c965af4a)

&emsp; **æ€»ç»“ï¼š**å½“ä¿®é¥°å¯å˜ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚NSMutableArrayã€NSMutableDictionaryã€NSMutableStringï¼Œç”¨strongã€‚å½“ä¿®é¥°ä¸å¯å˜ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚NSArrayã€NSDictionaryã€NSStringï¼Œç”¨copyã€‚





<br/>
<br/>

> <h2 id="ä»£ç ç®¡ç†">ä»£ç ç®¡ç†</h2>

<br/>

> <h3 id="pod instalå’Œpod updateåŒºåˆ«">**pod install**å’Œ**pod update**åŒºåˆ«
</h3>

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd4.jpg)

- **pod install:**æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œå¦‚æœPodfile.lockæ–‡ä»¶å­˜åœ¨, åˆ™ç›´æ¥ä»æ­¤æ–‡ä»¶ä¸­è¯»å–æ¡†æ¶ä¿¡æ¯å¹¶ä¸”å®ƒä¼šåªä¸‹è½½Podfile.lockæ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬å®‰è£…ã€‚å¯¹äºä¸åœ¨Podfile.lockæ–‡ä»¶ä¸­çš„podåº“ï¼Œpod installå‘½ä»¤ä¼šæœç´¢è¿™ä¸ªpodåº“åœ¨Podfileæ–‡ä»¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬æ¥å®‰è£…ï¼›å¦‚æœPodfile.lockä¸å­˜åœ¨, åˆ™ä¼šè¯»å–Podfileæ–‡ä»¶å†…çš„æ¡†æ¶ä¿¡æ¯ï¼Œç„¶åæ‰§è¡Œä¸‹è½½å¹¶ä¸”æ ¹æ®ä¸‹è½½å¥½çš„æ¡†æ¶ä¿¡æ¯, ç”ŸæˆPodfile.lockæ–‡ä»¶ã€‚

- **pod update:**åªæœ‰å½“ä½ æƒ³è¦æ›´æ–°podåº“çš„ç‰ˆæœ¬æ—¶æ‰ä½¿ç”¨pod updateï¼›å®ƒä¸ç®¡Podfile.lockæ˜¯å¦å­˜åœ¨, éƒ½ä¼šè¯»å–Podfileæ–‡ä»¶çš„çš„æ¡†æ¶ä¿¡æ¯å»ä¸‹è½½å®‰è£…ï¼Œä¸‹è½½å¥½ä¹‹å, å†æ ¹æ®ä¸‹è½½å¥½çš„æ¡†æ¶ä¿¡æ¯, ç”ŸæˆPodfile.lockæ–‡ä»¶

å½“å¤šäººåˆä½œå¼€å‘é¡¹ç›®æ—¶ï¼Œæœ€å¼€å§‹æŠŠé¡¹ç›®ä¸‹è½½ä¸‹æ¥æ—¶æœ€å¥½éƒ½æ‰§è¡Œ**`pod install`**ï¼Œä»¥åä¸ºäº†ä¿æŒç±»åº“ç‰ˆæœ¬ä¸€è‡´ç»Ÿä¸€ç”¨**`pod update`**å‘½ä»¤ã€‚



<br/>
<br/>


>## <h2 id = "æ•°æ®æœ¬åœ°æŒä¹…åŒ–">[æ•°æ®æœ¬åœ°æŒä¹…åŒ–](https://www.jianshu.com/p/d1c621631f7e)</h2>

- plistæ–‡ä»¶ï¼ˆåºåˆ—åŒ–ï¼‰
	- å¯ä»¥è¢«åºåˆ—åŒ–çš„ç±»å‹

	```
	NSArray;  //æ•°ç»„
	NSMutableArray;  //å¯å˜æ•°ç»„
	NSDictionary;  //å­—å…¸
	NSMutableDictionary;  //å¯å˜å­—å…¸
	NSData;  //äºŒè¿›åˆ¶æ•°æ®
	NSMutableData;  //å¯å˜äºŒè¿›åˆ¶æ•°æ®
	NSString;  //å­—ç¬¦ä¸²
	NSMutableString;  //å¯å˜å­—ç¬¦ä¸²
	NSNumber;  //åŸºæœ¬æ•°æ®
	NSDate;  //æ—¥æœŸ
	```
- preferenceï¼ˆåå¥½è®¾ç½®ï¼‰
	- ä½¿ç”¨NSUserDefaultsä¿å­˜ç¨‹åºçš„é…ç½®ä¿¡æ¯
- NSKeyedArchiverï¼ˆå½’æ¡£ï¼‰
	- è¦ä½¿ç”¨å½’æ¡£ï¼Œå…¶å½’æ¡£å¯¹è±¡å¿…é¡»å®ç°NSCodingåè®®

	```
	NSCodingåè®®å£°æ˜çš„ä¸¤ä¸ªæ–¹æ³•éƒ½å¿…é¡»å®ç°ã€‚
	encodeWithCoderï¼šç”¨æ¥è¯´æ˜å¦‚ä½•å°†å¯¹è±¡ç¼–ç åˆ°å½’æ¡£ä¸­ã€‚
	initWithCoderï¼šç”¨æ¥è¯´æ˜å¦‚ä½•è¿›è¡Œè§£æ¡£æ¥è·å–ä¸€ä¸ªæ–°å¯¹è±¡ã€‚
	```

- SQLite3
- FMDB
	- ä»‹ç»ï¼š FMDBæ˜¯ä¸€ç§ç¬¬ä¸‰æ–¹çš„å¼€æºåº“ï¼ŒFMDBå°±æ˜¯å¯¹SQLiteçš„APIè¿›è¡Œäº†å°è£…ï¼ŒåŠ ä¸Šäº†é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œè®©æˆ‘ä»¬ä¸å¿…ä½¿ç”¨ç¹ççš„Cè¯­è¨€APIå‡½æ•°ï¼Œæ¯”èµ·ç›´æ¥æ“ä½œSQLiteæ›´åŠ æ–¹ä¾¿ã€‚
	- ä¸»è¦æ˜¯ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªç±»ï¼š

	```
	FMDatabase ï¼š ä¸€ä¸ªå•ä¸€çš„SQLiteæ•°æ®åº“ï¼Œç”¨äºæ‰§è¡ŒSQLè¯­å¥ã€‚
	FMResultSet ï¼šæ‰§è¡ŒæŸ¥è¯¢ä¸€ä¸ªFMDatabaseç»“æœé›†ã€‚
	FMDatabaseQueue ï¼šåœ¨å¤šä¸ªçº¿ç¨‹æ¥æ‰§è¡ŒæŸ¥è¯¢å’Œæ›´æ–°æ—¶ä¼šä½¿ç”¨è¿™ä¸ªç±»ã€‚
	
	```

- CoreData



<br/>
<br/>

> <h2 id="ä½¿ç”¨copyå…³é”®å­—ä¸ºä»€ä¹ˆ">@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h2>

- å½“ä¿®é¥°å¯å˜ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚NSMutableArrayã€NSMutableDictionaryã€NSMutableStringï¼Œç”¨strongã€‚å½“ä¿®é¥°ä¸å¯å˜ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚NSArrayã€NSDictionaryã€NSStringï¼Œç”¨copyï¼›

- ç”¨ @property å£°æ˜ NSStringã€NSArrayã€NSDictionary ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—ï¼Œæ˜¯å› ä¸ºä»–ä»¬æœ‰å¯¹åº”çš„å¯å˜ç±»å‹ï¼šNSMutableStringã€NSMutableArrayã€NSMutableDictionaryï¼Œä»–ä»¬ä¹‹é—´å¯èƒ½è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œä¸ºç¡®ä¿å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²å€¼ä¸ä¼šæ— æ„é—´å˜åŠ¨ï¼Œåº”è¯¥åœ¨è®¾ç½®æ–°å±æ€§å€¼æ—¶æ‹·è´ä¸€ä»½ã€‚


[å‚è€ƒ](https://github.com/ChenYilong/iOSInterviewQuestions/blob/master/01)
[å‚è€ƒ2](https://juejin.cn/post/6844903480017043464#heading-3)




<br/>

***
<br/>



># <h1 id = "æ€§èƒ½ä¼˜åŒ–"> [æ€§èƒ½ä¼˜åŒ–](https://www.jianshu.com/p/3ad7880e3667) </h1>


<br/>

>## <h2 id = "æ€§èƒ½ä¼˜åŒ–æ€»ç»“"> [**æ€§èƒ½ä¼˜åŒ–æ€»ç»“**](https://juejin.cn/post/6844903590138478600) </h2>



<br/>
<br/>

> <h2 id = "å¾ªç¯å¼•ç”¨è§£å†³">å¾ªç¯å¼•ç”¨è§£å†³</h2>

[â™»ï¸è§£å†³å¾ªç¯å¼•ç”¨æ¡†æ¶ï¼šFBRetainCycleDetector](https://draveness.me/retain-cycle1/)








<br/>
<br/>

> <h3 id = "NSTimerå¾ªç¯å¼•ç”¨è§£å†³">NSTimerå¾ªç¯å¼•ç”¨è§£å†³ï¼Ÿ</h1>

NSTimerå¾ªç¯å¼•ç”¨çš„è§£å†³æ–¹æ³•ï¼Œç›®å‰æœ‰ä»¥ä¸‹å‡ ç§
- ç±»æ–¹æ³•
- GCDæ–¹æ³•
- [weakProxy](https://www.cnblogs.com/guohai-stronger/p/10430106.html)
	- è§£å†³NSTimerå¾ªç¯å¼•ç”¨çš„æ›´ä½³æ–¹æ¡ˆ:NSProxyç›´æ¥æ¶ˆæ¯è½¬å‘ï¼Œä¸ä¼šåƒç»§æ‰¿äºNSObjectçš„å¯¹è±¡å»çˆ¶ç±»é‡Œé¢æœç´¢ï¼Œé™ä½æ•ˆç‡


<br/>


**æ–¹æ³•ä¸€ï¼š**ç±»æ–¹æ³•

```
@interface NSTimer (JQUsingBlock)
+ (NSTimer *)jq_scheduledTimerWithTimeInterval:(NSTimeInterval)ti
                                     block:(void(^)())block
                                   repeats:(BOOL)repeats;
@end

@implementation NSTimer (JQUsingBlock)

+ (NSTimer *)jq_scheduledTimerWithTimeInterval:(NSTimeInterval)ti
                                     block:(void(^)())block
                                   repeats:(BOOL)repeats{

    return [self scheduledTimerWithTimeInterval:ti
                                     target:self
                                   selector:@selector(jq_blockInvoke:)
                                   userInfo:[block copy]
                                    repeats:repeats];
}

+ (void)jq_blockInvoke:(NSTimer *)timer{

    void(^block)() = timer.userInfo;
    if (block) {
        block();
    }
}

@end
```

&emsp; å®šä¹‰ä¸€ä¸ªNSTimerçš„ç±»åˆ«ï¼Œåœ¨ç±»åˆ«ä¸­å®šä¹‰ä¸€ä¸ªç±»æ–¹æ³•ã€‚ç±»æ–¹æ³•æœ‰ä¸€ä¸ªç±»å‹ä¸ºå—çš„å‚æ•°ï¼ˆå®šä¹‰çš„å—ä½äºæ ˆä¸Šï¼Œä¸ºäº†é˜²æ­¢å—è¢«é‡Šæ”¾ï¼Œéœ€è¦è°ƒç”¨copyæ–¹æ³•ï¼Œå°†å—ç§»åˆ°å †ä¸Šï¼‰ã€‚ä½¿ç”¨è¿™ä¸ªç±»åˆ«çš„æ–¹å¼å¦‚ä¸‹ï¼š

```
__weak ViewController *weakSelf = self;
_timer = [NSTimer jq_scheduledTimerWithTimeInterval:5.0
                                              block:^{
                                                  __strong ViewController *strongSelf = weakSelf;
                                                  [strongSelf startCounting];
                                              }
                                            repeats:YES];

```

&emsp; ä½¿ç”¨è¿™ç§æ–¹æ¡ˆå°±å¯ä»¥é˜²æ­¢NSTimerå¯¹ç±»çš„ä¿ç•™ï¼Œä»è€Œæ‰“ç ´äº†å¾ªç¯å¼•ç”¨çš„äº§ç”Ÿã€‚__strong ViewController *strongSelf = weakSelfä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æ‰§è¡Œå—çš„ä»£ç æ—¶ï¼Œç±»è¢«é‡Šæ”¾äº†ã€‚åœ¨ç±»çš„deallocæ–¹æ³•ä¸­ï¼Œè®°å¾—è°ƒç”¨[_timer invalidate]ã€‚


æé—®1ï¼šç±»æ–¹æ³•ä¸­ä½¿ç”¨**self**æ˜¯è°ƒç”¨å¯¹è±¡æ–¹æ³•å˜›ï¼Ÿ

&emsp; ä¸æ˜¯ï¼ç±»æ–¹æ³•ä½¿ç”¨selfæ—¶ï¼Œselfä»£è¡¨ç±»æœ¬èº«å³Classï¼Œæ‰€ä»¥ç±»æ–¹å†…å¯ä»¥ç›´æ¥è°ƒç”¨ç±»æ–¹æ³•ï¼ˆåˆ«è°ƒç”¨è‡ªå·±ï¼æ­»å¾ªç¯ï¼ï¼‰ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åˆ›å»ºå®ä¾‹å¯¹è±¡æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•ã€‚

[ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•åŠselfå’Œsuper](#selfå’Œsuperå®ç°çš„åŸç†)


<br/>

æé—®2: ä½¿ç”¨Blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—ï¼Ÿ

[ä¸ä¸€å®šï¼Œçœ‹è¿™é‡Œ](#blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—)



<br/>


**æ–¹æ³•äºŒï¼š**ç”¨GCDçš„dispatch_timeræ–¹æ³•æ›¿ä»£NSTimeræ¥è¿›è¡Œè®¡æ—¶


<br/>

**æ–¹æ³•ä¸‰ï¼š**weakProxyç¤ºä¾‹

![å¼•ç”¨ç¤ºæ„å›¾<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd7.png)

æ–°å»ºä¸€ä¸ªç»§æ‰¿NSProxyç±»çš„å­ç±»WeakProxyç±»

```
#import <Foundation/Foundation.h>
NS_ASSUME_NONNULL_BEGIN

@interface WeakProxy : NSProxy
@property(nonatomic , weak)id target;

@end

NS_ASSUME_NONNULL_END


#import "WeakProxy.h"
#import <objc/runtime.h>

@implementation WeakProxy

- (void)forwardInvocation:(NSInvocation *)invocation{
    [self.target forwardInvocation:invocation];
}

- (nullable NSMethodSignature *)methodSignatureForSelector:(SEL)sel{
    return [self.target methodSignatureForSelector:sel];
}

@end

```

ç„¶ååœ¨éœ€è¦ç”¨åˆ°çš„ç±»ä¸­å¼•å…¥WeakProxyï¼Œå¹¶å£°æ˜å±æ€§

```
#import "ViewController.h"
#import "WeakProxy.h"

@interface ViewController ()
@property (strong, nonatomic) NSTimer *timer;
@property(nonatomic,strong)WeakProxy *weakProxy;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    _weakProxy = [WeakProxy alloc];
    _weakProxy.target = self;
    _timer = [NSTimer scheduledTimerWithTimeInterval:1.0f target:_weakProxy selector:@selector(fire) userInfo:nil repeats:YES];

}

- (void)fire{
    NSLog(@"fire");
}

- (void)dealloc{
    [self.timer invalidate];
    self.timer = nil;
}

@end

```



<br/>

> <h3 id = "NSTimerè®¡æ—¶ä¸å‡†ç¡®æ€ä¹ˆåŠ">NSTimerè®¡æ—¶ä¸å‡†ç¡®æ€ä¹ˆåŠï¼Ÿ</h1>


&emsp; ä¸å‡†ç¡®æ˜¯å› ä¸ºå½“çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ—¶ä¼šé˜»ç¢å®ƒè®¡æ—¶ï¼Œå½“ç”¨çš„æ˜¯NSRunloopCommentModelsæ—¶ï¼Œå¯ä»¥ç”¨GCDæ¥è®¡æ—¶ã€‚

&emsp; GCDçš„å®šæ—¶å™¨ä¸ä¾èµ–äºrunloopï¼Œè€Œæ˜¯å’Œå†…æ ¸æŒ‚é’©çš„ï¼Œä¼šæ¯”è¾ƒå‡†æ—¶ï¼Œå®šæ—¶å™¨çš„æ¥å£è®¾è®¡

æ¥å£å®šä¹‰ï¼š

```
+ (NSString *)execTask:(void(^)(void))task
           start:(NSTimeInterval)start
        interval:(NSTimeInterval)interval
         repeats:(BOOL)repeats
           async:(BOOL)async;

+ (NSString *)execTask:(id)target
              selector:(SEL)selector
                 start:(NSTimeInterval)start
              interval:(NSTimeInterval)interval
               repeats:(BOOL)repeats
                 async:(BOOL)async;

+ (void)cancelTask:(NSString *)name;

```


<br/>

æ¥å£å®ç°

```

static NSMutableDictionary *timers_;
dispatch_semaphore_t semaphore_;
+ (void)initialize
{
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        timers_ = [NSMutableDictionary dictionary];
        semaphore_ = dispatch_semaphore_create(1);
    });
}

+ (NSString *)execTask:(void (^)(void))task start:(NSTimeInterval)start interval:(NSTimeInterval)interval repeats:(BOOL)repeats async:(BOOL)async
{
    if (!task || start < 0 || (interval <= 0 && repeats)) return nil;
    
    // é˜Ÿåˆ—
    dispatch_queue_t queue = async ? dispatch_get_global_queue(0, 0) : dispatch_get_main_queue();
    
    // åˆ›å»ºå®šæ—¶å™¨
    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);
    
    // è®¾ç½®æ—¶é—´
    dispatch_source_set_timer(timer,
                              dispatch_time(DISPATCH_TIME_NOW, start * NSEC_PER_SEC),
                              interval * NSEC_PER_SEC, 0);
    
    
    dispatch_semaphore_wait(semaphore_, DISPATCH_TIME_FOREVER);
    // å®šæ—¶å™¨çš„å”¯ä¸€æ ‡è¯†
    NSString *name = [NSString stringWithFormat:@"%zd", timers_.count];
    // å­˜æ”¾åˆ°å­—å…¸ä¸­
    timers_[name] = timer;
    dispatch_semaphore_signal(semaphore_);
    
    // è®¾ç½®å›è°ƒ
    dispatch_source_set_event_handler(timer, ^{
        task();
        
        if (!repeats) { // ä¸é‡å¤çš„ä»»åŠ¡
            [self cancelTask:name];
        }
    });
    
    // å¯åŠ¨å®šæ—¶å™¨
    dispatch_resume(timer);
    
    return name;
}

+ (NSString *)execTask:(id)target selector:(SEL)selector start:(NSTimeInterval)start interval:(NSTimeInterval)interval repeats:(BOOL)repeats async:(BOOL)async
{
    if (!target || !selector) return nil;
    
    return [self execTask:^{
        if ([target respondsToSelector:selector]) {
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Warc-performSelector-leaks"
            [target performSelector:selector];
#pragma clang diagnostic pop
        }
    } start:start interval:interval repeats:repeats async:async];
}

+ (void)cancelTask:(NSString *)name
{
    if (name.length == 0) return;
    
    dispatch_semaphore_wait(semaphore_, DISPATCH_TIME_FOREVER);
    
    dispatch_source_t timer = timers_[name];
    if (timer) {
        dispatch_source_cancel(timer);
        [timers_ removeObjectForKey:name];
    }

    dispatch_semaphore_signal(semaphore_);
}

```



<br/>
<br/>

> <h2 id="å›¾ç‰‡ä¼˜åŒ–">å›¾ç‰‡ä¼˜åŒ–</h2>

<br/>

**å›¾ç‰‡æ€§èƒ½ç“¶é¢ˆï¼š**

å¤§éƒ¨åˆ†æ ¼å¼çš„å›¾ç‰‡ï¼Œéƒ½éœ€è¦è¢«é¦–å…ˆè§£ç ä¸ºbitmapï¼Œç„¶åæ‰èƒ½æ¸²æŸ“åˆ°UIä¸Šã€‚

UIImageView æ˜¾ç¤ºå›¾ç‰‡ï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„è¿‡ç¨‹ã€‚å®é™…ä¸Šï¼Œä¸€å¼ å›¾ç‰‡ä»åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåˆ°è¢«æ˜¾ç¤ºåˆ° UIImageViewï¼Œä¼šç»å†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

- åˆ†é…å†…å­˜ç¼“å†²åŒºå’Œå…¶å®ƒèµ„æºã€‚
- ä»ç£ç›˜æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº
- ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´
- ç”ŸæˆUIImageViewï¼ŒæŠŠå›¾åƒæ•°æ®èµ‹å€¼ç»™UIImageView
- å°†å‹ç¼©çš„å›¾ç‰‡æ•°æ®ï¼Œè§£ç ä¸ºä½å›¾æ•°æ®ï¼ˆbitmapï¼‰ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰å­—èŠ‚å¯¹é½ï¼ŒCore Animationä¼šå†æ‹·è´ä¸€ä»½æ•°æ®ï¼Œè¿›è¡Œå­—èŠ‚å¯¹é½ã€‚
- CATransactionæ•è·åˆ°UIImageView layeræ ‘çš„å˜åŒ–ï¼Œä¸»çº¿ç¨‹Runloopæäº¤CATransactionï¼Œå¼€å§‹è¿›è¡Œå›¾åƒæ¸²æŸ“
- GPUå¤„ç†ä½å›¾æ•°æ®ï¼Œè¿›è¡Œæ¸²æŸ“ã€‚

ç”±äº UIKit çš„å°è£…æ€§ï¼Œè¿™äº›ç»†èŠ‚ä¸ä¼šç›´æ¥å¯¹å¼€å‘è€…å±•ç¤ºã€‚å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬è°ƒç”¨`[UIImage imageNamed:@"xxx"]`åï¼ŒUIImage ä¸­å­˜å‚¨çš„æ˜¯æœªè§£ç çš„å›¾ç‰‡ï¼Œè€Œè°ƒç”¨ `[UIImageView setImage:image]`åï¼Œä¼šåœ¨ä¸»çº¿ç¨‹è¿›è¡Œå›¾ç‰‡çš„è§£ç å·¥ä½œå¹¶ä¸”å°†å›¾ç‰‡æ˜¾ç¤ºåˆ° UI ä¸Šï¼Œè¿™æ—¶å€™ï¼ŒUIImage ä¸­å­˜å‚¨çš„æ˜¯è§£ç åçš„ bitmap æ•°æ®ã€‚

è€Œå›¾ç‰‡çš„è§£å‹ç¼©æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€— CPU èµ„æºçš„å·¥ä½œï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤§é‡çš„å›¾ç‰‡éœ€è¦å±•ç¤ºåˆ°åˆ—è¡¨ä¸­ï¼Œå°†ä¼šå¤§å¤§æ‹–æ…¢ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼Œé™ä½è¿è¡Œå¸§ç‡ã€‚è¿™å°±æ˜¯ UIImageView çš„ä¸€ä¸ªæ€§èƒ½ç“¶é¢ˆã€‚

<br/>
<br/>

> <h2 id = "å›¾ç‰‡çš„å¤„ç†">å›¾ç‰‡çš„å¤„ç†</h2>

<br/>

- <h3 id="å›¾ç‰‡å¼‚æ­¥ç»˜åˆ¶">å›¾ç‰‡å¼‚æ­¥ç»˜åˆ¶</h3>

```
- (void)image
{
    UIImageView *imageView = [[UIImageView alloc] init];
    imageView.frame = CGRectMake(100, 100, 100, 56);
    [self.view addSubview:imageView];
    self.imageView = imageView;
    
	//åœ¨å­çº¿ç¨‹ä¸­å¯¹å›¾ç‰‡åŸå§‹æ•°æ®è¿›è¡Œå¼ºåˆ¶è§£ç ï¼Œå†å°†è§£ç åçš„å›¾ç‰‡æŠ›å›ä¸»çº¿ç¨‹ç»§ç»­ä½¿ç”¨ï¼Œä»è€Œæé«˜ä¸»çº¿ç¨‹çš„å“åº”é€Ÿåº¦ã€‚
    dispatch_async(dispatch_get_global_queue(0, 0), ^{
        // è·å–CGImage
        CGImageRef cgImage = [UIImage imageNamed:@"timg"].CGImage;

		//+colorSpaceForImageRef: æ–¹æ³•æ¥è·å–åŸå§‹å›¾ç‰‡çš„é¢œè‰²ç©ºé—´å‚æ•°
		//CGColorSpaceRef colorspaceRef = [UIImage colorSpaceForImageRef:imageRef];
        // alphaInfo
        CGImageAlphaInfo alphaInfo = CGImageGetAlphaInfo(cgImage) & kCGBitmapAlphaInfoMask;
        BOOL hasAlpha = NO;
        if (alphaInfo == kCGImageAlphaPremultipliedLast ||
            alphaInfo == kCGImageAlphaPremultipliedFirst ||
            alphaInfo == kCGImageAlphaLast ||
            alphaInfo == kCGImageAlphaFirst) {
            hasAlpha = YES;
        }

        // bitmapInfo
        CGBitmapInfo bitmapInfo = kCGBitmapByteOrder32Host;
        bitmapInfo |= hasAlpha ? kCGImageAlphaPremultipliedFirst : kCGImageAlphaNoneSkipFirst;

        // size
        size_t width = CGImageGetWidth(cgImage);
        size_t height = CGImageGetHeight(cgImage);

        // context
        //CGBitmapContextCreate() æ–¹æ³•ï¼Œç”Ÿæˆä¸€ä¸ªç©ºç™½çš„å›¾ç‰‡ç»˜åˆ¶ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬ä¼ å…¥äº†ä¸Šè¿°çš„ä¸€äº›å‚æ•°ï¼ŒæŒ‡å®šäº†å›¾ç‰‡çš„å¤§å°ã€é¢œè‰²ç©ºé—´ã€åƒç´ æ’åˆ—ç­‰ç­‰å±æ€§
        CGContextRef context = CGBitmapContextCreate(NULL, width, height, 8, 0, CGColorSpaceCreateDeviceRGB(), bitmapInfo);

        // draw
        //CGContextDrawImage() æ–¹æ³•ï¼Œå°†æœªè§£ç çš„ imageRef æŒ‡é’ˆå†…å®¹ï¼Œå†™å…¥åˆ°æˆ‘ä»¬åˆ›å»ºçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¸ªæ­¥éª¤ï¼Œå®Œæˆäº†éšå¼çš„è§£ç å·¥ä½œã€‚
        CGContextDrawImage(context, CGRectMake(0, 0, width, height), cgImage);

        // get CGImage
        //ä» context ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ imageRefï¼Œè¿™æ˜¯è§£ç åçš„å›¾ç‰‡äº†
        cgImage = CGBitmapContextCreateImage(context);

        // into UIImage
        /*
        ä» imageRef ç”Ÿæˆä¾›UIå±‚ä½¿ç”¨çš„ UIImage å¯¹è±¡ï¼ŒåŒæ—¶æŒ‡å®šå›¾ç‰‡çš„ scale å’Œorientation ä¸¤ä¸ªå‚æ•°ã€‚

				scale æŒ‡çš„æ˜¯å›¾ç‰‡è¢«æ¸²æŸ“æ—¶éœ€è¦è¢«å‹ç¼©çš„å€æ•°ï¼Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨è¿™ä¸ªå‚æ•°å‘¢ï¼Œå› ä¸ºè‹¹æœä¸ºäº†èŠ‚çœå®‰è£…åŒ…ä½“ç§¯ï¼Œå…è®¸å¼€å‘è€…ä¸ºåŒä¸€å¼ å›¾ç‰‡ä¸Šä¼ ä¸åŒåˆ†è¾¨ç‡çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„@2xï¼Œ@3xåç¼€å›¾ç‰‡ã€‚ä¸åŒå±å¹•ç´ è´¨çš„è®¾å¤‡ï¼Œä¼šè·å–åˆ°å¯¹åº”çš„èµ„æºã€‚ä¸ºäº†ç»˜åˆ¶å›¾ç‰‡æ—¶ç»Ÿä¸€ï¼Œè¿™äº›å›¾ç‰‡ä¼šè¢«setè‡ªå·±çš„scaleå±æ€§ï¼Œæ¯”å¦‚@2xå›¾ç‰‡ï¼Œscale å€¼å°±æ˜¯2ï¼Œè™½ç„¶å’Œ1xå›¾ç‰‡çš„ç»˜åˆ¶å®½é«˜ä¸€æ ·ï¼Œä½†æ˜¯å®é™…çš„é•¿æ˜¯width * scaleã€‚

				orientation å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯å›¾ç‰‡çš„æ—‹è½¬å±æ€§ï¼Œå‘Šè¯‰è®¾å¤‡ï¼Œä»¥å“ªä¸ªæ–¹å‘ä½œä¸ºå›¾ç‰‡çš„é»˜è®¤æ–¹å‘æ¥æ¸²æŸ“ã€‚
        */
        //UIImage *newImage = [UIImage imageWithCGImage:newImageRef scale:image.scale orientation:image.imageOrientation];
	     UIImage *newImage = [UIImage imageWithCGImage:cgImage];

        // release
        CGContextRelease(context);
        CGImageRelease(cgImage);

        // back to the main thread
        dispatch_async(dispatch_get_main_queue(), ^{
            self.imageView.image = newImage;
        });
    });
}
```


<br/>

- <h3 id="å›¾ç‰‡æ ¼å¼åˆ¤æ–­">å›¾ç‰‡æ ¼å¼åˆ¤æ–­</h3>

æ ¹æ®å›¾ç‰‡ä¸åŒå‹ç¼©æ ¼å¼çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®çš„ç¼–ç ç‰¹å¾ï¼Œå°±å¯ä»¥è¿›è¡Œç®€å•çš„åˆ†ç±»äº†ï¼Œå¦‚ä¸‹Codeï¼š

```
+ (XRImageFormat)imageFormatForImageData:(nullable NSData *)data {
    if (!data) {
        return XRImageFormatUndefined;
    }
    
    uint8_t c;
    [data getBytes:&c length:1];
    switch (c) {
        case 0xFF:
            return XRImageFormatJPEG;
        case 0x89:
            return XRImageFormatPNG;
        case 0x47:
            return XRImageFormatGIF;
        case 0x49:
        case 0x4D:
            return XRImageFormatTIFF;
        case 0x52:
            if (data.length < 12) {
                return XRImageFormatUndefined;
            }
            
            NSString *testString = [[NSString alloc] initWithData:[data subdataWithRange:NSMakeRange(0, 12)] encoding:NSASCIIStringEncoding];
            if ([testString hasPrefix:@"RIFF"] && [testString hasSuffix:@"WEBP"]) {
                return XRImageFormatWebP;
            }
    }
    return XRImageFormatUndefined;
}
```



<br/>
<br/>


> <h2 id="ImageIOå›¾ç‰‡ç¼©æ”¾">ImageIOå›¾ç‰‡ç¼©æ”¾</h2>

UIImage åœ¨è®¾ç½®å’Œè°ƒæ•´å¤§å°çš„æ—¶å€™ï¼Œéœ€è¦å°†åŸå§‹å›¾åƒåŠ å‹åˆ°å†…å­˜ä¸­ï¼Œç„¶åå¯¹å†…éƒ¨åæ ‡ç©ºé—´åšä¸€ç³»åˆ—è½¬æ¢ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¼šæ¶ˆè€—å¾ˆå¤šèµ„æºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ImageIOï¼Œå®ƒå¯ä»¥ç›´æ¥è¯»å–å›¾åƒå¤§å°å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼Œä¸ä¼šå¸¦æ¥é¢å¤–çš„å†…å­˜å¼€é”€ã€‚

- Swiftä»£ç 

```
func downsample(imageAt imageURL: URL, to pointSize: CGSize, scale: CGFloat) -> UIImage {

    //ç”ŸæˆCGImageSourceRef æ—¶ï¼Œä¸éœ€è¦å…ˆè§£ç ã€‚
    let imageSourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary
    let imageSource = CGImageSourceCreateWithURL(imageURL as CFURL, imageSourceOptions)!
    let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale
    
    //kCGImageSourceShouldCacheImmediately 
    //åœ¨åˆ›å»ºThumbnailæ—¶ç›´æ¥è§£ç ï¼Œè¿™æ ·å°±æŠŠè§£ç çš„æ—¶æœºæ§åˆ¶åœ¨è¿™ä¸ªdownsampleçš„å‡½æ•°å†…
    let downsampleOptions = [kCGImageSourceCreateThumbnailFromImageAlways: true,
                                 kCGImageSourceShouldCacheImmediately: true,
                                 kCGImageSourceCreateThumbnailWithTransform: true,
                                 kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels] as CFDictionary
    //ç”Ÿæˆ
    let downsampledImage = CGImageSourceCreateThumbnailAtIndex(imageSource, 0, downsampleOptions)!
    return UIImage(cgImage: downsampledImage)
}
```



<br/>

- **OCå®ç°**

```
- (UIImage *)resizeScaleImage:(CGFloat)scale {
    
    CGSize imgSize = self.size;
    CGSize targetSize = CGSizeMake(imgSize.width * scale, imgSize.height * scale);
    NSData *imageData = UIImageJPEGRepresentation(self, 1.0);
    CFDataRef data = (__bridge CFDataRef)imageData;
    
    CFStringRef optionKeys[1];
    CFTypeRef optionValues[4];
    optionKeys[0] = kCGImageSourceShouldCache;
    optionValues[0] = (CFTypeRef)kCFBooleanFalse;
    CFDictionaryRef sourceOption = CFDictionaryCreate(kCFAllocatorDefault, (const void **)optionKeys, (const void **)optionValues, 1, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);
    CGImageSourceRef imageSource = CGImageSourceCreateWithData(data, sourceOption);
    CFRelease(sourceOption);
    if (!imageSource) {
        NSLog(@"imageSource is Null!");
        return nil;
    }
    //è·å–åŸå›¾ç‰‡å±æ€§
    int imageSize = (int)MAX(targetSize.height, targetSize.width);
    CFStringRef keys[5];
    CFTypeRef values[5];
    //åˆ›å»ºç¼©ç•¥å›¾ç­‰æ¯”ç¼©æ”¾å¤§å°ï¼Œä¼šæ ¹æ®é•¿å®½å€¼æ¯”è¾ƒå¤§çš„ä½œä¸ºimageSizeè¿›è¡Œç¼©æ”¾
    keys[0] = kCGImageSourceThumbnailMaxPixelSize;
    CFNumberRef thumbnailSize = CFNumberCreate(NULL, kCFNumberIntType, &imageSize);
    values[0] = (CFTypeRef)thumbnailSize;
    keys[1] = kCGImageSourceCreateThumbnailFromImageAlways;
    values[1] = (CFTypeRef)kCFBooleanTrue;
    keys[2] = kCGImageSourceCreateThumbnailWithTransform;
    values[2] = (CFTypeRef)kCFBooleanTrue;
    keys[3] = kCGImageSourceCreateThumbnailFromImageIfAbsent;
    values[3] = (CFTypeRef)kCFBooleanTrue;
    keys[4] = kCGImageSourceShouldCacheImmediately;
    values[4] = (CFTypeRef)kCFBooleanTrue;
    
    CFDictionaryRef options = CFDictionaryCreate(kCFAllocatorDefault, (const void **)keys, (const void **)values, 4, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);
    CGImageRef thumbnailImage = CGImageSourceCreateThumbnailAtIndex(imageSource, 0, options);
    UIImage *resultImg = [UIImage imageWithCGImage:thumbnailImage];
    
    CFRelease(thumbnailSize);
    CFRelease(options);
    CFRelease(imageSource);
    CFRelease(thumbnailImage);
    
    return resultImg;
}
```



<br/>
<br/>

> <h2 id="å›¾ç‰‡ä¸Šä¼ ">å›¾ç‰‡ä¸Šä¼ </h2>

<br/>


- ä¸Šä¼ å›¾ç‰‡æ—¶å‡ºç°çš„é—®é¢˜ï¼Ÿéœ€è¦æ³¨æ„çš„äº‹é¡¹

**äº‹é¡¹ä¸€ï¼š**ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨ä¸€èˆ¬æ˜¯å°†å›¾ç‰‡NSDataä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªå›¾ç‰‡NSStringåœ°å€ï¼Œä¹‹åå†å°†NSStringçš„è·¯å¾„è½¬ä¸ºurlå¹¶é€šè¿‡urlè¯·æ±‚å»æ›´æ–°å›¾ç‰‡ï¼ˆå›¾ç‰‡æ­¤æ—¶æ›´æ–°çš„ä¾¿æ˜¯NSStringï¼‰

ä¸Šä¼ çš„å›¾ç‰‡ä¸€èˆ¬å‹ç¼©æ–¹å¼æ˜¯ï¼š

```
NSData *eachImgData = UIImageJPEGRepresentation(image, 0.5);
```

ä½†æ˜¯ä½ å¯èƒ½ä¼šå‘ç°è¿™æ ·è®¾ç½®ä¹‹åï¼Œä¸Šä¼ è¿˜æ˜¯æ¯”è¾ƒæ…¢ï¼Œå³ä½¿æ˜¯æŠŠå‹ç¼©æ¯”ä¾‹è®¾ç½®ä¸º0.1 ç»“æœè¿˜æ˜¯ä¸€æ ·ã€‚ä½ ä¹Ÿè®¸ä¼šçœ‹åˆ°å›¾ç‰‡å¤§å°å¤§æ¦‚ä¸º200-300KB  ä¸ºä½•è¿™ä¹ˆå°äº†  è¿˜æ˜¯ä¸Šä¼ æ¯”è¾ƒæ…¢ï¼Œæˆ–è€…åŠ è½½æ¯”è¾ƒæ…¢ï¼Œè¿™æ˜¯å› ä¸ºä½ å¿½ç•¥äº†ä¸€ä¸ªå›¾ç‰‡åˆ†è¾¨ç‡çš„å‹ç¼©è¿‡ç¨‹ï¼Œæ‰€ä»¥æ­¤æ—¶ä½ è¦å‹ç¼©çš„ä¸åªæ˜¯å›¾ç‰‡å¤§å°ï¼Œè¿˜æ˜¯å›¾ç‰‡åˆ†è¾¨ç‡ã€‚å›¾ç‰‡åˆ†è¾¨ç‡å‹ç¼©ä»£ç ï¼š

```
//ç­‰æ¯”ä¾‹å‹ç¼©

+ (UIImage *) imageCompressForSize:(UIImage *)sourceImage targetSize:(CGSize)size {

Â  Â  UIImage *newImage = nil;
Â  Â  CGSize imageSize = sourceImage.size;
Â  Â  CGFloat width = imageSize.width;
Â  Â  CGFloat height = imageSize.height;

Â  Â  CGFloat targetWidth = size.width;
Â  Â  CGFloat targetHeight = size.height;
Â  Â  CGFloat scaleFactor = 0.0;

Â  Â  CGFloat scaledWidth = targetWidth;
Â  Â  CGFloat scaledHeight = targetHeight;

Â  Â  CGPoint thumbnailPoint = CGPointMake(0.0, 0.0);

	//Sizeæ˜¯å¦ç›¸ç­‰
Â  Â  if(CGSizeEqualToSize(imageSize, size) == NO){
		//å®½åº¦å› å­
Â  Â  Â  Â  CGFloat widthFactor = targetWidth / width;
Â  Â  Â  Â  CGFloat heightFactor = targetHeight / height;

Â  Â  Â  Â  if(widthFactor > heightFactor){
Â  Â  Â  Â  Â  Â  scaleFactor = widthFactor;
Â  Â  Â  Â  }
Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  Â  scaleFactor = heightFactor;
Â  Â  Â  Â  }

		//ç¼©æ”¾å®½åº¦
Â  Â  Â  Â  scaledWidth = width * scaleFactor;
Â  Â  Â  Â  scaledHeight = height * scaleFactor;

Â  Â  Â  Â  if(widthFactor > heightFactor){
			//ç¼©å›¾åæ ‡
Â  Â  Â  Â  Â  Â  thumbnailPoint.y = (targetHeight - scaledHeight) * 0.5;
Â  Â  Â  Â  }else if(widthFactor < heightFactor){
Â  Â  Â  Â  Â  Â  thumbnailPoint.x = (targetWidth - scaledWidth) * 0.5;
Â  Â  Â  Â  }

Â  Â  }

Â Â  
Â  Â  UIGraphicsBeginImageContext(size);
Â 
	  CGRect thumbnailRect = CGRectZero;
Â  Â  thumbnailRect.origin = thumbnailPoint;
Â  Â  thumbnailRect.size.width = scaledWidth;
Â  Â  thumbnailRect.size.height = scaledHeight;
Â  Â  
	[sourceImage drawInRect:thumbnailRect];

Â  Â  newImage = UIGraphicsGetImageFromCurrentImageContext();

Â  Â  if(newImage == nil){
Â  Â  Â  Â  NSLog(@"scale image fail");
Â  Â  }

Â  Â  UIGraphicsEndImageContext();

Â  Â  return newImage;
}
```
è¿™æ ·åŒé‡å‹ç¼©ï¼Œå®Œç¾è§£å†³å›¾ç‰‡å‹ç¼©é—®é¢˜ã€‚


<br/>

NSDataçš„lengthæ˜¯bytesæ ¼å¼éœ€è¦è¿›è¡Œé™¤ä»¥1024è¿›è¡Œå•ä½è½¬æ¢,æ ¼å¼åˆ¤æ–­Codeï¼š

```
- (BOOL)imgeData:(NSData *)data andImage:(UIImage *)image{
    
    double dataLength = [data length] * 1.0;
    
    NSArray *typeArray = @[@"bytes",@"KB",@"MB",@"GB",@"TB",@"PB", @"EB",@"ZB",@"YB"];
        NSInteger index = 0;
        while (dataLength > 1024) {
            dataLength /= 1024.0;
            index ++;
        }
    NSString *str = [NSString stringWithFormat:@"%.3f %@\n",dataLength,typeArray[index]];
   
    if(index >=2){
        //å¤§äº1M
        return YES;
    }
    
    if(index ==1 && dataLength > 850){
        //å¤§äº850KB
        return YES;
    }
    
    NSLog(@"str=== æ— å‹ç¼©====%@",str);
    
    return NO;
}

```

å¯¹äºéå¸¸å¤§çš„å›¾ç‰‡å’Œè§†é¢‘è¯·çœ‹[ç½‘ç»œä¼˜åŒ–(I)](https://github.com/harleyGit/StudyNotes/blob/master/Optimization/ç½‘ç»œä¼˜åŒ–(I).md)ä¸­çš„**ä¸Šä¼ ä¼˜åŒ–**ã€‚



<br/>
<br/>

> <h2 id ="ç•Œé¢ä¿æŒæµç•…">[ç•Œé¢ä¿æŒæµç•…](https://xilankong.github.io/iosæ€§èƒ½ä¼˜åŒ–/2017/10/29/iOSå¦‚ä½•ä¿æŒç•Œé¢æµç•….html)</h2>

<br/>

æ–‡æœ¬ç»˜åˆ¶

> [TextKit æœ€ä½³å®è·µ](https://juejin.cn/post/6844903621553831944)

> [CoreTextä½¿ç”¨è¯´æ˜ä¹¦](https://www.jianshu.com/p/1c3d0936bba6)


å›¾ç‰‡
> [å›¾ç‰‡è§£ç ](https://www.cnblogs.com/dins/p/ios-tu-pian.html)

Alphaï¼ˆä¸é€æ˜åº¦ï¼‰ï¼š
 - å±æ€§ä¸ºæµ®ç‚¹ç±»å‹çš„å€¼ï¼Œå–å€¼èŒƒå›´ä»0åˆ°1.0ï¼Œè¡¨ç¤ºä»å®Œå…¨é€æ˜åˆ°å®Œå…¨ä¸é€æ˜ï¼Œå…¶ç‰¹æ€§æœ‰å½“å‰UIViewçš„alphaå€¼ä¼šè¢«å…¶æ‰€æœ‰subviewç»§æ‰¿ã€‚
 - alphaå€¼ä¼šå½±å“åˆ°UIViewè·Ÿå…¶æ‰€æœ‰subviewï¼Œalphaå…·æœ‰åŠ¨ç”»æ•ˆæœã€‚
 - å½“alphaä¸º0æ—¶ï¼Œè·Ÿhiddenä¸ºYESæ—¶æ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯alphaä¸»è¦ç”¨äºå®ç°éšè—çš„åŠ¨ç”»æ•ˆæœï¼Œåœ¨åŠ¨ç”»å—ä¸­å°†hiddenè®¾ç½®ä¸ºYESæ²¡æœ‰åŠ¨ç”»æ•ˆæœã€‚


&emsp; äº‹å®ä¸Šï¼Œè§£å‹ç¼©åçš„å›¾ç‰‡å¤§å°ä¸åŸå§‹æ–‡ä»¶å¤§å°ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè€Œåªä¸å›¾ç‰‡çš„åƒç´ æœ‰å…³ï¼š
`è§£å‹ç¼©åçš„å›¾ç‰‡å¤§å°(3600) = å›¾ç‰‡çš„åƒç´ å®½(30) * å›¾ç‰‡çš„åƒç´ é«˜(30) * æ¯ä¸ªåƒç´ æ‰€å çš„å­—èŠ‚æ•°(4)`


&emsp; å½“æœªè§£å‹ç¼©çš„å›¾ç‰‡å°†è¦æ¸²æŸ“åˆ°å±å¹•æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨ä¸»çº¿ç¨‹å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ï¼Œè€Œå¦‚æœå›¾ç‰‡å·²ç»è§£å‹ç¼©äº†ï¼Œç³»ç»Ÿå°±ä¸ä¼šå†å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ã€‚å› æ­¤ï¼Œä¹Ÿå°±æœ‰äº†ä¸šå†…çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨å­çº¿ç¨‹æå‰å¯¹å›¾ç‰‡è¿›è¡Œå¼ºåˆ¶è§£å‹ç¼©ã€‚

&emsp; è€Œå¼ºåˆ¶è§£å‹ç¼©çš„åŸç†å°±æ˜¯å¯¹å›¾ç‰‡è¿›è¡Œé‡æ–°ç»˜åˆ¶ï¼Œå¾—åˆ°ä¸€å¼ æ–°çš„è§£å‹ç¼©åçš„ä½å›¾ã€‚å…¶ä¸­ï¼Œç”¨åˆ°çš„æœ€æ ¸å¿ƒçš„å‡½æ•°æ˜¯ 

```
/*

data ï¼šå¦‚æœä¸ä¸º NULL ï¼Œé‚£ä¹ˆå®ƒåº”è¯¥æŒ‡å‘ä¸€å—å¤§å°è‡³å°‘ä¸º bytesPerRow * height å­—èŠ‚çš„å†…å­˜ï¼›å¦‚æœ ä¸º NULL ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾æ‰€éœ€çš„å†…å­˜ï¼Œæ‰€ä»¥ä¸€èˆ¬æŒ‡å®š NULL å³å¯ï¼›

width å’Œ height ï¼šä½å›¾çš„å®½åº¦å’Œé«˜åº¦ï¼Œåˆ†åˆ«èµ‹å€¼ä¸ºå›¾ç‰‡çš„åƒç´ å®½åº¦å’Œåƒç´ é«˜åº¦å³å¯ï¼›

bitsPerComponent ï¼šåƒç´ çš„æ¯ä¸ªé¢œè‰²åˆ†é‡ä½¿ç”¨çš„ bit æ•°ï¼Œåœ¨ RGB é¢œè‰²ç©ºé—´ä¸‹æŒ‡å®š 8 å³å¯ï¼›

bytesPerRow ï¼šä½å›¾çš„æ¯ä¸€è¡Œä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¤§å°è‡³å°‘ä¸º width * bytes per pixel å­—èŠ‚ã€‚æœ‰æ„æ€çš„æ˜¯ï¼Œå½“æˆ‘ä»¬æŒ‡å®š 0 æ—¶ï¼Œç³»ç»Ÿä¸ä»…ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨è®¡ç®—ï¼Œè€Œä¸”è¿˜ä¼šè¿›è¡Œ cache line alignment çš„ä¼˜åŒ–ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹ what is byte alignment (cache line alignment) for Core Animation? Why it matters? å’Œ Why is my imageâ€™s Bytes per Row more than its Bytes per Pixel times its Width?

space ï¼šå°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„é¢œè‰²ç©ºé—´ï¼Œä¸€èˆ¬ä½¿ç”¨ RGB å³å¯ï¼›

bitmapInfo ï¼šå°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„ä½å›¾çš„å¸ƒå±€ä¿¡æ¯ã€‚
åˆ°è¿™é‡Œï¼Œä½ å·²ç»æŒæ¡äº†å¼ºåˆ¶è§£å‹ç¼©å›¾ç‰‡éœ€è¦ç”¨åˆ°çš„æœ€æ ¸å¿ƒçš„å‡½æ•°



*/



CG_EXTERN CGContextRef __nullable CGBitmapContextCreate(void * __nullable data,
    size_t width, size_t height, size_t bitsPerComponent, size_t bytesPerRow,
    CGColorSpaceRef cg_nullable space, uint32_t bitmapInfo)
    CG_AVAILABLE_STARTING(__MAC_10_0, __IPHONE_2_0);
```

<br/>

- Pixel Formatï¼ˆåƒç´ æ ¼å¼ï¼‰

ä½å›¾å…¶å®å°±æ˜¯ä¸€ä¸ªåƒç´ æ•°ç»„ï¼Œè€Œåƒç´ æ ¼å¼åˆ™æ˜¯ç”¨æ¥æè¿°æ¯ä¸ªåƒç´ çš„ç»„æˆæ ¼å¼ï¼Œå®ƒåŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯ï¼š

	- Bits per componentï¼šä¸€ä¸ªåƒç´ ä¸­æ¯ä¸ªç‹¬ç«‹çš„é¢œè‰²åˆ†é‡ä½¿ç”¨çš„ bit æ•°ï¼›
	- Bits per pixelï¼šä¸€ä¸ªåƒç´ ä½¿ç”¨çš„æ€» bit æ•°ï¼›
	- Bytes per rowï¼šä½å›¾ä¸­çš„æ¯ä¸€è¡Œä½¿ç”¨çš„å­—èŠ‚æ•°ã€‚
	

<br/>

- Color and Color Spacesï¼ˆé¢œè‰²ç©ºé—´ï¼‰

åœ¨ Quartz ä¸­ï¼Œä¸€ä¸ªé¢œè‰²æ˜¯ç”±ä¸€ç»„å€¼æ¥è¡¨ç¤ºçš„ï¼Œæ¯”å¦‚ (0, 0, 1)ã€‚è€Œé¢œè‰²ç©ºé—´åˆ™æ˜¯ç”¨æ¥è¯´æ˜å¦‚ä½•è§£æè¿™äº›å€¼çš„ï¼Œç¦»å¼€äº†é¢œè‰²ç©ºé—´ï¼Œå®ƒä»¬å°†å˜å¾—æ¯«æ— æ„ä¹‰ã€‚æ¯”å¦‚,ä¸‹é¢çš„å€¼éƒ½è¡¨ç¤ºè“è‰²ï¼š

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_oc0.png)


<br/>

- Color Spaces and Bitmap Layoutï¼ˆé¢œè‰²ç©ºé—´å’Œä½å›¾æ ¼å¼ï¼‰

åƒç´ æ ¼å¼æ˜¯ç”¨æ¥æè¿°æ¯ä¸ªåƒç´ çš„ç»„æˆæ ¼å¼çš„ï¼Œæ¯”å¦‚æ¯ä¸ªåƒç´ ä½¿ç”¨çš„æ€» bit æ•°ã€‚è€Œè¦æƒ³ç¡®ä¿ Quartz èƒ½å¤Ÿæ­£ç¡®åœ°è§£æè¿™äº› bit æ‰€ä»£è¡¨çš„å«ä¹‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ä½å›¾çš„å¸ƒå±€ä¿¡æ¯ CGBitmapInfoï¼š


```

typedef CF_OPTIONS(uint32_t, CGBitmapInfo) {
    kCGBitmapAlphaInfoMask = 0x1F,

    kCGBitmapFloatInfoMask = 0xF00,
    kCGBitmapFloatComponents = (1 << 8),

    kCGBitmapByteOrderMask     = kCGImageByteOrderMask,
    kCGBitmapByteOrderDefault  = (0 << 12),
    kCGBitmapByteOrder16Little = kCGImageByteOrder16Little,
    kCGBitmapByteOrder32Little = kCGImageByteOrder32Little,
    kCGBitmapByteOrder16Big    = kCGImageByteOrder16Big,
    kCGBitmapByteOrder32Big    = kCGImageByteOrder32Big
} CG_AVAILABLE_STARTING(__MAC_10_0, __IPHONE_2_0);

```





<br/>
<br/>


>## <h2 id ="å¯åŠ¨ä¼˜åŒ–">[å¯åŠ¨ä¼˜åŒ–](https://juejin.cn/post/6844904127068110862#heading-3)</h2>

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_oc3.png)


- **å†·å¯åŠ¨æµç¨‹**

&emsp; Apple å®˜æ–¹çš„ã€ŠWWDC Optimizing App Startup Timeã€‹ å°† iOS åº”ç”¨çš„å¯åŠ¨å¯åˆ†ä¸º pre-main é˜¶æ®µå’Œ main ä¸¤ä¸ªé˜¶æ®µï¼Œæœ€ä½³çš„å¯åŠ¨é€Ÿåº¦æ˜¯400msä»¥å†…ï¼Œæœ€æ…¢ä¸å¾—å¤§äº20sï¼Œå¦åˆ™ä¼šè¢«ç³»ç»Ÿè¿›ç¨‹æ€æ­»ï¼ˆæœ€ä½é…ç½®è®¾å¤‡ï¼‰ã€‚

&emsp; ä¸ºäº†æ›´å¥½çš„åŒºåˆ†ï¼Œç¬”è€…å°†æ•´ä¸ªå¯åŠ¨æµç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œ **Appæ€»å¯åŠ¨æµç¨‹ = pre-main + mainå‡½æ•°ä»£ç†ï¼ˆdidFinishLaunchingWithOptionsï¼‰+ é¦–å±æ¸²æŸ“ï¼ˆviewDidAppearï¼‰ï¼Œåä¸¤ä¸ªé˜¶æ®µéƒ½å±äº mainå‡½æ•°  æ‰§è¡Œé˜¶æ®µ**ã€‚


<br/>

[**APPçš„å¯åŠ¨æµç¨‹:**](https://www.jianshu.com/p/229dd6190b95)

```
1.iOSç³»ç»Ÿé¦–å…ˆä¼šåŠ è½½è§£æè¯¥APPçš„Info.plistæ–‡ä»¶ï¼Œå› ä¸ºInfo.plistæ–‡ä»¶ä¸­åŒ…å«äº†æ”¯æŒAPPåŠ è½½è¿è¡Œæ‰€éœ€è¦çš„ä¼—å¤šKeyï¼Œvalueé…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚APPçš„è¿è¡Œæ¡ä»¶(Required device capabilities)ï¼Œæ˜¯å¦å…¨å±ï¼ŒAPPå¯åŠ¨å›¾ä¿¡æ¯ç­‰ã€‚

2.åˆ›å»ºæ²™ç›’(iOS8åï¼Œæ¯æ¬¡å¯åŠ¨APPéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ²™ç›’è·¯å¾„)

3.æ ¹æ®Info.plistçš„é…ç½®æ£€æŸ¥ç›¸åº”æƒé™çŠ¶æ€

4.åŠ è½½Mach-Oæ–‡ä»¶è¯»å–dyldè·¯å¾„å¹¶è¿è¡ŒdyldåŠ¨æ€è¿æ¥å™¨(å†…æ ¸åŠ è½½äº†ä¸»ç¨‹åºï¼Œdyldåªä¼šè´Ÿè´£åŠ¨æ€åº“çš„åŠ è½½)
	4.1 é¦–å…ˆdyldä¼šå¯»æ‰¾åˆé€‚çš„CPUè¿è¡Œç¯å¢ƒ
	4.2 ç„¶ååŠ è½½ç¨‹åºè¿è¡Œæ‰€éœ€çš„ä¾èµ–åº“å’Œæˆ‘ä»¬è‡ªå·±å†™çš„.h.mæ–‡ä»¶ç¼–è¯‘æˆçš„.oå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å¯¹è¿™äº›åº“è¿›è¡Œé“¾æ¥ã€‚
	4.3 åŠ è½½æ‰€æœ‰æ–¹æ³•(runtimeå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™è¢«åˆå§‹åŒ–å¹¶å®ŒæˆOCçš„å†…å­˜å¸ƒå±€)
	4.4 åŠ è½½Cå‡½æ•°
	4.5 åŠ è½½categoryçš„æ‰©å±•(æ­¤æ—¶runtimeä¼šå¯¹æ‰€æœ‰ç±»ç»“æ„è¿›è¡Œåˆå§‹åŒ–)
	4.6 åŠ è½½C++é™æ€å‡½æ•°ï¼ŒåŠ è½½OC+load
	4.7 æœ€ådyldè¿”å›mainå‡½æ•°åœ°å€ï¼Œmainå‡½æ•°è¢«è°ƒç”¨
```

<br/>


**Mach-Oæ–‡ä»¶è¯´æ˜:**

&emsp; Mach-Oæ–‡ä»¶æ ¼å¼æ˜¯ OS X ä¸ iOS ç³»ç»Ÿä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œç±»ä¼¼äºwindowsçš„ PE æ–‡ä»¶ã€‚åƒæˆ‘ä»¬ç¼–è¯‘äº§ç”Ÿçš„.oæ–‡ä»¶ã€ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶å’Œå„ç§åº“ç­‰éƒ½æ˜¯Mach-Oæ–‡ä»¶ã€‚

Mach-Oæ–‡ä»¶ä¸»è¦æœ‰3éƒ¨åˆ†ç»„æˆï¼š

1).Headerï¼šä¿å­˜äº†ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†è¯¥æ–‡ä»¶è¿è¡Œçš„å¹³å°ã€æ–‡ä»¶ç±»å‹ã€LoadCommandsçš„ä¸ªæ•°ç­‰ç­‰ã€‚Headersçš„ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©ç³»ç»Ÿè¿…é€Ÿçš„å®šä½Mach-Oæ–‡ä»¶çš„è¿è¡Œç¯å¢ƒï¼Œæ–‡ä»¶ç±»å‹ã€‚ä¿å­˜äº†ä¸€äº›dyldé‡è¦çš„åŠ è½½å‚æ•°

2).LoadCommandsï¼šå¯ä»¥ç†è§£ä¸ºåŠ è½½å‘½ä»¤ï¼Œåœ¨åŠ è½½Mach-Oæ–‡ä»¶æ—¶ä¼šä½¿ç”¨è¿™é‡Œçš„æ•°æ®æ¥ç¡®å®šå†…å­˜çš„åˆ†å¸ƒä»¥åŠç›¸å…³çš„åŠ è½½å‘½ä»¤ã€‚æ¯”å¦‚æˆ‘ä»¬çš„mainå‡½æ•°çš„åŠ è½½åœ°å€ï¼Œç¨‹åºæ‰€éœ€çš„dyldçš„æ–‡ä»¶è·¯å¾„ï¼Œä»¥åŠç›¸å…³ä¾èµ–åº“çš„æ–‡ä»¶è·¯å¾„ã€‚

3).Dataï¼š æ¯ä¸€ä¸ªsegmentçš„å…·ä½“æ•°æ®éƒ½ä¿å­˜åœ¨è¿™é‡Œï¼Œè¿™é‡ŒåŒ…å«äº†å…·ä½“çš„ä»£ç ã€æ•°æ®ç­‰ç­‰ã€‚




<br/>

[**é«˜å¾·å¯åŠ¨è€—æ—¶ä¼˜åŒ–**](https://cloud.tencent.com/developer/news/616444)




<br/>


- **ä¼˜åŒ–ç‚¹**

	- åˆå¹¶åŠ¨æ€åº“ï¼Œå¹¶å‡å°‘ä½¿ç”¨ Embedded Frameworkï¼Œå³éç³»ç»Ÿåˆ›å»ºçš„åŠ¨æ€ Frameworkï¼Œå¦‚æœå¯¹åŒ…ä½“ç§¯è¦æ±‚ä¸ä¸¥æ ¼è¿˜å¯ä»¥ä½¿ç”¨é™æ€åº“ä»£æ›¿ã€‚
	
	- åˆ é™¤æ— ç”¨ä»£ç ï¼ˆæœªä½¿ç”¨çš„é™æ€å˜é‡ã€ç±»å’Œæ–¹æ³•ç­‰ï¼‰å¹¶æŠ½å–é‡å¤ä»£ç ã€‚
	
	- é¿å…åœ¨ +load æ‰§è¡Œæ–¹æ³•ï¼Œä½¿ç”¨ +initialize ä»£æ›¿ã€‚
	
	- é¿å…ä½¿ç”¨ attribute((constructor))ï¼Œå¯å°†è¦å®ç°çš„å†…å®¹æ”¾åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­é…åˆ dispatch_once ä½¿ç”¨ã€‚
	
	- å‡å°‘éåŸºæœ¬ç±»å‹çš„ C++ é™æ€å…¨å±€å˜é‡çš„ä¸ªæ•°ã€‚ï¼ˆå› ä¸ºè¿™ç±»å…¨å±€å˜é‡é€šå¸¸æ˜¯ç±»æˆ–è€…ç»“æ„ä½“ï¼Œå¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­æœ‰ç¹é‡çš„å·¥ä½œï¼Œå°±ä¼šæ‹–æ…¢å¯åŠ¨é€Ÿåº¦ï¼‰





<br/>
<br/>


> <h2 id = "UIå¡é¡¿ä¼˜åŒ–">UIå¡é¡¿ä¼˜åŒ–</h2>

å¡é¡¿çš„ä¼˜åŒ–ï¼Œå“ªå‡ ä¸ªæ–¹é¢ï¼Ÿä»å“ªå¯ä»¥æ£€æµ‹åˆ°ï¼Ÿ

- **å¡é¡¿ä¼˜åŒ–**

<br/>

**1ï¼‰. CPUä¼˜åŒ–**

- å°½é‡ç”¨è½»é‡çº§çš„å¯¹è±¡ï¼Œæ¯”å¦‚ç”¨ä¸åˆ°äº‹ä»¶å¤„ç†çš„åœ°æ–¹ä½¿ç”¨CALayerå–ä»£UIView
- å°½é‡æå‰è®¡ç®—å¥½å¸ƒå±€ï¼ˆä¾‹å¦‚cellè¡Œé«˜ï¼‰
- ä¸è¦é¢‘ç¹åœ°è°ƒç”¨å’Œè°ƒæ•´UIViewçš„ç›¸å…³å±æ€§ï¼Œæ¯”å¦‚frameã€boundsã€transformç­‰å±æ€§ï¼Œå°½é‡å‡å°‘ä¸å¿…è¦çš„è°ƒç”¨å’Œä¿®æ”¹(UIViewçš„æ˜¾ç¤ºå±æ€§å®é™…éƒ½æ˜¯CALayerçš„æ˜ å°„ï¼Œè€ŒCALayeræœ¬èº«æ˜¯æ²¡æœ‰è¿™äº›å±æ€§çš„ï¼Œéƒ½æ˜¯åˆæ¬¡è°ƒç”¨å±æ€§æ—¶é€šè¿‡resolveInstanceMethodæ·»åŠ å¹¶åˆ›å»ºDictionryä¿å­˜çš„ï¼Œè€—è´¹èµ„æº)
- Autolayoutä¼šæ¯”ç›´æ¥è®¾ç½®frameæ¶ˆè€—æ›´å¤šçš„CPUèµ„æºï¼Œå½“è§†å›¾æ•°é‡å¢é•¿æ—¶ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿
- å›¾ç‰‡çš„sizeæœ€å¥½åˆšå¥½è·ŸUIImageViewçš„sizeä¿æŒä¸€è‡´ï¼Œå‡å°‘å›¾ç‰‡æ˜¾ç¤ºæ—¶çš„å¤„ç†è®¡ç®—(é¡¹ç›®ä¸­å›¾ç‰‡å¯ä»¥é™ä½é‡‡æ ·ç‡ä½¿ç”¨ç¼©ç•¥å›¾ï¼Œé‡æ–°ç»˜åˆ¶æ‰€éœ€å›¾ç‰‡å¤§å°)
- æ§åˆ¶ä¸€ä¸‹çº¿ç¨‹çš„æœ€å¤§å¹¶å‘æ•°é‡ï¼ˆå¼€å¯å¤šä¸ªçº¿ç¨‹ä¹Ÿä¼šè€—è´¹cpuèµ„æºï¼‰
- å°½é‡æŠŠè€—æ—¶çš„æ“ä½œæ”¾åˆ°å­çº¿ç¨‹ï¼ˆé¡¹ç›®æ¯”å¦‚ï¼šå›¾ç‰‡è§£ç ã€å¤§æ•°æ®è¯»å–ã€ç½‘ç»œå¼‚æ­¥è¯·æ±‚ï¼‰
- æ–‡æœ¬å¤„ç†ï¼ˆå°ºå¯¸è®¡ç®—ã€ç»˜åˆ¶ã€CoreTextå’ŒYYTextï¼‰

- è®¡ç®—æ–‡æœ¬å®½é«˜boundingRectWithSize:options:context: å’Œæ–‡æœ¬ç»˜åˆ¶drawWithRect:options:context:æ”¾åœ¨å­çº¿ç¨‹æ“ä½œ
- ä½¿ç”¨CoreTextè‡ªå®šä¹‰æ–‡æœ¬ç©ºé—´ï¼Œåœ¨å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ä¸­å¯ä»¥ç¼“å­˜å®½é«˜ç­‰ä¿¡æ¯ï¼Œé¿å…åƒUILabel/UITextViewéœ€è¦å¤šæ¬¡è®¡ç®—(è°ƒæ•´å’Œç»˜åˆ¶éƒ½è¦è®¡ç®—ä¸€æ¬¡)ï¼Œä¸”CoreTextç›´æ¥ä½¿ç”¨äº†CoreGraphicså ç”¨å†…å­˜å°ï¼Œæ•ˆç‡é«˜ã€‚ï¼ˆYYTextï¼‰

- å›¾ç‰‡å¤„ç†ï¼ˆè§£ç ã€ç»˜åˆ¶ï¼‰
- å›¾ç‰‡éƒ½éœ€è¦å…ˆè§£ç æˆbitmapæ‰èƒ½æ¸²æŸ“åˆ°UIä¸Šï¼ŒiOSåˆ›å»ºUIImageï¼Œä¸ä¼šç«‹åˆ»è¿›è¡Œè§£ç ï¼Œåªæœ‰ç­‰åˆ°æ˜¾ç¤ºå‰æ‰ä¼šåœ¨ä¸»çº¿ç¨‹è¿›è¡Œè§£ç ï¼Œå›ºå¯ä»¥ä½¿ç”¨Core Graphicsä¸­çš„CGBitmapContextCreateç›¸å…³æ“ä½œæå‰åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œå¼ºåˆ¶è§£å‹ç¼©è·å¾—ä½å›¾(YYImage/SDWebImage/kingfisherçš„å¯¹æ¯”)

```
SDWebImageçš„ä½¿ç”¨:
 CGImageRef imageRef = image.CGImage;
        // device color space
        CGColorSpaceRef colorspaceRef = SDCGColorSpaceGetDeviceRGB();
        BOOL hasAlpha = SDCGImageRefContainsAlpha(imageRef);
        // iOS display alpha info (BRGA8888/BGRX8888)
        CGBitmapInfo bitmapInfo = kCGBitmapByteOrder32Host;
        bitmapInfo |= hasAlpha ? kCGImageAlphaPremultipliedFirst : kCGImageAlphaNoneSkipFirst;
        
        size_t width = CGImageGetWidth(imageRef);
        size_t height = CGImageGetHeight(imageRef);
        
        // kCGImageAlphaNone is not supported in CGBitmapContextCreate.
        // Since the original image here has no alpha info, use kCGImageAlphaNoneSkipLast
        // to create bitmap graphics contexts without alpha info.
        CGContextRef context = CGBitmapContextCreate(NULL,
                                                     width,
                                                     height,
                                                     kBitsPerComponent,
                                                     0,
                                                     colorspaceRef,
                                                     bitmapInfo);
        if (context == NULL) {
            return image;
        }
        
        // Draw the image into the context and retrieve the new bitmap image without alpha
        CGContextDrawImage(context, CGRectMake(0, 0, width, height), imageRef);
        CGImageRef imageRefWithoutAlpha = CGBitmapContextCreateImage(context);
        UIImage *imageWithoutAlpha = [[UIImage alloc] initWithCGImage:imageRefWithoutAlpha scale:image.scale orientation:image.imageOrientation];
        CGContextRelease(context);
        CGImageRelease(imageRefWithoutAlpha);
        
        return imageWithoutAlpha;

```



<br/>

- **GPUä¼˜åŒ–**
	- å°½é‡é¿å…çŸ­æ—¶é—´å†…å¤§é‡å›¾ç‰‡çš„æ˜¾ç¤ºï¼Œå°½å¯èƒ½å°†å¤šå¼ å›¾ç‰‡åˆæˆä¸€å¼ è¿›è¡Œæ˜¾ç¤º
	
	- GPUèƒ½å¤„ç†çš„æœ€å¤§çº¹ç†å°ºå¯¸æ˜¯4096x4096ï¼Œä¸€æ—¦è¶…è¿‡è¿™ä¸ªå°ºå¯¸ï¼Œå°±ä¼šå ç”¨CPUèµ„æºè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥çº¹ç†å°½é‡ä¸è¦è¶…è¿‡è¿™ä¸ªå°ºå¯¸

	- GPUä¼šå°†å¤šä¸ªè§†å›¾æ··åˆåœ¨ä¸€èµ·å†å»æ˜¾ç¤ºï¼Œæ··åˆçš„è¿‡ç¨‹ä¼šæ¶ˆè€—CPUèµ„æºï¼Œå°½é‡å‡å°‘è§†å›¾æ•°é‡å’Œå±‚æ¬¡

	- å‡å°‘é€æ˜çš„è§†å›¾ï¼ˆalpha<1ï¼‰ï¼Œä¸é€æ˜çš„å°±è®¾ç½®opaqueä¸ºYESï¼ŒGPUå°±ä¸ä¼šå»è¿›è¡Œalphaçš„é€šé“åˆæˆ

	- å°½é‡é¿å…å‡ºç°ç¦»å±æ¸²æŸ“

		- 	è¿™é‡Œç‰¹åˆ«è¯´ä¸‹ç¦»å±æ¸²æŸ“ï¼Œå¯¹ GPU çš„èµ„æºæ¶ˆè€—æå¤§ã€‚
		- åœ¨OpenGLä¸­ï¼ŒGPUæœ‰2ç§æ¸²æŸ“æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯å±å¹•æ¸²æŸ“ï¼ˆOn-Screen Renderingï¼‰å’Œç¦»å±æ¸²æŸ“ï¼ˆOff-Screen Renderingï¼‰ï¼ŒåŒºåˆ«åœ¨äºæ¸²æŸ“æ“ä½œæ˜¯åœ¨å½“å‰ç”¨äºæ˜¾ç¤ºçš„å±å¹•ç¼“å†²åŒºè¿›è¡Œè¿˜æ˜¯æ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“ï¼Œæ¸²æŸ“å®Œæˆåå†åœ¨å½“å‰æ˜¾ç¤ºçš„å±å¹•å±•ç¤ºã€‚
		- ç¦»å±æ¸²æŸ“æ¶ˆè€—æ€§èƒ½çš„åŸå› ï¼Œåœ¨äºéœ€è¦åˆ›å»ºæ–°çš„ç¼“å†²åŒºï¼Œå¹¶ä¸”åœ¨æ¸²æŸ“çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¤šæ¬¡åˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå…ˆæ˜¯ä»å½“å‰å±å¹•ï¼ˆOn-Screenï¼‰åˆ‡æ¢åˆ°ç¦»å±ï¼ˆOff-Screenï¼‰ï¼›ç­‰åˆ°ç¦»å±æ¸²æŸ“ç»“æŸä»¥åï¼Œå°†ç¦»å±ç¼“å†²åŒºçš„æ¸²æŸ“ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œåˆéœ€è¦å°†ä¸Šä¸‹æ–‡ç¯å¢ƒä»ç¦»å±åˆ‡æ¢åˆ°å½“å‰å±å¹•ï¼Œé€ æˆäº†èµ„æºçš„åŠå¤§å°æ¶ˆè€—ã€‚
		- ä¸€äº›ä¼šè§¦å‘ç¦»å±æ¸²æŸ“çš„æ“ä½œï¼š

			- å…‰æ …åŒ–ï¼Œlayer.shouldRasterize = YES
			
			- é®ç½©ï¼Œlayer.mask
			
			- åœ†è§’ï¼ŒåŒæ—¶è®¾ç½®layer.masksToBounds = YESã€layer.cornerRadiuså¤§äº0
			- è€ƒè™‘é€šè¿‡CoreGraphicsç»˜åˆ¶è£å‰ªåœ†è§’ï¼Œæˆ–è€…å«ç¾å·¥æä¾›åœ†è§’å›¾ç‰‡
			
			- é˜´å½±ï¼Œlayer.shadowXXX
			- å¦‚æœè®¾ç½®äº†layer.shadowPathå°±ä¸ä¼šäº§ç”Ÿç¦»å±æ¸²æŸ“


	
<br/>


- [**å¡é¡¿ç›‘æµ‹**](https://juejin.cn/post/6844904004053368846#heading-6)
	- Xcode è‡ªå¸¦ Instruments
	- å¸§ç‡FPSï¼ˆCADisplayLinkï¼‰ç›‘æµ‹
	- RunLoop ç›‘å¬



<br/>
<br/>


>## <h2 id = "å†…å­˜ä¼˜åŒ–">[**å†…å­˜ä¼˜åŒ–**](https://juejin.cn/post/6864492188404088846)</h2>

- **å†…å­˜æ³„æ¼**
	- ARCæ¨¡å¼ä¸‹ç”±äºå¾ªç¯å¼•ç”¨é€ æˆå†…å­˜æ³„æ¼ï¼Œå¯ä»¥ä½¿ç”¨**`weak`**å’Œ**`unowned`**æ¥é¿å…;
		- æé—®ï¼š [weakå’ŒunowenedåŒºåˆ«](https://hisoka0917.github.io/swift/2017/10/17/closure-unowned-weak-self/)ï¼Ÿ
			- ç­”ï¼š1ï¼‰.unownedç›¸å½“äºä»¥å‰çš„unsafe_unretainedï¼Œå½“å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œunownedå¼•ç”¨åœ°å€ä¸ä¼šè¢«æŒ‡å‘nilï¼Œè€Œæ˜¯ç»´æŒåŸå†…å­˜åœ°å€ï¼Œè€Œå®é™…ä¸Šè¯¥åœ°å€ä¸Šçš„å¯¹è±¡å·²ç»è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶å»è®¿é—®è¿™ä¸ªåœ°å€ï¼Œç¨‹åºå½“ç„¶ä¼šå´©æºƒã€‚è€Œweakçš„å¯¹è±¡åœ¨é‡Šæ”¾åä¼šæŒ‡å‘nilï¼Œè¿™æ ·ä¸ä¼šé€ æˆcrashã€‚
			- 2ï¼‰.å¦‚ä½•æ­£ç¡®é€‰æ‹©è¿™ä¸¤è€…çš„ä½¿ç”¨ï¼ŒAppleç»™æˆ‘ä»¬çš„å»ºè®®æ˜¯å¦‚æœèƒ½å¤Ÿç¡®å®šåœ¨è®¿é—®æ—¶ä¸ä¼šå·²è¢«é‡Šæ”¾çš„è¯ï¼Œå°½é‡ä½¿ç”¨ unownedï¼Œå¦‚æœå­˜åœ¨è¢«é‡Šæ”¾çš„å¯èƒ½ï¼Œé‚£å°±é€‰æ‹©ç”¨ weakã€‚
		- æé—®ï¼šweakçš„åŸç†ï¼Ÿ
			- ç­”ï¼š[weakåŸç†](http://cloverkim.com/ios_weak-principle.html)

<br/>

- **é‡æŒ‡é’ˆ**
	- å¼€å‘é˜¶æ®µå¯ä»¥é€šè¿‡å¼€å¯ç¼–è¯‘é‡Œçš„ **Zombie Objects**ï¼ˆåœ¨edit schemeçš„Runä¸­è¿›è¡Œæ‰“å¼€ï¼‰å¤ç°é—®é¢˜ï¼ŒåŸç†æ˜¯ Hook ç³»ç»Ÿçš„ dealloc æ–¹æ³•ï¼Œæ‰§è¡Œ __dealloc_zombie å°†å¯¹è±¡è¿›è¡Œåƒµå°¸åŒ–ï¼Œå¦‚æœå½“å‰å¯¹è±¡å†æ¬¡æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ™ç»ˆæ­¢ç¨‹åºå¹¶æ‰“å°å‡ºè°ƒç”¨ä¿¡æ¯ã€‚ 

<br/>

- **å›¾ç‰‡å­˜å–** 
	- å›¾ç‰‡è¯»å–
		- imageNamed ä¼šè¢«ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œé€‚ç”¨äºé¢‘ç¹ä½¿ç”¨çš„å°å›¾ç‰‡ï¼›
		- imageWithContentOfFile é€‚ç”¨äºå¤§å›¾ç‰‡ï¼ŒæŒæœ‰è€…ç”Ÿå‘½å‘¨æœŸç»“æŸåæ—¢è¢«é‡Šæ”¾ã€‚
	- ç¼©æ”¾å›¾ç‰‡ 
		- å°†å¤§å›¾ç‰‡åŠ è½½åˆ°å°ç©ºé—´æ—¶ï¼Œ UIImage ï¼ˆUIImage.contentsOfFileï¼‰éœ€è¦å…ˆè§£å‹æ•´ä¸ªå›¾åƒå†æ¸²æŸ“ï¼Œä¼šäº§ç”Ÿå†…å­˜å³°å€¼ï¼Œç”¨ [ImageIOæ¡†æ¶ æ›¿ä»£ UIImage å¯é¿å…å›¾åƒå³°å€¼](#ImageIOå›¾ç‰‡ç¼©æ”¾)ï¼ŒImageIOæ¡†æ¶ï¼ˆCGImageSourceCreateWithURLï¼‰å¯ä»¥ç›´æ¥æŒ‡å®šåŠ è½½åˆ°å†…å­˜çš„å›¾åƒå°ºå¯¸å’Œä¿¡æ¯ï¼Œçœå»äº†è§£å‹ç¼©çš„è¿‡ç¨‹ã€‚
	- åå°ä¼˜åŒ–
		-  å½“åº”ç”¨åˆ‡å…¥åå°æ—¶ï¼Œå›¾åƒé»˜è®¤è¿˜åœ¨å†…å­˜ä¸­ ï¼Œå¯ä»¥åœ¨é€€åˆ°åå°æˆ–viewæ¶ˆå¤±æ—¶ä»å†…å­˜ä¸­ç§»é™¤å›¾ç‰‡ï¼Œè¿›å…¥å‰å°æˆ–viewå‡ºç°æ—¶å†åŠ è½½å›¾ç‰‡ ï¼ˆé€šè¿‡ç›‘å¬ç³»ç»Ÿé€šçŸ¥) 
	- HEICæ ¼å¼ 
		- HEIC æ˜¯è‹¹æœæ¨å‡ºçš„ä¸“é—¨ç”¨äºå…¶ç³»ç»Ÿçš„å›¾ç‰‡æ ¼å¼ï¼ŒiOS 11ä»¥ä¸Šæ”¯æŒã€‚
		- æ®æµ‹è¯•ï¼Œç›¸åŒç”»è´¨æ¯” JPEG èŠ‚çœ 50% å†…å­˜ï¼Œä¸”æ”¯æŒä¿å­˜è¾…åŠ©å›¾ç‰‡ï¼ˆæ·±åº¦å›¾ã€è§†å·®å›¾ç­‰ï¼‰ã€‚ 

<br/>

- **OOM ç›‘æ§**
	- æŒ‡ App åœ¨å‰å°å› æ¶ˆè€—å†…å­˜è¿‡å¤§å¯¼è‡´è¢«ç³»ç»Ÿæ€æ­»ï¼Œé’ˆå¯¹è¿™ç±»é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®°å½•å‘ç”Ÿ FOOM æ—¶çš„è°ƒç”¨æ ˆã€å†…å­˜å ç”¨ç­‰ä¿¡æ¯ï¼Œä»è€Œå…·ä½“åˆ†æè§£å†³å†…å­˜å ç”¨å¤§çš„é—®é¢˜ã€‚
	- **OOMDetector(è…¾è®¯å¼€æº)**é€šè¿‡  malloc/free çš„æ›´åº•å±‚æ¥å£ malloc_logger_t è®°å½•å½“å‰å­˜æ´»å¯¹è±¡çš„å†…å­˜åˆ†é…ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿæ ¹æ®ç³»ç»Ÿçš„ backtrace_symbols å›æº¯äº†å †æ ˆä¿¡æ¯ã€‚ä¹‹åå†æ ¹æ®ä¼¸å±•æ ‘ï¼ˆSplay Treeï¼‰ç­‰åšæ•°æ®å­˜å‚¨åˆ†æï¼Œå…·ä½“æ–¹å¼å‚çœ‹è¿™ç¯‡æ–‡ç« ï¼š[iOSå¾®ä¿¡å†…å­˜ç›‘æ§](https://wetest.qq.com/lab/view/367.html)ã€‚


<br/>

- å…¶å®ƒä¼˜åŒ–
	- æ„å»ºç¼“å­˜æ—¶ä½¿ç”¨ NSCache æ›¿ä»£ NSMutableDictionary
		- NSCache æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼ˆå–æ•°æ®æ—¶éœ€è¦å…ˆåˆ¤ç©ºï¼‰ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ countLimit å’Œ totalCostLimit å±æ€§è®¾ç½®ä¸Šé™ï¼Œå¦å¤–å¯¹å­˜åœ¨ Compressed Memory æƒ…å†µä¸‹çš„å†…å­˜è­¦å‘Šä¹Ÿåšäº†ä¼˜åŒ–ï¼Œè¿™äº›éƒ½æ˜¯ NSDictionary ä¸å…·å¤‡çš„ã€‚
	- ä¸è¦å°†åºåˆ—åŒ–çš„æ•°æ®æ–‡ä»¶å½“ä½œæ•°æ®åº“ä½¿ç”¨
		- Plistsã€XMLã€JSONç­‰æ–‡ä»¶ä¿®æ”¹éƒ½å¿…é¡»æ›¿æ¢æ•´ä¸ªæ–‡ä»¶ï¼Œæ‹“å±•æ€§å·®ï¼Œä¸”å¼€é”€å¤§ï¼Œå®¹æ˜“è¯¯ç”¨
		- NSUserDefaultsé»˜è®¤æ˜¯Plist







<br/>
<br/>




>## <h2 id = "åŒ…ä½“ç§¯ä¼˜åŒ–">[åŒ…ä½“ç§¯ä¼˜åŒ–](https://juejin.cn/post/6844904169938092045)</h3>

<br/>

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_oc1.png)


- **èµ„æºç˜¦èº«**
	
	<br/>
	
- ç§»é™¤æ— ç”¨å›¾ç‰‡èµ„æº

&emspï¼› è¿™é‡Œæ¨èä½¿ç”¨å·¥å…· [LSUnusedResources](https://github.com/tinymind/LSUnusedResources)ï¼Œå¯ä»¥æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µå®šä¹‰æŸ¥æ‰¾æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦å¤–å»ºè®®å‹¾é€‰ Ignore similar name ï¼Œé¿å…æ‰«æå‡ºå›¾ç‰‡ç»„ã€‚


![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_oc2.png)


<br/>

- å‹ç¼©å›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶


&emsp; å»ºè®®ä½¿ç”¨æ— æŸå‹ç¼©ï¼Œä¾‹å¦‚ ImageOptimã€pngquantå‘½ä»¤ã€tinypng ï¼Œå¦‚æœæ¶‰åŠæœ‰æŸå‹ç¼©æœ€å¥½è¦æ±‚è®¾è®¡ä»‹å…¥è¿›è¡Œèµ„æºæ£€æŸ¥ã€‚


&emsp; è¿˜å¯ä»¥ä½¿ç”¨ Webp æ ¼å¼çš„å›¾ç‰‡ï¼ŒWebp æ˜¯ç”± Google æ¨å‡ºçš„å›¾ç‰‡æ ¼å¼ï¼Œæœ‰æŸå‹ç¼©æ¨¡å¼ä¸‹å›¾ç‰‡ä½“ç§¯åªæœ‰ jpeg æ ¼å¼çš„ 1/3ï¼Œæ— æŸå‹ç¼©ä¹Ÿèƒ½å‡å° 1/4ï¼Œå¯ä»¥ä½¿ç”¨ cwebp è¿›è¡Œæ ¼å¼å‹ç¼©è½¬æ¢ï¼Œç›®å‰ SDWebImageã€Kingfisher éƒ½ç”¨æ”¯æŒè¯¥æ ¼å¼è§£æçš„æ‹“å±•ã€‚æ— æŸå‹ç¼©å‘½ä»¤å¦‚ä¸‹ï¼š

```
// è¯­æ³•
cwebp [options] input_file -o output_file.webp
// æ— æŸå‹ç¼©
cwebp -lossless original.png -o new.webp
å¤åˆ¶ä»£ç 
é™¤äº†ç»ˆç«¯å‘½ä»¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ iSparta è¿›è¡Œæ‰¹é‡è½¬æ¢æ ¼å¼ã€‚
```


<br/>

- Xcode æœ¬èº«ä¹Ÿæä¾›å‹ç¼©å›¾ç‰‡çš„ç¼–è¯‘é€‰é¡¹
	- Compress PNG Files
æ‰“åŒ…çš„æ—¶å€™åŸºäº pngcrush å·¥å…·è‡ªåŠ¨å¯¹å›¾ç‰‡è¿›è¡Œæ— æŸå‹ç¼©ï¼Œå¦‚æœæˆ‘ä»¬å·²è‡ªè¡Œå¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œè¯¥é€‰é¡¹æœ€å¥½å…³é—­ã€‚
	
	- Remove Text Medadata From PNG Files
ç§»é™¤ PNG èµ„æºçš„æ–‡æœ¬å­—ç¬¦ï¼Œæ¯”å¦‚å›¾åƒåç§°ã€ä½œè€…ã€ç‰ˆæƒã€åˆ›ä½œæ—¶é—´ã€æ³¨é‡Šç­‰ä¿¡æ¯ã€‚

***


<br/>

- **åˆ é™¤é‡å¤æ–‡ä»¶**

&emsp; é€šè¿‡æ ¡éªŒæ‰€æœ‰èµ„æºçš„ MD5ï¼Œç­›é€‰å‡ºé¡¹ç›®ä¸­çš„é‡å¤èµ„æºï¼Œæ¨èä½¿ç”¨ fdupes å·¥å…·è¿›è¡Œé‡å¤æ–‡ä»¶æ‰«æï¼Œ[fdupes ](https://github.com/adrianlopezroche/fdupes)æ˜¯ Linux å¹³å°çš„ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”± C è¯­è¨€ç¼–å†™ ï¼Œæ–‡ä»¶æ¯”è¾ƒé¡ºåºæ˜¯`å¤§å°å¯¹æ¯” > éƒ¨åˆ† MD5 ç­¾åå¯¹æ¯” > å®Œæ•´ MD5 ç­¾åå¯¹æ¯” > é€å­—èŠ‚å¯¹æ¯”`ã€‚

é€šè¿‡ `Homebrew å®‰è£… fdupesï¼š`

```
brew install fdupes

```

æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶å¤¹ä¸‹çš„é‡å¤æ–‡ä»¶ï¼š

```
fdupes -Sr æ–‡ä»¶å¤¹   // æŸ¥çœ‹æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰å­ç›®å½•ä¸­çš„é‡å¤æ–‡ä»¶åŠå¤§å°
fdupes -Sr æ–‡ä»¶å¤¹ > è¾“å‡ºåœ°å€.txt  // å°†ä¿¡æ¯è¾“å‡ºåˆ°txtæ–‡ä»¶ä¸­
```

è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç›¸åŒæ–‡ä»¶ä»…ä¿ç•™ä¸€ä»½ï¼Œä¿®æ”¹å¯¹åº”çš„å¼•ç”¨å³å¯ã€‚

```
4474 bytes each:
Test/Images.xcassets/TabBarImage/tabBar_2.imageset/tabBar_2@2x.png
Test/Resource/TabBarImage/tabBar_2@2x.png

3912 bytes each:
Test/Images.xcassets/TabBarImage/tabBar_3.imageset/tabBar_3@2x.png
Test/Resource/TabBarImage/tabBar_3@2x.png
```





<br/>
<br/>


> <h2 id ="å†…å­˜æš´æ¶¨è§£å†³">å†…å­˜æš´æ¶¨è§£å†³</h2>

&emsp; åœ¨åˆ—è¡¨æ»‘åŠ¨çš„æƒ…å†µå†…å­˜è«åçš„å¢é•¿ï¼Œé¢‘ç¹è®¿é—®å›¾ç‰‡çš„æ—¶å€™å†…å­˜è«åçš„å¢é•¿ï¼Œé¢‘ç¹çš„æ‰“å¼€å’Œå…³é—­æ•°æ®åº“çš„æ—¶å€™å†…å­˜è«åçš„å¢é•¿â€¦â€¦ã€‚ è¿™äº›éƒ½æ˜¯æ‹œiOSçš„autoreleaseæœºåˆ¶æ‰€èµï¼›å…·ä½“åˆ†æå¦‚ä¸‹ï¼š

1.æ»‘åŠ¨åˆ—è¡¨çš„æ—¶å€™ï¼Œå†…å­˜å‡ºç°è«åçš„å¢é•¿ï¼ŒåŸå› å¯èƒ½æœ‰å¦‚ä¸‹å¯èƒ½ï¼š

	a. æ²¡æœ‰ä½¿ç”¨UITableViewçš„reuseæœºåˆ¶ï¼› å¯¼è‡´æ¯æ˜¾ç¤ºä¸€ä¸ªcelléƒ½ç”¨autoreleaseçš„æ–¹å¼é‡æ–°allocä¸€æ¬¡ï¼›å¯¼è‡´cellçš„å†…å­˜ä¸æ–­çš„å¢åŠ ï¼›

	b. æ¯ä¸ªcellä¼šæ˜¾ç¤ºä¸€ä¸ªå•ç‹¬çš„UIViewï¼Œ åœ¨UIViewå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œå¯¼è‡´cellçš„å†…å­˜ä¸æ–­å¢é•¿ï¼›


<br/>

2.é¢‘ç¹è®¿é—®å›¾ç‰‡çš„æ—¶å€™ï¼Œå†…å­˜è«åçš„å¢é•¿ï¼›

&emsp; é¢‘ç¹çš„è®¿é—®ç½‘ç»œå›¾ç‰‡ï¼Œå¯¼è‡´iOSå†…éƒ¨APIï¼Œä¼šä¸æ–­çš„åˆ†é…autoreleaseæ–¹å¼çš„bufferæ¥å¤„ç†å›¾ç‰‡çš„è§£ç ä¸æ˜¾ç¤ºï¼› åˆ©ç”¨å›¾ç‰‡NSCacheå¯ä»¥ç¼“è§£ä¸€ä¸‹æ­¤é—®é¢˜ï¼›

**NSCacheä½¿ç”¨ï¼š**

```
// åˆ›å»ºå¯¹è±¡
NSCache *cache = [[NSCache alloc] init];
// è®¾ç½®ç¼“å­˜æ•°é‡é™åˆ¶ï¼Œé»˜è®¤å€¼æ˜¯ 0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶
cache.countLimit = 10;
// è®¾ç½®ç¼“å­˜æ€»æˆæœ¬é™åˆ¶ï¼Œé»˜è®¤å€¼æ˜¯ 0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶
cache.totalCostLimit = 1024 * 1024;
// è®¾ç½®æ˜¯å¦è‡ªåŠ¨æ¸…ç†ç¼“å­˜ï¼Œé»˜è®¤ä¸º YESï¼Œè¡¨ç¤ºè‡ªåŠ¨æ¸…ç†
cache.evictsObjectsWithDiscardedContent = YES;
// è®¾ç½®ä»£ç†
cache.delegate = self;
// è®¾ç½®ç¼“å­˜
/*
	0 æˆæœ¬ï¼Œä¸å¯å˜å­—å…¸ä¸åŒï¼Œç¼“å­˜å¯¹è±¡ä¸ä¼šå¯¹é”®ååš copy æ“ä½œï¼Œåªæ˜¯åšå¼ºå¼•ç”¨
*/
[cache setObject:str forKey:@(i)];
// è®¾ç½®ç¼“å­˜
/*
	æŒ‡å®šæˆæœ¬
*/
[cache setObject:str forKey:@(i) cost:1024];
// æŸ¥çœ‹ç¼“å­˜å†…å®¹
/*
	NSCache æ²¡æœ‰æä¾›éå†çš„æ–¹æ³•ï¼Œåªæ”¯æŒç”¨ key æ¥å–å€¼ï¼ŒNSCache çš„ Key åªæ˜¯åšå¼ºå¼•ç”¨ï¼Œä¸éœ€è¦å®ç° NSCopying åè®®
*/
NSString *string = [cache objectForKey:@(i)];
// åˆ é™¤æŒ‡å®šç¼“å­˜
[cache removeObjectForKey:@8];
// åˆ é™¤æ‰€æœ‰ç¼“å­˜
/*
	ä¸€æ—¦è°ƒç”¨äº† removeAllObjectsï¼Œå°±æ— æ³•ç»™ cache æ·»åŠ å¯¹è±¡ï¼Œå…³äº NSCache çš„å†…å­˜ç®¡ç†ï¼Œäº¤ç»™ä»–è‡ªå·±å°±è¡Œ
*/
[cache removeAllObjects];
// ç¼“å­˜åè®®æ–¹æ³•
/*
	é¡»éµå®ˆ <NSCacheDelegate> åè®®ï¼Œobj å°±æ˜¯è¦è¢«æ¸…ç†çš„å¯¹è±¡
	å½“ç¼“å­˜ä¸­çš„å¯¹è±¡è¢«æ¸…é™¤çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œä¸å»ºè®®å¹³æ—¶å¼€å‘æ—¶é‡å†™ï¼ä»…ä¾›è°ƒè¯•ä½¿ç”¨
*/
- (void)cache:(NSCache *)cache willEvictObject:(id)obj {
}
	
```

 
<br/>


3.é¢‘ç¹æ‰“å¼€å’Œå…³é—­SQLiteï¼Œå¯¼è‡´å†…å­˜ä¸æ–­çš„å¢é•¿ï¼›

&emsp; åœ¨è¿›è¡ŒSQLiteé¢‘ç¹æ‰“å¼€å’Œå…³é—­æ“ä½œï¼Œè€Œä¸”è¯»å†™çš„æ•°æ®bufferè¾ƒå¤§ï¼Œé‚£ä¹ˆSQLiteåœ¨æ¯æ¬¡æ‰“å¼€ä¸å…³é—­çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ©ç”¨autoreleaseçš„æ–¹å¼åˆ†é…51Kçš„å†…å­˜ï¼› å¦‚æœè®¿é—®æ¬¡æ•°å¾ˆå¤šï¼Œå†…å­˜é©¬ä¸Šå°±ä¼šé¡¶åˆ°å‡ åå…†ï¼Œç”šè‡³ä¸Šç™¾å…†ï¼ æ‰€ä»¥é’ˆå¯¹é¢‘ç¹çš„è¯»å†™æ•°æ®åº“ä¸”æ•°æ®bufferè¾ƒå¤§çš„æƒ…å†µï¼Œ å¯ä»¥è®¾ç½®SQLiteçš„é•¿è¿æ¥æ–¹å¼ï¼›é¿å…é¢‘ç¹çš„æ‰“å¼€å’Œå…³é—­æ•°æ®åº“ï¼›

**SQLiteæ“ä½œå°è£…-é•¿è¿æ¥æ–¹å¼**

```
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SQLite;
using System.IO;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
 
namespace Acon.UrineAnalyzerPlatform.DataAccess
{
    /// <summary>
    /// SQLiteæ•°æ®åº“æ“ä½œç±»ï¼Œé•¿è¿æ¥æ¨¡å¼
    /// </summary>
    public sealed class SQLiteHelper
    {
        public static string ConnectionString { get; set; }
 
        private static SQLiteConnection Connection;
 
        static SQLiteHelper()
        {
            string fileName = Path.Combine(Application.StartupPath, @"Data\\UrineMachine.db");
            ConnectionString = string.Format("Data Source={0};{1}", fileName, ";foreign keys=true;");
        }
 
        #region é™æ€æ–¹æ³•
 
        private static SQLiteConnection CreateConnection()
        {
            if (Connection == null)
                Connection = new SQLiteConnection(ConnectionString);
            
            return Connection;
        }
 
        public static SQLiteTransaction GetTransaction()
        {
            return CreateConnection().BeginTransaction();
        }
 
        private static void PrepareCommand(SQLiteCommand command, SQLiteConnection connection, SQLiteTransaction transaction, CommandType commandType, string commandText, SQLiteParameter[] parms)
        {
            if (connection.State != ConnectionState.Open) connection.Open();
 
            command.Connection = connection;
            //command.CommandTimeout = CommandTimeOut;
            // è®¾ç½®å‘½ä»¤æ–‡æœ¬(å­˜å‚¨è¿‡ç¨‹åæˆ–SQLè¯­å¥)
            command.CommandText = commandText;
            // åˆ†é…äº‹åŠ¡
            if (transaction != null)
            {
                command.Transaction = transaction;
            }
            // è®¾ç½®å‘½ä»¤ç±»å‹.
            command.CommandType = commandType;
            if (parms != null && parms.Length > 0)
            {
                //é¢„å¤„ç†SqlParameterå‚æ•°æ•°ç»„ï¼Œå°†ä¸ºNULLçš„å‚æ•°èµ‹å€¼ä¸ºDBNull.Value;
                foreach (SQLiteParameter parameter in parms)
                {
                    if ((parameter.Direction == ParameterDirection.InputOutput || parameter.Direction == ParameterDirection.Input) && (parameter.Value == null))
                    {
                        parameter.Value = DBNull.Value;
                    }
                }
                command.Parameters.AddRange(parms);
            }
        }
 
        #region ExecuteNonQuery
        public static int ExecuteNonQuery(string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteNonQuery(CreateConnection(), commandText, parms);
        }
   
        public static int ExecuteNonQuery(SQLiteConnection connection, string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteNonQuery(connection, CommandType.Text, commandText, parms);
        }
 
        /// <summary>
        /// æ‰§è¡ŒSQLè¯­å¥,è¿”å›å½±å“çš„è¡Œæ•°
        /// </summary>
        /// <param name="connection">æ•°æ®åº“è¿æ¥</param>
        /// <param name="commandType">å‘½ä»¤ç±»å‹(å­˜å‚¨è¿‡ç¨‹,å‘½ä»¤æ–‡æœ¬, å…¶å®ƒ.)</param>
        /// <param name="commandText">SQLè¯­å¥æˆ–å­˜å‚¨è¿‡ç¨‹åç§°</param>
        /// <param name="parms">æŸ¥è¯¢å‚æ•°</param>
        /// <returns>è¿”å›å½±å“çš„è¡Œæ•°</returns>
        public static int ExecuteNonQuery(SQLiteConnection connection, CommandType commandType, string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteNonQuery(connection, null, commandType, commandText, parms);
            //try
            //{
            //    return ExecuteNonQuery(connection, null, commandType, commandText, parms);
            //}
            //finally
            //{
            //    connection.Close();
            //}
        }
 
        /// <summary>
        /// æ‰§è¡ŒSQLè¯­å¥,è¿”å›å½±å“çš„è¡Œæ•°
        /// </summary>
        /// <param name="transaction">äº‹åŠ¡</param>
        /// <param name="commandType">å‘½ä»¤ç±»å‹(å­˜å‚¨è¿‡ç¨‹,å‘½ä»¤æ–‡æœ¬, å…¶å®ƒ.)</param>
        /// <param name="commandText">SQLè¯­å¥æˆ–å­˜å‚¨è¿‡ç¨‹åç§°</param>
        /// <param name="parms">æŸ¥è¯¢å‚æ•°</param>
        /// <returns>è¿”å›å½±å“çš„è¡Œæ•°</returns>
        public static int ExecuteNonQuery(SQLiteTransaction transaction, CommandType commandType, string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteNonQuery(transaction.Connection, transaction, commandType, commandText, parms);
 
        }
 
        /// <summary>
        /// æ‰§è¡ŒSQLè¯­å¥,è¿”å›å½±å“çš„è¡Œæ•°
        /// </summary>
        /// <param name="connection">æ•°æ®åº“è¿æ¥</param>
        /// <param name="transaction">äº‹åŠ¡</param>
        /// <param name="commandType">å‘½ä»¤ç±»å‹(å­˜å‚¨è¿‡ç¨‹,å‘½ä»¤æ–‡æœ¬, å…¶å®ƒ.)</param>
        /// <param name="commandText">SQLè¯­å¥æˆ–å­˜å‚¨è¿‡ç¨‹åç§°</param>
        /// <param name="parms">æŸ¥è¯¢å‚æ•°</param>
        /// <returns>è¿”å›å½±å“çš„è¡Œæ•°</returns>
        private static int ExecuteNonQuery(SQLiteConnection connection, SQLiteTransaction transaction, CommandType commandType, string commandText, params SQLiteParameter[] parms)
        {
            SQLiteCommand command = new SQLiteCommand();
            PrepareCommand(command, connection, transaction, commandType, commandText, parms);
            int retval = command.ExecuteNonQuery();
            command.Parameters.Clear();
            return retval;
        }
 
        #endregion ExecuteNonQuery
 
        #region ExecuteScalar
        /// <summary>
        /// æ‰§è¡ŒSQLè¯­å¥,è¿”å›ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—
        /// </summary>
        /// <param name="connectionString">æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²</param>
        /// <param name="commandText">SQLè¯­å¥</param>
        /// <param name="parms">æŸ¥è¯¢å‚æ•°</param>
        /// <returns>è¿”å›ç»“æœé›†ä¸­çš„ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—</returns>
        public static object ExecuteScalar(string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteScalar(CreateConnection(), commandText, parms);
        }
 
        public static object ExecuteScalar(SQLiteConnection connection, string commandText, SQLiteParameter[] parms)
        {
            return ExecuteScalar(connection, CommandType.Text, commandText, parms);
        }
 
        public static object ExecuteScalar(SQLiteConnection connection, CommandType commandType, string commandText, SQLiteParameter[] parms)
        {
            SQLiteCommand command = new SQLiteCommand();
            PrepareCommand(command, connection, null, commandType, commandText, parms);
            object retval = command.ExecuteScalar();
            command.Parameters.Clear();
            return retval;
        }
 
 
        #endregion
 
        #region ExecuteDataSet
        public static DataSet ExecuteDataSet(string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteDataSet(CreateConnection(), commandText, parms);
        }
 
        public static DataSet ExecuteDataSet(SQLiteConnection connection, string commandText, SQLiteParameter[] parms)        {
            return ExecuteDataSet(connection, CommandType.Text, commandText, parms);
        }
 
        public static DataSet ExecuteDataSet(SQLiteConnection connection, CommandType commandType, string commandText, SQLiteParameter[] parms)
        {
            return ExecuteDataSet(connection, null, commandType, commandText, parms);
        }
 
        /// <summary>
        /// æ‰§è¡ŒSQLè¯­å¥,è¿”å›ç»“æœé›†
        /// </summary>
        /// <param name="transaction">äº‹åŠ¡</param>
        /// <param name="commandType">å‘½ä»¤ç±»å‹(å­˜å‚¨è¿‡ç¨‹,å‘½ä»¤æ–‡æœ¬, å…¶å®ƒ.)</param>
        /// <param name="commandText">SQLè¯­å¥æˆ–å­˜å‚¨è¿‡ç¨‹åç§°</param>
        /// <param name="parms">æŸ¥è¯¢å‚æ•°</param>
        /// <returns>è¿”å›ç»“æœé›†</returns>
        public static DataSet ExecuteDataSet(SQLiteTransaction transaction, CommandType commandType, string commandText, params SQLiteParameter[] parms)
        {
            return ExecuteDataSet(transaction.Connection, transaction, commandType, commandText, parms);
        }
 
        private static DataSet ExecuteDataSet(SQLiteConnection connection, SQLiteTransaction transaction, CommandType commandType, string commandText, SQLiteParameter[] parms)
        {
            SQLiteCommand command = new SQLiteCommand();
            PrepareCommand(command, connection, transaction, commandType, commandText, parms);
            SQLiteDataAdapter adapter = new SQLiteDataAdapter(command);
            DataSet ds = new DataSet();
            adapter.Fill(ds);
            command.Parameters.Clear();
            return ds;
        }
        #endregion
 
        #endregion é™æ€æ–¹æ³•
 
        public static void Close()
        {
            if (Connection != null && Connection.State == ConnectionState.Open)
            {
                Connection.Close();
                System.Data.SQLite.SQLiteConnection.ClearPool(Connection);//æ¸…é™¤è¿æ¥æ± ï¼Œå¦åˆ™æ•°æ®åº“æ–‡ä»¶ä¸ä¼šè¢«é‡Šæ”¾ã€‚
            }
        }
    }
}


```



<br/>
<br/>

> <h2 id = "æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–">æ–‡ä»¶å­˜å‚¨ä¼˜åŒ–</h2>

<br/>

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_oc3.png)


- Documentsï¼šä¿å­˜åº”ç”¨è¿è¡Œæ—¶ç”Ÿæˆçš„éœ€è¦æŒä¹…åŒ–çš„æ•°æ®,iTunesä¼šè‡ªåŠ¨å¤‡ä»½è¯¥ç›®å½•ã€‚è‹¹æœå»ºè®®å°†åœ¨åº”ç”¨ç¨‹åºä¸­æµè§ˆåˆ°çš„æ–‡ä»¶æ•°æ®ä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹ã€‚

- tmpï¼šä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œåœ¨ç¨‹åºé‡æ–°è¿è¡Œçš„æ—¶å€™ï¼Œå’Œå¼€æœºçš„æ—¶å€™ï¼Œä¼šæ¸…ç©ºtmpæ–‡ä»¶å¤¹ã€‚

- Library:
	- Cachesï¼šä¸€èˆ¬å­˜å‚¨çš„æ˜¯ç¼“å­˜æ–‡ä»¶ï¼Œä¾‹å¦‚å›¾ç‰‡è§†é¢‘ç­‰ï¼Œæ­¤ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸ä¼šå†åº”ç”¨ç¨‹åºé€€å‡ºæ—¶åˆ é™¤ã€‚åœ¨æ‰‹æœºå¤‡ä»½çš„æ—¶å€™ï¼ŒiTunesä¸ä¼šå¤‡ä»½è¯¥ç›®å½•ã€‚ä¾‹å¦‚:éŸ³é¢‘,è§†é¢‘ç­‰æ–‡ä»¶å­˜æ”¾å…¶ä¸­
	- Preferencesï¼šä¿å­˜åº”ç”¨ç¨‹åºçš„æ‰€æœ‰åå¥½è®¾ç½®iOSçš„Settings(è®¾ç½®)ï¼Œæˆ‘ä»¬ä¸åº”è¯¥ç›´æ¥åœ¨è¿™é‡Œåˆ›å»ºæ–‡ä»¶ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡NSUserDefaultè¿™ä¸ªç±»æ¥è®¿é—®åº”ç”¨ç¨‹åºçš„åå¥½è®¾ç½®ã€‚iTunesä¼šè‡ªåŠ¨å¤‡ä»½è¯¥æ–‡ä»¶ç›®å½•ä¸‹çš„å†…å®¹ã€‚æ¯”å¦‚è¯´:æ˜¯å¦å…è®¸è®¿é—®å›¾ç‰‡,æ˜¯å¦å…è®¸è®¿é—®åœ°ç†ä½ç½®......






<br/>

***
<br/>




># <h1 id = "æ¶æ„ä¸è®¾è®¡æ¨¡å¼">æ¶æ„ä¸è®¾è®¡æ¨¡å¼</h1>

<br/>

- [å¼€å‘æ¶æ„è®¾è®¡æ€è€ƒ](https://www.jianshu.com/p/1e1009ba061c)
- [ç»„ä»¶åŒ–å¼€å‘å®æ–½](https://www.jianshu.com/p/599e97b63af7)
- [ç»„ä»¶ä¼˜åŒ–](https://casatwy.com/iOS-Modulization.html?hmsr=toutiao.io)


<br/>
<br/>

>## <h2 id="MVCå’ŒMVVM">[MVCå’ŒMVVM](https://github.com/harleyGit/StudyNotes/blob/master/iOS/ProjectDesc/MVCå’ŒMVVM.md)</h2>


<br/>
<br/>

>## <h2 id="å•ä¾‹ç±»">[**å•ä¾‹ç±»**](https://github.com/harleyGit/StudyNotes/blob/master/iOS/ProjectDesc/å•ä¾‹ç±».md)</h2>

<br/>
<br/>

>## <h2 id="åè®®ä»£ç†">[**åè®®ä»£ç†**](https://github.com/harleyGit/StudyNotes/blob/master/iOS/ProjectDesc/åè®®ä»£ç†.md)</h2>

<br/>
<br/>

>## <h2 id="KVCå’ŒKVO">[**KVCå’ŒKVO**](https://github.com/harleyGit/StudyNotes/blob/master/iOS/ProjectDesc/KVCå’ŒKVO.md)</h2>











<br/>

***
<br/>


># <h1 id = "åº•å±‚">åº•å±‚</h1>

<br/>

>## <h2 id = "Runloop">[Runloop](https://www.jianshu.com/p/e29f846d8a97)</h2>
[Run Loop åŸç†è¯¦è§£](http://chuquan.me/2018/10/06/understand-ios-runloop/)

<br/>


> <h3 id ="Runloopåº•å±‚åŸç†">Runloopåº•å±‚åŸç†</h3>
[Runloopè¯¦è§£](https://imlifengfeng.github.io/article/487/)


[**Runloopåº•å±‚åŸç†**](https://juejin.cn/post/6844903604965523464#heading-11)ï¼Œ[**CFRunLoopå¼€æºä»£ç **](http://opensource.apple.com/source/CF/CF-855.17/)


Runloop æºç ï¼š

```
void CFRunLoopRun(void) {	/* DOES CALLOUT */
    int32_t result;
    do {
        result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false);
        CHECK_FOR_FORK();
    } while (kCFRunLoopRunStopped != result && kCFRunLoopRunFinished != result);
}

```


&emsp; æˆ‘ä»¬å‘ç°RunLoopç¡®å®æ˜¯do whileé€šè¿‡åˆ¤æ–­resultçš„å€¼å®ç°çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠRunLoopçœ‹æˆä¸€ä¸ªæ­»å¾ªç¯ã€‚å¦‚æœæ²¡æœ‰RunLoopï¼ŒUIApplicationMainå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åå°†ç›´æ¥è¿”å›ï¼Œä¹Ÿå°±æ²¡æœ‰ç¨‹åºæŒç»­è¿è¡Œä¸€è¯´äº†ã€‚
æ‰§è¡Œé¡ºåºçš„ä¼ªä»£ç ï¼š

```

int32_t __CFRunLoopRun()
{
    // é€šçŸ¥å³å°†è¿›å…¥runloop
    __CFRunLoopDoObservers(KCFRunLoopEntry);
    
    do
    {
        // é€šçŸ¥å°†è¦å¤„ç†timerå’Œsource
        __CFRunLoopDoObservers(kCFRunLoopBeforeTimers);
        __CFRunLoopDoObservers(kCFRunLoopBeforeSources);
        
        // å¤„ç†éå»¶è¿Ÿçš„ä¸»çº¿ç¨‹è°ƒç”¨
        __CFRunLoopDoBlocks();
        // å¤„ç†Source0äº‹ä»¶
        __CFRunLoopDoSource0();
        
        if (sourceHandledThisLoop) {
            __CFRunLoopDoBlocks();
         }
        /// å¦‚æœæœ‰ Source1 (åŸºäºport) å¤„äº ready çŠ¶æ€ï¼Œç›´æ¥å¤„ç†è¿™ä¸ª Source1 ç„¶åè·³è½¬å»å¤„ç†æ¶ˆæ¯ã€‚
        if (__Source0DidDispatchPortLastTime) {
            Boolean hasMsg = __CFRunLoopServiceMachPort();
            if (hasMsg) goto handle_msg;
        }
            
        /// é€šçŸ¥ Observers: RunLoop çš„çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ (sleep)ã€‚
        if (!sourceHandledThisLoop) {
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting);
        }
            
        // GCD dispatch main queue
        CheckIfExistMessagesInMainDispatchQueue();
        
        // å³å°†è¿›å…¥ä¼‘çœ 
        __CFRunLoopDoObservers(kCFRunLoopBeforeWaiting);
        
        // ç­‰å¾…å†…æ ¸mach_msgäº‹ä»¶
        mach_port_t wakeUpPort = SleepAndWaitForWakingUpPorts();
        
        // ç­‰å¾…ã€‚ã€‚ã€‚
        
        // ä»ç­‰å¾…ä¸­é†’æ¥
        __CFRunLoopDoObservers(kCFRunLoopAfterWaiting);
        
        // å¤„ç†å› timerçš„å”¤é†’
        if (wakeUpPort == timerPort)
            __CFRunLoopDoTimers();
        
        // å¤„ç†å¼‚æ­¥æ–¹æ³•å”¤é†’,å¦‚dispatch_async
        else if (wakeUpPort == mainDispatchQueuePort)
            __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__()
            
        // å¤„ç†Source1
        else
            __CFRunLoopDoSource1();
        
        // å†æ¬¡ç¡®ä¿æ˜¯å¦æœ‰åŒæ­¥çš„æ–¹æ³•éœ€è¦è°ƒç”¨
        __CFRunLoopDoBlocks();
        
    } while (!stop && !timeout);
    
    // é€šçŸ¥å³å°†é€€å‡ºrunloop
    __CFRunLoopDoObservers(CFRunLoopExit);
}

```


[**Runloopé¢è¯•é¢˜åˆ†æ**](https://www.neroxie.com/2019/07/26/RunLoopé¢è¯•é¢˜åˆ†æ/)


<br/>
<br/>


> <h3 id="Runloopæœ‰å‡ ç§è¿è¡ŒçŠ¶æ€">Runloopæœ‰å‡ ç§è¿è¡ŒçŠ¶æ€</h3>

Runloopæ˜¯é€šè¿‡è§‚å¯Ÿè€…CFRunLoopObserverRefæ¥ç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜ï¼š

```

-(void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
     //åˆ›å»ºç›‘å¬è€…
     /*
     ç¬¬ä¸€ä¸ªå‚æ•° CFAllocatorRef allocatorï¼šåˆ†é…å­˜å‚¨ç©ºé—´ CFAllocatorGetDefault()é»˜è®¤åˆ†é…
     ç¬¬äºŒä¸ªå‚æ•° CFOptionFlags activitiesï¼šè¦ç›‘å¬çš„çŠ¶æ€ kCFRunLoopAllActivities ç›‘å¬æ‰€æœ‰çŠ¶æ€
     ç¬¬ä¸‰ä¸ªå‚æ•° Boolean repeatsï¼šYES:æŒç»­ç›‘å¬ NO:ä¸æŒç»­
     ç¬¬å››ä¸ªå‚æ•° CFIndex orderï¼šä¼˜å…ˆçº§ï¼Œä¸€èˆ¬å¡«0å³å¯
     ç¬¬äº”ä¸ªå‚æ•° ï¼šå›è°ƒ ä¸¤ä¸ªå‚æ•°observer:ç›‘å¬è€… activity:ç›‘å¬çš„äº‹ä»¶
     */
     /*
     æ‰€æœ‰äº‹ä»¶
     typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) {
     kCFRunLoopEntry = (1UL << 0),   //   å³å°†è¿›å…¥RunLoop
     kCFRunLoopBeforeTimers = (1UL << 1), // å³å°†å¤„ç†Timer
     kCFRunLoopBeforeSources = (1UL << 2), // å³å°†å¤„ç†Source
     kCFRunLoopBeforeWaiting = (1UL << 5), //å³å°†è¿›å…¥ä¼‘çœ 
     kCFRunLoopAfterWaiting = (1UL << 6),// åˆšä»ä¼‘çœ ä¸­å”¤é†’
     kCFRunLoopExit = (1UL << 7),// å³å°†é€€å‡ºRunLoop
     kCFRunLoopAllActivities = 0x0FFFFFFFU
     };
     */
    CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) {
        switch (activity) {
            case kCFRunLoopEntry:
                NSLog(@"RunLoopè¿›å…¥");
                break;
            case kCFRunLoopBeforeTimers:
                NSLog(@"RunLoopè¦å¤„ç†Timersäº†");
                break;
            case kCFRunLoopBeforeSources:
                NSLog(@"RunLoopè¦å¤„ç†Sourcesäº†");
                break;
            case kCFRunLoopBeforeWaiting:
                NSLog(@"RunLoopè¦ä¼‘æ¯äº†");
                break;
            case kCFRunLoopAfterWaiting:
                NSLog(@"RunLoopé†’æ¥äº†");
                break;
            case kCFRunLoopExit:
                NSLog(@"RunLoopé€€å‡ºäº†");
                break;

            default:
                break;
        }
    });

    // ç»™RunLoopæ·»åŠ ç›‘å¬è€…
    /*
     ç¬¬ä¸€ä¸ªå‚æ•° CFRunLoopRef rlï¼šè¦ç›‘å¬å“ªä¸ªRunLoop,è¿™é‡Œç›‘å¬çš„æ˜¯ä¸»çº¿ç¨‹çš„RunLoop
     ç¬¬äºŒä¸ªå‚æ•° CFRunLoopObserverRef observer ç›‘å¬è€…
     ç¬¬ä¸‰ä¸ªå‚æ•° CFStringRef mode è¦ç›‘å¬RunLoopåœ¨å“ªç§è¿è¡Œæ¨¡å¼ä¸‹çš„çŠ¶æ€
     */
    CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode);
     /*
     CFçš„å†…å­˜ç®¡ç†ï¼ˆCore Foundationï¼‰
     å‡¡æ˜¯å¸¦æœ‰Createã€Copyã€Retainç­‰å­—çœ¼çš„å‡½æ•°ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œéƒ½éœ€è¦åœ¨æœ€ååšä¸€æ¬¡release
     GCDæœ¬æ¥åœ¨iOS6.0ä¹‹å‰ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬é‡Šæ”¾çš„ï¼Œ6.0ä¹‹åGCDå·²ç»çº³å…¥åˆ°äº†ARCä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡äº†
     */
    CFRelease(observer);
}
```


è¾“å‡ºç»“æœï¼š

![è¾“å‡ºç»“æœ <br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd8.png)




<br/>
<br/>

>### <h3 id ="runloopä¸è‡ªåŠ¨é‡Šæ”¾æ± å…³ç³»ä»€ä¹ˆæ—¶ä¾¯é‡Šæ”¾">[RunLoop](https://github.com/harleyGit/StudyNotes/blob/master/åº•å±‚/RunLoop(I).md)ä¸è‡ªåŠ¨é‡Šæ”¾æ± å…³ç³»ï¼Œä»€ä¹ˆæ—¶ä¾¯é‡Šæ”¾?</h3>


- **åˆ†ä¸¤ç§æƒ…å†µï¼šæ‰‹åŠ¨å¹²é¢„é‡Šæ”¾å’Œç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾**
	- æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾å°±æ˜¯æŒ‡å®šautoreleasepool,å½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸå°±ç«‹å³é‡Šæ”¾
	- ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾:ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepool,Autoreleaseå¯¹è±¡ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾
	- kCFRunLoopEntry(1):ç¬¬ä¸€æ¬¡è¿›å…¥ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªautorelease
	- kCFRunLoopBeforeWaiting(32):è¿›å…¥ä¼‘çœ çŠ¶æ€å‰ä¼šè‡ªåŠ¨é”€æ¯ä¸€ä¸ªautorelease,ç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„autorelease
	- kCFRunLoopExit(128):é€€å‡ºrunloopæ—¶ä¼šè‡ªåŠ¨é”€æ¯æœ€åä¸€ä¸ªåˆ›å»ºçš„autorelease

<br/>

- **ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾æ—¶æœºï¼š**

&emsp; æ¯ä¸ªrunloopä¸­éƒ½åˆ›å»ºä¸€ä¸ªAutorelease Poolï¼Œå¹¶åœ¨runloopçš„æœ«å°¾è¿›è¡Œé‡Šæ”¾ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ¥å—autoreleaseæ¶ˆæ¯çš„å¯¹è±¡ï¼Œéƒ½ä¼šåœ¨ä¸‹ä¸ªrunloopå¼€å§‹å‰è¢«é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€æ®µåŒæ­¥çš„ä»£ç ä¸­æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆçš„å¯¹è±¡æ¥å—autoreleaseæ¶ˆæ¯åï¼Œä¸€èˆ¬æ˜¯ä¸ä¼šåœ¨ä½œç”¨åŸŸç»“æŸå‰é‡Šæ”¾çš„ã€‚Autoreleaseå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«æ·»åŠ åˆ°æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå¹¶ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸï¼ˆRunLoop åœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»º, åœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ï¼‰æ—¶é‡Šæ”¾,è‡³äºä½•æ—¶runloopç»“æŸå¹¶æ²¡æœ‰å›ºå®šçš„durationã€‚

&emsp; Runloopæ˜¯ä¸€ä¸ªè¿è¡Œå¾ªç¯ï¼Œä½†æ˜¯å®ƒä¸å¯èƒ½ä¸€ç›´è¿è¡Œç€ï¼Œæ‰€ä»¥å®ƒä¼šæœ‰ä¸€ä¸ªä¼‘çœ æœŸã€‚Runloopç»´æŠ¤ç€ä¸€ä¸ªAutoreleasePoolï¼Œå½“å®ƒè¿›å…¥ä¼‘çœ å‰å®ƒä¼šæŠŠè¿™ä¸ªé‡Šæ”¾æ± é‡Œçš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾ã€‚

&emsp; UIKité€šè¿‡RunLoopObserveråœ¨RunLoopä¸¤æ¬¡Sleepé—´å¯¹AutoreleasePoolè¿›è¡Œpopå’Œpush,å°†è¿™æ¬¡Loopä¸­äº§ç”Ÿçš„Autoreleaseå¯¹è±¡é‡Šæ”¾ã€‚


<br/>

- **åœ¨UIKitä¸­Runloopä»€ä¹ˆæ—¶å€™è¿›å…¥ä¼‘çœ ï¼Ÿ**

å…ˆçœ‹ä¸€ä¸ªç®€å•Demoï¼š

```
- (void)viewDidLoad{
    [super viewDidLoad];
    NSString *string = [NSString stringWithFormat:@"é½æ»‡å¤§åœ£"];
}

```

&emsp; è¿™é‡Œ[NSString stringWithFormat:@â€é½æ»‡å¤§åœ£â€];åˆ›å»ºå¯¹è±¡æ—¶è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 1 ã€‚å½“ä½¿ç”¨å±€éƒ¨å˜é‡ string æŒ‡å‘è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•° +1 ï¼Œå˜æˆäº† 2 ã€‚è€Œå½“ viewDidLoad æ–¹æ³•è¿”å›æ—¶ï¼Œå±€éƒ¨å˜é‡ string è¢«å›æ”¶ï¼ŒæŒ‡å‘äº† nil ã€‚å› æ­¤ï¼Œå…¶æ‰€æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨è®¡æ•° -1 ï¼Œå˜æˆäº† 1 ã€‚

&emsp; ç„¶åæˆ‘ä»¬çš„è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªautoreleaseçš„å®ä¾‹ï¼Œæ˜¯è¢«ç³»ç»Ÿè‡ªåŠ¨æ·»åŠ åˆ°äº†å½“å‰çš„ autoreleasepool ä¸­çš„ã€‚æ‰€ä»¥ä¼šå½“Runloopä¸€æ¬¡è¿­ä»£ç»“æŸå³å°†è¿›å…¥ä¼‘çœ çš„æ—¶å€™autoreleasepool drainå¯¹è±¡å¼•ç”¨è®¡æ•° -1ï¼Œå¯¹è±¡é‡Šæ”¾ã€‚

ä¸‹é¢æˆ‘ä»¬é…åˆç€å †æ ˆä¿¡æ¯çœ‹ä¸€ä¸‹è¿™ä¸ªRunloopä»€ä¹ˆæ—¶å€™ç»“æŸä¸€æ¬¡è¿­ä»£ã€‚

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd0.png)


&emsp; è¿™é‡Œæˆ‘ä»¬åŠ å…¥ä¸€ä¸ªweakçš„å…¨å±€å˜é‡referenceæ¥æŒ‡å‘æˆ‘ä»¬çš„å¯¹è±¡ã€‚å› ä¸ºweakå¼•ç”¨ä¸æŒæœ‰æˆ‘ä»¬çš„å¯¹è±¡ï¼Œä¸ä¼šå½±å“æ‰€æŒ‡å‘å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å®ƒæ¥è¾“å‡ºä»¥åˆ¤æ–­æˆ‘ä»¬çš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ã€‚

&emsp; æˆ‘ä»¬èƒ½çœ‹åˆ°referenceåœ¨viewDidLoadå’ŒviewWillAppearçš„æ—¶å€™æœ‰è¾“å‡ºï¼Œè€Œåœ¨viewDidAppearçš„æ—¶å€™ä¸ºnullï¼Œè¯´æ˜è¢«é‡Šæ”¾äº†ã€‚é‚£æˆ‘ä»¬æ¥çŒœæµ‹ä¸€ä¸‹runloopçš„è¿­ä»£å‘¨æœŸã€‚

&emsp; viewWillAppearå¾ˆå®¹æ˜“ç†è§£æ˜¯å³å°†è¿›å…¥é¡µé¢å˜›ï¼Œé‚£runloopè‚¯å®šæ˜¯è¿˜æœ‰äº‹è¦åšçš„å˜›ï¼Œå½“viewDidAppearçš„æ—¶å€™è¡¨ç¤ºå·²ç»è¿›å…¥é¡µé¢äº†ã€‚é‚£å°±è¡¨ç¤ºæ²¡äº‹åšäº†ï¼Œè¿›å…¥ç¡çœ ï¼Œç­‰å¾…ç”¨æˆ·åŠ¨ä½œçš„æ—¶å€™å†æ¬¡å”¤é†’ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—æˆ‘å£è¯´æ— å‡­ä¸é è°±ï¼Œå¥½é‚£æˆ‘å°±æ‹¿å‡ºè¯æ®æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸¤å¼ å›¾ã€‚

æ–­ç‚¹1å’Œæ–­ç‚¹2:

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd1.png)

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd2.png)

æˆ‘ä»¬èƒ½çœ‹åˆ°æ–­ç‚¹1å’Œæ–­ç‚¹2 runloopè¿˜æ˜¯åœ¨æ‰§è¡Œçš„ï¼Œæ–­ç‚¹3è¡¨ç¤ºrunloopä¸€ä¸ªè¿­ä»£å·²ç»ç»“æŸäº†ï¼Œå³å°†è¿›å…¥ç¡çœ ã€‚

```
//è§¦å‘ Source0 (éåŸºäºportçš„) å›è°ƒã€‚
__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__(source0);
//out_to_blockè¡¨ç¤ºä»blockè·³å‡ºï¼Œblockæ‰§è¡Œå®Œæ¯•ï¼Œå³å°†è¿›å…¥ç¡çœ ã€‚
__CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);
```


<br/>

- **è‡ªåŠ¨é‡Šæ”¾æ± ä½¿ç”¨æ—¶æœºï¼š**
	- å†™ç»™äºˆå‘½ä»¤è¡Œçš„ç¨‹åºæ—¶ï¼Œå°±æ˜¯æ²¡æœ‰UIæ¡†æ¶ï¼›
	- å†™å¾ªç¯ï¼Œå¾ªç¯é‡Œè¾¹åŒ…å«äº†å¤§é‡ä¸´æ—¶åˆ›å»ºçš„å¯¹è±¡ï¼›
	- åˆ›å»ºäº†æ–°çš„çº¿ç¨‹ï¼›
	- é•¿æ—¶é—´åœ¨åå°è¿è¡Œçš„ä»»åŠ¡ï¼›
	- åˆç†è¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¯ä»¥é™ä½ç¨‹åºçš„å†…å­˜å³°å€¼ï¼Œå¼‚æ­¥çš„æ–¹å¼å°†æ–‡ä»¶ä¿å­˜åœ¨ç£ç›˜ï¼ˆSDWebimageé‡Œè¾¹å¼‚æ­¥ä¿å­˜å›¾ç‰‡åˆ°ç£ç›˜ï¼Œç±»ä¼¼çš„å ç”¨å†…å­˜çš„æ“ä½œï¼‰ï¼›


<br/>
<br/>


 > <h3 id ="RunLoopåŸç†å’Œä¸çº¿ç¨‹çš„è”ç³»">RunLoopåŸç†å’Œä¸çº¿ç¨‹çš„è”ç³»ï¼Ÿè¯´ä¸€ä¸‹ä½ å¯¹ä»–çš„äº†è§£</h3>

1. RunLoop çš„ä½œç”¨å°±æ˜¯æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„ RunLoopå¼€å¯åï¼Œçº¿ç¨‹å°±ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œå¤„äºä¼‘çœ çŠ¶æ€ï¼Œéšæ—¶ç­‰å¾…æ¥å—æ–°çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é€€å‡ºã€‚

2. åªæœ‰ä¸»çº¿ç¨‹çš„RunLoopæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ç¨‹åºåœ¨å¼€å¯åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡ºã€‚å…¶ä»–çº¿ç¨‹çš„RunLoopå¦‚æœéœ€è¦å¼€å¯ï¼Œå°±æ‰‹åŠ¨å¼€å¯ï¼Œ


3. **runloopçš„modeä½œç”¨:**

	- model ä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œå¾ªç¯ä¸­çš„ä¼˜å…ˆçº§çš„ï¼Œåˆ†ä¸ºï¼š

	```
	* NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰ï¼šé»˜è®¤ï¼Œç©ºé—²çŠ¶æ€
	* UITrackingRunLoopMode Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ï¼šç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“
	* UIInitializationRunLoopMode  Â  Â  Â  Â  Â  Â  Â  Â  ï¼šåœ¨åˆšå¯åŠ¨ App æ—¶è¿›å…¥çš„ç¬¬ä¸€ä¸ª Mode ï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨
	* GSEventReceiveRunLoopMode  Â  Â  Â  Â  Â  Â  Â  Â  ï¼šæ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ°
  	* kCFRunLoopCommonModes                      ï¼šè¿™æ˜¯ä¸€ä¸ªå ä½çš„ Modeï¼Œæ²¡æœ‰å®é™…ä½œç”¨
	```

	- è‹¹æœå…¬å¼€æä¾›çš„ Modeæœ‰ä¸¤ä¸ªï¼š

	```
	NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰
	NSRunLoopCommonModesï¼ˆkCFRunLoopCommonModesï¼‰
	```



<br/>

æé—®ï¼šRunloopåœ¨çº¿ç¨‹ä¸­æœ‰å“ªäº›ç”¨æ³•ï¼Ÿ
å®ä¾‹ï¼š[çœ‹è¿™é‡Œ](https://www.jianshu.com/p/e29f846d8a97)


æé—®ï¼šä¸»çº¿ç¨‹é»˜è®¤å¼€å¯Runloopçš„modeæ˜¯ä»€ä¹ˆmodeï¼Ÿ
ä¸»çº¿ç¨‹çš„Runloopé»˜è®¤çš„ RunloopMode æ˜¯ NSDefaultRunLoopModeã€‚


<br/>
<br/>




> <h2 id = "å¤šçº¿ç¨‹">å¤šçº¿ç¨‹</h2>

<br/>

>### <h3 id = "è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»"> [è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„å…³ç³»](https://juejin.cn/post/6844903939599515655) </h3>

- **çº¿ç¨‹å®šä¹‰ï¼š**
	- çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ
	- è¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼Œè¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹
	- ç¨‹åºå¯åŠ¨ä¼šé»˜è®¤å¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œè¿™æ¡çº¿ç¨‹è¢«ç§°ä¸ºä¸»çº¿ç¨‹æˆ– UI çº¿ç¨‹


<br/>


- **è¿›ç¨‹å®šä¹‰**

	- è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åº
	
	- æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨çš„ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…
	
	- é€šè¿‡â€œæ´»åŠ¨ç›‘è§†å™¨â€å¯ä»¥æŸ¥çœ‹ Mac ç³»ç»Ÿä¸­æ‰€å¼€å¯çš„è¿›ç¨‹


<br/>

- **è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«**

	- åœ°å€ç©ºé—´ï¼šåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè€Œè¿›ç¨‹ä¹‹é—´åˆ™æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚
	
	- èµ„æºæ‹¥æœ‰ï¼šåŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„èµ„æºå¦‚å†…å­˜ã€I/Oã€cpu(çº¿ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯å¯ä»¥å…±äº«çš„ï¼Œæ¯”å¦‚ï¼šåœ¨å­çº¿ç¨‹è¯·æ±‚åˆ°çš„å›¾ç‰‡ï¼Œè¦è½¬åˆ°ä½çº¿ç¨‹è¿›è¡Œæ˜¾ç¤ºè¿™å°±æ¶‰åŠåˆ°çº¿ç¨‹çš„é€šä¿¡ã€èµ„æºå…±äº«)ç­‰ï¼Œ**ä½†æ˜¯è¿›ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯ç‹¬ç«‹çš„**ã€‚
	
	- ä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰ã€‚æ‰€ä»¥å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹å¥å£®ã€‚
	
	- è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œæ¶ˆè€—çš„èµ„æºå¤§ï¼Œæ•ˆç‡é«˜ã€‚æ‰€ä»¥æ¶‰åŠåˆ°é¢‘ç¹çš„åˆ‡æ¢æ—¶ï¼Œä½¿ç”¨çº¿ç¨‹è¦å¥½äºè¿›ç¨‹ã€‚åŒæ ·å¦‚æœè¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œåªèƒ½ç”¨çº¿ç¨‹ä¸èƒ½ç”¨è¿›ç¨‹
	
	- æ‰§è¡Œè¿‡ç¨‹ï¼šæ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºå…¥å£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ã€‚
	
	- çº¿ç¨‹æ˜¯å¤„ç†å™¨è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œä½†æ˜¯è¿›ç¨‹ä¸æ˜¯ã€‚











<br/>
<br/>


> <h2 id = "è‡ªåŠ¨é‡Šæ”¾æ± ">è‡ªåŠ¨é‡Šæ”¾æ± </h2>


<br/>

> <h3 id = "è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†">è‡ªåŠ¨é‡Šæ”¾æ± å®ç°åŸç†</h3> 

**å®ç°åŸç†ï¼š**

&emsp; è‡ªåŠ¨é‡Šæ”¾æ± ä»¥æ ˆçš„å½¢å¼å®ç°ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªåŠ¨é‡Šæ”¾æ± æ—¶ï¼Œä»–å°†è¢«æ·»åŠ åˆ°æ ˆé¡¶ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¶åˆ°autoreleaseæ¶ˆæ¯çš„æ—¶å€™ï¼Œä»–è¢«æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„å¤„äºé¡¶çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå½“è‡ªåŠ¨é‡Šæ”¾æ± è¢«å›æ”¶æ—¶ï¼Œä»–ä»¬å°±ä»æ ˆä¸­è¢«åˆ é™¤ï¼Œå¹¶ä¸”ä¼šç»™æ± å­é‡Œé¢æ‰€æœ‰å¯¹è±¡çš„ä½¿ç”¨éƒ½ä¼šåšä¸€æ¬¡releaseæ“ä½œ




<br/>
<br/>




> <h2 id = "APP">APP</h2>

<br/>

> <h3 id = "appå¯åŠ¨æµç¨‹">appå¯åŠ¨æµç¨‹</h3>

[**APPçš„å¯åŠ¨æµç¨‹:**](https://www.jianshu.com/p/229dd6190b95)

```
1.iOSç³»ç»Ÿé¦–å…ˆä¼šåŠ è½½è§£æè¯¥APPçš„Info.plistæ–‡ä»¶ï¼Œå› ä¸ºInfo.plistæ–‡ä»¶ä¸­åŒ…å«äº†æ”¯æŒAPPåŠ è½½è¿è¡Œæ‰€éœ€è¦çš„ä¼—å¤šKeyï¼Œvalueé…ç½®ä¿¡æ¯ï¼Œä¾‹å¦‚APPçš„è¿è¡Œæ¡ä»¶(Required device capabilities)ï¼Œæ˜¯å¦å…¨å±ï¼ŒAPPå¯åŠ¨å›¾ä¿¡æ¯ç­‰ã€‚
2.åˆ›å»ºæ²™ç›’(iOS8åï¼Œæ¯æ¬¡å¯åŠ¨APPéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ²™ç›’è·¯å¾„)
3.æ ¹æ®Info.plistçš„é…ç½®æ£€æŸ¥ç›¸åº”æƒé™çŠ¶æ€
4.åŠ è½½Mach-Oæ–‡ä»¶è¯»å–dyldè·¯å¾„å¹¶è¿è¡ŒdyldåŠ¨æ€è¿æ¥å™¨(å†…æ ¸åŠ è½½äº†ä¸»ç¨‹åºï¼Œdyldåªä¼šè´Ÿè´£åŠ¨æ€åº“çš„åŠ è½½)
	4.1 é¦–å…ˆdyldä¼šå¯»æ‰¾åˆé€‚çš„CPUè¿è¡Œç¯å¢ƒ
	4.2 ç„¶ååŠ è½½ç¨‹åºè¿è¡Œæ‰€éœ€çš„ä¾èµ–åº“å’Œæˆ‘ä»¬è‡ªå·±å†™çš„.h.mæ–‡ä»¶ç¼–è¯‘æˆçš„.oå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å¯¹è¿™äº›åº“è¿›è¡Œé“¾æ¥ã€‚
	4.3 åŠ è½½æ‰€æœ‰æ–¹æ³•(runtimeå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™è¢«åˆå§‹åŒ–å¹¶å®ŒæˆOCçš„å†…å­˜å¸ƒå±€)
	4.4 åŠ è½½Cå‡½æ•°
	4.5 åŠ è½½categoryçš„æ‰©å±•(æ­¤æ—¶runtimeä¼šå¯¹æ‰€æœ‰ç±»ç»“æ„è¿›è¡Œåˆå§‹åŒ–)
	4.6 åŠ è½½C++é™æ€å‡½æ•°ï¼ŒåŠ è½½OC+load
	4.7 æœ€ådyldè¿”å›mainå‡½æ•°åœ°å€ï¼Œmainå‡½æ•°è¢«è°ƒç”¨
```


Mach-Oæ–‡ä»¶è¯´æ˜:
Mach-Oæ–‡ä»¶æ ¼å¼æ˜¯ OS X ä¸ iOS ç³»ç»Ÿä¸Šçš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ï¼Œç±»ä¼¼äºwindowsçš„ PE æ–‡ä»¶ã€‚åƒæˆ‘ä»¬ç¼–è¯‘äº§ç”Ÿçš„.oæ–‡ä»¶ã€ç¨‹åºå¯æ‰§è¡Œæ–‡ä»¶å’Œå„ç§åº“ç­‰éƒ½æ˜¯Mach-Oæ–‡ä»¶ã€‚
Mach-Oæ–‡ä»¶ä¸»è¦æœ‰3éƒ¨åˆ†ç»„æˆï¼š

1.Headerï¼šä¿å­˜äº†ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº†è¯¥æ–‡ä»¶è¿è¡Œçš„å¹³å°ã€æ–‡ä»¶ç±»å‹ã€LoadCommandsçš„ä¸ªæ•°ç­‰ç­‰ã€‚Headersçš„ä¸»è¦ä½œç”¨å°±æ˜¯å¸®åŠ©ç³»ç»Ÿè¿…é€Ÿçš„å®šä½Mach-Oæ–‡ä»¶çš„è¿è¡Œç¯å¢ƒï¼Œæ–‡ä»¶ç±»å‹ã€‚ä¿å­˜äº†ä¸€äº›dyldé‡è¦çš„åŠ è½½å‚æ•°

2.LoadCommandsï¼šå¯ä»¥ç†è§£ä¸ºåŠ è½½å‘½ä»¤ï¼Œåœ¨åŠ è½½Mach-Oæ–‡ä»¶æ—¶ä¼šä½¿ç”¨è¿™é‡Œçš„æ•°æ®æ¥ç¡®å®šå†…å­˜çš„åˆ†å¸ƒä»¥åŠç›¸å…³çš„åŠ è½½å‘½ä»¤ã€‚æ¯”å¦‚æˆ‘ä»¬çš„mainå‡½æ•°çš„åŠ è½½åœ°å€ï¼Œç¨‹åºæ‰€éœ€çš„dyldçš„æ–‡ä»¶è·¯å¾„ï¼Œä»¥åŠç›¸å…³ä¾èµ–åº“çš„æ–‡ä»¶è·¯å¾„ã€‚

3.Dataï¼š æ¯ä¸€ä¸ªsegmentçš„å…·ä½“æ•°æ®éƒ½ä¿å­˜åœ¨è¿™é‡Œï¼Œè¿™é‡ŒåŒ…å«äº†å…·ä½“çš„ä»£ç ã€æ•°æ®ç­‰ç­‰ã€‚

å®‰å…¨
ASLRï¼ˆAddress Space Layout Randomizationï¼‰ï¼šåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼Œé•œåƒä¼šåœ¨éšæœºçš„åœ°å€ä¸ŠåŠ è½½ã€‚

ä»£ç ç­¾åï¼šä¸ºäº†åœ¨è¿è¡Œæ—¶éªŒè¯ Mach-O æ–‡ä»¶çš„ç­¾åï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡é‡å¤çš„å»è¯»å…¥æ•´ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯æŠŠæ–‡ä»¶æ¯é¡µå†…å®¹éƒ½ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„åŠ å¯†æ•£åˆ—å€¼ï¼Œå¹¶æŠŠå€¼å­˜å‚¨åœ¨ __LINKEDIT ä¸­ã€‚è¿™ä½¿å¾—æ–‡ä»¶æ¯é¡µçš„å†…å®¹éƒ½èƒ½åŠæ—¶è¢«æ ¡éªŒç¡®å¹¶ä¿ä¸è¢«ç¯¡æ”¹ã€‚è€Œä¸æ˜¯æ¯ä¸ªæ–‡ä»¶éƒ½åšhashåŠ å¯†å¹¶åšæ•°å­—ç­¾åã€‚



<br/>
<br/>

> <h3 id = "appå¯åŠ¨ä¼˜åŒ–">appå¯åŠ¨ä¼˜åŒ–</h3>

<br/>
<br/>


> <h3 id = "appç”Ÿå‘½å‘¨æœŸ">appç”Ÿå‘½å‘¨æœŸ</h3>
	
ViewControllerçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è¯´æ˜:(è¯¦ç»†è¯´æ˜éƒ½åœ¨ä»£ç æ³¨é‡Šä¸­)
	
```
#pragma mark --- sbç›¸å…³çš„life circle
//æ‰§è¡Œé¡ºåº1
// å½“ä½¿ç”¨storyBoardæ—¶èµ°çš„ç¬¬ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è€Œä¸èµ°initWithNibNameæ–¹æ³•ã€‚
- (instancetype)initWithCoder:(NSCoder *)aDecoder {
     NSLog(@"%s", __func__);
    if (self = [super initWithCoder:aDecoder])
     {
          //è¿™é‡Œä»…ä»…æ˜¯åˆ›å»ºselfï¼Œè¿˜æ²¡æœ‰åˆ›å»ºself.viewæ‰€ä»¥ä¸è¦åœ¨è¿™é‡Œè®¾ç½®self.viewç›¸å…³æ“ä½œ
     }
    return self;
}
#pragma mark --- life circle
//æ‰§è¡Œé¡ºåº1
// å½“æ§åˆ¶å™¨ä¸æ˜¯SBæ—¶ï¼Œéƒ½èµ°è¿™ä¸ªæ–¹æ³•ã€‚(xibæˆ–çº¯ä»£ç éƒ½ä¼šèµ°è¿™ä¸ªæ–¹æ³•)
- (instancetype)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    NSLog(@"%s", __func__);
    if (self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil]) 
    {
        //è¿™é‡Œä»…ä»…æ˜¯åˆ›å»ºselfï¼Œè¿˜æ²¡æœ‰åˆ›å»ºself.viewæ‰€ä»¥ä¸è¦åœ¨è¿™é‡Œè®¾ç½®self.viewç›¸å…³æ“ä½œ
    }
    return self;
}

//æ‰§è¡Œé¡ºåº2
// xibåŠ è½½å®Œæˆæ—¶è°ƒç”¨ï¼Œçº¯ä»£ç ä¸ä¼šè°ƒç”¨ã€‚ç³»ç»Ÿè‡ªè¡Œè°ƒç”¨
- (void)awakeFromNib {
    [super awakeFromNib];
     //å½“awakeFromNibæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰è§†å›¾çš„outletå’Œactionå·²ç»è¿æ¥ï¼Œä½†è¿˜æ²¡æœ‰è¢«ç¡®å®šã€‚
     NSLog(@"%s", __func__);
}

//æ‰§è¡Œé¡ºåº3
// åŠ è½½æ§åˆ¶å™¨çš„self.viewè§†å›¾ã€‚(é»˜è®¤ä»nib)
- (void)loadView {
    //è¯¥æ–¹æ³•ä¸€èˆ¬å¼€å‘è€…ä¸ä¸»åŠ¨è°ƒç”¨ï¼Œåº”è¯¥ç”±ç³»ç»Ÿè‡ªè¡Œè°ƒç”¨ã€‚
    //ç³»ç»Ÿä¼šåœ¨self.viewä¸ºnilçš„æ—¶å€™è°ƒç”¨ã€‚å½“æ§åˆ¶å™¨ç”Ÿå‘½å‘¨æœŸåˆ°è¾¾éœ€è¦è°ƒç”¨self.viewçš„æ—¶å€™ä¼šè‡ªè¡Œè°ƒç”¨ã€‚
    //æˆ–è€…å½“æˆ‘ä»¬è®¾ç½®self.view=nilåï¼Œä¸‹æ¬¡éœ€è¦ç”¨åˆ°self.viewæ—¶ï¼Œç³»ç»Ÿå‘ç°self.viewä¸ºnilï¼Œåˆ™ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚
    //è¯¥æ–¹æ³•ä¸€èˆ¬ä¼šé¦–å…ˆæ ¹æ®nibNameå»æ‰¾å¯¹åº”çš„nibæ–‡ä»¶ç„¶ååŠ è½½ã€‚
    //å¦‚æœnibNameä¸ºç©ºæˆ–æ‰¾ä¸åˆ°å¯¹åº”çš„nibæ–‡ä»¶ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªç©ºè§†å›¾(è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯çº¯ä»£ç )
    NSLog(@"%s", __func__);
    //è¯¥æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚æœé‡å†™ä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•[super loadView];
    self.view = [[UIView alloc] initWithFrame:[UIScreen mainScreen].bounds];
}

//æ‰§è¡Œé¡ºåº4
//è§†å›¾æ§åˆ¶å™¨ä¸­çš„è§†å›¾åŠ è½½å®Œæˆï¼ŒviewControllerè‡ªå¸¦çš„viewåŠ è½½å®Œæˆåä¼šç¬¬ä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•
- (void)viewDidLoad {
    //å½“self.viewè¢«åˆ›å»ºåï¼Œä¼šç«‹å³è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨äºå®Œæˆå„ç§åˆå§‹åŒ–æ“ä½œ
    NSLog(@"%s", __func__);
    [super viewDidLoad];
}

//æ‰§è¡Œé¡ºåº5
//è§†å›¾å°†è¦å‡ºç°
- (void)viewWillAppear:(BOOL)animated {
    NSLog(@"%s", __func__);
    [super viewWillAppear:animated];
}

//æ‰§è¡Œé¡ºåº6
// view å³å°†å¸ƒå±€å…¶ Subviews
- (void)viewWillLayoutSubviews {
    //viewå³å°†å¸ƒå±€å®ƒçš„Subviewså­è§†å›¾ã€‚ å½“viewçš„çš„å±æ€§å‘ç”Ÿäº†æ”¹å˜ã€‚
    //éœ€è¦è¦è°ƒæ•´viewçš„Subviewså­è§†å›¾çš„ä½ç½®ï¼Œåœ¨è°ƒæ•´ä¹‹å‰è¦åšçš„å·¥ä½œéƒ½å¯ä»¥æ”¾åœ¨è¯¥æ–¹æ³•ä¸­å®ç°
    NSLog(@"%s", __func__);
    [super viewWillLayoutSubviews];
}

//æ‰§è¡Œé¡ºåº7
// view å·²ç»å¸ƒå±€å…¶ Subviews
- (void)viewDidLayoutSubviews {
    //viewå·²ç»å¸ƒå±€å…¶Subviewsï¼Œè¿™é‡Œå¯ä»¥æ”¾ç½®è°ƒæ•´å®Œæˆä¹‹åéœ€è¦åšçš„å·¥ä½œ
    NSLog(@"%s", __func__);
    [super viewDidLayoutSubviews];
}

//æ‰§è¡Œé¡ºåº8
//è§†å›¾å·²ç»å‡ºç°
- (void)viewDidAppear:(BOOL)animated {
    NSLog(@"%s", __func__);
    [super viewDidAppear:animated];
}

//æ‰§è¡Œé¡ºåº9
//è§†å›¾å°†è¦æ¶ˆå¤±
- (void)viewWillDisappear:(BOOL)animated {
    NSLog(@"%s", __func__);
    [super viewWillDisappear:animated];
}

//æ‰§è¡Œé¡ºåº10
//è§†å›¾å·²ç»æ¶ˆå¤±
- (void)viewDidDisappear:(BOOL)animated {
    NSLog(@"%s", __func__);
    [super viewDidDisappear:animated];
}

//æ‰§è¡Œé¡ºåº11
// è§†å›¾è¢«é”€æ¯
- (void)dealloc {
    //ç³»ç»Ÿä¼šåœ¨æ­¤æ—¶é‡Šæ”¾æ‰initä¸viewDidLoadä¸­åˆ›å»ºçš„å¯¹è±¡
    NSLog(@"%s", __func__);
}

//æ‰§è¡Œé¡ºåº12
//å‡ºç°å†…å­˜è­¦å‘Š  //æ¨¡æ‹Ÿå†…å­˜è­¦å‘Š:ç‚¹å‡»æ¨¡æ‹Ÿå™¨->hardware-> Simulate Memory Warning
- (void)didReceiveMemoryWarning {
    //åœ¨å†…å­˜è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œappçš„è§†å›¾é€šå¸¸ä¼šä¸€ç›´ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œä¸€äº›æ²¡æœ‰æ­£åœ¨æ˜¾ç¤ºçš„viewControllerå°±ä¼šæ”¶åˆ°å†…å­˜ä¸è¶³çš„è­¦å‘Šã€‚
    //ç„¶åå°±ä¼šé‡Šæ”¾è‡ªå·±æ‹¥æœ‰çš„è§†å›¾ï¼Œä»¥è¾¾åˆ°é‡Šæ”¾å†…å­˜çš„ç›®çš„ã€‚ä½†æ˜¯ç³»ç»Ÿåªä¼šé‡Šæ”¾å†…å­˜ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œå°†ä¸éœ€è¦æ˜¾ç¤ºåœ¨å†…å­˜ä¸­ä¿ç•™çš„å¯¹è±¡é‡Šæ”¾å®ƒçš„æ‰€æœ‰æƒï¼Œå°†å…¶æŒ‡é’ˆç½®nilã€‚
    NSLog(@"%s", __func__);
    [super didReceiveMemoryWarning];
}

```
		
		
		
		
		
<br/>
<br/>

>## <h2 id ="mainå‡½æ•°ä¹‹å‰ä¼šåšä»€ä¹ˆ">[mainå‡½æ•°ä¹‹å‰ä¼šåšä»€ä¹ˆ](https://juejin.cn/post/6844903783160348685#heading-11)</h2>

main()å‡½æ•°è°ƒç”¨ä¹‹å‰ï¼Œå…¶å®æ˜¯åšäº†å¾ˆå¤šå‡†å¤‡å·¥ä½œï¼Œä¸»è¦æ˜¯dyldè¿™ä¸ªåŠ¨æ€é“¾æ¥å™¨åœ¨è´Ÿè´£ï¼Œæ ¸å¿ƒæµç¨‹å¦‚ä¸‹:

- ç¨‹åºæ‰§è¡Œä»_dyld_starå¼€å§‹
	- è¯»å–machoæ–‡ä»¶ä¿¡æ¯ï¼Œè®¾ç½®è™šæ‹Ÿåœ°å€åç§»é‡ï¼Œç”¨äºé‡å®šå‘;
	- è°ƒç”¨dyld::_mainæ–¹æ³•è¿›å…¥machoæ–‡ä»¶çš„ä¸»ç¨‹åº;

<br/>

- é…ç½®ä¸€äº›ç¯å¢ƒå˜é‡
	- è®¾ç½®çš„ç¯å¢ƒå˜é‡æ–¹ä¾¿æˆ‘ä»¬æ‰“å°å‡ºæ›´å¤šçš„ä¿¡æ¯ã€‚
	- è°ƒç”¨getHostInfo()æ¥è·å–machOå¤´éƒ¨è·å–å½“å‰è¿è¡Œæ¶æ„çš„ä¿¡æ¯

<br/>

- å®ä¾‹åŒ–ä¸»ç¨‹åº,å³machoå¯æ‰§è¡Œæ–‡ä»¶

<br/>

- åŠ è½½å…±äº«ç¼“å­˜åº“

<br/>


- æ’å…¥åŠ¨æ€ç¼“å­˜åº“

<br/>

- é“¾æ¥ä¸»ç¨‹åº

<br/>

- åˆå§‹åŒ–å‡½æ•°
	- ç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–å‡½æ•°æœ€ç»ˆè°ƒç”¨notifSingleå‡½æ•°
	-  æ­¤å›è°ƒæ˜¯è¢«è¿è¡Œæ—¶_objc_initåˆå§‹åŒ–æ—¶èµ‹å€¼çš„ä¸€ä¸ªå‡½æ•°load_image(åé¢çš„æ€»ç»“æ˜¯ï¼šå…ˆç±»æ–‡ä»¶load,å†åˆ†ç±»æ–‡ä»¶load,ç„¶åå†æ˜¯C++æ„é€ å‡½æ•°ï¼Œæœ€åå°±è¿›å…¥äº†æˆ‘ä»¬çš„mainä¸»ç¨‹åº)
	-  load_imagesé‡Œé¢æ‰§è¡Œcall_load_methodså‡½æ•°ï¼Œå¾ªç¯è°ƒç”¨æ‰€ç”¨ç±»ä»¥åŠåˆ†ç±»çš„loadæ–¹æ³•
		-  call_load_methodsæ–¹æ³•è°ƒç”¨,åœ¨call_load_methodsä¸­ï¼Œé€šè¿‡doWhileå¾ªç¯æ¥è°ƒç”¨call_class_loadsåŠ è½½`æ¯ä¸ªç±»çš„loadæ–¹æ³•`,ç„¶åå†åŠ `è½½åˆ†ç±»çš„loadsæ–¹æ³•`;
	- doModInitFunctionså‡½æ•°ï¼Œå†…éƒ¨ä¼šè°ƒç”¨å…¨å±€C++å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œå³_ _ attribute_ _((constructor))è¿™æ ·çš„å‡½æ•°
		- åœ¨è°ƒç”¨å®ŒnotifySiginåï¼Œç»§ç»­è°ƒç”¨äº†doInitializationï¼ŒdoModInitFunctionsä¼šè°ƒç”¨machOæ–‡ä»¶ä¸­_mod_init_funcæ®µçš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨æ–‡ä»¶ä¸­æ‰€å®šä¹‰çš„å…¨å±€C++æ„é€ å‡½æ•°

	
<br/>


- 	è¿”å›ä¸»ç¨‹åºçš„å…¥å£å‡½æ•°ï¼Œå¼€å§‹è¿›å…¥ä¸»ç¨‹åºçš„mainï¼ˆï¼‰å‡½æ•°




<br/>
<br/>


> <h2 id = "Runtimeçš„æ¶ˆæ¯è½¬å‘">Runtimeçš„æ¶ˆæ¯è½¬å‘</h2>

[Runtimeçš„æ¶ˆæ¯è½¬å‘](https://blog.csdn.net/zhw521411/article/details/85617353)

<br/>
<br/>

> <h2 id = "å“åº”è€…é“¾">å“åº”è€…é“¾</h2>

<br/>

- [å“åº”è€…é“¾ï¼ˆIï¼‰](https://github.com/harleyGit/StudyNotes/blob/master/iOS/Objective-C/å“åº”é“¾(I).md)




<br/>
<br/>



> <h2 id = "OCçš„å¼•ç”¨è®¡æ•°æ˜¯å­˜æ”¾">OCçš„å¼•ç”¨è®¡æ•°æ˜¯å­˜æ”¾åœ¨å“ªï¼Ÿ</h2>

åœ¨64bitæ“ä½œç³»ç»Ÿä¸­,appleå¯¹å¯¹è±¡ä¸­çš„isaè¿›è¡Œäº†ä¼˜åŒ–ä½¿ç”¨isa_tç»“æ„æ¥ä¿å­˜å…³äºå¯¹è±¡çš„æ›´å¤šä¿¡æ¯.

```
# if __arm64__
#   define ISA_MASK        0x0000000ffffffff8ULL
#   define ISA_MAGIC_MASK  0x000003f000000001ULL
#   define ISA_MAGIC_VALUE 0x000001a000000001ULL
#   define ISA_BITFIELD                                                      \
      uintptr_t nonpointer        : 1;   //æŒ‡é’ˆæ˜¯å¦ä¼˜åŒ–è¿‡                                   \
      uintptr_t has_assoc         : 1;   //æ˜¯å¦æœ‰è®¾ç½®è¿‡å…³è”å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«                                   \
      uintptr_t has_cxx_dtor      : 1; 	 //æ˜¯å¦æœ‰C++çš„ææ„å‡½æ•°ï¼ˆ.cxx_destructï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«                                     \
      uintptr_t shiftcls          : 33; //å­˜å‚¨ç€Classã€Meta-Classå¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯ \
      uintptr_t magic             : 6;  //ç”¨äºåœ¨è°ƒè¯•æ—¶åˆ†è¾¨å¯¹è±¡æ˜¯å¦æœªå®Œæˆåˆå§‹åŒ–                                     \
      uintptr_t weakly_referenced : 1;  //æ˜¯å¦æœ‰è¢«å¼±å¼•ç”¨æŒ‡å‘è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«                                     \
      uintptr_t deallocating      : 1;  //å¯¹è±¡æ˜¯å¦æ­£åœ¨é‡Šæ”¾                                     \
      uintptr_t has_sidetable_rc  : 1;  //å¼•ç”¨è®¡æ•°å™¨æ˜¯å¦è¿‡å¤§æ— æ³•å­˜å‚¨åœ¨isaä¸­                                     \
      uintptr_t extra_rc          : 19  //é‡Œé¢å­˜å‚¨çš„å€¼æ˜¯å¼•ç”¨è®¡æ•°å™¨å‡1
#   define RC_ONE   (1ULL<<45)
#   define RC_HALF  (1ULL<<18)
 
# elif __x86_64__
#   define ISA_MASK        0x00007ffffffffff8ULL
#   define ISA_MAGIC_MASK  0x001f800000000001ULL
#   define ISA_MAGIC_VALUE 0x001d800000000001ULL
#   define ISA_BITFIELD                                                        \
      uintptr_t nonpointer        : 1;                                         \
      uintptr_t has_assoc         : 1;                                         \
      uintptr_t has_cxx_dtor      : 1;                                         \
      uintptr_t shiftcls          : 44; /*MACH_VM_MAX_ADDRESS 0x7fffffe00000*/ \
      uintptr_t magic             : 6;                                         \
      uintptr_t weakly_referenced : 1;                                         \
      uintptr_t deallocating      : 1;                                         \
      uintptr_t has_sidetable_rc  : 1;                                         \
      uintptr_t extra_rc          : 8
#   define RC_ONE   (1ULL<<56)
#   define RC_HALF  (1ULL<<7)
 
# else
#   error unknown architecture for packed isa
# endif


```

å…¶ä¸­ï¼šextra_rcå’Œhas_sidetable_rcä¸¤ä¸ªæ ‡å¿—å°±æ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡å¼•ç”¨è®¡æ•°çš„.


isaä¸­ä¸åŒçš„ä½åŸŸä»£è¡¨ä¸åŒçš„å«ä¹‰ã€‚


- nonpointer
	- 0ï¼Œä»£è¡¨æ™®é€šçš„æŒ‡é’ˆï¼Œå­˜å‚¨ç€Classã€Meta-Classå¯¹è±¡çš„å†…å­˜åœ°å€
	- 1ï¼Œä»£è¡¨ä¼˜åŒ–è¿‡ï¼Œä½¿ç”¨ä½åŸŸå­˜å‚¨æ›´å¤šçš„ä¿¡æ¯



- has_assoc
	- æ˜¯å¦æœ‰è®¾ç½®è¿‡å…³è”å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«


- has_cxx_dtor
	- æ˜¯å¦æœ‰C++çš„ææ„å‡½æ•°ï¼ˆ.cxx_destructï¼‰ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«


- shiftcls
	- å­˜å‚¨ç€Classã€Meta-Classå¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯

- magic
	- ç”¨äºåœ¨è°ƒè¯•æ—¶åˆ†è¾¨å¯¹è±¡æ˜¯å¦æœªå®Œæˆåˆå§‹åŒ–


- weakly_referenced
	- æ˜¯å¦æœ‰è¢«å¼±å¼•ç”¨æŒ‡å‘è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«


- deallocating
	- å¯¹è±¡æ˜¯å¦æ­£åœ¨é‡Šæ”¾


- extra_rc
	- é‡Œé¢å­˜å‚¨çš„å€¼æ˜¯å¼•ç”¨è®¡æ•°å™¨å‡1


- has_sidetable_rc
	- å¼•ç”¨è®¡æ•°å™¨æ˜¯å¦è¿‡å¤§æ— æ³•å­˜å‚¨åœ¨isaä¸­
	- å¦‚æœä¸º1ï¼Œé‚£ä¹ˆå¼•ç”¨è®¡æ•°ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªå«SideTableçš„ç±»çš„å±æ€§ä¸­


<br/>

**å¼•ç”¨è®¡æ•°çš„å­˜å‚¨**

å¼•ç”¨è®¡æ•°çš„å¢åŠ ä¸»è¦é€šè¿‡retain()å‡½æ•°æ¥å®ç°.

```
// Equivalent to calling [this retain], with shortcuts if there is no override
inline id 
objc_object::retain()
{
    assert(!isTaggedPointer());
 
    if (fastpath(!ISA()->hasCustomRR())) {
        //åœ¨ARCä¸­ç›´æ¥è°ƒç”¨
        return rootRetain();
    }
 
    return ((id(*)(objc_object *, SEL))objc_msgSend)(this, SEL_retain);
}
 
ALWAYS_INLINE id 
objc_object::rootRetain()
{
    return rootRetain(false, false);
}
 
ALWAYS_INLINE id 
objc_object::rootRetain(bool tryRetain, bool handleOverflow)
{
    if (isTaggedPointer()) return (id)this;
 
    bool sideTableLocked = false;
    //æ˜¯å¦å°†å¼•ç”¨è®¡æ•°ç»“æœè½¬å­˜åˆ°sidetableä¸­
    bool transcribeToSideTable = false;
 
    isa_t oldisa;
    isa_t newisa;
 
    do {
        transcribeToSideTable = false;
        oldisa = LoadExclusive(&isa.bits);
        newisa = oldisa;
        //ä¸æ”¯æŒnonpointerï¼šå¼•ç”¨è®¡æ•°ä¿å­˜åœ¨sidetableä¸­
        if (slowpath(!newisa.nonpointer)) {
            ClearExclusive(&isa.bits);
            //ä¸å°è¯•å¢åŠ å¼•ç”¨è®¡æ•°ä¸”sidetableè¢«é”ï¼Œåˆ™æ‰“å¼€sidetableé”å®š
            if (!tryRetain && sideTableLocked) sidetable_unlock();
            //å°è¯•å¢åŠ å¼•ç”¨è®¡æ•°:å¦‚æœå°è¯•æˆåŠŸåˆ™è¿”å›å½“å‰å¯¹è±¡;å¦‚æœå°è¯•å¤±è´¥åˆ™è¿”å›nil
            if (tryRetain) return sidetable_tryRetain() ? (id)this : nil;
            //ç›´æ¥è¿›è¡Œretainæ“ä½œ:åœ¨sidetableä¸­ä½¿å¼•ç”¨è®¡æ•°å¢åŠ 1
            else return sidetable_retain();
        }
        
        //æ”¯æŒnonpointer
 
        // å°è¯•å¢åŠ å¼•ç”¨è®¡æ•°ä¸”å¯¹è±¡æ­£åœ¨é‡Šæ”¾
        if (slowpath(tryRetain && newisa.deallocating)) {
            ClearExclusive(&isa.bits);
            if (!tryRetain && sideTableLocked) sidetable_unlock();
            return nil;
        }
        uintptr_t carry;
        newisa.bits = addc(newisa.bits, RC_ONE, 0, &carry);  // extra_rc++
 
        //extra_rcæº¢å‡º
        if (slowpath(carry)) {
            // newisa.extra_rc++ overflowed
            if (!handleOverflow) {
                ClearExclusive(&isa.bits);
                return rootRetain_overflow(tryRetain);
            }
            // Leave half of the retain counts inline and 
            // prepare to copy the other half to the side table.
            if (!tryRetain && !sideTableLocked) sidetable_lock();
            //sidetableåŠ é”
            sideTableLocked = true;
            //å¼•ç”¨è®¡æ•°è½¬å­˜åˆ°sidetableä¸­
            transcribeToSideTable = true;
            newisa.extra_rc = RC_HALF;
            newisa.has_sidetable_rc = true;
        }
    } while (slowpath(!StoreExclusive(&isa.bits, oldisa.bits, newisa.bits)));
 
    if (slowpath(transcribeToSideTable)) {
        // Copy the other half of the retain counts to the side table.
        sidetable_addExtraRC_nolock(RC_HALF);
    }
 
    if (slowpath(!tryRetain && sideTableLocked)) sidetable_unlock();
    return (id)this;
}


```


- åœ¨ä¸æ”¯æŒnonpointerçš„å¯¹è±¡ä¸­,å¼•ç”¨è®¡æ•°åªå­˜å‚¨åœ¨sidetableä¸­;
- å¯ä»¥çœ‹å‡ºåœ¨æ”¯æŒnonpointerçš„æƒ…å†µä¸‹ï¼š
	- åœ¨isaçš„ä½åŸŸextra_rcè¶³ä»¥å­˜å‚¨çš„æƒ…å†µ,å¼•ç”¨è®¡æ•°ä¼šä¼˜å…ˆé€‰æ‹©å­˜å‚¨åœ¨isaçš„extra_rcä½åŸŸä¸­;
	- è‹¥isaä½åŸŸextra_rcæº¢å‡ºï¼Œåˆ™ä¼šé€‰æ‹©å°†å°†å¼•ç”¨è®¡æ•°çš„RC_HALF(å¦‚æœextra_rcå æ®8bitï¼Œåˆ™RC_HALF=2^7)ä¿å­˜åœ¨isaä¸­ï¼Œå¦ä¸€åŠRC_HALFå åŠ ä¿å­˜åœ¨sidetableä¸­.ä¹‹æ‰€ä»¥è¿™æ ·é€‰æ‹©æ˜¯å› ä¸ºisa_tçš„å­˜å–ç†è®ºä¸Šä¼šæ¯”sidetableçš„æ“ä½œæ•ˆç‡ä¸Šå¿«å¾ˆå¤š,è¿™æ ·åšæ—¢å¯ä»¥ä½¿è¶…å‡ºextra_rcå­˜å‚¨èŒƒå›´çš„å¼•ç”¨è®¡æ•°å¾—åˆ°æœ‰æ•ˆå­˜å‚¨,åˆå¯ä»¥ç¡®ä¿å¼•ç”¨è®¡æ•°çš„å¢å‡è¶³å¤Ÿå¿«é€Ÿ(å­˜å–éƒ½ä»¥extra_rcä¼˜å…ˆ).


<br/>

**å¼•ç”¨è®¡æ•°çš„è·å–**

å› ä¸ºå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸»è¦å­˜å‚¨åœ¨isaä½åŸŸextra_rcå’Œæ•£åˆ—è¡¨ä¸­,æ‰€ä»¥è¦è·å–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿéœ€è¦ä»ä¸¤ä¸ªä½ç½®è¿›è¡Œè·å–.

```
uintptr_t
_objc_rootRetainCount(id obj)
{
    assert(obj);
 
    return obj->rootRetainCount();
}
 
inline uintptr_t 
objc_object::rootRetainCount()
{
    if (isTaggedPointer()) return (uintptr_t)this;
 
    //æ·»åŠ sidetableæ“ä½œé”
    sidetable_lock();
    //åŠ è½½å¯¹è±¡isa
    isa_t bits = LoadExclusive(&isa.bits);
    ClearExclusive(&isa.bits);
    //å¦‚æœå¯¹è±¡å¼€å¯äº†nonpointer
    if (bits.nonpointer) {
        //è·å–isaä¸­å­˜å‚¨çš„å¼•ç”¨è®¡æ•°
        uintptr_t rc = 1 + bits.extra_rc;
        if (bits.has_sidetable_rc) {
            //è·å–æ•£åˆ—è¡¨ä¸­å­˜å‚¨çš„å¼•ç”¨è®¡æ•°
            rc += sidetable_getExtraRC_nolock();
        }
        sidetable_unlock();
        return rc;
    }
    //å¯¹è±¡æœªå¼€å¯nonpointer
    sidetable_unlock();
    return sidetable_retainCount();
}
 
 
 
uintptr_t
objc_object::sidetable_retainCount()
{
    SideTable& table = SideTables()[this];
 
    size_t refcnt_result = 1;
    
    table.lock();
    RefcountMap::iterator it = table.refcnts.find(this);
    if (it != table.refcnts.end()) {
        // this is valid for SIDE_TABLE_RC_PINNED too
        refcnt_result += it->second >> SIDE_TABLE_RC_SHIFT;
    }
    table.unlock();
    return refcnt_result;
}


```

- åœ¨å¼€å¯nonpointerçš„å¯¹è±¡ä¸­,å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŒ…æ‹¬ä¸¤éƒ¨åˆ†:
	- å­˜å‚¨åœ¨isaä¸­çš„å¼•ç”¨è®¡æ•°;
	- å­˜å‚¨åœ¨sidetableä¸­çš„å¼•ç”¨è®¡æ•°.
- åœ¨æœªå¼€å¯nonpointerçš„å¯¹è±¡ä¸­,å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å…¨éƒ¨å­˜å‚¨åœ¨sidetableä¸­ï¼Œåªéœ€è¦ä»sidetableä¸­è·å–å°±å¯ä»¥.


è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼š

- åœ¨å¼€å¯nonpointerçš„å¯¹è±¡ä¸­,å¼•ç”¨è®¡æ•°retainCount=1+isa.extra_rc+sidetable_getExtraRC_nolock();
- åœ¨æœªå¼€å¯nonpointerçš„å¯¹è±¡ä¸­,å¼•ç”¨è®¡æ•°retainCount=1+table.refcnts.find(this)->second >> SIDE_TABLE_RC_SHIFT;


&emsp; æ‰€ä»¥å…¶å®åœ¨åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ä¸­(ä¾‹å¦‚allocå’Œcopy)ï¼Œå­˜å‚¨çš„å¼•ç”¨è®¡æ•°å¹¶æ²¡æœ‰è¿›è¡Œ+1æ“ä½œ,è€Œæ˜¯é»˜è®¤å¯¹è±¡çš„æœ€å°å¼•ç”¨è®¡æ•°ä¸º1.åœ¨releaseæ“ä½œæ—¶æ‰ä¼šåˆ¤æ–­å¼•ç”¨è®¡æ•°-1æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0åˆ™è¿›è¡Œé‡Šæ”¾;å¦åˆ™è¿›è¡Œå¼•ç”¨è®¡æ•°-1.

[å¼•ç”¨è®¡æ•°è¯´èµ·](https://juejin.cn/post/6844903919127101448)


<br/>
<br/>


> <h2 id="ç±»åº“æ²¡æœ‰å¯¼å…¥">ç±»åº“æ²¡æœ‰å¯¼å…¥</h2>

- å½“ä¸€ä¸ªç±»åº“æ²¡æœ‰è¿›è¡Œå¯¼å…¥æ–‡ä»¶æ—¶ï¼Œä½†æ˜¯æˆ‘æƒ³ä½¿ç”¨å®ƒï¼Œå¦‚ä½•åšåˆ°ï¼Ÿ
	ä½¿ç”¨runtime



<br/>
<br/>


> <h2 id="OCçš„åˆ†ç±»Category">OCçš„åˆ†ç±»Category</h2>
[OCçš„åˆ†ç±»Category](https://blog.csdn.net/LIN1986LIN/article/details/86009099)

<br/>

- åˆ†ç±»ä¸­èƒ½ä¸èƒ½å®šä¹‰å®ä¾‹å˜é‡ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

ä¸èƒ½ã€‚ç±»çš„å†…å­˜å¸ƒå±€åœ¨ç¼–è¯‘æ—¶æœŸå°±å·²ç»ç¡®å®šäº†ï¼Œcategoryæ˜¯è¿è¡Œæ—¶æ‰åŠ è½½çš„æ—©å·²ç»ç¡®å®šäº†å†…å­˜å¸ƒå±€æ‰€ä»¥æ— æ³•æ·»åŠ å®ä¾‹å˜é‡ï¼Œå¦‚æœæ·»åŠ å®ä¾‹å˜é‡å°±ä¼šç ´åcategoryçš„å†…éƒ¨å¸ƒå±€ã€‚

<br/>

- ä¸èƒ½æ·»åŠ å®ä¾‹å˜é‡ï¼Œé‚£ä¸ºä»€ä¹ˆèƒ½æ·»åŠ å±æ€§ï¼Ÿ

å› ä¸ºåœ¨categoryçš„åˆå§‹åŒ–é˜²èŒƒä¸­åªæŠŠå®ä¾‹æ–¹æ³•ã€åè®®ä»¥åŠå±æ€§æ·»åŠ åˆ°ç±»ä¸Šã€‚




<br/>
<br/>


> <h2 id="Blockæ·±å…¥æ¢ç©¶">Blockæ·±å…¥æ¢ç©¶</h2>

<br/>

- <h3 id="blokcåˆ†ç±»">blokcåˆ†ç±»</h3>
[blokcåˆ†ç±»](https://github.com/harleyGit/StudyNotes/blob/master/iOS/Objective-C/Block(I).md)


<br/>

- <h3 id="blockåŸç†">blockåŸç†</h3>
[blockåŸç†](https://www.jianshu.com/p/00a0747740ba)

[BlockåŸç†è¯¦è§£](https://gsl201600.github.io/2020/05/13/iOSblockåŸç†è¯¦è§£/)



<br/>

- <h3 id="blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—">blockéƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å—</h3>

1). ç³»ç»ŸUIViewçš„Block

![UIView çš„Blcok <br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd11.png)

å¦‚ä¸Šå›¾ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„UIView çš„Blcokï¼Œæ§åˆ¶å™¨èƒ½è¢«é”€æ¯-->è¯´æ˜æ²¡æœ‰å‘é€å¾ªç¯å¼•ç”¨ã€‚

åŸç†ï¼š UIViewçš„è°ƒç”¨çš„æ˜¯ç±»æ–¹æ³•ï¼Œå½“å‰æ§åˆ¶å™¨ä¸å¯èƒ½å¼ºå¼•ç”¨ä¸€ä¸ªç±» ï¼Œæ‰€ä»¥å¾ªç¯æ— æ³•å½¢æˆ --> åŠ¨ç”»blockä¸ä¼šé€ æˆå¾ªç¯å¼•ç”¨çš„åŸå› ã€‚


<br/>

&emsp; AFNä¹Ÿæœ‰å¯èƒ½ä¸ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ï¼Œæ˜¯å› ä¸ºå¯èƒ½åº•å±‚åšäº†ä¸€äº›æ“ä½œå§ã€‚


<br/>

2). é€šçŸ¥+blockå¯èƒ½ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨

å®é™…å¼€å‘ä¸­ï¼šä½¿ç”¨é€šçŸ¥ï¼ˆNSNotifationï¼‰ï¼Œè°ƒç”¨ç³»ç»Ÿè‡ªå¸¦çš„Blockï¼Œåœ¨Blockä¸­ä½¿ç”¨self --> ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨ã€‚

![twoVCå‘é€é€šçŸ¥ --> ç»™oneVC <br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd12.1.png)

![oneVC æ¥æ”¶é€šçŸ¥ ä½¿ç”¨é€šçŸ¥-å‘ç”Ÿå¾ªç¯å¼•ç”¨<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd12.2.png)

![ä½¿ç”¨é€šçŸ¥-å‘ç”Ÿå¾ªç¯å¼•ç”¨ <br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd12.3.png)


**è§£å†³æ–¹æ³•ï¼š`ä½¿ç”¨weakSelf`**

<br/>

2). AFNæ¡†æ¶çš„Block



<br/>
<br/>


>## <h2 id="KVOçš„åŸç†"> [KVOçš„åŸç†](https://www.jianshu.com/p/e59bb8f59302) </h2>

- **åŸºæœ¬åŸç†ï¼š**
	- 	å½“è§‚å¯ŸæŸå¯¹è±¡ A æ—¶ï¼ŒKVO æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aå½“å‰ç±»çš„å­ç±»ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„å­ç±»é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§ keyPath çš„ setter æ–¹æ³•ã€‚setter æ–¹æ³•éšåè´Ÿè´£é€šçŸ¥è§‚å¯Ÿå¯¹è±¡å±æ€§çš„æ”¹å˜çŠ¶å†µã€‚

<br/>

- **æ·±å…¥å‰–æåŸç†ï¼š**

>Apple ä½¿ç”¨äº† isa æ··å†™ï¼ˆisa-swizzlingï¼‰æ¥å®ç° KVO ã€‚å½“è§‚å¯Ÿå¯¹è±¡Aæ—¶ï¼ŒKVOæœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºï¼šNSKVONotifying_A çš„æ–°ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªå¯¹è±¡Açš„æœ¬ç±»ï¼Œä¸” KVO ä¸º NSKVONotifying_A é‡å†™è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ï¼Œsetter æ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸ setter æ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼çš„æ›´æ”¹æƒ…å†µã€‚
ï¼ˆå¤‡æ³¨ï¼š isa æ··å†™ï¼ˆisa-swizzlingï¼‰isaï¼šis a kind of ï¼› swizzlingï¼šæ··åˆï¼Œæ…åˆï¼›ï¼‰

>â‘ NSKVONotifying_A ç±»å‰–æï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„ isa æŒ‡é’ˆä»æŒ‡å‘åŸæ¥çš„ A ç±»ï¼Œè¢« KVO æœºåˆ¶ä¿®æ”¹ä¸ºæŒ‡å‘ç³»ç»Ÿæ–°åˆ›å»ºçš„å­ç±» NSKVONotifying_A ç±»ï¼Œæ¥å®ç°å½“å‰ç±»å±æ€§å€¼æ”¹å˜çš„ç›‘å¬ï¼›
æ‰€ä»¥å½“æˆ‘ä»¬ä»åº”ç”¨å±‚é¢ä¸Šçœ‹æ¥ï¼Œå®Œå…¨æ²¡æœ‰æ„è¯†åˆ°æœ‰æ–°çš„ç±»å‡ºç°ï¼Œè¿™æ˜¯ç³»ç»Ÿâ€œéšç’â€äº†å¯¹ KVO çš„åº•å±‚å®ç°è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬è¯¯ä»¥ä¸ºè¿˜æ˜¯åŸæ¥çš„ç±»ã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºâ€œNSKVONotifying_Aâ€çš„ç±»ï¼Œå°±ä¼šå‘ç°ç³»ç»Ÿè¿è¡Œåˆ°æ³¨å†Œ KVO çš„é‚£æ®µä»£ç æ—¶ç¨‹åºå°±å´©æºƒï¼Œå› ä¸ºç³»ç»Ÿåœ¨æ³¨å†Œç›‘å¬çš„æ—¶å€™åŠ¨æ€åˆ›å»ºäº†åä¸º NSKVONotifying_A çš„ä¸­é—´ç±»ï¼Œå¹¶æŒ‡å‘è¿™ä¸ªä¸­é—´ç±»äº†ã€‚
ï¼ˆisa æŒ‡é’ˆçš„ä½œç”¨ï¼šæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ isa æŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„ç±»ï¼Œå®ƒå‘Šè¯‰ Runtime ç³»ç»Ÿè¿™ä¸ªå¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆã€‚æ‰€ä»¥å¯¹è±¡æ³¨å†Œä¸ºè§‚å¯Ÿè€…æ—¶ï¼Œisa æŒ‡é’ˆæŒ‡å‘æ–°å­ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªè¢«è§‚å¯Ÿçš„å¯¹è±¡å°±ç¥å¥‡åœ°å˜æˆæ–°å­ç±»çš„å¯¹è±¡ï¼ˆæˆ–å®ä¾‹ï¼‰äº†ã€‚ï¼‰ å› è€Œåœ¨è¯¥å¯¹è±¡ä¸Šå¯¹ setter çš„è°ƒç”¨å°±ä¼šè°ƒç”¨å·²é‡å†™çš„ setterï¼Œä»è€Œæ¿€æ´»é”®å€¼é€šçŸ¥æœºåˆ¶ã€‚
â€”>æˆ‘çŒœï¼Œè¿™ä¹Ÿæ˜¯ KVO å›è°ƒæœºåˆ¶ï¼Œä¸ºä»€ä¹ˆéƒ½ä¿—ç§°KVOæŠ€æœ¯ä¸ºé»‘é­”æ³•çš„åŸå› ä¹‹ä¸€å§ï¼šå†…éƒ¨ç¥ç§˜ã€å¤–è§‚ç®€æ´ã€‚

>â‘¡å­ç±»setteræ–¹æ³•å‰–æï¼šKVO çš„é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äº NSObject çš„ä¸¤ä¸ªæ–¹æ³•:willChangeValueForKey:å’Œ didChangevlueForKey:ï¼Œåœ¨å­˜å–æ•°å€¼çš„å‰ååˆ†åˆ«è°ƒç”¨ 2 ä¸ªæ–¹æ³•ï¼š
è¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKey:è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥ keyPath çš„å±æ€§å€¼å³å°†å˜æ›´ï¼›å½“æ”¹å˜å‘ç”Ÿåï¼Œ didChangeValueForKey: è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥ keyPath çš„å±æ€§å€¼å·²ç»å˜æ›´ï¼›ä¹‹åï¼Œ observeValueForKey:ofObject:change:context: ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ä¸”é‡å†™è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•è¿™ç§ç»§æ‰¿æ–¹å¼çš„æ³¨å…¥æ˜¯åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶å®ç°çš„ã€‚
KVO ä¸ºå­ç±»çš„è§‚å¯Ÿè€…å±æ€§é‡å†™è°ƒç”¨å­˜å–æ–¹æ³•çš„å·¥ä½œåŸç†åœ¨ä»£ç ä¸­ç›¸å½“äºï¼š


```
-(void)setName:(NSString *)newName{
    [self willChangeValueForKey:@"name"];    //KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹å‰æ€»è°ƒç”¨
    [super setValue:newName forKey:@"name"]; //è°ƒç”¨çˆ¶ç±»çš„å­˜å–æ–¹æ³•
    [self didChangeValueForKey:@"name"];     //KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹åæ€»è°ƒç”¨
}
```


**å˜¿ä¾é¢è¯•æé—®ï¼š**	å½“ä½¿ç”¨KVOæ—¶ï¼Œä¸€ä¸ªç±»çš„å®ä¾‹ä½¿ç”¨kvoï¼Œå®ƒçš„å±æ€§å€¼æ”¹å˜äº†ï¼Œé‚£å®ƒçš„å¦ä¸€ä¸ªå®ä¾‹å˜é‡å±æ€§å€¼ä¼šå˜å—ï¼Ÿ

æ¯”å¦‚å®ƒæœ‰2ä¸ªå®ä¾‹å˜é‡åˆ†åˆ«æ˜¯Aï¼ŒBï¼Œè‹¥æ˜¯AåŠ çš„å±æ€§æ·»åŠ ç›‘å¬è€ŒBæ²¡æœ‰æ·»åŠ ç›‘å¬ï¼Œåˆ™Açš„å±æ€§å€¼å¯ä»¥æ”¹å˜Bçš„ä¸å˜ã€‚

è‹¥2è€…éƒ½æ·»åŠ çˆ±äº†ç›‘å¬ï¼Œåˆ™å±æ€§å€¼éƒ½ä¼šæ”¹å˜ã€‚


<br/>

æ³¨æ„ï¼šè§‚å¯Ÿè€…æ˜¯è°ï¼Œå°±åœ¨è°é‡Œé¢å†™è§‚å¯Ÿè€…æ–¹æ³•

```
//è§‚å¯Ÿè€…æ˜¯self
[self.myObject addObserver:self
                       forKeyPath:@"num"
                          options:NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew
                          context:nil];
                          
                          

//è§‚å¯Ÿé”®å€¼æ–¹æ³•                          
-(void)observeValueForKeyPath:(NSString *)keyPath
                     ofObject:(id)object
                       change:(NSDictionary<NSString *,id> *)change
                      context:(void *)context {}
```




<br/>
storehubæé—®ï¼šNSNotificationçš„classæ–¹æ³•æŒ‡å‘è°ï¼Ÿ

é”™è¯¯ç­”æ¡ˆï¼šæŒ‡å‘äº†**NSKVONotifying_MyKVOModel**ï¼Œè¿™è¯´æ˜ä½ æ ¹æœ¬å°±æ²¡æœ‰ç†è§£classæ–¹æ³•å¦‚ä½•ä½¿ç”¨çš„ã€‚

```
#import <objc/message.h>


- (void)viewDidLoad {
    [super viewDidLoad];
    
    // åˆå§‹åŒ–å¾…è§‚å¯Ÿç±»å¯¹è±¡
    self.myObject2 = [[MyKVOModel alloc]init];
    self.myObject2.num = 2;
    
    [self.myObject2 addObserver:self
                       forKeyPath:@"num"
                          options:NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew
                          context:nil];
                          
    NSLog(@"%@", [self.myObject2 class]);
	//[obj class]è¿”å›ç±»å¯¹è±¡æœ¬èº«
	NSLog(@"---->>>2: %@", [self.myObject2 class]);
	
	//object_getClass(obj)è¿”å›ç±»å¯¹è±¡ä¸­çš„isaæŒ‡å‘çš„å…ƒç±»å¯¹è±¡ï¼Œå³æŒ‡å‘å…ƒç±»å¯¹è±¡
	NSLog(@"---->>>3: %s", object_getClassName(self.myObject2));
	NSLog(@"---->>>4: %@", object_getClass(self.myObject2));
}

```

æ‰“å°ç»“æœï¼š

```
2021-05-27 12:31:41.461998+0800 KVOæ¼”ç¤º[5668:218909] MyKVOModel
2021-05-27 12:31:43.766168+0800 KVOæ¼”ç¤º[5668:218909] ---->>>2: MyKVOModel
2021-05-27 12:31:49.794671+0800 KVOæ¼”ç¤º[5668:218909] ---->>>3: NSKVONotifying_MyKVOModel
2021-05-27 12:31:50.925324+0800 KVOæ¼”ç¤º[5668:218909] ---->>>4: NSKVONotifying_MyKVOModel

```




<br/>
<br/>


> <h2 id="APNSåº•å±‚åŸç†">APNSå¦‚ä½•é€šçŸ¥çš„ï¼Œåº•å±‚å¦‚ä½•å¤„ç†ï¼Ÿ</h2>
[APNsè¿œç¨‹æ¨é€è¯¦è§£](https://juejin.cn/post/6844903893592178696#heading-42)


- **æ¨é€çš„å®ç°æ–¹å¼ï¼š** 
	- æ‰‹æœºå®¢æˆ·ç«¯å’ŒAPNSæœåŠ¡å™¨ä¹‹é—´ç»´æŒä¸€ä¸ªTCP/IPé•¿è¿æ¥ï¼ŒAPNSæœåŠ¡å™¨å‘å®¢æˆ·ç«¯pushæ¶ˆæ¯ã€‚ 
	- è‹¹æœçš„æ¨é€ç³»ç»Ÿæ˜¯åœ¨ç³»ç»Ÿçº§åˆ«ç»´æŠ¤ä¸€ä¸ªTCP/IPé•¿è¿æ¥ï¼ˆæ‰€ä»¥ä½ éœ€è¦æ³¨å†Œæ¨é€è¯ä¹¦ï¼‰

- **å®ç°æ¶ˆæ¯æ¨é€çš„æ­¥éª¤** 
	- æ³¨å†Œï¼šä¸ºåº”ç”¨ç¨‹åºç”³è¯·æ¶ˆæ¯æ¨é€æœåŠ¡ã€‚æ­¤æ—¶ä½ çš„appä¼šå‘APNsæœåŠ¡å™¨å‘é€æ³¨å†Œè¯·æ±‚ã€‚ 
	- APNsæœåŠ¡å™¨æ¥å—è¯·æ±‚ï¼Œå¹¶å°†deviceTokenå“åº”ç»™ä½ è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åº 
	- å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†deviceTokenå‘é€ç»™åå°æœåŠ¡å™¨ç¨‹åºï¼Œåå°æ¥æ”¶å¹¶å‚¨å­˜ã€‚ 
	- åå°æœåŠ¡å™¨å‘APNsæœåŠ¡å™¨å‘é€æ¨é€æ¶ˆæ¯ 
	- APNsæœåŠ¡å™¨å°†æ¶ˆæ¯å‘ç»™deviceTokenå¯¹åº”çš„åº”ç”¨ç¨‹åº

- æƒ³è¦æ”¶åˆ°æ¨é€æ¶ˆæ¯ï¼Œå°±å¿…é¡»è¦æœ‰åå°æœåŠ¡å™¨ï¼ˆä¸‹é¢çš„1ã€2ï¼‰å¾€ è‹¹æœçš„APNsçš„æœåŠ¡å™¨å‘è¯·æ±‚ã€‚ 
	- 	å…¬å¸è‡ªå·±å¼€å‘åå°æœåŠ¡å™¨ç¨‹åº 
	- 	é‡‡ç”¨ç¬¬ä¸‰æ–¹çš„åå°æœåŠ¡ç¨‹åºï¼Œæ¯”å¦‚ï¼šç™¾åº¦äº‘æ¨é€ã€æå…‰æ¨é€ã€å‹ç›Ÿæ¨é€




[è¿œç¨‹æ¨é€ç¤ºæ„å›¾](https://github.com/harleyGit/StudyNotes/blob/master/iOS/Objective-C/è¿œç¨‹æ¨é€(US).md)


<br/>
<br/>

> <h2 id="NSDictionaryNSArrayåŸç†">NSDictionaryNSArrayåŸç†</h2>
[NSDictionaryåŸç†](https://juejin.cn/post/6844903608954126344)

- NSDictionary
	- NSDictionaryï¼ˆå­—å…¸ï¼‰æ˜¯ä½¿ç”¨ hashè¡¨æ¥å®ç°keyå’Œvalueä¹‹é—´çš„æ˜ å°„å’Œå­˜å‚¨çš„ï¼Œ hashå‡½æ•°è®¾è®¡çš„å¥½åå½±å“ç€æ•°æ®çš„æŸ¥æ‰¾è®¿é—®æ•ˆç‡ã€‚æ•°æ®åœ¨hashè¡¨ä¸­åˆ†å¸ƒçš„è¶Šå‡åŒ€ï¼Œå…¶è®¿é—®æ•ˆç‡è¶Šé«˜ã€‚è€Œåœ¨Objective-Cä¸­ï¼Œé€šå¸¸éƒ½æ˜¯åˆ©ç”¨NSString æ¥ä½œä¸ºé”®å€¼ï¼Œå…¶å†…éƒ¨ä½¿ç”¨çš„hashå‡½æ•°ä¹Ÿæ˜¯é€šè¿‡ä½¿ç”¨ NSStringå¯¹è±¡ä½œä¸ºé”®å€¼æ¥ä¿è¯æ•°æ®çš„å„ä¸ªèŠ‚ç‚¹åœ¨hashè¡¨ä¸­å‡åŒ€åˆ†å¸ƒã€‚

<br/>

**åŸç†ï¼š**
- NSDictionaryæ˜¯é€šè¿‡NSMapTableå®ç°çš„ï¼ŒNSMapTableåŒæ ·æ˜¯ä¸€ä¸ªkeyï¼valueçš„å®¹å™¨ã€‚

- NSMapTableæ˜¯ä¸€ä¸ªå“ˆå¸Œï¼‹é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤åœ¨NSMapTableä¸­æ’å…¥æˆ–è€…åˆ é™¤ä¸€å¯¹å¯¹è±¡æ—¶ï¼Œ
- å¯»æ‰¾çš„æ—¶é—´æ˜¯Oï¼ˆ1ï¼‰ï¼‹Oï¼ˆmï¼‰ï¼Œmæœ€åæ—¶å¯èƒ½ä¸ºn
	- Oï¼ˆ1ï¼‰ï¼šä¸ºå¯¹keyè¿›è¡Œhashå¾—åˆ°bucketçš„ä½ç½®
	- Oï¼ˆmï¼‰ï¼šéå†è¯¥bucketåé¢å†²çªçš„valueï¼Œé€šè¿‡é“¾è¡¨è¿æ¥èµ·æ¥ã€‚

- å› æ­¤NSDictionaryä¸­çš„Key-Valueéå†æ—¶æ˜¯æ— åºçš„ï¼Œè‡³å¦‚æŒ‰ç…§ä»€ä¹ˆæ ·çš„é¡ºåºï¼Œè·Ÿhashå‡½æ•°ç›¸å…³ã€‚NSMapTableä½¿ç”¨NSObjectçš„å“ˆå¸Œå‡½æ•°ã€‚

```
- (NSUInteger)hash {
   return (NSUInteger)self>>4;
}
```
ä¸Šè¿°æ˜¯NSObjectçš„å“ˆå¸Œå€¼çš„è®¡ç®—æ–¹å¼ï¼Œç®€å•é€šè¿‡ç§»ä½å®ç°ã€‚å³ç§»4ä½ï¼Œå·¦è¾¹è¡¥0ã€‚å› ä¸ºå¯¹è±¡å¤§å¤šå­˜äºå †ä¸­ï¼Œåœ°å€ç›¸å·®4ä½åº”è¯¥å¾ˆæ­£å¸¸ã€‚

**å¦‚æœå¯¹è±¡keyçš„hashå€¼ç›¸åŒï¼Œé‚£åœ¨hashè¡¨é‡Œé¢çš„å¯¹åº”çš„valueå€¼æ˜¯ç›¸åŒçš„(valueå€¼è¢«æ›´æ–°äº†)**


<br/>

- NSArrayå®ç°åŸç†ï¼š

&emspï¼› [NSArrayåŸç†](https://blog.csdn.net/Deft_MKJing/article/details/82732833)å¾—ç›Šäºä½¿ç”¨äº†ç¯å½¢ç¼“å†²åŒºçš„æ–¹æ³•ã€‚

**ivars çš„æ„æ€ï¼š**

```
_used æ˜¯è®¡æ•°çš„æ„æ€
_list æ˜¯ç¼“å†²åŒºæŒ‡é’ˆ
_size æ˜¯ç¼“å†²åŒºçš„å¤§å°
_offset æ˜¯åœ¨ç¼“å†²åŒºé‡Œçš„æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç´¢å¼•
```

<br/>

**å†…å­˜å¸ƒå±€:**

&emsp; æœ€å…³é”®çš„éƒ¨åˆ†æ˜¯å†³å®š realOffset åº”è¯¥ç­‰äº fetchOffsetï¼ˆå‡å» 0ï¼‰è¿˜æ˜¯ fetchOffset å‡ _sizeã€‚çœ‹ç€çº¯ä»£ç ä¸ä¸€å®šèƒ½ç”»å‡ºå®Œç¾çš„å›¾ç”»ï¼Œæˆ‘ä»¬è®¾æƒ³ä¸€ä¸‹ä¸¤ä¸ªå…³äºå¦‚ä½•è·å–å¯¹è±¡çš„ä¾‹å­ã€‚


<br/>
<br/>

>  <h2 id="selfå’Œsuperå®ç°çš„åŸç†">selfå’Œsuperå®ç°çš„åŸç†</h2>
[selfå’Œsuperå®ç°çš„åŸç†](https://www.jianshu.com/p/7a9912c97fdb)


**class æ–¹æ³•åªæ˜¯è·å–ç±»ï¼Œå¹¶ä¸èƒ½è·å–çœŸæ­£è·å–å…¶ç±»å¯¹è±¡ã€‚**

- **åŸç†ï¼š**
	- self è°ƒç”¨æ–¹æ³•äº‹å®é™…ä¸Šæ˜¯é€šè¿‡objc_msgSend(id _Nullable self, SEL _Nonnull op, ...)å‡½æ•°è¿›è¡Œæ¶ˆæ¯çš„å‘é€ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯æ¥æ”¶è€…ï¼Œç¬¬äºŒä¸ªå‚æ•°opæ˜¯è°ƒç”¨çš„å…·ä½“ç±»çš„æ–¹æ³•çš„selectorï¼Œåé¢æ˜¯ selector æ–¹æ³•çš„å¯å˜å‚æ•°ã€‚å¦‚ä¸Šä¾‹æ‰€ç¤º[self returnSomething]å®é™…ä¸Šæ˜¯id _Nullable objc_msgSend(self, @selector(returnSomething))è€ŒreturnSomethingæ–¹æ³•ä¼šä»[self class]ç±»ä¸­æŸ¥æ‰¾ã€‚
	
	- superè°ƒç”¨æ–¹æ³•äº‹å®é™…ä¸Šæ˜¯é€šè¿‡id _Nullable objc_msgSendSuper(struct objc_super * _Nonnull super, SEL _Nonnull op, ...)å‡½æ•°è¿›è¡Œæ¶ˆæ¯çš„å‘é€ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªobjc_superç»“æ„ä½“ã€‚

```
struct objc_super {
    __unsafe_unretained _Nonnull id receiver;
    __unsafe_unretained _Nonnull Class super_class;
};
```

- æ­¤æ—¶è¿™ä¸ªç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡receiverå°±æ˜¯å­ç±»ï¼Œå’Œ objc_msgSend ä¸­çš„selfç›¸åŒã€‚è€Œç¬¬äºŒä¸ªæˆå‘˜å˜é‡super_classå°±æ˜¯æŒ‡çˆ¶ç±»ï¼Œè°ƒç”¨ objc_msgSendSuper çš„æ–¹æ³•æ—¶ä¼šå°†è¿™ä¸ªç»“æ„ä½“å’ŒreturnSomethingçš„selectorä¼ é€’è¿‡å»ã€‚

- åœ¨ç»“æ„ä½“å‡½æ•°é‡Œé¢åšçš„äº‹æƒ…ç±»ä¼¼è¿™æ ·ï¼šä»objc_superç»“æ„ä½“æŒ‡å‘çš„super_classçš„æ–¹æ³•åˆ—è¡¨å¼€å§‹æ‰¾ returnSomethingçš„selectorï¼Œæ‰¾åˆ°åå†ç”¨objc_super->receiverå»è°ƒç”¨è¿™ä¸ªselectorã€‚æ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™ã€‚




<br/>
<br/>

>## <h2 id="å†…å­˜ç®¡ç†">[å†…å­˜ç®¡ç†](https://github.com/harleyGit/StudyNotes/blob/master/åº•å±‚/å†…å­˜ç®¡ç†.md)</h2>




<br/>
<br/>



>### <h3 id="isaæŒ‡é’ˆåŒ…å«äº†ä»€ä¹ˆ">[isaæŒ‡é’ˆåŒ…å«äº†ä»€ä¹ˆ](https://juejin.cn/post/6844904134286524429#heading-2)</h3>

åœ¨æ§åˆ¶å°è¾“å‡ºobjçš„æ•°æ®ç»“æ„ï¼Œæ’åœ¨ç¬¬ä¸€ä½çš„å°±æ˜¯isaçš„åœ°å€ã€‚

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd14.jpeg)

&emsp; è‹¥å¯¹è±¡ç»§æ‰¿è‡ªNSObjectï¼ŒNSObjectåœ¨åº•å±‚çš„å®ç°æ˜¯ç»“æ„ä½“objc_objectï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªisaæˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¯¹è±¡çš„é¦–åœ°å€æŒ‡å‘çš„ç¬¬ä¸€å—å°±æ˜¯isaæ‰€åœ¨ã€‚


ä»æºç é‡Œé¢çœ‹isaæ˜¯Classç±»å‹ï¼š

```
struct objc_object {
	Class _Nonnull isa OBJC_ISA_AVAILABILITY;
}
```

Class ç±»å‹å…¶å®æ˜¯objc_class:

```
typedef struct objc_class *Class;
typedef struct objc_object *id;

```


&emsp; å¯ä»¥çœ‹åˆ°objc_classç»§æ‰¿è‡ªobjc_objectï¼Œé‚£ä¹ˆé‡Œé¢å°±åº”è¯¥æœ‰ä¸€ä¸ªisaã€‚æ­¤å¤–è¿˜æœ‰çš„æˆå‘˜å˜é‡å°±æ˜¯**`superclassã€cacheã€bitsã€data`**ï¼Œåœ¨**`objc-runtime-new.h`**æ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯æœ€æ–°çš„:

```
struct objc_class : objc_object {
    // Class ISA;
    Class superclass;
    cache_t cache;             // æ–¹æ³•ç¼“å­˜
    class_data_bits_t bits;    // è·å–å…·ä½“ç±»ä¿¡æ¯

    class_rw_t *data() const {
        return bits.data();
    }
    void setData(class_rw_t *newData) {
        bits.setData(newData);
    }

    void setInfo(uint32_t set) {
        ASSERT(isFuture()  ||  isRealized());
        data()->setFlags(set);
    }

    void clearInfo(uint32_t clear) {
        ASSERT(isFuture()  ||  isRealized());
        data()->clearFlags(clear);
    }

    // set and clear must not overlap
    void changeInfo(uint32_t set, uint32_t clear) {
        ASSERT(isFuture()  ||  isRealized());
        ASSERT((set & clear) == 0);
        data()->changeFlags(set, clear);
    }
    
    Â· Â· Â· Â· Â· Â· Â· Â· Â· Â·
    
    Â· Â· Â· Â· Â· Â· Â· Â·
    
    Â· Â· Â· Â· Â· Â·
    
    //ä¸‹é¢è¿˜æœ‰300å¤šè¡Œä»£ç ï¼Œæˆ‘å°±ä¸ç²˜è´´å¤åˆ¶äº†
}


```


<br/>

**isaç»“æ„**

ä»ä¸Šé¢çš„ä»£ç çœ‹ï¼Œè¿˜æ˜¯çœ‹ä¸å‡ºisaçš„ç»“æ„ï¼Œä½†æ˜¯çœ‹è¿‡ [**iOS alloc & init æ–¹æ³•è§£æ**](https://juejin.cn/post/6844904133074370573) çš„æœ‹å‹åº”è¯¥æœ‰å°è±¡ï¼Œåœ¨allocæ–¹æ³•é‡Œé¢ä¼šè°ƒç”¨ä¸€ä¸ªå«initIsa()çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰¾åˆ°isaçš„çœŸæ­£ç»“æ„å‘¢ï¼Ÿ

åœ¨runtimeçš„æºç æ–‡ä»¶**objc-object.h**,å¯ä»¥çœ‹åˆ°è¿™ä¸ªC++æ–¹æ³•ï¼š**objc_object::initIsa**

![<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd15.png)

ç‚¹å‡»isa_t,å‘ç°å…¶æ˜¯ä¸ªè”åˆä½“ï¼Œæ¥ä¸‹æ¥çœ‹**ISA_BITFIELD**


```
#include "isa.h"

union isa_t {
    isa_t() { }
    isa_t(uintptr_t value) : bits(value) { }

    Class cls;
    uintptr_t bits;
#if defined(ISA_BITFIELD)
    struct {
        ISA_BITFIELD;  // defined in isa.h
    };
#endif
};
```


ç‚¹å‡» ISA_BITFIELDå¯ä»¥çœ‹åˆ°å…¶å®å®šä¹‰å†…å®¹ï¼š

```
#if SUPPORT_PACKED_ISA

    // extra_rc must be the MSB-most field (so it matches carry/overflow flags)
    // nonpointer must be the LSB (fixme or get rid of it)
    // shiftcls must occupy the same bits that a real class pointer would
    // bits + RC_ONE is equivalent to extra_rc + 1
    // RC_HALF is the high bit of extra_rc (i.e. half of its range)

    // future expansion:
    // uintptr_t fast_rr : 1;     // no r/r overrides
    // uintptr_t lock : 2;        // lock for atomic property, @synch
    // uintptr_t extraBytes : 1;  // allocated with extra bytes

# if __arm64__
#   define ISA_MASK        0x0000000ffffffff8ULL
#   define ISA_MAGIC_MASK  0x000003f000000001ULL
#   define ISA_MAGIC_VALUE 0x000001a000000001ULL
#   define ISA_BITFIELD                                                      \
      uintptr_t nonpointer        : 1;                                       \
      uintptr_t has_assoc         : 1;                                       \
      uintptr_t has_cxx_dtor      : 1;                                       \
      uintptr_t shiftcls          : 33; /*MACH_VM_MAX_ADDRESS 0x1000000000*/ \
      uintptr_t magic             : 6;                                       \
      uintptr_t weakly_referenced : 1;                                       \
      uintptr_t deallocating      : 1;                                       \
      uintptr_t has_sidetable_rc  : 1;                                       \
      uintptr_t extra_rc          : 19
#   define RC_ONE   (1ULL<<45)
#   define RC_HALF  (1ULL<<18)

# elif __x86_64__
#   define ISA_MASK        0x00007ffffffffff8ULL
#   define ISA_MAGIC_MASK  0x001f800000000001ULL
#   define ISA_MAGIC_VALUE 0x001d800000000001ULL
#   define ISA_BITFIELD                                                        \
      uintptr_t nonpointer        : 1;                                         \
      uintptr_t has_assoc         : 1;                                         \
      uintptr_t has_cxx_dtor      : 1;                                         \
      uintptr_t shiftcls          : 44; /*MACH_VM_MAX_ADDRESS 0x7fffffe00000*/ \
      uintptr_t magic             : 6;                                         \
      uintptr_t weakly_referenced : 1;                                         \
      uintptr_t deallocating      : 1;                                         \
      uintptr_t has_sidetable_rc  : 1;                                         \
      uintptr_t extra_rc          : 8
#   define RC_ONE   (1ULL<<56)
#   define RC_HALF  (1ULL<<7)

# else
#   error unknown architecture for packed isa
# endif

// SUPPORT_PACKED_ISA
#endif

```

| å‚æ•°å | ä½œç”¨ | å¤§å° | æ‰€åœ¨ä½ç½® |
|:--|:--|:--|:--|
| nonpointer | æ˜¯å¦å¯¹isaæŒ‡é’ˆå¼€å¯æŒ‡é’ˆä¼˜åŒ– 0ï¼šçº¯isaæŒ‡é’ˆåªåŒ…å«ç±»å¯¹è±¡åœ°å€  1ï¼šisaä¸­åŒ…å«äº†ç±»å¯¹è±¡åœ°å€ã€ç±»ä¿¡æ¯ã€å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ç­‰ | 1 | 0 |
| has_assoc | æ˜¯å¦æœ‰å…³è”å¯¹è±¡ 0ï¼šæ²¡æœ‰ 1ï¼šå­˜åœ¨ | 1 | 1 |
| has_cxx_dtor | è¯¥å¯¹è±¡æ˜¯å¦æœ‰C++æˆ–è€…Objcçš„ææ„å™¨ å¦‚æœæœ‰ææ„å‡½æ•°åˆ™éœ€è¦åšææ„é€»è¾‘ å¦‚æœæ²¡æœ‰åˆ™å¯ä»¥æ›´å¿«çš„é‡Šæ”¾å¯¹è±¡ | 1 | 2 |
| shiftcls | å­˜å‚¨ç±»æŒ‡é’ˆçš„å€¼ã€‚å¼€å¯æŒ‡é’ˆä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œåœ¨arm64æ¶æ„ä¸­æœ‰ 33 ä½ç”¨æ¥å­˜å‚¨ç±»æŒ‡é’ˆ | 33 | 3 ~ 35 |
| magic | ç”¨äºè°ƒè¯•å™¨åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯çœŸçš„å¯¹è±¡è¿˜æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ç©ºé—´ | 5 | 36 ~ 40 |
| weakly_referenced | æ˜¯å¦æœ‰å¼±å¼•ç”¨ 0ï¼šæ²¡æœ‰1ï¼šå­˜åœ¨ | 1 | 41 |
| deallocating | æ˜¯å¦æ­£åœ¨é‡Šæ”¾å†…å­˜ 0ï¼šä¸æ˜¯ 1ï¼šæ˜¯ | 1 | 42 |
| has_sidetable_rc | æ˜¯å¦éœ€è¦ç”¨åˆ°å¤–æŒ‚å¼•ç”¨è®¡æ•°ï¼Œå½“å¯¹è±¡å¼•ç”¨æŠ€æœ¯å¤§äº 10 åˆ™éœ€è¦å€Ÿç”¨è¯¥å˜é‡å­˜å‚¨è¿›ä½ | 1 | 43 |
| extra_rc | è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å€¼ï¼Œå®é™…ä¸Šæ˜¯å¼•ç”¨è®¡æ•°å€¼å‡ 1ã€‚ å¦‚æœå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º10ï¼Œé‚£ä¹ˆ extra_rc ä¸º 9ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å¤§äº 10 åˆ™éœ€è¦ä½¿ç”¨ has_sidetable_rc | 19 | 44 ~ 63 |

<br/>
<br/>




>### <h3 id="weakåŸç†">[weakåŸç†](http://www.cocoachina.com/articles/18962)</h3>


&emsp; **ä»‹ç»ï¼š**Runtimeç»´æŠ¤äº†ä¸€ä¸ªweakè¡¨ï¼Œç”¨äºå­˜å‚¨æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰weakæŒ‡é’ˆã€‚weakè¡¨å…¶å®æ˜¯ä¸€ä¸ªhashï¼ˆå“ˆå¸Œï¼‰è¡¨ï¼ŒKeyæ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼ŒValueæ˜¯weakæŒ‡é’ˆçš„åœ°å€æ•°ç»„ã€‚æ›´å¤šäººçš„äººåªæ˜¯çŸ¥é“weakæ˜¯å¼±å¼•ç”¨ï¼Œæ‰€å¼•ç”¨å¯¹è±¡çš„è®¡æ•°å™¨ä¸ä¼šåŠ ä¸€ï¼Œå¹¶åœ¨å¼•ç”¨å¯¹è±¡è¢«é‡Šæ”¾çš„æ—¶å€™è‡ªåŠ¨è¢«è®¾ç½®ä¸ºnilï¼Œé€šå¸¸ç”¨äºè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚


- weak çš„å®ç°åŸç†å¯ä»¥æ¦‚æ‹¬ä¸€ä¸‹ä¸‰æ­¥ï¼š

	- 1)ã€åˆå§‹åŒ–æ—¶ï¼šruntimeä¼šè°ƒç”¨objc_initWeakå‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„weakæŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚

	- 2)ã€æ·»åŠ å¼•ç”¨æ—¶ï¼šobjc_initWeakå‡½æ•°ä¼šè°ƒç”¨ objc_storeWeak() å‡½æ•°ï¼Œ objc_storeWeak() çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨ã€‚

	- 3)ã€é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨clearDeallocatingå‡½æ•°ã€‚clearDeallocatingå‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰weakæŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸ºnilï¼Œæœ€åæŠŠè¿™ä¸ªentryä»weakè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•ã€‚





>## <h2 id="Categoryå±æ€§æ”¾åœ¨å“ª">[Categoryå±æ€§æ”¾åœ¨å“ª](https://www.jianshu.com/p/bc4678829397)</h2>


Categoryçš„å®ç°åŸç†æˆ–è€…æœ¬è´¨ ï¼Ÿ

Â  Â Categoryç¼–è¯‘ä¹‹åçš„åº•å±‚ç»“æ„æ˜¯struct category_tï¼Œé‡Œé¢å­˜å‚¨ç€åˆ†ç±»çš„å¯¹è±¡æ–¹æ³•ã€ç±»æ–¹æ³•ã€å±æ€§ã€åè®®ä¿¡æ¯

Â  Â  åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œruntimeä¼šå°†Categoryçš„æ•°æ®åˆå¹¶åˆ°ç±»ä¿¡æ¯ä¸­ï¼ˆç±»å¯¹è±¡ã€å…ƒç±»å¯¹è±¡ä¸­ï¼‰

Â  Â  åˆ†ç±»çš„å®ç°åŸç†æ˜¯å°†categoryä¸­çš„æ–¹æ³•ï¼Œå±æ€§ï¼Œåè®®æ•°æ®æ”¾åœ¨category_tç»“æ„ä½“ä¸­ï¼Œç„¶åå°†ç»“æ„ä½“å†…çš„æ–¹æ³•åˆ—è¡¨æ‹·è´åˆ°ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ä¸­ã€‚Â 

3.Categoryçš„åŠ è½½å¤„ç†è¿‡ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ

Â  Â é€šè¿‡RuntimeåŠ è½½æŸä¸ªç±»çš„æ‰€æœ‰Categoryæ•°æ®

Â  Â  æŠŠæ‰€æœ‰Categoryçš„æ–¹æ³•ã€å±æ€§ã€åè®®æ•°æ®ï¼Œåˆå¹¶åˆ°ä¸€ä¸ªå¤§æ•°ç»„ä¸­

Â  Â  åé¢å‚ä¸ç¼–è¯‘çš„Categoryæ•°æ®ï¼Œä¼šåœ¨æ•°ç»„çš„å‰é¢

Â  Â  å°†åˆå¹¶åçš„åˆ†ç±»æ•°æ®ï¼ˆæ–¹æ³•ã€å±æ€§ã€åè®®ï¼‰ï¼Œæ’å…¥åˆ°ç±»åŸæ¥æ•°æ®çš„å‰é¢

å¯ä»¥ç†è§£ä¸ºï¼š

Â  Â  æŠŠ category çš„å®ä¾‹æ–¹æ³•ã€åè®®ä»¥åŠå±æ€§æ·»åŠ åˆ°ç±»ä¸Šã€‚

Â  Â  æŠŠ category çš„ç±»æ–¹æ³•å’Œåè®®æ·»åŠ åˆ°ç±»çš„ metaclass ä¸Šã€‚

å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

category çš„æ–¹æ³•æ²¡æœ‰ã€Œå®Œå…¨æ›¿æ¢æ‰ã€åŸæ¥ç±»å·²ç»æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ category å’ŒåŸæ¥ç±»éƒ½æœ‰ methodAï¼Œé‚£ä¹ˆ category é™„åŠ å®Œæˆä¹‹åï¼Œç±»çš„æ–¹æ³•åˆ—è¡¨é‡Œä¼šæœ‰ä¸¤ä¸ª methodAã€‚

category çš„æ–¹æ³•è¢«æ”¾åˆ°äº†æ–°æ–¹æ³•åˆ—è¡¨çš„å‰é¢ï¼Œè€ŒåŸæ¥ç±»çš„æ–¹æ³•è¢«æ”¾åˆ°äº†æ–°æ–¹æ³•åˆ—è¡¨çš„åé¢ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„category çš„æ–¹æ³•ä¼šã€Œè¦†ç›–ã€æ‰åŸæ¥ç±»çš„åŒåæ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸ºè¿è¡Œæ—¶åœ¨æŸ¥æ‰¾æ–¹æ³•çš„æ—¶å€™æ˜¯é¡ºç€æ–¹æ³•åˆ—è¡¨çš„é¡ºåºæŸ¥æ‰¾çš„ï¼Œå®ƒåªè¦ä¸€æ‰¾åˆ°å¯¹åº”åå­—çš„æ–¹æ³•ï¼Œå°±ä¼šè¿”å›ï¼Œä¸ä¼šç®¡åé¢å¯èƒ½è¿˜æœ‰ä¸€æ ·åå­—çš„æ–¹æ³•ã€‚

4.Categoryä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡?

Category å¯ä»¥ç»™ç±»å¢åŠ æ–¹æ³•å’Œå±æ€§ï¼Œä½†æ˜¯å¹¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡åŠset/getæ–¹æ³•ã€‚å› ä¸ºcategory_tç»“æ„ä½“ä¸­å¹¶ä¸å­˜åœ¨æˆå‘˜å˜é‡ã€‚æˆ‘ä»¬çŸ¥é“æˆå‘˜å˜é‡æ˜¯å­˜æ”¾åœ¨å®ä¾‹å¯¹è±¡ä¸­çš„ï¼Œå¹¶ä¸”ç¼–è¯‘çš„é‚£ä¸€åˆ»å°±å·²ç»å†³å®šå¥½äº†ã€‚è€Œåˆ†ç±»æ˜¯åœ¨è¿è¡Œæ—¶æ‰å»åŠ è½½çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å†ç¨‹åºè¿è¡Œæ—¶å°†åˆ†ç±»çš„æˆå‘˜å˜é‡ä¸­æ·»åŠ åˆ°å®ä¾‹å¯¹è±¡çš„ç»“æ„ä½“ä¸­ã€‚å› æ­¤åˆ†ç±»ä¸­ä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ã€‚

åœ¨ Objective-C æä¾›çš„ runtime å‡½æ•°ä¸­ï¼Œç¡®å®æœ‰ä¸€ä¸ª class_addIvar() å‡½æ•°ç”¨äºç»™ç±»æ·»åŠ æˆå‘˜å˜é‡ï¼Œ

å¤§æ¦‚çš„æ„æ€è¯´ï¼Œè¿™ä¸ªå‡½æ•°åªèƒ½åœ¨â€œæ„å»ºä¸€ä¸ªç±»çš„è¿‡ç¨‹ä¸­â€è°ƒç”¨ã€‚å½“ç¼–è¯‘ç±»çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ç”Ÿæˆäº†ä¸€ä¸ªå®ä¾‹å˜é‡å†…å­˜å¸ƒå±€ ivar layoutï¼Œæ¥å‘Šè¯‰è¿è¡Œæ—¶å»é‚£é‡Œè®¿é—®ç±»çš„å®ä¾‹å˜é‡ä»¬ï¼Œä¸€æ—¦å®Œæˆç±»å®šä¹‰ï¼Œå°±ä¸èƒ½å†æ·»åŠ æˆå‘˜å˜é‡äº†ã€‚ç»è¿‡ç¼–è¯‘çš„ç±»åœ¨ç¨‹åºå¯åŠ¨åå°±è¢« runtime åŠ è½½ï¼Œæ²¡æœ‰æœºä¼šè°ƒç”¨ addIvarã€‚ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ¨æ€æ„å»ºçš„ç±»éœ€è¦åœ¨è°ƒç”¨ objc_registerClassPair ä¹‹åæ‰å¯ä»¥è¢«ä½¿ç”¨ï¼ŒåŒæ ·æ²¡æœ‰æœºä¼šå†æ·»åŠ æˆå‘˜å˜é‡ã€‚

ä¸èƒ½ä¸ºä¸€ä¸ªç±»åŠ¨æ€çš„æ·»åŠ æˆå‘˜å˜é‡ï¼Œå¯ä»¥ç»™ç±»åŠ¨æ€å¢åŠ æ–¹æ³•å’Œå±æ€§ã€‚å› ä¸ºæ–¹æ³•å’Œå±æ€§å¹¶ä¸â€œå±äºâ€ç±»å®ä¾‹ï¼Œè€Œæˆå‘˜å˜é‡â€œå±äºâ€ç±»å®ä¾‹ã€‚æˆ‘ä»¬æ‰€è¯´çš„â€œç±»å®ä¾‹â€æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ä¸€å—å†…å­˜åŒºåŸŸï¼ŒåŒ…å«äº†isaæŒ‡é’ˆå’Œæ‰€æœ‰çš„æˆå‘˜å˜é‡ã€‚æ‰€ä»¥å‡å¦‚å…è®¸åŠ¨æ€ä¿®æ”¹ç±»æˆå‘˜å˜é‡å¸ƒå±€ï¼Œå·²ç»åˆ›å»ºå‡ºçš„ç±»å®ä¾‹å°±ä¸ç¬¦åˆç±»å®šä¹‰äº†ï¼Œå˜æˆäº†æ— æ•ˆå¯¹è±¡ã€‚ä½†æ–¹æ³•å®šä¹‰æ˜¯åœ¨objc_classä¸­ç®¡ç†çš„ï¼Œä¸ç®¡å¦‚ä½•å¢åˆ ç±»æ–¹æ³•ï¼Œéƒ½ä¸å½±å“ç±»å®ä¾‹çš„å†…å­˜å¸ƒå±€ï¼Œå·²ç»åˆ›å»ºå‡ºçš„ç±»å®ä¾‹ä»ç„¶å¯æ­£å¸¸ä½¿ç”¨ã€‚





<br/>

***
<br/>

># ç½‘ç»œ

[**iOSçŠ¶æ€ç è§£è¯»**](https://github.com/ChenYilong/iOSDevelopmentTips/blob/master/Tips/HTTPçŠ¶æ€ç æ±‡æ€».md)

<br/>

> <h2 id="NSURLSessionä¸RunLoopçš„è”ç³»">NSURLSessionä¸RunLoopçš„è”ç³»</h2>


AFNet2.0ç½‘ç»œè¯·æ±‚å¸¸é©»çº¿ç¨‹æœºåˆ¶

```
//ä½¿ç”¨GCDå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹æ¥å‘é€ç½‘ç»œè¯·æ±‚
dispatch_async(dispatch_get_global_queue(0, 0), ^{
    //ä½¿ç”¨éè‡ªåŠ¨å‘é€ç½‘ç»œè¯·æ±‚æ¨¡å¼,å‘é€è¯·æ±‚OK
    /*
    //åˆ›å»ºNSURLConnectionå¯¹è±¡ï¼Œè®¾ç½®ä»£ç†ï¼Œæš‚ä¸å‘é€
	  NSURLConnection *connect =  [[NSURLConnection alloc]initWithRequest:request delegate:self startImmediately:NO];
    //è®¾ç½®ä»£ç†æ–¹æ³•çš„æ‰§è¡Œé˜Ÿåˆ—
    [connect setDelegateQueue:[[NSOperationQueue alloc]init]];

    //è°ƒç”¨startå‘é€ç½‘ç»œè¯·æ±‚
    [connect start];
    */

    //ä½¿ç”¨è‡ªåŠ¨å‘é€ç½‘ç»œè¯·æ±‚æ¨¡å¼ï¼Œå‘é€è¯·æ±‚å¤±è´¥ï¼ˆéœ€è¦æ”¹é€ ä»£ç ï¼‰
    //WHY?
    /*1âƒ£ï¸ ç½‘ç»œè¯·æ±‚å‘é€å’Œæ•°æ®æ¥æ”¶æ˜¯å¦æˆåŠŸï¼Œå’Œä¸€äº›å› ç´ ç›¸å…³ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯çš„ç½‘é€Ÿã€æœåŠ¡å™¨ç«¯çš„æŸ¥è¯¢é€Ÿåº¦ç­‰ç­‰ã€‚
      2âƒ£ï¸ è€Œåœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºçš„NSURLConnectionå¯¹è±¡æ˜¯ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œå½“è¯·æ±‚å‘é€å®Œæˆä¹‹åå°±è¢«é‡Šæ”¾äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å®ƒçš„ä»£ç†æ–¹æ³•ä¸ä¼šè°ƒç”¨ç”¨ã€‚
      3âƒ£ï¸ ä¸ºä»€ä¹ˆä½¿ç”¨éè‡ªåŠ¨å‘é€ç½‘ç»œè¯·æ±‚æ¨¡å¼æ˜¯OKçš„ã€‚
        å› ä¸ºåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œè°ƒç”¨äº†startæ¥å¼€å§‹å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè¯¥æ–¹æ³•å†…éƒ¨ä¼šè‡ªåŠ¨å°†å½“å‰çš„connectä½œä¸ºä¸€ä¸ªSourceæ·»åŠ åˆ°å½“å‰çº¿ç¨‹æ‰€åœ¨çš„Runloopä¸­
        å¦‚æœå½“å‰çº¿ç¨‹æ˜¯å­çº¿ç¨‹ï¼ˆå³å½“å‰çº¿ç¨‹çš„runloopå¹¶æœªåˆ›å»ºï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å†…éƒ¨ä¼šé»˜è®¤å…ˆåˆ›å»ºå½“å‰çº¿ç¨‹çš„Runloop,è®¾ç½®åœ¨runloopçš„é»˜è®¤æ¨¡å¼ä¸‹è¿è¡Œã€‚
        æ­¤æ—¶runloopä¼šå¯¹è¿™ä¸ªConnectå¯¹è±¡è¿›è¡Œå¼ºå¼•ç”¨ï¼Œä¿è¯äº†ä»£ç†æ–¹æ³•è¢«è°ƒç”¨çš„å‰æ
     */
    NSURLConnection *connect = [[NSURLConnection alloc]initWithRequest:request delegate:self];
    [connect setDelegateQueue:[[NSOperationQueue alloc]init]];
    
    //åˆ›å»ºå½“å‰çº¿ç¨‹çš„runloopï¼Œå¹¶å¼€å¯runloop
    [[NSRunLoop currentRunLoop] run];
});

```

&emsp; åœ¨ SDWebImage çš„ v3.7.0 ç‰ˆæœ¬åŠä»¥å‰ï¼Œå¹¶æ²¡æœ‰å¼•å…¥ NSURLSession è€Œæ˜¯é‡‡ç”¨çš„ NSURLConnectionã€‚è€Œåè€…å¾€å¾€æ˜¯éœ€è¦ä¸ Runloop ååŒä½¿ç”¨ï¼Œå› ä¸ºæ¯ä¸ª Connect ä¼šä½œä¸ºä¸€ä¸ª Source æ·»åŠ åˆ°å½“å‰çº¿ç¨‹æ‰€åœ¨çš„ Runloop ä¸­ï¼Œå¹¶ä¸” Runloop ä¼šå¯¹è¿™ä¸ª Connect å¯¹è±¡å¼ºå¼•ç”¨ï¼Œä»¥ä¿è¯ä»£ç†æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚

<br/>

iOS ä¸­ï¼Œå…³äºç½‘ç»œè¯·æ±‚çš„æ¥å£è‡ªä¸‹è‡³ä¸Šæœ‰å¦‚ä¸‹å‡ å±‚:

```
CFSocket
CFNetwork       ->ASIHttpRequest
NSURLConnection ->AFNetworking
NSURLSession    ->AFNetworking2, Alamofire
```


CFSocket æ˜¯æœ€åº•å±‚çš„æ¥å£ï¼Œåªè´Ÿè´£ socket é€šä¿¡ã€‚
- CFNetwork æ˜¯åŸºäº CFSocket ç­‰æ¥å£çš„ä¸Šå±‚å°è£…ï¼ŒASIHttpRequest å·¥ä½œäºè¿™ä¸€å±‚ã€‚
- NSURLConnection æ˜¯åŸºäº CFNetwork çš„æ›´é«˜å±‚çš„å°è£…ï¼Œæä¾›é¢å‘å¯¹è±¡çš„æ¥å£ï¼ŒAFNetworking å·¥ä½œäºè¿™ä¸€å±‚ã€‚
- NSURLSession æ˜¯ iOS7 ä¸­æ–°å¢çš„æ¥å£ï¼Œè¡¨é¢ä¸Šæ˜¯å’Œ NSURLConnection å¹¶åˆ—çš„ï¼Œä½†åº•å±‚ä»ç„¶ç”¨åˆ°äº† NSURLConnection çš„éƒ¨åˆ†åŠŸèƒ½ (æ¯”å¦‚ com.apple.NSURLConnectionLoader çº¿ç¨‹)ï¼ŒAFNetworking2 å’Œ Alamofire å·¥ä½œäºè¿™ä¸€å±‚ã€‚

ä¸‹é¢ä¸»è¦ä»‹ç»ä¸‹ NSURLConnection çš„å·¥ä½œè¿‡ç¨‹ã€‚

&emsp; é€šå¸¸ä½¿ç”¨ NSURLConnection æ—¶ï¼Œä½ ä¼šä¼ å…¥ä¸€ä¸ª Delegateï¼Œå½“è°ƒç”¨äº† [connection start] åï¼Œè¿™ä¸ª Delegate å°±ä¼šä¸åœæ”¶åˆ°äº‹ä»¶å›è°ƒã€‚å®é™…ä¸Šï¼Œstart è¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ä¼šä¼šè·å– CurrentRunLoopï¼Œç„¶ååœ¨å…¶ä¸­çš„ DefaultMode æ·»åŠ äº†4ä¸ª Source0 (å³éœ€è¦æ‰‹åŠ¨è§¦å‘çš„Source)ã€‚CFMultiplexerSource æ˜¯è´Ÿè´£å„ç§ Delegate å›è°ƒçš„ï¼ŒCFHTTPCookieStorage æ˜¯å¤„ç†å„ç§ Cookie çš„ã€‚

&emsp; å½“å¼€å§‹ç½‘ç»œä¼ è¾“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° NSURLConnection åˆ›å»ºäº†ä¸¤ä¸ªæ–°çº¿ç¨‹ï¼šcom.apple.NSURLConnectionLoader å’Œ com.apple.CFSocket.privateã€‚å…¶ä¸­ CFSocket çº¿ç¨‹æ˜¯å¤„ç†åº•å±‚ socket è¿æ¥çš„ã€‚NSURLConnectionLoader è¿™ä¸ªçº¿ç¨‹å†…éƒ¨ä¼šä½¿ç”¨ RunLoop æ¥æ¥æ”¶åº•å±‚ socket çš„äº‹ä»¶ï¼Œå¹¶é€šè¿‡ä¹‹å‰æ·»åŠ çš„ Source0 é€šçŸ¥åˆ°ä¸Šå±‚çš„ Delegateã€‚

<br/>

![ <br/> ](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/AFNet11.png)



**RunLoopå®é™…åº”ç”¨ä¸¾ä¾‹**

AFNetworking
AFURLConnectionOperation è¿™ä¸ªç±»æ˜¯åŸºäº NSURLConnection æ„å»ºçš„ï¼Œå…¶å¸Œæœ›èƒ½åœ¨åå°çº¿ç¨‹æ¥æ”¶ Delegate å›è°ƒã€‚ä¸ºæ­¤ AFNetworking å•ç‹¬åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨äº†ä¸€ä¸ª RunLoopï¼š


```
+ (void)networkRequestThreadEntryPoint:(id)__unused object {
    @autoreleasepool {
        [[NSThread currentThread] setName:@"AFNetworking"];
        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];
        [runLoop run];
    }
}
 
+ (NSThread *)networkRequestThread {
    static NSThread *_networkRequestThread = nil;
    static dispatch_once_t oncePredicate;
    dispatch_once(&oncePredicate, ^{
        _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];
        [_networkRequestThread start];
    });
    return _networkRequestThread;
}
```

RunLoop å¯åŠ¨å‰å†…éƒ¨å¿…é¡»è¦æœ‰è‡³å°‘ä¸€ä¸ª Timer/Observer/Sourceï¼Œæ‰€ä»¥ AFNetworking åœ¨ [runLoop run] ä¹‹å‰å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ NSMachPort æ·»åŠ è¿›å»äº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè°ƒç”¨è€…éœ€è¦æŒæœ‰è¿™ä¸ª NSMachPort (mach_port) å¹¶åœ¨å¤–éƒ¨çº¿ç¨‹é€šè¿‡è¿™ä¸ª port å‘é€æ¶ˆæ¯åˆ° loop å†…ï¼›ä½†æ­¤å¤„æ·»åŠ  port åªæ˜¯ä¸ºäº†è®© RunLoop ä¸è‡³äºé€€å‡ºï¼Œå¹¶æ²¡æœ‰ç”¨äºå®é™…çš„å‘é€æ¶ˆæ¯ã€‚

```
- (void)start {
    [self.lock lock];
    if ([self isCancelled]) {
        [self performSelector:@selector(cancelConnection) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    } else if ([self isReady]) {
        self.state = AFOperationExecutingState;
        [self performSelector:@selector(operationDidStart) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    }
    [self.lock unlock];
}
```

å½“éœ€è¦è¿™ä¸ªåå°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼ŒAFNetworking é€šè¿‡è°ƒç”¨ [NSObject performSelector:onThread:..] å°†è¿™ä¸ªä»»åŠ¡æ‰”åˆ°äº†åå°çº¿ç¨‹çš„ RunLoop ä¸­ã€‚


<br/>
<br/>





>## <h2 id="ç½‘ç»œæ€§èƒ½ä¼˜åŒ–">[**ç½‘ç»œæ€§èƒ½ä¼˜åŒ–**](https://www.jianshu.com/p/a470ab485e39)</h2>


<br/>

- [**ç½‘ç»œç¼“å­˜ï¼ˆURLç¼“å­˜ï¼‰**](https://www.jianshu.com/p/fb5aaeac06ef)

&emsp; å¦‚æœæ‰“ç®—åœ¨é …ç›®ä¸­åŠ å…¥ç¶²çµ¡è«‹æ±‚ç·©å­˜ï¼Œä½ ä¸¦ä¸éœ€è¦è‡ªå·±é€ ä¸€å€‹è¼ªå­ï¼Œç­è§£ä¸€ä¸‹NSURLCacheå°±è¶³å¤ ï¼Œé€™æ˜¯ä¸€å€‹Appleå·²ç¶“ç‚ºä½ æº–å‚™å¥½äº†çš„ç¶²çµ¡è«‹æ±‚ç·©å­˜é¡ã€‚

```
public enum NSURLRequestCachePolicy : UInt {
case UseProtocolCachePolicy // é»˜èªå€¼
case ReloadIgnoringLocalCacheData // ä¸ä½¿ç”¨ç·©å­˜æ•¸æ“š
case ReloadIgnoringLocalAndRemoteCacheData // Unimplemented
public static var ReloadIgnoringCacheData: NSURLRequestCachePolicy { get } //å¿½ç•¥ç¼“å­˜ç›´æ¥ä»åŸå§‹åœ°å€ä¸‹è½½
case ReturnCacheDataElseLoad // ç„¡è«–ç·©å­˜æ˜¯å¦éæœŸéƒ½æ˜¯ç”¨ç·©å­˜ï¼Œæ²’æœ‰ç·©å­˜å°±é€²è¡Œç¶²çµ¡è«‹æ±‚
case ReturnCacheDataDontLoad // ç„¡è«–ç·©å­˜æ˜¯å¦éæœŸéƒ½æ˜¯ç”¨ç·©å­˜ï¼Œæ²’æœ‰ç·©å­˜ä¹Ÿä¸æœƒé€²è¡Œç¶²çµ¡è«‹æ±‚
case ReloadRevalidatingCacheData // Unimplemented
}



//ä½¿ç”¨NSURLCacheä¹‹å‰éœ€è¦åœ¨AppDelegateä¸­ç·©å­˜ç©ºé–“çš„è¨­ç½®ï¼š
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
	NSURLCache *URLCache = [[NSURLCache alloc] initWithMemoryCapacity:4 * 1024 * 1024
	diskCapacity:20 * 1024 * 1024
	diskPath:nil];
	[NSURLCache setSharedURLCache:URLCache];
}
```

&emsp; æ–‡ä»¶çš„ç¼“å­˜æ˜¯å¦æœ‰æ•ˆæ˜¯é€šè¿‡`Last-Modified`å’Œ`ETag`æ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚

<br/>

- **`Last-Modified`**é¡¾åæ€ä¹‰ï¼Œæ˜¯èµ„æºæœ€åä¿®æ”¹çš„æ—¶é—´æˆ³ï¼Œå¾€å¾€ä¸ç¼“å­˜æ—¶é—´è¿›è¡Œå¯¹æ¯”æ¥åˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸã€‚

&emsp; åœ¨æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚æŸä¸€ä¸ªURLæ—¶ï¼ŒæœåŠ¡å™¨ç«¯çš„è¿”å›çŠ¶æ€ä¼šæ˜¯200ï¼Œå†…å®¹æ˜¯ä½ è¯·æ±‚çš„èµ„æºï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªLast-Modifiedçš„å±æ€§æ ‡è®°æ­¤æ–‡ä»¶åœ¨æœåŠ¡æœŸç«¯æœ€åè¢«ä¿®æ”¹çš„æ—¶é—´ï¼Œæ ¼å¼ç±»ä¼¼è¿™æ ·ï¼š

`Last-Modified: Fri, 12 May 2006 18:53:33 GMT`

&emsp; å®¢æˆ·ç«¯ç¬¬äºŒæ¬¡è¯·æ±‚æ­¤URLæ—¶ï¼Œæ ¹æ® HTTP åè®®çš„è§„å®šï¼Œæµè§ˆå™¨ä¼šå‘æœåŠ¡å™¨ä¼ é€ If-Modified-Since æŠ¥å¤´ï¼Œè¯¢é—®è¯¥æ—¶é—´ä¹‹åæ–‡ä»¶æ˜¯å¦æœ‰è¢«ä¿®æ”¹è¿‡ï¼š

`If-Modified-Since: Fri, 12 May 2006 18:53:33 GMT`


<br/>

- ETag æ˜¯çš„åŠŸèƒ½ä¸ Last-Modified ç±»ä¼¼ï¼šæœåŠ¡ç«¯ä¸ä¼šæ¯æ¬¡éƒ½ä¼šè¿”å›æ–‡ä»¶èµ„æºã€‚

&emsp; å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯å‘é€ä¸Šæ¬¡æœåŠ¡å™¨è¿”å›çš„ ETag å€¼ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ ETag å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ¥å†³å®šæ˜¯å¦è¿”å› dataï¼ŒåŒæ—¶æ€»æ˜¯è¿”å›å¯¹åº”çš„ HTTP çŠ¶æ€ç ã€‚å®¢æˆ·ç«¯é€šè¿‡ HTTP çŠ¶æ€ç æ¥å†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€‚æ¯”å¦‚ï¼šæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„ ETag å€¼ç›¸ç­‰ï¼Œåˆ™ HTTP çŠ¶æ€ç ä¸º 304ï¼Œä¸è¿”å› dataã€‚æœåŠ¡ç«¯æ–‡ä»¶ä¸€æ—¦ä¿®æ”¹ï¼ŒæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„ ETag å€¼ä¸ç­‰ï¼Œå¹¶ä¸”çŠ¶æ€å€¼ä¼šå˜ä¸º200ï¼ŒåŒæ—¶è¿”å› dataã€‚


æ€»ç»“ï¼š åœ¨å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£ä¸­æå‡º ETag æ˜¯é¦–é€‰çš„æ–¹å¼ï¼Œä¼˜äº Last-Modified æ–¹å¼ã€‚å› ä¸º ETag æ˜¯åŸºäº hash ï¼Œhash çš„è§„åˆ™å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œè€Œä¸”æ˜¯åŸºäºä¸€è‡´æ€§ï¼Œæ˜¯â€œå¼ºæ ¡éªŒâ€ã€‚ Last-Modified æ˜¯åŸºäºæ—¶é—´ï¼Œæ˜¯å¼±æ ¡éªŒï¼Œå¼±åœ¨å“ªé‡Œï¼Ÿæ¯”å¦‚è¯´ï¼šå¦‚æœæœåŠ¡ç«¯çš„èµ„æºå›æ»šå®¢æˆ·ç«¯çš„ Last-Modified åè€Œä¼šæ¯”æœåŠ¡ç«¯è¿˜è¦æ–°ã€‚


<br/>

- [ç½‘ç»œæ¨¡å—ä¼˜åŒ–(å¤±è´¥ã€ç¼“å­˜è¯·æ±‚é‡å‘)](https://www.cnblogs.com/ziyi--caolu/p/8176331.html)


<br/>

- [HTTPDNSå®è·µ](https://www.jianshu.com/p/fb54405dbdca)

[HTTPDNSåœ¨Appå¼€å‘ä¸­å®è·µæ€»ç»“](http://www.iosfly.com/2016/12/03/HTTPDNS/)

ä¸ºä»€ä¹ˆæœ‰äº›å…¬å¸çš„ç½‘ç»œæ¥å£ä½¿ç”¨çš„è‹±æ–‡åŸŸåè€Œä¸æ˜¯IPåœ°å€ï¼Ÿ

è¿™æ˜¯å› ä¸ºä½¿ç”¨IPåœ°å€å°±å¯ä»¥é˜²æ­¢ä½ çš„åŸŸåè¢«DNSåŠ«æŒï¼Œé€ æˆç½‘ç»œå·®å’Œå…¶ä»–è¿è¥å•†ç»™ä½ åŠ å„ç§å†…å®¹ã€‚

- [HttpDns åœ¨ iOS ç«¯çš„æ¥å…¥æ–¹æ¡ˆ](https://juejin.cn/post/6844904144705339400)

- [å³æ—¶é€šè®¯æ€§èƒ½è°ƒä¼˜](https://github.com/ChenYilong/iOSBlog/issues/6)
- [ç½‘ç»œè¯·æ±‚ä¼˜åŒ–ä¹‹å–æ¶ˆè¯·æ±‚](https://www.jianshu.com/p/20f6172524d6)
- [iOSç½‘ç»œå±‚è®¾è®¡](https://www.jianshu.com/p/fe0dd50d0af1)




<br/>
<br/>


> <h2 id="TCPå’ŒUDPåŒºåˆ«">TCPå’ŒUDPåŒºåˆ«</h2>


- **TCPï¼š**é¢å‘è¿æ¥ã€ä¼ è¾“å¯é (ä¿è¯æ•°æ®æ­£ç¡®æ€§,ä¿è¯æ•°æ®é¡ºåº)ã€ç”¨äºä¼ è¾“å¤§é‡æ•°æ®(æµæ¨¡å¼)ã€é€Ÿåº¦æ…¢ï¼Œå»ºç«‹è¿æ¥éœ€è¦å¼€é”€è¾ƒå¤š(æ—¶é—´ï¼Œç³»ç»Ÿèµ„æº)ã€‚

- **UDPï¼š**é¢å‘éè¿æ¥ã€ä¼ è¾“ä¸å¯é ã€ç”¨äºä¼ è¾“å°‘é‡æ•°æ®(æ•°æ®åŒ…æ¨¡å¼)ã€é€Ÿåº¦å¿«ã€‚

- æ¯”è¾ƒï¼š
	- åŸºäºè¿æ¥ä¸æ— è¿æ¥ï¼›
	- å¯¹ç³»ç»Ÿèµ„æºçš„è¦æ±‚ï¼ˆTCPè¾ƒå¤šï¼ŒUDPå°‘ï¼‰ï¼›
	- UDPç¨‹åºç»“æ„è¾ƒç®€å•ï¼›
	- æµæ¨¡å¼ä¸æ•°æ®æŠ¥æ¨¡å¼ ï¼›
	- TCPä¿è¯æ•°æ®æ­£ç¡®æ€§ï¼ŒUDPå¯èƒ½ä¸¢åŒ…ï¼ŒTCPä¿è¯æ•°æ®é¡ºåºï¼ŒUDPä¸ä¿è¯




<br/>
<br/>

> <h2 id="Socketé€šä¿¡">Socketé€šä¿¡</h2>

<br/>

> <h3 id="Socketå°åŒ…æ‹†åŒ…">Socketå°åŒ…ã€æ‹†åŒ…</h3>
[Socketå°åŒ…ã€ç²˜åŒ…ã€æ‹†åŒ…å¤„ç†](https://www.jianshu.com/p/9ea0f0c84990)


&emsp; iOSå®¢æˆ·ç«¯ç”¨ç¬¬ä¸‰æ–¹[CocoaAsyncSocket](https://github.com/robbiehanson/CocoaAsyncSocket)æ¥è¿›è¡Œé•¿è¿æ¥è¿æ¥å’Œä¼ è¾“æ•°æ®ã€‚

&emsp; ä¸€èˆ¬åœ¨ä½¿ç”¨Socketçš„æ—¶å€™ï¼Œåå°ä¼šå¯¹Socketä¼ è¾“æ•°æ®æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„åè®®ï¼Œåè®®å¯èƒ½æœ‰äº›å·®åˆ«ä¸è¿‡åŸºæœ¬ä¸Šæ˜¯å¤§åŒå°å¼‚ã€‚ å¦‚å›¾

![åŸºæœ¬å®šåˆ¶åè®®<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd9.png)

&emsp; ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬é€šè¿‡Socketå‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ï¼Œæœ€ç»ˆè¦è½¬æ¢æˆäºŒè¿›åˆ¶æµæ•°æ®ï¼Œå¹¶ä¸”æŒ‰ç…§åè®®çº¦å®šçš„æ ¼å¼ã€‚

&emsp; ä¸‹é¢æˆ‘ç®€å•è§£é‡Šä¸‹è¿™ä¸ªåè®®ï¼Œå› ä¸ºä¸€å¼€å§‹æˆ‘è‡ªå·±ä¹Ÿä¸æ˜¯å¾ˆç†è§£ã€‚è¿™ä¸ªåè®®æ˜¯æŒ‡æˆ‘ä»¬åœ¨å‘é€çš„æ•°æ®åŒ…å¤´éƒ¨å¼€è¾Ÿä¸€ä¸ª4ä¸ªå­—èŠ‚é•¿åº¦çš„ç©ºé—´ï¼Œç”¨æ¥å­˜å‚¨æœåŠ¡å·è½¬æ¢æˆçš„äºŒè¿›åˆ¶æ•°æ®ã€‚ï¼ˆå°†1è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®å­˜å‚¨è¿›å»å 4ä¸ªå­—èŠ‚é•¿åº¦ï¼‰ï¼Œç„¶åå†å°†æ•°æ®åŒ…é•¿åº¦è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®å¹¶å­˜å‚¨åˆ°åé¢å¼€è¾Ÿçš„4ä¸ªå­—èŠ‚ä¸­ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„ä¸‹å¦‚æœæ•°æ®è¦è¿›è¡ŒåŠ å¯†ä¼ è¾“ï¼Œè¿™é‡Œçš„é•¿åº¦åº”æ˜¯åŠ å¯†åçš„é•¿åº¦ï¼‰ï¼Œæœ€åå°†æ•°æ®æ•°æ®åŒ…è½¬æ¢æˆäºŒè¿›åˆ¶æ•°æ®æ·»åŠ åˆ°åé¢ï¼Œç»„æˆä¸€ä¸ªå®Œæ•´çš„æ•°æ®åŒ…ä¹Ÿå°±æ˜¯å°åŒ…ã€‚è¿™é‡Œä¸€å®šè¦æŒ‰åè®®è§„å®šçš„é¡ºåºä¸ç„¶æœåŠ¡å™¨è§£æä¸äº†ã€‚


&emsp; **å­—æ®µå®šä¹‰ï¼š**
- **ç²˜åŒ…ï¼š**
	- æŒ‡TCPåè®®ä¸­ï¼Œå‘é€æ–¹å‘é€çš„è‹¥å¹²åŒ…æ•°æ®åˆ°æ¥æ”¶æ–¹æ¥æ”¶æ—¶ç²˜æˆä¸€åŒ…ï¼Œä»æ¥æ”¶ç¼“å†²åŒºçœ‹ï¼Œåä¸€åŒ…æ•°æ®çš„å¤´ç´§æ¥ç€å‰ä¸€åŒ…æ•°æ®çš„å°¾ã€‚
	
	- TCPæ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼Œå°±æ˜¯æ²¡æœ‰ç•Œé™çš„ä¸€ä¸²æ•°æ®ï¼Œæœ¬æ²¡æœ‰â€œåŒ…â€çš„æ¦‚å¿µï¼Œâ€œç²˜åŒ…â€å’Œâ€œæ‹†åŒ…â€ä¸€è¯´æ˜¯ä¸ºäº†æœ‰åŠ©äºå½¢è±¡åœ°ç†è§£è¿™ä¸¤ç§ç°è±¡ã€‚


<br/>

- **æé—®ï¼šä¸ºä»€ä¹ˆUDPæ²¡æœ‰ç²˜åŒ…ï¼Ÿ**
	- ç²˜åŒ…æ‹†åŒ…é—®é¢˜åœ¨æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ä»¥åŠä¼ è¾“å±‚éƒ½æœ‰å¯èƒ½å‘ç”Ÿã€‚æ—¥å¸¸çš„ç½‘ç»œåº”ç”¨å¼€å‘å¤§éƒ½åœ¨ä¼ è¾“å±‚è¿›è¡Œï¼Œç”±äºUDPæœ‰æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œï¼Œä¸ä¼šå‘ç”Ÿç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼Œå› æ­¤ç²˜åŒ…æ‹†åŒ…é—®é¢˜åªå‘ç”Ÿåœ¨TCPåè®®ä¸­ã€‚


<br/>

- **ç²˜åŒ…æ‹†åŒ…å‘ç”Ÿåœºæ™¯**

	- å› ä¸ºTCPæ˜¯é¢å‘æµï¼Œæ²¡æœ‰è¾¹ç•Œï¼Œè€Œæ“ä½œç³»ç»Ÿåœ¨å‘é€TCPæ•°æ®æ—¶ï¼Œä¼šé€šè¿‡ç¼“å†²åŒºæ¥è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚ç¼“å†²åŒºä¸º1024ä¸ªå­—èŠ‚å¤§å°ã€‚
	
	- å¦‚æœä¸€æ¬¡è¯·æ±‚å‘é€çš„æ•°æ®é‡æ¯”è¾ƒå°ï¼Œæ²¡è¾¾åˆ°ç¼“å†²åŒºå¤§å°ï¼ŒTCPåˆ™ä¼šå°†å¤šä¸ªè¯·æ±‚åˆå¹¶ä¸ºåŒä¸€ä¸ªè¯·æ±‚è¿›è¡Œå‘é€ï¼Œè¿™å°±å½¢æˆäº†ç²˜åŒ…é—®é¢˜ã€‚
	
	- å¦‚æœä¸€æ¬¡è¯·æ±‚å‘é€çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè¶…è¿‡äº†ç¼“å†²åŒºå¤§å°ï¼ŒTCPå°±ä¼šå°†å…¶æ‹†åˆ†ä¸ºå¤šæ¬¡å‘é€ï¼Œè¿™å°±æ˜¯æ‹†åŒ…ã€‚

å…³äºç²˜åŒ…å’Œæ‹†åŒ…å¯ä»¥å‚è€ƒä¸‹å›¾çš„å‡ ç§æƒ…å†µï¼š

![ç²˜åŒ…å’Œæ‹†åŒ…å‡ ç§æƒ…å†µ<br/>](https://raw.githubusercontent.com/harleyGit/StudyNotes/master/Pictures/ios_pd10.png)

- ä¸Šå›¾ä¸­æ¼”ç¤ºäº†ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š
	- æ­£å¸¸çš„ç†æƒ³æƒ…å†µï¼Œä¸¤ä¸ªåŒ…æ°å¥½æ»¡è¶³TCPç¼“å†²åŒºçš„å¤§å°æˆ–è¾¾åˆ°TCPç­‰å¾…æ—¶é•¿ï¼Œåˆ†åˆ«å‘é€ä¸¤ä¸ªåŒ…ï¼›
	- ç²˜åŒ…ï¼šä¸¤ä¸ªåŒ…è¾ƒå°ï¼Œé—´éš”æ—¶é—´çŸ­ï¼Œå‘ç”Ÿç²˜åŒ…ï¼Œåˆå¹¶æˆä¸€ä¸ªåŒ…å‘é€ï¼›
	- æ‹†åŒ…ï¼šä¸€ä¸ªåŒ…è¿‡å¤§ï¼Œè¶…è¿‡ç¼“å­˜åŒºå¤§å°ï¼Œæ‹†åˆ†æˆä¸¤ä¸ªæˆ–å¤šä¸ªåŒ…å‘é€ï¼›
	- æ‹†åŒ…å’Œç²˜åŒ…ï¼šPacket1è¿‡å¤§ï¼Œè¿›è¡Œäº†æ‹†åŒ…å¤„ç†ï¼Œè€Œæ‹†å‡ºå»çš„ä¸€éƒ¨åˆ†åˆä¸Packet2è¿›è¡Œç²˜åŒ…å¤„ç†ã€‚


<br/>

- **å¸¸è§çš„å››ç§è§£å†³æ–¹æ¡ˆ**
	- å‘é€ç«¯å°†æ¯ä¸ªåŒ…éƒ½å°è£…æˆå›ºå®šçš„é•¿åº¦ï¼Œæ¯”å¦‚100å­—èŠ‚å¤§å°ã€‚å¦‚æœä¸è¶³100å­—èŠ‚å¯é€šè¿‡è¡¥0æˆ–ç©ºç­‰è¿›è¡Œå¡«å……åˆ°æŒ‡å®šé•¿åº¦ï¼›
	- å‘é€ç«¯åœ¨æ¯ä¸ªåŒ…çš„æœ«å°¾ä½¿ç”¨å›ºå®šçš„åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚\r\nã€‚å¦‚æœå‘ç”Ÿæ‹†åŒ…éœ€ç­‰å¾…å¤šä¸ªåŒ…å‘é€è¿‡æ¥ä¹‹åå†æ‰¾åˆ°å…¶ä¸­çš„\r\nè¿›è¡Œåˆå¹¶ï¼›ä¾‹å¦‚ï¼ŒFTPåè®®ï¼›
	- å°†æ¶ˆæ¯åˆ†ä¸ºå¤´éƒ¨å’Œæ¶ˆæ¯ä½“ï¼Œå¤´éƒ¨ä¸­ä¿å­˜æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œåªæœ‰è¯»å–åˆ°è¶³å¤Ÿé•¿åº¦çš„æ¶ˆæ¯ä¹‹åæ‰ç®—æ˜¯è¯»åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼›
	- é€šè¿‡è‡ªå®šä¹‰åè®®è¿›è¡Œç²˜åŒ…å’Œæ‹†åŒ…çš„å¤„ç†ã€‚


<br/>


**Nettyå¯¹ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜çš„å¤„ç†**
- Nettyå¯¹è§£å†³ç²˜åŒ…å’Œæ‹†åŒ…çš„æ–¹æ¡ˆåšäº†æŠ½è±¡ï¼Œæä¾›äº†ä¸€äº›è§£ç å™¨ï¼ˆDecoderï¼‰æ¥è§£å†³ç²˜åŒ…å’Œæ‹†åŒ…çš„é—®é¢˜ã€‚å¦‚ï¼š
	- LineBasedFrameDecoderï¼šä»¥è¡Œä¸ºå•ä½è¿›è¡Œæ•°æ®åŒ…çš„è§£ç ï¼›
	- DelimiterBasedFrameDecoderï¼šä»¥ç‰¹æ®Šçš„ç¬¦å·ä½œä¸ºåˆ†éš”æ¥è¿›è¡Œæ•°æ®åŒ…çš„è§£ç ï¼›
	- FixedLengthFrameDecoderï¼šä»¥å›ºå®šé•¿åº¦è¿›è¡Œæ•°æ®åŒ…çš„è§£ç ï¼›
	- LenghtFieldBasedFrameDecodeï¼šé€‚ç”¨äºæ¶ˆæ¯å¤´åŒ…å«æ¶ˆæ¯é•¿åº¦çš„åè®®ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼›
	- åŸºäºNettyè¿›è¡Œç½‘ç»œè¯»å†™çš„ç¨‹åºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›Decoderæ¥å®Œæˆæ•°æ®åŒ…çš„è§£ç ã€‚å¯¹äºé«˜å¹¶å‘ã€å¤§æµé‡çš„ç³»ç»Ÿæ¥è¯´ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½ä¸åº”è¯¥ä¼ è¾“å¤šä½™çš„æ•°æ®ï¼ˆæ‰€ä»¥è¡¥é½çš„æ–¹å¼ä¸å¯å–ï¼‰ï¼ŒLenghtFieldBasedFrameDecodeæ›´é€‚åˆè¿™æ ·çš„åœºæ™¯ã€‚

<br/>

**æ€»ç»“ï¼š**TCPåè®®ç²˜åŒ…æ‹†åŒ…é—®é¢˜æ˜¯å› ä¸ºTCPåè®®æ•°æ®ä¼ è¾“æ˜¯åŸºäºå­—èŠ‚æµçš„ï¼Œå®ƒä¸åŒ…å«æ¶ˆæ¯ã€æ•°æ®åŒ…ç­‰æ¦‚å¿µï¼Œéœ€è¦åº”ç”¨å±‚åè®®è‡ªå·±è®¾è®¡æ¶ˆæ¯çš„è¾¹ç•Œï¼Œå³æ¶ˆæ¯å¸§ï¼ˆMessage Framingï¼‰ã€‚å¦‚æœåº”ç”¨å±‚åè®®æ²¡æœ‰ä½¿ç”¨åŸºäºé•¿åº¦æˆ–è€…åŸºäºç»ˆç»“ç¬¦æ¯è¾¹ç•Œç­‰æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œåˆ™ä¼šå¯¼è‡´å¤šä¸ªæ¶ˆæ¯çš„ç²˜åŒ…å’Œæ‹†åŒ…ã€‚

<br/>

**æ‹“å±•ï¼š**

&emsp; [**Netty**](https://juejin.cn/post/6844903703183360008)æ˜¯ä¸€ä¸ªéé˜»å¡I/Oå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¡†æ¶ï¼Œä¸»è¦ç”¨äºå¼€å‘Javaç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå¦‚åè®®æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚å¼‚æ­¥äº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºæ¡†æ¶å’Œå·¥å…·ç”¨äºç®€åŒ–ç½‘ç»œç¼–ç¨‹ï¼Œä¾‹å¦‚TCPå’ŒUDPå¥—æ¥å­—æœåŠ¡å™¨ã€‚[2]NettyåŒ…æ‹¬äº†ååº”å™¨ç¼–ç¨‹æ¨¡å¼çš„å®ç°ã€‚Nettyæœ€åˆç”±JBosså¼€å‘ï¼Œç°åœ¨ç”±Nettyé¡¹ç›®ç¤¾åŒºå¼€å‘å’Œç»´æŠ¤ã€‚

&emsp; æœ‰äº†Nettyï¼Œä½ å¯ä»¥å®ç°è‡ªå·±çš„HTTPæœåŠ¡å™¨ï¼ŒFTPæœåŠ¡å™¨ï¼ŒUDPæœåŠ¡å™¨ï¼ŒRPCæœåŠ¡å™¨ï¼ŒWebSocketæœåŠ¡å™¨ï¼ŒRedisçš„ProxyæœåŠ¡å™¨ï¼ŒMySQLçš„ProxyæœåŠ¡å™¨ç­‰ç­‰ã€‚ 

[èŠå¤©ç³»ç»Ÿè®¾è®¡](https://m.imooc.com/wiki/nettylesson-netty28)

[**Nettyæ˜¯ä»€ä¹ˆï¼Ÿå®ƒèƒ½å¹²ä»€ä¹ˆï¼Ÿ**](https://www.cnblogs.com/ivy-xu/p/12656290.html) 











<br/>

***
<br/>

># <h2 id = "ç±»åº“">ç±»åº“<h3>

<br/>
<br/>

> <h2 id = "fishhook">FishHook</h2>

hookç³»ç»Ÿå‡½æ•°ï¼Œä¸€ä¸ªfaceBookå†™çš„ä¸‰æ–¹æ¡†æ¶




<br/>
<br/>



> <h2 id = "SDWebImage">[SDWebImage](https://github.com/harleyGit/StudyNotes/blob/master/ClassLibrary/SDWebImage(I).md)</h2>

<br/>

> <h3 id = "SDWebImageå®ç°åŸç†">SDWebImageå®ç°åŸç†, tableViewå¤ç”¨é”™ä¹±é—®é¢˜</h3>

è§£å†³tableViewå¤ç”¨é”™ä¹±é—®é¢˜ï¼šæ¯æ¬¡éƒ½ä¼šè°ƒUIImageView+WebCacheæ–‡ä»¶ä¸­çš„ [self sd_cancelCurrentImageLoad];

**SDWebImageå®ç°è¿‡ç¨‹**

- ç¬¬ä¸€æ­¥ï¼Œå…¥å£ setImageWithURL:placeholderImage:options: ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚

- ç¬¬äºŒæ­¥ï¼Œè¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:.

- ç¬¬ä¸‰æ­¥ï¼Œå…ˆä»å†…å­˜å›¾ç‰‡ç¼“å­˜æŸ¥æ‰¾æ˜¯å¦æœ‰å›¾ç‰‡ï¼Œå¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚

- ç¬¬å››æ­¥ï¼ŒSDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage: åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚

- ç¬¬äº”æ­¥ï¼Œå¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚

- ç¬¬å…­æ­¥ï¼Œæ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚

- ç¬¬ä¸ƒæ­¥ï¼Œå¦‚æœä¸Šä¸€æ“ä½œä»ç¡¬ç›˜è¯»å–åˆ°äº†å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚

- ç¬¬å…«æ­¥ï¼Œå¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚

- ç¬¬ä¹æ­¥ï¼Œå…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚

- ç¬¬åæ­¥ï¼Œå›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ï¼Œconnection:didReceiveData: ä¸­åˆ©ç”¨ ImageIO åšäº†æŒ‰å›¾ç‰‡ä¸‹è½½è¿›åº¦åŠ è½½æ•ˆæœã€‚

- ç¬¬åä¸€æ­¥ï¼ŒconnectionDidFinishLoading: æ•°æ®ä¸‹è½½å®Œæˆåäº¤ç»™ SDWebImageDecoder åšå›¾ç‰‡è§£ç å¤„ç†ã€‚å›¾ç‰‡è§£ç å¤„ç†åœ¨ä¸€ä¸ª NSOperationQueue å®Œæˆï¼Œä¸ä¼šæ‹–æ…¢ä¸»çº¿ç¨‹ UIã€‚å¦‚æœæœ‰éœ€è¦å¯¹ä¸‹è½½çš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œæœ€å¥½ä¹Ÿåœ¨è¿™é‡Œå®Œæˆï¼Œæ•ˆç‡ä¼šå¥½å¾ˆå¤šã€‚

- ç¬¬åäºŒæ­¥ï¼Œåœ¨ä¸»çº¿ç¨‹ notifyDelegateOnMainThreadWithInfo: å®£å‘Šè§£ç å®Œæˆï¼ŒimageDecoder:didFinishDecodingImage:userInfo: å›è°ƒç»™ SDWebImageDownloaderã€‚

- ç¬¬åä¸‰æ­¥ï¼ŒimageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚

- ç¬¬åå››æ­¥ï¼Œé€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚

- ç¬¬åäº”æ­¥ï¼Œå°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚

- å¦å¤–ï¼ŒSDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚



<br/>


**åŸç†ï¼š**
- SDWebImageDownloader
- å›¾ç‰‡çš„ä¸‹è½½æ“ä½œæ”¾åœ¨ä¸€ä¸ªNSOperationQueueå¹¶å‘æ“ä½œé˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—é»˜è®¤æœ€å¤§å¹¶å‘æ•°æ˜¯6
- æ¯ä¸ªå›¾ç‰‡å¯¹åº”ä¸€äº›å›è°ƒï¼ˆä¸‹è½½è¿›åº¦ï¼Œå®Œæˆå›è°ƒç­‰ï¼‰ï¼Œå›è°ƒä¿¡æ¯ä¼šå­˜åœ¨downloaderçš„URLCallbacksï¼ˆä¸€ä¸ªå­—å…¸ï¼Œkeyæ˜¯urlåœ°å€ï¼Œvalueæ˜¯å›¾ç‰‡ä¸‹è½½å›è°ƒæ•°ç»„ï¼‰ä¸­ï¼ŒURLCallbackså¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œæ‰€ä»¥downloaderæŠŠä¸‹è½½ä»»åŠ¡æ”¾åœ¨ä¸€ä¸ªbarrierQueueä¸­ï¼Œå¹¶è®¾ç½®å±éšœä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®URLCallbacksã€‚ï¼Œåœ¨åˆ›å»ºå›è°ƒURLCallbacksçš„blockä¸­åˆ›å»ºäº†ä¸€ä¸ªNSOperationå¹¶æ·»åŠ åˆ°NSOperationQueueä¸­
- ä¸‹è½½çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨NSURLSessionåŠ è½½æ•°æ®ï¼Œæ¯ä¸ªå›¾ç‰‡çš„ä¸‹è½½éƒ½æœ‰ä¸€ä¸ªoperationæ“ä½œæ¥å®Œæˆï¼Œå¹¶å°†è¿™äº›æ“ä½œæ”¾åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·å¯ä»¥å®ç°å›¾ç‰‡çš„å¹¶å‘ä¸‹è½½ã€‚
- å†…å­˜ç¼“å­˜çš„å¤„ç†ç”±NSCacheå¯¹è±¡å®ç°ï¼ŒNSCacheç±»ä¼¼ä¸€ä¸ªé›†åˆçš„å®¹å™¨ï¼Œå®ƒå­˜å‚¨key-valueå¯¹ï¼Œç±»ä¼¼äºnsdictionaryç±»ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ç¼“å­˜æ¥ä¸´æ—¶å­˜å‚¨çŸ­æ—¶é—´ä½¿ç”¨ä½†åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡ï¼Œé‡ç”¨è¿™äº›å¯¹è±¡å¯ä»¥ä¼˜åŒ–æ–°èƒ½ï¼ŒåŒæ—¶è¿™äº›å¯¹è±¡å¯¹äºç¨‹åºæ¥è¯´ä¸æ˜¯ç´§è¦çš„ï¼Œå¦‚æœå†…å­˜ç´§å¼ å°±ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚
- å…ˆåœ¨å†…å­˜ä¸­æ”¾ç½®ä¸€ä»½ç¼“å­˜ï¼Œå¦‚æœéœ€è¦ç¼“å­˜åˆ°ç£ç›˜ï¼Œå°†ç£ç›˜ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ªtaskæ”¾åˆ°ä¸²è¡Œé˜Ÿåˆ—ä¸­å¤„ç†ï¼Œä¼šå…ˆæ£€æŸ¥å›¾ç‰‡æ ¼å¼æ˜¯jpegè¿˜æ˜¯pngï¼Œå°†å…¶è½¬æ¢ä¸ºå“åº”çš„å›¾ç‰‡æ•°æ®ï¼Œæœ€åå§æ•°æ®å†™å…¥ç£ç›˜ä¸­ï¼ˆæ–‡ä»¶åæ˜¯å¯¹keyå€¼åšMD5åçš„ä¸²ï¼‰ã€‚


<br/>





<br/>
<br/>

>## <h2 id = "RxSwift">[RxSwift](https://github.com/harleyGit/StudyNotes/blob/master/ClassLibrary/RxSwift(I).md)<h2>





<br/>
<br/>



>## <h2 id = "AFNetworking">AFNetworking</h2>

[AFNetworkingå®ç°åŸç†](https://www.jianshu.com/p/7ef7f818aa95)




<br/>
<br/>

>## <h2 id = "é™æ€åº“å’ŒåŠ¨æ€åº“">[é™æ€åº“å’ŒåŠ¨æ€åº“](https://www.jianshu.com/p/a200b593696b)<h3>

ä»‹ç»
> é™æ€åº“ï¼šé“¾æ¥æ—¶å®Œæ•´åœ°æ‹·è´è‡³å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¢«å¤šæ¬¡ä½¿ç”¨å°±æœ‰å¤šä»½å†—ä½™æ‹·è´ã€‚åˆ©ç”¨é™æ€å‡½æ•°åº“ç¼–è¯‘æˆçš„æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå› ä¸ºæ•´ä¸ª å‡½æ•°åº“çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«æ•´åˆè¿›ç›®æ ‡ä»£ç ä¸­ï¼Œä»–çš„ä¼˜ç‚¹å°±æ˜¾è€Œæ˜“è§äº†ï¼Œå³ç¼–è¯‘åçš„æ‰§è¡Œç¨‹åºä¸éœ€è¦å¤–éƒ¨çš„å‡½æ•°åº“æ”¯æŒï¼Œå› ä¸ºæ‰€æœ‰ä½¿ç”¨çš„å‡½æ•°éƒ½å·²ç»è¢«ç¼–è¯‘è¿›å»äº†ã€‚å½“ç„¶è¿™ä¹Ÿä¼šæˆä¸ºä»–çš„ç¼ºç‚¹ï¼Œå› ä¸ºå¦‚æœé™æ€å‡½æ•°åº“æ”¹å˜äº†ï¼Œé‚£ä¹ˆä½ çš„ç¨‹åºå¿…é¡»é‡æ–°ç¼–è¯‘ã€‚



<br/>

> åŠ¨æ€åº“ï¼šé“¾æ¥æ—¶ä¸å¤åˆ¶ï¼Œç¨‹åºè¿è¡Œæ—¶ç”±ç³»ç»ŸåŠ¨æ€åŠ è½½åˆ°å†…å­˜ï¼Œä¾›ç¨‹åºè°ƒç”¨ï¼Œç³»ç»ŸåªåŠ è½½ä¸€æ¬¡ï¼Œå¤šä¸ªç¨‹åºå…±ç”¨ï¼ŒèŠ‚çœå†…å­˜ã€‚ç”±äºå‡½æ•°åº“æ²¡æœ‰è¢«æ•´åˆè¿›ä½ çš„ç¨‹åºï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€çš„ç”³è¯·å¹¶è°ƒç”¨ï¼Œæ‰€ä»¥ç¨‹åºçš„è¿è¡Œç¯å¢ƒä¸­å¿…é¡»æä¾›ç›¸åº”çš„åº“ã€‚åŠ¨æ€å‡½æ•°åº“çš„æ”¹å˜å¹¶ä¸å½±å“ä½ çš„ç¨‹åºï¼Œæ‰€ä»¥åŠ¨æ€å‡½æ•°åº“çš„å‡çº§æ¯”è¾ƒæ–¹ä¾¿ã€‚

&emsp; é™æ€åº“å’ŒåŠ¨æ€åº“éƒ½æ˜¯é—­æºåº“ï¼Œåªèƒ½æ‹¿æ¥æ»¡è¶³æŸä¸ªåŠŸèƒ½çš„ä½¿ç”¨ï¼Œä¸ä¼šæš´éœ²å†…éƒ¨å…·ä½“çš„ä»£ç ä¿¡æ¯ï¼Œè€Œä»githubä¸Šä¸‹è½½çš„ç¬¬ä¸‰æ–¹åº“å¤§å¤šæ˜¯å¼€æºåº“


<br/>

é™æ€åº“ä¼˜ç‚¹ï¼š
>- æ¨¡å—åŒ–ï¼Œåˆ†å·¥åˆä½œ
- é¿å…å°‘é‡æ”¹åŠ¨ç»å¸¸å¯¼è‡´å¤§é‡çš„é‡å¤ç¼–è¯‘è¿æ¥
- ä¹Ÿå¯ä»¥é‡ç”¨ï¼Œæ³¨æ„ä¸æ˜¯å…±äº«ä½¿ç”¨


åŠ¨æ€åº“ä¼˜ç‚¹ï¼š

>- å¯ä»¥å°†æœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯ç¼©å°
- å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«å†…å­˜ä¸­å¾—åŒä¸€ä»½åº“æ–‡ä»¶ï¼ŒèŠ‚çœèµ„æº
- å¯ä»¥ä¸é‡æ–°ç¼–è¯‘è¿æ¥å¯æ‰§è¡Œç¨‹åºçš„å‰æä¸‹ï¼Œæ›´æ–°åŠ¨æ€åº“æ–‡ä»¶è¾¾åˆ°æ›´æ–°åº”ç”¨ç¨‹åºçš„ç›®çš„ã€‚
- å°†æ•´ä¸ªåº”ç”¨ç¨‹åºåˆ†æ¨¡å—ï¼Œå›¢é˜Ÿåˆä½œï¼Œè¿›è¡Œåˆ†å·¥ï¼Œå½±å“æ¯”è¾ƒå°ã€‚


<br/>
æ ¼å¼åŒºåˆ«ï¼š
>é™æ€åº“ï¼š.aå’Œ.framework (windows:.lib , linux: .a)

>åŠ¨æ€åº“ï¼š.dylibå’Œ.frameworkï¼ˆç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬çš„frameworkéƒ½æ˜¯åŠ¨æ€åº“ï¼ï¼‰(windows:.dll , linux: .so)

æ³¨æ„ï¼šä¸¤è€…éƒ½æœ‰frameworkçš„æ ¼å¼ï¼Œä½†æ˜¯å½“ä½ åˆ›å»ºä¸€ä¸ªframeworkæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿé»˜è®¤æ˜¯åŠ¨æ€åº“çš„æ ¼å¼ï¼Œå¦‚æœæƒ³åšæˆé™æ€åº“ï¼Œéœ€è¦åœ¨buildSettingä¸­å°†Mach-O Typeé€‰é¡¹è®¾ç½®ä¸ºStatic Libraryå°±è¡Œäº†ï¼


<br/>
<br/>

- <h2 id = "åº“å¼•ç”¨é”™è¯¯è§£æ">åº“å¼•ç”¨é”™è¯¯è§£æ</h2>

frameworkå’Œ[hostå·¥ç¨‹](https://www.jianshu.com/p/d25f9465cfa8)(å¯æ‰§è¡Œçš„å·¥ç¨‹é¡¹ç›®)èµ„æºå…±ç”¨

ç¬¬æ–¹ä¸‰åº“

Class XXX is implemented in both XXX and XXX. One of the two will be used. Which one is undefined.

è¿™æ˜¯å½“ framework å·¥ç¨‹å’Œ host å·¥ç¨‹é“¾æ¥äº†ç›¸åŒçš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…ç±»é€ æˆçš„ã€‚

ä¸ºäº†è®©æ‰“å‡ºçš„ framework ä¸­ä¸åŒ…å« host å·¥ç¨‹ä¸­å·²åŒ…å«çš„ä¸‰æ–¹åº“ï¼ˆå¦‚ cocoapods å·¥ç¨‹ç¼–è¯‘å‡ºçš„ .a æ–‡ä»¶ï¼‰ï¼Œå¯ä»¥è¿™æ ·ï¼š

åˆ é™¤ Build Phases > Link Binary With Libraries ä¸­çš„å†…å®¹ï¼ˆå¦‚æœ‰ï¼‰ã€‚æ­¤æ—¶ç¼–è¯‘ä¼šæç¤ºä¸‰æ–¹åº“ä¸­åŒ…å«çš„ç¬¦å·æ‰¾ä¸åˆ°ã€‚

åœ¨ framework çš„ Build Settings > Other Linker Flags æ·»åŠ  -undefined dynamic_lookupã€‚å¿…é¡»ä¿è¯ host å·¥ç¨‹ç¼–è¯‘å‡ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åŒ…å«è¿™äº›ç¬¦å·ã€‚


<br/>
<br/>

> <h2 id = "MJRefresh">**MJRefresh**<h3>

- MJRefreshä½¿ç”¨æ—¶æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰å“ªäº›éœ€è¦æ³¨æ„çš„ï¼Ÿ

&emsp;
**äº‹é¡¹1ï¼š**åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¦‚æœendRefreshing å…ˆæ‰§è¡Œ Â reloadDataåæ‰§è¡Œ ä¼šå‡ºç°indexPath.rowä¸å‡†ç¡®ï¼ˆå€¼ä¸º4ï¼‰è¿™æ—¶å€™ä½ çš„æ•°ç»„ä¸­å¾ˆæœ‰å¯èƒ½ä¸åˆ°å››ä¸ªæˆå‘˜ï¼Œè¿™æ—¶å€™å°±ä¼šé€ æˆæ•°ç»„è¶Šç•Œã€‚

æ‰€ä»¥ä¸€å®šè¦å…ˆæ‰§è¡ŒreloadData æ–¹æ³• å†æ‰§è¡ŒendRefreshingæ–¹æ³•

```
Â [_tableView reloadData];

Â [_tableView.header endRefreshing];

Â [_tableView.footer endRefreshing];
```


<br/>

**äº‹é¡¹2ï¼š**ä½¿ç”¨ä¸Šæ‹‰åŠ è½½æ›´å¤šï¼Œ å½“æ•°æ®åŠ è½½å®Œè°ƒç”¨`[ableView.mj_footer endRefreshingWithNoMoreData]`æ–¹æ³•æ˜¾ç¤ºå·²ç»å…¨éƒ¨åŠ è½½å®Œæ¯•è¿™ä¸ªæ–¹æ³•ï¼Œä¸€å®šè¦æ”¾åœ¨`[tableView.mj_footer endRefreshing];`åœæ­¢åŠ è½½æ–¹æ³•çš„åé¢ï¼Œä¸ç„¶`[ableView.mj_footer endRefreshingWithNoMoreData]`è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚

```
[Request requestGET:parameter view:nil urlPre:CourseCenterURL funItem:HuFuncItem_DiscoverCourseLibraryList success:^(NSDictionary *dic) {
    NSArray *dataListArray =  [HospitalShareRightModel mj_objectArrayWithKeyValuesArray:dic[@"data"][@"result"]];
    //ä¸‹æ‹‰åˆ·æ–°
    if (weakSelf.pageNum == kPageNum) {
        [weakSelf.rightTableView.mj_header endRefreshing];
        [weakSelf.hospitalShareRightArray removeAllObjects];
        if (dataListArray.count <= 0) {
            [weakSelf.rightTableView removeFromSuperview];
            [weakSelf defauleView];
        }
    }
    [weakSelf.rightTableView.mj_footer endRefreshing];
    [weakSelf.hospitalShareRightArray addObjectsFromArray:dataListArray];
    if (dataListArray.count < 10) {
        [weakSelf.rightTableView.mj_footer endRefreshingWithNoMoreData];//æ”¾åˆ°åœæ­¢åŠ è½½æ–¹æ³•åé¢ ä¸ç„¶ä¼šå¤±æ•ˆ
    }
    [weakSelf.rightTableView reloadData];
} error:^(NSDictionary *dic) {
    [MBProgressHUD showError:dic[@"errmsg"]];
} failure:^{
}];

```



<br/>
<br/>

> 
JSONModel å¦‚ä½•å¤„ç†æ•°æ®çš„ï¼Ÿé‚£ä¸ªæ€ä¹ˆå¯¹å±æ€§è¿›è¡Œèµ‹å€¼çš„ï¼Ÿ


















