
> <h2 id=''></h2>
- [**ç±»**](#ç±»)
	- [åŠ¨æ€èƒ½åŠ›ç›¸å…³çš„isaæŒ‡é’ˆ](#åŠ¨æ€èƒ½åŠ›ç›¸å…³çš„isaæŒ‡é’ˆ)
	- [NSObjectç®€åŒ–ç‰ˆ](#NSObjectç®€åŒ–ç‰ˆ)
	- [objc_classç»“æ„ä½“å®šä¹‰](#objc_classç»“æ„ä½“å®šä¹‰)
	- [æ¶ˆæ¯è½¬å‘](#æ¶ˆæ¯è½¬å‘)
	- [æŒ‡é’ˆå¹³ç§»](#æŒ‡é’ˆå¹³ç§»)
	- [loadæ–¹æ³•è°ƒç”¨](#loadæ–¹æ³•è°ƒç”¨)
		- [æºç åˆ†æ](#æºç åˆ†æ)
			- 	[load_images](#load_images)
			- 	[prepare_load_methods](#prepare_load_methods)
			- [call_load_methods](#call_load_methods)
			- 	[call_class_loads & call_category_loads](#call_class_loads&call_category_loads)
- [**Categoryåˆ†ç±»**](#Categoryåˆ†ç±»)
	- [åˆ†ç±»ç»“æ„ä½“](#åˆ†ç±»ç»“æ„ä½“)
	- [åˆ†ç±»çš„åˆå¹¶attachCategories](#åˆ†ç±»çš„åˆå¹¶attachCategories)
	- [ä»£ç åŸç†](#ä»£ç åŸç†)
	- [å…³è”å¯¹è±¡AssociatedObject](#å…³è”å¯¹è±¡AssociatedObject)
		- [å…³è”å¯¹è±¡æœ¬è´¨](#å…³è”å¯¹è±¡æœ¬è´¨)
		- [**Demo**](#Demo)
		- [**æ·»åŠ å±æ€§**](#æ·»åŠ å±æ€§)
		- [åˆ†ç±»ä¸­çš„loadæ–¹æ³•å’Œinitializeæ–¹æ³•](#åˆ†ç±»ä¸­çš„loadæ–¹æ³•å’Œinitializeæ–¹æ³•)
			- [1.loadæ–¹æ³•](#1.loadæ–¹æ³•)
			- [2.initializeæ–¹æ³•](#2.initializeæ–¹æ³•)
				- [lookUpImpOrForward](#lookUpImpOrForward)
				- [_class_initialize](#_class_initialize)
- [**Extensionæ‰©å±•**](#Extensionæ‰©å±•)
- [**NSProxy(ä¼ªå¤šç»§æ‰¿)**](#NSProxy(ä¼ªå¤šç»§æ‰¿))
- [**iOSåŸç”Ÿç³»ç»Ÿæ¶æ„**](#iOSåŸç”Ÿç³»ç»Ÿæ¶æ„)
	- [iOSçš„ç³»ç»Ÿæ¶æ„æˆ](#iOSçš„ç³»ç»Ÿæ¶æ„æˆ)
	- [Cocoa](#Cocoa)
	- [Cocoaå’ŒCocoaTouch](#Cocoaå’ŒCocoaTouch)
	- [æ¶æ„å±‚çº§ç»†åˆ†](#æ¶æ„å±‚çº§ç»†åˆ†)
- [**NSObject ç»§æ‰¿å…³ç³»å›¾**](#NSObjectç»§æ‰¿å…³ç³»å›¾)
	- [Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»](#Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»)
- [**UIResponder ç»§æ‰¿å…³ç³»å›¾**](#UIResponderç»§æ‰¿å…³ç³»å›¾)
- [**æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾**](#æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾)
- **èµ„æ–™**
	- [iOSåˆ†ç±»ä¸èƒ½æ·»åŠ å±æ€§åŸå› çš„æ¢ç´¢](https://blog.csdn.net/u012409247/article/details/80206229)
	- [ç±»çš„åŸç†(ä¸Š)](https://juejin.cn/post/6974962306530672670)
	- [ç±»çš„åŸç†(ä¸­)](https://juejin.cn/post/6975813381060034574)
	- [ç±»çš„åŸç†(ä¸‹)](https://juejin.cn/post/6978374430267457573)
	- [å†…å­˜ç®¡ç†](https://blog.csdn.net/u013378438/article/details/80733391)
	-  runtimeæœºåˆ¶(4)â€”â€”æ·±å…¥ç†è§£Category[](https://blog.csdn.net/u013378438/article/details/80605871?spm=1001.2014.3001.5502)



<br/>

***
<br/>
<br/>


> <h1 id='ç±»'>ç±»</h1>

&emsp; æºä»£ç è½¬æ¢ä¸ºå¯æ‰§è¡Œçš„ç¨‹åºï¼Œé€šå¸¸è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼š **ç¼–è¯‘ã€é“¾æ¥ã€è¿è¡Œ**ã€‚ä¸åŒçš„ç¼–è¯‘è¯­è¨€ï¼Œåœ¨è¿™ä¸‰ä¸ªæ­¥éª¤ä¸­æ‰€è¿›è¡Œçš„æ“ä½œåˆæœ‰äº›ä¸åŒã€‚

- **é™æ€è¯­è¨€ï¼š** å¦‚Cè¯­è¨€ï¼Œç¼–è¯‘é˜¶æ®µå°±è¦å†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œå¦‚æœå‡½æ•°æœªå®ç°å°±ä¼šç¼–è¯‘æŠ¥é”™ã€‚
- **åŠ¨æ€è¯­è¨€ï¼š** å¦‚OCè¯­è¨€ï¼Œç¼–è¯‘é˜¶æ®µå¹¶ä¸èƒ½å†³å®šçœŸæ­£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåªè¦å‡½æ•°å£°æ˜è¿‡å³ä½¿æ²¡æœ‰å®ç°ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚

&emsp; æˆ‘ä»¬å¸¸è¯´OCæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå°±æ˜¯å› ä¸ºå®ƒæ€»æ˜¯æŠŠä¸€äº›å†³å®šæ€§çš„å·¥ä½œä»ç¼–è¯‘é˜¶æ®µæ¨è¿Ÿåˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚OCä»£ç çš„è¿è¡Œä¸ä»…éœ€è¦ç¼–è¯‘å™¨ï¼Œè¿˜éœ€è¦è¿è¡Œæ—¶ç³»ç»Ÿ(Runtime Sytem)æ¥æ‰§è¡Œç¼–è¯‘åçš„ä»£ç ã€‚

&emsp; Runtimeæ˜¯ä¸€å¥—åº•å±‚çº¯Cè¯­è¨€APIï¼ŒOCä»£ç æœ€ç»ˆéƒ½ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºè¿è¡Œæ—¶ä»£ç ï¼Œé€šè¿‡æ¶ˆæ¯æœºåˆ¶å†³å®šå‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯OCä½œä¸ºåŠ¨æ€è¯­è¨€ä½¿ç”¨çš„åŸºç¡€ã€‚


<br/>

>## <h2 id='åŠ¨æ€èƒ½åŠ›ç›¸å…³çš„isaæŒ‡é’ˆ'>**åŠ¨æ€èƒ½åŠ›ç›¸å…³çš„isaæŒ‡é’ˆ**</h2>


&emsp; æ¯ä¸ªObjective-Cå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšè—çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„æ˜¯Objective-Cå¯¹è±¡çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå®ƒå°±æ˜¯isaæŒ‡é’ˆã€‚

&emsp; `è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å“ªå‘¢ï¼Ÿ`

&emsp; å®ƒæŒ‡å‘ä¸€ä¸ªç±»å¯¹è±¡(class objectè®°ä½å®ƒæ˜¯ä¸ªå¯¹è±¡ï¼Œæ˜¯å ç”¨å†…å­˜ç©ºé—´çš„ä¸€ä¸ªå˜é‡ï¼Œ[è¿™ä¸ªå¯¹è±¡åœ¨ç¼–è¯‘çš„æ—¶å€™ç¼–è¯‘å™¨å°±ç”Ÿæˆäº†](./çŸ¥è¯†ç‚¹(I).md#å¯åŠ¨ä¼˜åŒ–)ï¼Œä¸“é—¨æ¥æè¿°æŸä¸ªç±»çš„å®šä¹‰)ï¼Œè¿™ä¸ªç±»å¯¹è±¡åŒ…å«äº†Objective-Cå¯¹è±¡çš„ä¸€äº›ä¿¡æ¯ï¼ˆä¸ºäº†åŒºåˆ†ä¸¤ä¸ªå¯¹è±¡ï¼Œæˆ‘æŠŠå‰é¢æåˆ°çš„å¯¹è±¡å«Objective-Cå¯¹è±¡ï¼‰ï¼ŒåŒ…æ‹¬Objective-Cå¯¹è±¡çš„æ–¹æ³•è°ƒåº¦è¡¨ï¼Œå®ç°äº†ä»€ä¹ˆåè®®ç­‰ç­‰ã€‚è¿™ä¸ªåŒ…å«ä¿¡æ¯å°±æ˜¯Objective-CåŠ¨æ€èƒ½åŠ›çš„æ ¹æºäº†ã€‚


[isaç»“æ„](./çŸ¥è¯†ç‚¹(I).md#arm64å‰åisaç»“æ„)


<br/>

**`é‚£æˆ‘ä»¬çœ‹çœ‹isaæŒ‡é’ˆç±»å‹çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ`**


é€šè¿‡æŸ¥çœ‹runtimeæºç ,åœ¨objc.hä¸­æœ‰å¦‚ä¸‹å…³äºobjc_classçš„å®šä¹‰å¦‚ä¸‹:

```
#if !OBJC_TYPES_DEFINED
/// An opaque type that represents an Objective-C class.
typedef struct objc_class *Class;

/// Represents an instance of a class.
struct objc_object {
    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;
};

/// A pointer to an instance of a class.
typedef struct objc_object *id;
#endif
```

&emsp; ç”±ä¸Šè¿°çš„ä»£ç å¯ä»¥çœ‹å‡º**Class**æ˜¯ä¸€ä¸ª**objc_class**ç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼›

&emsp; è€Œ idï¼ˆä»»æ„å¯¹è±¡ï¼‰ æ˜¯ä¸€ä¸ª objc_object ç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œå…¶ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ä¸€ä¸ª objc_class ç»“æ„ç±»å‹çš„æŒ‡é’ˆã€‚

&emsp; æ³¨æ„è¿™é‡Œæœ‰ä¸€å…³é”®çš„å¼•ç”³è§£è¯»ï¼š å†…å­˜å¸ƒå±€ä»¥ä¸€ä¸ª objc_class æŒ‡é’ˆä¸ºå¼€å§‹çš„æ‰€æœ‰ä¸œä¸œéƒ½å¯ä»¥å½“åšä¸€ä¸ª object æ¥å¯¹å¾…


<br/>

åœ¨runtimeä¸­ï¼Œå¯ä»¥è¿™æ ·è·å–isaçš„å†…å®¹ï¼š

```
#define _OBJC_TAG_SLOT_SHIFT 60
#define _OBJC_TAG_EXT_SLOT_MASK 0xff

inline Class 
objc_object::getIsa() 
{
	// å¦‚æœä¸æ˜¯tagged pointerï¼Œåˆ™è¿”å›ISA()
    if (!isTaggedPointer()) return ISA();

	// å¦‚æœæ˜¯tagged pointerï¼Œå–å‡ºé«˜4ä½çš„å†…å®¹ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„class
    uintptr_t ptr = (uintptr_t)this;
	  
    uintptr_t slot = (ptr >> _OBJC_TAG_SLOT_SHIFT) & _OBJC_TAG_SLOT_MASK;
    return objc_tag_classes[slot];
    
}
```

åœ¨runtimeä¸­ï¼Œè¿˜æœ‰ä¸“ç”¨çš„æ–¹æ³•ç”¨äºåˆ¤æ–­æŒ‡é’ˆæ˜¯tagged pointerè¿˜æ˜¯æ™®é€šæŒ‡é’ˆï¼š

```
#   define _OBJC_TAG_MASK (1UL<<63)
static inline bool 
_objc_isTaggedPointer(const void * _Nullable ptr) 
{
    return ((uintptr_t)ptr & _OBJC_TAG_MASK) == _OBJC_TAG_MASK;
}
```




<br/>
<br/>
<br/>

> <h2 id='NSObjectç®€åŒ–ç‰ˆ'>NSObjectç®€åŒ–ç‰ˆ</h2>


æˆ‘ä»¬åœ¨å…¶ä»–çš„èµ„æ–™ã€åšå®¢ä¸­çœ‹åˆ°è®¸å¤šä¸‹é¢çš„ä¸œè¥¿,éƒ½æ˜¯ç»“æ„ä½“ã€isaæŒ‡é’ˆå•¥çš„!ä½†æ˜¯çœ‹æ¥çœ‹å»è¿˜æ˜¯ä¸ç”šæ˜äº†!å°±å…¶åŸå› å°±æ˜¯ä»–ä»¬è‡ªå·±éƒ½æ²¡ææ¸…æ¥š,æ®µç« å–ä¹‰,æŠŠä½ ä¹Ÿç»•ç³Šæ¶‚äº†.[æˆ‘çœ‹äº†ä¸‹é¢çš„ä¸€ä¸ªè§†é¢‘æ‰æ¸æ¸æŠŠå¯¹è±¡ã€ç±»å¯¹è±¡ã€æ¶ˆæ¯è½¬å‘ä¸²è”èµ·æ¥!](https://www.bilibili.com/video/BV1eh411h7Xg/?spm_id_from=333.337.search-card.all.click&vd_source=a7fe275f0ee54c4d2f691a823f8876b8)æœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹,ä¸é”™!å¯¹äºä¸€äº›åœ°æ–¹æˆ‘çœ‹äº†å‡ é!


å¦‚æœæŠ›å¼€NSObjectå¯¹è±¡çš„å…¶ä»–çš„æˆå‘˜æ•°æ®å’Œå˜é‡ï¼ŒNSObjectå¯ä»¥çœ‹æˆè¿™æ ·ï¼š

```
@interface NSObject  {

Class    isa;

}

```

ä¸è€ƒè™‘@interfaceå…³é”®å­—åœ¨ç¼–è¯‘æ—¶çš„ä½œç”¨ï¼Œå¯ä»¥æŠŠNSObjectæ›´æ¥è¿‘Cè¯­è¨€ç»“æ„è¡¨ç¤ºä¸ºï¼š

```
struct NSObject{

ClassÂ isa;

}
```

Classæ˜¯ç”¨typedefå®šä¹‰çš„`typedef struct objc_classÂ *Class;`

é‚£NSObjectå¯ä»¥è¿™æ ·å†™äº†

```
struct NSObject{

objc_classÂ *isa

}
```




<br/>
<br/>

> <h2 id='objc_classç»“æ„ä½“å®šä¹‰'>objc_classç»“æ„ä½“å®šä¹‰</h2>


```
struct objc_class {
    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;  // objc_class ç»“æ„ä½“çš„å®ä¾‹æŒ‡é’ˆ

#if !__OBJC2__
    Class _Nullable super_class                              OBJC2_UNAVAILABLE; // æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆ
    const char * _Nonnull name                               OBJC2_UNAVAILABLE; // ç±»çš„åå­—
    long version                                             OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º 0
    long info                                                OBJC2_UNAVAILABLE; // ç±»çš„ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†
    long instance_size                                       OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°(å®ä¾‹å˜é‡çš„å†…å­˜å¤§å°);
    struct objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡åˆ—è¡¨(å®é™…ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨)
    struct objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;  // æ–¹æ³•å®šä¹‰çš„åˆ—è¡¨
    struct objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE; // æ–¹æ³•ç¼“å­˜
    struct objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE; // éµå®ˆçš„åè®®åˆ—è¡¨
#endif

} OBJC2_UNAVAILABLE;
```


<br/>
<br/>

- **isa ï¼š** æ˜¯ä¸€ä¸ª objc_class ç±»å‹çš„æŒ‡é’ˆ. è¿™å°±æ˜¯è¯´ objc_class æˆ–è€…è¯´ç±»å…¶å®ä¹Ÿå¯ä»¥å½“åšä¸€ä¸ª objc_object å¯¹è±¡æ¥å¯¹å¾…ï¼
	- ObjCè¿˜å¯¹ç±»å¯¹è±¡ä¸å®ä¾‹å¯¹è±¡ä¸­çš„ isa æ‰€æŒ‡å‘çš„ç±»ç»“æ„ä½œäº†ä¸åŒçš„å‘½åï¼šç±»å¯¹è±¡ä¸­çš„ isa æŒ‡å‘ç±»ç»“æ„è¢«ç§°ä½œ metaclassï¼Œmetaclass å­˜å‚¨ç±»çš„staticç±»æˆå‘˜å˜é‡ä¸staticç±»æˆå‘˜æ–¹æ³•ï¼ˆ+å¼€å¤´çš„æ–¹æ³•ï¼‰ï¼›
	- å®ä¾‹å¯¹è±¡ä¸­çš„ isa æŒ‡å‘ç±»ç»“æ„ç§°ä½œ classï¼ˆæ™®é€šçš„ï¼‰ï¼Œclass ç»“æ„å­˜å‚¨ç±»çš„æ™®é€šæˆå‘˜å˜é‡ä¸æ™®é€šæˆå‘˜æ–¹æ³•ï¼ˆ-å¼€å¤´çš„æ–¹æ³•ï¼‰ã€‚ 

- **super_class** ï¼šæŒ‡å‘è¯¥ç±»çš„çˆ¶ç±»å‘—ï¼å¦‚æœè¯¥ç±»å·²ç»æ˜¯æœ€é¡¶å±‚çš„æ ¹ç±»ï¼ˆå¦‚ NSObject æˆ– NSProxyï¼‰ï¼Œé‚£ä¹ˆ super_class å°±ä¸º NULLã€‚ 

- **name** ï¼šä¸€ä¸ª C å­—ç¬¦ä¸²ï¼ŒæŒ‡ç¤ºç±»çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡ŒæœŸï¼Œé€šè¿‡è¿™ä¸ªåç§°æŸ¥æ‰¾åˆ°è¯¥ç±»ï¼ˆé€šè¿‡ï¼šid objc_getClass(const char *aClassName)ï¼‰æˆ–è¯¥ç±»çš„ metaclassï¼ˆid objc_getMetaClass(const char *aClassName)ï¼‰ï¼› 

- **version** ï¼šç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º 0ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡ŒæœŸå¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼ˆclass_setVersionï¼‰æˆ–è·å–ï¼ˆclass_getVersionï¼‰ã€‚ 

- **info** ï¼šä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯†ã€‚æœ‰å¦‚ä¸‹ä¸€äº›ä½æ©ç ï¼š

```
CLS_CLASS (0x1L) è¡¨ç¤ºè¯¥ç±»ä¸ºæ™®é€š class ï¼Œå…¶ä¸­åŒ…å«å®ä¾‹æ–¹æ³•å’Œå˜é‡ï¼› 
CLS_META (0x2L) è¡¨ç¤ºè¯¥ç±»ä¸º metaclassï¼Œå…¶ä¸­åŒ…å«ç±»æ–¹æ³•ï¼› 
CLS_INITIALIZED (0x4L) è¡¨ç¤ºè¯¥ç±»å·²ç»è¢«è¿è¡ŒæœŸåˆå§‹åŒ–äº†ï¼Œè¿™ä¸ªæ ‡è¯†ä½åªè¢« objc_addClass æ‰€è®¾ç½®ï¼› 
CLS_POSING (0x8L) è¡¨ç¤ºè¯¥ç±»è¢« pose æˆå…¶ä»–çš„ç±»ï¼›ï¼ˆposeclass åœ¨ObjC 2.0ä¸­è¢«åºŸå¼ƒäº†ï¼‰ï¼› 
CLS_MAPPED (0x10L) ä¸ºObjCè¿è¡ŒæœŸæ‰€ä½¿ç”¨
CLS_FLUSH_CACHE (0x20L) ä¸ºObjCè¿è¡ŒæœŸæ‰€ä½¿ç”¨ 
CLS_GROW_CACHE (0x40L) ä¸ºObjCè¿è¡ŒæœŸæ‰€ä½¿ç”¨
CLS_NEED_BIND (0x80L) ä¸ºObjCè¿è¡ŒæœŸæ‰€ä½¿ç”¨
CLS_METHOD_ARRAY (0x100L) è¯¥æ ‡å¿—ä½æŒ‡ç¤º methodlists æ˜¯æŒ‡å‘ä¸€ä¸ª objc_method_list è¿˜æ˜¯ä¸€ä¸ªåŒ…å« objc_method_list æŒ‡é’ˆçš„æ•°ç»„ï¼› 
```

- **instance_size**ï¼šè¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å°ï¼ˆåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å®ä¾‹å˜é‡ï¼‰ï¼›

- **ivars** ï¼šæŒ‡å‘ objc_ivar_list çš„æŒ‡é’ˆï¼Œå­˜å‚¨æ¯ä¸ªå®ä¾‹å˜é‡çš„å†…å­˜åœ°å€ï¼Œå¦‚æœè¯¥ç±»æ²¡æœ‰ä»»ä½•å®ä¾‹å˜é‡åˆ™ä¸º NULLï¼› 

- **methodLists** ï¼šä¸ info çš„ä¸€äº›æ ‡å¿—ä½æœ‰å…³ï¼ŒCLS_METHOD_ARRAY æ ‡è¯†ä½å†³å®šå…¶æŒ‡å‘çš„ä¸œè¥¿ï¼ˆæ˜¯æŒ‡å‘å•ä¸ª objc_method_listè¿˜æ˜¯ä¸€ä¸ª objc_method_list æŒ‡é’ˆæ•°ç»„ï¼‰ï¼Œå¦‚æœ info è®¾ç½®äº† CLS_CLASS åˆ™ objc_method_list  å­˜å‚¨å®ä¾‹æ–¹æ³•ï¼Œå¦‚æœè®¾ç½®çš„æ˜¯ CLS_META åˆ™å­˜å‚¨ç±»æ–¹æ³•ï¼› 

- **cache** ï¼šæŒ‡å‘ objc_cache çš„æŒ‡é’ˆï¼Œç”¨æ¥ç¼“å­˜æœ€è¿‘ä½¿ç”¨çš„æ–¹æ³•ï¼Œä»¥æé«˜æ•ˆç‡ï¼› 

- **protocols** ï¼šæŒ‡å‘ objc_protocol_list çš„æŒ‡é’ˆï¼Œå­˜å‚¨è¯¥ç±»å£°æ˜è¦éµå®ˆçš„æ­£å¼åè®®ã€‚


<br/>
<br/>

&emsp; è¿™é‡Œä¼šçœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªç»“æ„ä½“é‡Œè¿˜æœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼Œåˆæ˜¯ä¸€é‡æŒ‡å‘ï¼Œæ˜¯ä¸æ˜¯æœ‰ç§åˆ°äº†ç›—æ¢¦ç©ºé—´çš„æ„Ÿè§‰ã€‚ä¸ç”¨ç´§å¼ ï¼Œä¸ä¼šæœ‰é‚£ä¹ˆå¤šå±‚æ¬¡çš„ï¼Œè¿™é‡Œçš„isaæŒ‡é’ˆæŒ‡å‘çš„æ˜¯å…ƒç±»å¯¹è±¡(metaclass
 object)ï¼Œå¸¦æœ‰å…ƒå­—ï¼Œè¯æ˜å¿«åˆ°å¤´äº†ã€‚
 
 `é‚£å…ƒå¯¹è±¡æœ‰å•¥ç”¨å‘¢ï¼Ÿ`
 
 å®ƒç”¨æ¥å­˜å‚¨å…³äºç±»çš„ç‰ˆæœ¬ï¼Œåå­—ï¼Œç±»æ–¹æ³•ç­‰ä¿¡æ¯ã€‚æ‰€æœ‰çš„å…ƒç±»å¯¹è±¡(metaclass object)éƒ½æŒ‡å‘NSObjectçš„å…ƒç±»å¯¹è±¡ï¼Œåˆ°å¤´è¿˜æ˜¯NSObjectã€‚ä¸€å…±ä¸‰æ¬¡ï¼šç±»å¯¹è±¡->å…ƒç±»å¯¹è±¡->NSObjectå…ƒç±»å¯¹è±¡ã€‚

ä¸ºäº†å¾—åˆ°æ•´ä¸ªç±»ç»„ç»‡æ¶æ„çš„ä¿¡æ¯ï¼Œobjc_classç»“æ„é‡Œå®šä¹‰äº†ç¬¬äºŒä¸ªæˆå‘˜å˜é‡Class super_classï¼Œå®ƒæŒ‡å‘çˆ¶ç±»çš„ç±»å¯¹è±¡ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œå¯èƒ½å…³ç³»ç¼•ä¸æ¸…æ¥šï¼Œæœ‰é“æ˜¯ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­:


![<br/>](./../../Pictures/z59.jpg)


å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒD3ç»§æ‰¿D2,D2ç»§æ‰¿D1,D1æœ€ç»ˆç»§æ‰¿NSObjectã€‚ä¸‹å›¾ä»D3çš„ä¸€ä¸ªå¯¹è±¡å¼€å§‹ï¼Œæ’åˆ—å‡ºD3 D2 D1 NSObject ç±»å¯¹è±¡ï¼Œå…ƒç±»å¯¹è±¡ç­‰å…³ç³»ã€‚

![<br/>](./../../Pictures/z60.png)

ç›¸å½“äº 

![ios_oc1_83](./../../Pictures/ios_oc1_83.png)


<br/>

- **å­ç±»ï¼Œçˆ¶ç±»ï¼Œæ ¹ç±»ï¼ˆè¿™äº›éƒ½æ˜¯æ™®é€š classï¼‰ä»¥åŠå…¶å¯¹åº”çš„ metaclass çš„ isa ä¸ super_class ä¹‹é—´å…³ç³»:** 
	- è§„åˆ™ä¸€ï¼šç±»çš„å®ä¾‹å¯¹è±¡çš„ isa æŒ‡å‘è¯¥ç±»ï¼›è¯¥ç±»çš„ isa æŒ‡å‘è¯¥ç±»çš„ metaclassï¼›
	- è§„åˆ™äºŒï¼šç±»çš„ super_class æŒ‡å‘å…¶çˆ¶ç±»ï¼Œå¦‚æœè¯¥ç±»ä¸ºæ ¹ç±»åˆ™å€¼ä¸º NULLï¼› 
	- è§„åˆ™ä¸‰ï¼šmetaclass çš„ isa æŒ‡å‘æ ¹ metaclassï¼Œå¦‚æœè¯¥ metaclass æ˜¯æ ¹ metaclass åˆ™æŒ‡å‘è‡ªèº«ï¼›
	- è§„åˆ™å››ï¼šmetaclass çš„ super_class æŒ‡å‘çˆ¶ metaclassï¼Œå¦‚æœè¯¥ metaclass æ˜¯æ ¹ metaclass åˆ™æŒ‡å‘è¯¥ metaclass å¯¹åº”çš„ç±»ï¼› 


<br/>
<br/>



> <h2 id='ç±»ä¸å…ƒç±»åŒºåˆ«'>ç±»ä¸å…ƒç±»åŒºåˆ«</h2>

&emsp; å®ä¾‹å¯¹è±¡çš„classæ–¹æ³•å¯ä»¥æŸ¥çœ‹ç±»å¯¹è±¡æœ¬èº«,è€Œ**object_getClass(id _Nullable obj)** è¿”å›isaæŒ‡å‘çš„å…ƒç±»å¯¹è±¡.

```
DataModel *obj = [DataModel new];
//[obj class]è¿”å›ç±»å¯¹è±¡æœ¬èº«
NSLog(@"---->>>2: %@", [self.myObject2 class]);

//object_getClass(obj)è¿”å›ç±»å¯¹è±¡ä¸­çš„isaæŒ‡å‘çš„å…ƒç±»å¯¹è±¡ï¼Œå³æŒ‡å‘å…ƒç±»å¯¹è±¡
NSLog(@"---->>>3: %s", object_getClassName(self.myObject2));
NSLog(@"---->>>4: %@", object_getClass(self.myObject2));
```


&emsp; å®åŠ›å¯¹è±¡objçš„isaæŒ‡å‘çš„æ˜¯æœ¬ç±»,å³æ¶ˆæ¯æ¥æ”¶è€…æ˜¯[DataModelæœ¬ç±»](https://juejin.cn/post/6949585271692197925#heading-1);

&emsp; class æ˜¯ instance object çš„ç±»ç±»å‹ã€‚å½“æˆ‘ä»¬å‘å®ä¾‹å¯¹è±¡å‘é€æ¶ˆæ¯ï¼ˆå®ä¾‹æ–¹æ³•ï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯¥å®ä¾‹å¯¹è±¡çš„ class ç»“æ„çš„ methodlists ä¸­å»æŸ¥æ‰¾å“åº”çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æ‰¾åˆ°åŒ¹é…çš„å“åº”å‡½æ•°åˆ™åœ¨è¯¥ class çš„çˆ¶ç±»ä¸­çš„ methodlists å»æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾é“¾ä¸ºä¸Šå›¾çš„ä¸­é—´é‚£ä¸€æ’ï¼‰ã€‚å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå‘str å®ä¾‹å¯¹è±¡å‘é€ lowercaseString æ¶ˆæ¯ï¼Œä¼šåœ¨ NSString ç±»ç»“æ„çš„ methodlists ä¸­å»æŸ¥æ‰¾ lowercaseString çš„å“åº”å‡½æ•°ã€‚ 

```
NSString * str; 
[str lowercaseString];
```

<br/>

&emsp; metaclass æ˜¯ class object çš„ç±»ç±»å‹ã€‚å½“æˆ‘ä»¬å‘ç±»å¯¹è±¡å‘é€æ¶ˆæ¯ï¼ˆç±»æ–¹æ³•ï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯¥ç±»å¯¹è±¡çš„ metaclass ç»“æ„çš„ methodlists ä¸­å»æŸ¥æ‰¾å“åº”çš„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å“åº”å‡½æ•°åˆ™åœ¨è¯¥ metaclass çš„çˆ¶ç±»ä¸­çš„ methodlists å»æŸ¥æ‰¾ï¼ˆæŸ¥æ‰¾é“¾ä¸ºä¸Šå›¾çš„æœ€å³è¾¹é‚£ä¸€æ’ï¼‰ã€‚å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå‘ NSString ç±»å¯¹è±¡å‘é€ stringWithString æ¶ˆæ¯ï¼Œä¼šåœ¨ NSString çš„ metaclass ç±»ç»“æ„çš„ methodlists ä¸­å»æŸ¥æ‰¾ stringWithString çš„å“åº”å‡½æ•°ã€‚ 

```
[NSString stringWithString:@"str"];
```




<br/>
<br/>



> <h2 id='æ¶ˆæ¯è½¬å‘'>æ¶ˆæ¯è½¬å‘</h2>

[æ¶ˆæ¯è½¬å‘](https://blog.csdn.net/zhw521411/article/details/85617353)



**æŸ¥æ‰¾ IMP çš„è¿‡ç¨‹ï¼š**

&emsp; objc_msgSend ä¼šæ ¹æ®æ–¹æ³•é€‰æ ‡ SEL åœ¨ç±»ç»“æ„çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾æ–¹æ³•å®ç°IMPã€‚

&emsp; åœ¨ç±»ç»“æ„**struct objc_clas**sä¸­çœ‹åˆ°æœ‰ä¸€ä¸ªå«objc_cache *cache çš„æˆå‘˜ï¼Œè¿™ä¸ªç¼“å­˜ä¸ºæé«˜æ•ˆç‡è€Œå­˜åœ¨çš„ã€‚æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¼“å­˜ï¼ŒåŒæ—¶åŒ…æ‹¬ç»§æ‰¿çš„æ–¹æ³•å’Œåœ¨è¯¥ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚


ä¸‹é¢æ¥å‰–æä¸€æ®µè‹¹æœå®˜æ–¹è¿è¡Œæ—¶æºç ï¼š

```
static Method look_up_method(Class cls, SEL sel, 
                             BOOL withCache, BOOL withResolver)
{
    Method meth = NULL;
 
    if (withCache) {
        meth = _cache_getMethod(cls, sel, &_objc_msgForward_internal);
        if (meth == (Method)1) {
            // Cache contains forward:: . Stop searching.
            return NULL;
        }
    }
 
    if (!meth) meth = _class_getMethod(cls, sel);
 
    if (!meth  &&  withResolver) meth = _class_resolveMethod(cls, sel);
 
    return meth;
}
```

é€šè¿‡åˆ†æä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒæŸ¥æ‰¾æ—¶ï¼š

- 1ï¼Œé¦–å…ˆå»è¯¥ç±»çš„æ–¹æ³• cacheä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±è¿”å›å®ƒï¼›

- 2ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±å»è¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚å¦‚æœåœ¨è¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°äº†ï¼Œåˆ™å°† IMPè¿”å›ï¼Œå¹¶å°†å®ƒåŠ å…¥cacheä¸­ç¼“å­˜èµ·æ¥ã€‚æ ¹æ®æœ€è¿‘ä½¿ç”¨åŸåˆ™ï¼Œè¿™ä¸ªæ–¹æ³•å†æ¬¡è°ƒç”¨çš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œç¼“å­˜èµ·æ¥å¯ä»¥èŠ‚çœä¸‹æ¬¡è°ƒç”¨å†æ¬¡æŸ¥æ‰¾çš„å¼€é”€ã€‚

- 3ï¼Œå¦‚æœåœ¨è¯¥ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ²¡æ‰¾åˆ°å¯¹åº”çš„ IMPï¼Œåœ¨é€šè¿‡è¯¥ç±»ç»“æ„ä¸­çš„ super_classæŒ‡é’ˆåœ¨å…¶çˆ¶ç±»ç»“æ„çš„æ–¹æ³•åˆ—è¡¨ä¸­å»æŸ¥æ‰¾ï¼Œç›´åˆ°åœ¨æŸä¸ªçˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„IMPï¼Œè¿”å›å®ƒï¼Œå¹¶åŠ å…¥cacheä¸­ï¼›

- 4ï¼Œå¦‚æœåœ¨è‡ªèº«ä»¥åŠæ‰€æœ‰çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ IMPï¼Œåˆ™çœ‹æ˜¯ä¸æ˜¯å¯ä»¥è¿›è¡ŒåŠ¨æ€æ–¹æ³•å†³è®®ï¼ˆåé¢æœ‰ä¸“æ–‡è®²è¿°è¿™ä¸ªè¯é¢˜ï¼‰ï¼›

- 5ï¼Œå¦‚æœåŠ¨æ€æ–¹æ³•å†³è®®æ²¡èƒ½è§£å†³é—®é¢˜ï¼Œè¿›å…¥ä¸‹é¢è¦è®²çš„æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚



<br/>


æˆ‘ä»¬å¯ä»¥é€šè¿‡NSObjectçš„ä¸€äº›æ–¹æ³•è·å–è¿è¡Œæ—¶ä¿¡æ¯æˆ–åŠ¨æ€æ‰§è¡Œä¸€äº›æ¶ˆæ¯,å¦‚ä¸‹ä¾¿åˆ©å‡½æ•°ï¼š

```
class   è¿”å›å¯¹è±¡çš„ç±»ï¼›

isKindOfClass å’Œ isMemberOfClassæ£€æŸ¥å¯¹è±¡æ˜¯å¦åœ¨æŒ‡å®šçš„ç±»ç»§æ‰¿ä½“ç³»ä¸­ï¼›

respondsToSelector æ£€æŸ¥å¯¹è±¡èƒ½å¦ç›¸åº”æŒ‡å®šçš„æ¶ˆæ¯ï¼›

conformsToProtocol æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®ç°äº†æŒ‡å®šåè®®ç±»çš„æ–¹æ³•ï¼›

methodForSelector  è¿”å›æŒ‡å®šæ–¹æ³•å®ç°çš„åœ°å€ã€‚

performSelector:withObject æ‰§è¡ŒSEL æ‰€æŒ‡ä»£çš„æ–¹æ³•ã€‚
```




æ¶ˆæ¯è½¬å‘ï¼š

é€šå¸¸ï¼Œç»™ä¸€ä¸ªå¯¹è±¡å‘é€å®ƒä¸èƒ½å¤„ç†çš„æ¶ˆæ¯ä¼šå¾—åˆ°å‡ºé”™æç¤ºï¼Œç„¶è€Œï¼ŒObjective-Cè¿è¡Œæ—¶ç³»ç»Ÿåœ¨æŠ›å‡ºé”™è¯¯ä¹‹å‰ï¼Œä¼šç»™æ¶ˆæ¯æ¥æ”¶å¯¹è±¡å‘é€ä¸€æ¡ç‰¹åˆ«çš„æ¶ˆæ¯forwardInvocation æ¥é€šçŸ¥è¯¥å¯¹è±¡ï¼Œ`è¯¥æ¶ˆæ¯çš„å”¯ä¸€å‚æ•°æ˜¯ä¸ªNSInvocationç±»å‹çš„å¯¹è±¡â€”â€”è¯¥å¯¹è±¡å°è£…äº†åŸå§‹çš„æ¶ˆæ¯å’Œæ¶ˆæ¯çš„å‚æ•°`ã€‚

æˆ‘ä»¬å¯ä»¥å®ç°forwardInvocation:æ–¹æ³•æ¥å¯¹ä¸èƒ½å¤„ç†çš„æ¶ˆæ¯åšä¸€äº›é»˜è®¤çš„å¤„ç†ï¼Œä¹Ÿå¯ä»¥å°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†ï¼Œè€Œä¸æŠ›å‡ºé”™è¯¯





<br/>
<br/>



> <h2 id=''></h2>



<br/>
<br/>



> <h2 id=''></h2>





<br/>
<br/>


> <h2 id='æŒ‡é’ˆå¹³ç§»'>æŒ‡é’ˆå¹³ç§»</h2>

**PersonModel.hæ–‡ä»¶**

```
@interface WSPerson : NSObject

// å§“å
@property (nonatomic, copy) NSString *name;

/// æµ‹è¯•ç±»æŒ‡é’ˆå¹³ç§»
+ (void)testClassPointerTranslation;

/// ç±»æŒ‡é’ˆå¹³ç§»æµ‹è¯•
- (void) sayNB;
@end
```



**PersonModel.mæ–‡ä»¶**

```
- (void) sayNB {
    NSLog(@"ğŸ¥ºğŸ¥º %s name: %@", __func__, self.name);
}

/// æµ‹è¯•ç±»æŒ‡é’ˆå¹³ç§»
/// ä¸‹é¢çš„1 å’Œ 2 ä»£ç å—ä¸èƒ½è°ƒæ¢ä½ç½®,å¦åˆ™ä¼šæŠ¥é”™
+ (void)testClassPointerTranslation {
	
		//1.
    WSPerson *person = [WSPerson alloc];
    person.name = @"HarleyHuang20230318";
    [person sayNB];
    
    //2.
    Class pClass = [WSPerson class];
    void *ws = &pClass;
    [(__bridge  id)ws sayNB];
}
```

personèƒ½è°ƒç”¨æˆåŠŸå¯ä»¥ç†è§£,ä½†æ˜¯wsèƒ½è°ƒç”¨æˆåŠŸå—? è¯•ä¸€è¯•,æ‰“å°å¦‚ä¸‹:

```
2023-03-18 10:45:54.852829+0800 MLC[5281:106009] ğŸ¥ºğŸ¥º -[WSPerson sayNB] name: HarleyHuang20230318
2023-03-18 10:45:54.853075+0800 MLC[5281:106009] ğŸ¥ºğŸ¥º -[WSPerson sayNB] name: <WSPerson: 0x6000005bdc40>
```


2ä¸ªèƒ½æ‰“å°æˆåŠŸ,è¿™æ˜¯ä¸ºä»€ä¹ˆ? nameæ‰“å°ä¸åŒ,è¿™æ˜¯ä¸ºä»€ä¹ˆ?

- **åˆ†æ:**
	- é¦–å…ˆæ–¹æ³•æ˜¯å­˜åœ¨ç±»é‡Œçš„ï¼Œpersonèƒ½è°ƒç”¨æ˜¯å› ä¸ºpersoné‡Œçš„isaæŒ‡å‘ç±»ï¼Œpersonèƒ½è°ƒç”¨ç±»çš„æ–¹æ³•å®è´¨æ˜¯æŒ‡é’ˆå¹³ç§»çš„ç»“æœï¼Œæ‰€ä»¥personå¯ä»¥è®¿é—®åˆ°ç±»é‡Œçš„æ–¹æ³•ã€‚

	- void *ws = &pClassï¼Œå®è´¨æ˜¯å°†pClassåœ°å€èµ‹å€¼ç»™wsæŒ‡é’ˆï¼Œæ­¤æ—¶wsä¹ŸæŒ‡å‘ç±»ï¼Œè¿›è€Œèƒ½è®¿é—®åˆ°æ–¹æ³•ã€‚


![ios_oc1_94](./../../Pictures/ios_oc1_94.png)



<br/><br/>


> <h2 id='loadæ–¹æ³•è°ƒç”¨'>loadæ–¹æ³•è°ƒç”¨</h2>

- â‘  è°ƒç”¨æ—¶åˆ»ï¼š+loadæ–¹æ³•ä¼šåœ¨RuntimeåŠ è½½ç±»ã€åˆ†ç±»æ—¶è°ƒç”¨ï¼ˆä¸ç®¡æœ‰æ²¡æœ‰ç”¨åˆ°è¿™äº›ç±»ï¼Œåœ¨ç¨‹åºè¿è¡Œèµ·æ¥çš„æ—¶å€™éƒ½ä¼šåŠ è½½è¿›å†…å­˜ï¼Œå¹¶è°ƒç”¨+loadæ–¹æ³•ï¼‰ï¼› æ¯ä¸ªç±»ã€åˆ†ç±»çš„+loadï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªè°ƒç”¨ä¸€æ¬¡ï¼ˆé™¤éå¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚

- â‘¡ è°ƒç”¨æ–¹å¼ï¼šç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨+loadæ–¹å¼ä¸ºç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨ï¼Œå¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨+loadæ–¹å¼ä¸ºæ¶ˆæ¯æœºåˆ¶objc_msgSendå‡½æ•°è°ƒç”¨ã€‚

- â‘¢ è°ƒç”¨é¡ºåºï¼š å…ˆè°ƒç”¨ç±»çš„+loadï¼ŒæŒ‰ç…§ç¼–è¯‘å…ˆåé¡ºåºè°ƒç”¨ï¼ˆå…ˆç¼–è¯‘ï¼Œå…ˆè°ƒç”¨ï¼‰ï¼Œè°ƒç”¨å­ç±»çš„+loadä¹‹å‰ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„+loadï¼› å†è°ƒç”¨åˆ†ç±»çš„+loadï¼ŒæŒ‰ç…§ç¼–è¯‘å…ˆåé¡ºåºè°ƒç”¨ï¼ˆå…ˆç¼–è¯‘ï¼Œå…ˆè°ƒç”¨ï¼‰ï¼ˆæ³¨æ„ï¼šåˆ†ç±»çš„å…¶å®ƒæ–¹æ³•æ˜¯ï¼šåç¼–è¯‘ï¼Œä¼˜å…ˆè°ƒç”¨ï¼‰ã€‚



<br/><br/>

> <h3 id='æºç åˆ†æ'>æºç åˆ†æ</h3>

- objc-os.mm 
	- â‘  _objc_initï¼šRuntimeçš„å…¥å£å‡½æ•°ï¼Œè¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ

- objc-runtime-new.mm 
	- â‘¡ load_images 
	
	- â‘¢ prepare_load_methods â€ƒschedule_class_load â€ƒadd_class_to_loadable_list â€ƒadd_category_to_loadable_list 
	
	- â‘£ call_load_methods â€ƒcall_class_loads â€ƒcall_category_loads â€ƒ (*load_method)(cls, SEL_load) æ ¸å¿ƒå‡½æ•°


<br/>

> <h4 id='load_images'>load_images</h4>


```
void load_images(const char *path __unused, const struct mach_header *mh)
{
    recursive_mutex_locker_t lock(loadMethodLock);
 
    // Discover +load methods
    prepare_load_methods((const headerType *)mh);
 
    // Call +load methods (without classLock - re-entrant)
    call_load_methods();
}
```



<br/>

> <h4 id='prepare_load_methods'>prepare_load_methods</h4>

æŒ‰ç¼–è¯‘é¡ºåºå°†å¯åŠ è½½çš„ç±»æ·»åŠ è¿›loadable_classesæ•°ç»„ï¼Œå…ˆæ·»åŠ çˆ¶ç±»ï¼Œå†æ·»åŠ å­ç±»ï¼›æŒ‰ç¼–è¯‘é¡ºåºå°†å¯åŠ è½½çš„åˆ†ç±»æ·»åŠ è¿›loadable_categoriesæ•°ç»„ã€‚æ‰€ä»¥ï¼š

- æŒ‰ç¼–è¯‘é¡ºåºè°ƒç”¨ç±»çš„+loadæ–¹æ³•ï¼Œå…ˆç¼–è¯‘å…ˆè°ƒç”¨ï¼Œè°ƒç”¨å­ç±»çš„+loadä¹‹å‰ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„+loadï¼›

- æŒ‰ç¼–è¯‘é¡ºåºè°ƒç”¨åˆ†ç±»çš„+loadæ–¹æ³•ï¼Œå…ˆç¼–è¯‘å…ˆè°ƒç”¨ã€‚


```
void prepare_load_methods(const headerType *mhdr)
{
    size_t count, i;
 
    runtimeLock.assertLocked();
 
    // æŒ‰ç¼–è¯‘é¡ºåºå–å¾—ç±»æ•°ç»„
    classref_t *classlist =
        _getObjc2NonlazyClassList(mhdr, &count);
    for (i = 0; i < count; i++) {
        // å°†å¯åŠ è½½çš„ç±»æ·»åŠ åˆ° loadable_classes æ•°ç»„ä¸­
        // å…ˆæ·»åŠ çˆ¶ç±»ï¼Œå†æ·»åŠ å­ç±»
        schedule_class_load(remapClass(classlist[i]));
    }
 
    // æŒ‰ç¼–è¯‘é¡ºåºå–å¾—åˆ†ç±»æ•°ç»„
    category_t **categorylist = _getObjc2NonlazyCategoryList(mhdr, &count);
    for (i = 0; i < count; i++) {
        category_t *cat = categorylist[i];
        Class cls = remapClass(cat->cls);
        if (!cls) continue;  // category for ignored weak-linked class
        if (cls->isSwiftStable()) {
            _objc_fatal("Swift class extensions and categories on Swift "
                        "classes are not allowed to have +load methods");
        }
        realizeClassWithoutSwift(cls);
        assert(cls->ISA()->isRealized());
        // å°†å¯åŠ è½½çš„åˆ†ç±»æ·»åŠ åˆ° loadable_categories æ•°ç»„ä¸­
        add_category_to_loadable_list(cat);
    }
}
 
static void schedule_class_load(Class cls)
{
    if (!cls) return;
    assert(cls->isRealized());  // _read_images should realize
 
    if (cls->data()->flags & RW_LOADED) return;
 
    // Ensure superclass-first ordering
    /* é€’å½’è°ƒç”¨
       å…ˆæ·»åŠ çˆ¶ç±»ï¼Œå†æ·»åŠ å­ç±»
     */
    schedule_class_load(cls->superclass);
 
    // å°†å¯åŠ è½½çš„ç±»æ·»åŠ åˆ° loadable_classes æ•°ç»„ä¸­
    add_class_to_loadable_list(cls);
    cls->setInfo(RW_LOADED); 
}
```






<br/>

> <h4 id='call_load_methods'>call_load_methods</h4>

call_load_methods å…ˆè°ƒç”¨ç±»çš„+loadæ–¹æ³•ï¼Œå†è°ƒç”¨åˆ†ç±»çš„+loadæ–¹æ³•ã€‚


```
void call_load_methods(void)
{
    static bool loading = NO;
    bool more_categories;
 
    loadMethodLock.assertLocked();
 
    // Re-entrant calls do nothing; the outermost call will finish the job.
    if (loading) return;
    loading = YES;
 
    void *pool = objc_autoreleasePoolPush();
 
    do {
        // 1. Repeatedly call class +loads until there aren't any more
        // âš ï¸å…ˆè°ƒç”¨ç±»çš„ +load æ–¹æ³•
        while (loadable_classes_used > 0) {
            call_class_loads();
        }
 
        // 2. Call category +loads ONCE
        // âš ï¸å†è°ƒç”¨åˆ†ç±»çš„ +load æ–¹æ³•
        more_categories = call_category_loads();
 
        // 3. Run more +loads if there are classes OR more untried categories
    } while (loadable_classes_used > 0  ||  more_categories);
 
    objc_autoreleasePoolPop(pool);
 
    loading = NO;
}
```


<br/>

> <h4 id='call_class_loads&call_category_loads'>call_class_loads & call_category_loads</h4>

call_class_loads & call_category_loads ç±»å’Œåˆ†ç±»çš„+loadæ–¹æ³•æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨ï¼Œæ‰€ä»¥éƒ½ä¼šè°ƒç”¨ã€‚è€Œå…¶ä»–æ–¹æ³•å¦‚+teståˆ™æ˜¯é€šè¿‡æ¶ˆæ¯æœºåˆ¶objc_msgSendå‡½æ•°è°ƒç”¨ï¼Œä¼šä¼˜å…ˆæŸ¥æ‰¾å®¿ä¸»ç±»ä¸­é å‰çš„å…ƒç´ ï¼Œæ‰¾åˆ°åŒåæ–¹æ³•å°±è¿›è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥ä¼˜å…ˆè°ƒç”¨æœ€åç¼–è¯‘çš„åˆ†ç±»çš„æ–¹æ³•ã€‚


```
typedef void(*load_method_t)(id, SEL); //å‡½æ•°æŒ‡é’ˆ
 
struct loadable_class {
    Class cls;  // may be nil
    IMP method; // ç±»çš„ +load æ–¹æ³•çš„åœ°å€
};
 
struct loadable_category {
    Category cat;  // may be nil
    IMP method;    // åˆ†ç±»çš„ +load æ–¹æ³•çš„åœ°å€
};
 
static void call_class_loads(void)
{
    int i;
    
    // Detach current loadable list.
    // âš ï¸ä¸€å †å¯åŠ è½½çš„ç±»ï¼Œå°†å®ƒä»¬ä¿å­˜åˆ°å­˜æ”¾ loadable_class ç»“æ„ä½“ç±»å‹å…ƒç´ çš„æ•°ç»„
    struct loadable_class *classes = loadable_classes;
    int used = loadable_classes_used;
    loadable_classes = nil;
    loadable_classes_allocated = 0;
    loadable_classes_used = 0;
    
    // Call all +loads for the detached list.
    for (i = 0; i < used; i++) {
        Class cls = classes[i].cls;
        // âš ï¸ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªç±»çš„ methodï¼Œè¿™ä¸ª method å°±æ˜¯ç±»çš„ +load æ–¹æ³•çš„åœ°å€
        load_method_t load_method = (load_method_t)classes[i].method;
        if (!cls) continue; 
 
        if (PrintLoading) {
            _objc_inform("LOAD: +[%s load]\n", cls->nameForLogging());
        }
        // âš ï¸ç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨ +load æ–¹æ³•
        (*load_method)(cls, SEL_load);
    }
    
    // Destroy the detached list.
    if (classes) free(classes);
}
 
static bool call_category_loads(void)
{
    int i, shift;
    bool new_categories_added = NO;
    
    // Detach current loadable list.
    // âš ï¸ä¸€å †å¯åŠ è½½çš„åˆ†ç±»ï¼Œå°†å®ƒä»¬ä¿å­˜åˆ°å­˜æ”¾ loadable_category ç»“æ„ä½“ç±»å‹å…ƒç´ çš„æ•°ç»„
    struct loadable_category *cats = loadable_categories;
    int used = loadable_categories_used;
    int allocated = loadable_categories_allocated;
    loadable_categories = nil;
    loadable_categories_allocated = 0;
    loadable_categories_used = 0;
 
    // Call all +loads for the detached list.
    for (i = 0; i < used; i++) {
        Category cat = cats[i].cat;
        // âš ï¸ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªåˆ†ç±»çš„ methodï¼Œè¿™ä¸ª method å°±æ˜¯åˆ†ç±»çš„ +load æ–¹æ³•çš„åœ°å€
        load_method_t load_method = (load_method_t)cats[i].method;
        Class cls;
        if (!cat) continue;
 
        cls = _category_getClass(cat);
        if (cls  &&  cls->isLoadable()) {
            if (PrintLoading) {
                _objc_inform("LOAD: +[%s(%s) load]\n", 
                             cls->nameForLogging(), 
                             _category_getName(cat));
            }
            // âš ï¸ç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨ +load æ–¹æ³•
            (*load_method)(cls, SEL_load);
            cats[i].cat = nil;
        }
    }
    ......
}
```


ä»call_load_methodså‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šå…ˆè°ƒç”¨ç±»çš„+loadæ–¹æ³•ï¼Œå†è°ƒç”¨åˆ†ç±»çš„+loadæ–¹æ³•ã€‚ é‚£ä¹ˆåœ¨ç±»æˆ–è€…åˆ†ç±»ä¸­+loadæ–¹æ³•çš„è°ƒç”¨é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ ä»call_class_loadså’Œcall_category_loadså‡½æ•°ä¸­å¯ä»¥å¾—çŸ¥ï¼šå¯åŠ è½½çš„ç±»å’Œåˆ†ç±»åˆ†åˆ«ä¿å­˜åœ¨loadable_classeså’Œloadable_categoriesæ•°ç»„ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ææ˜ç™½è¿™ä¸¤ä¸ªæ•°ç»„ä¸­çš„ç±»å’Œåˆ†ç±»çš„å­˜æ”¾é¡ºåºï¼Œå°±å¯ä»¥çŸ¥é“è°ƒç”¨é¡ºåº



<br/>

> <h4 id=''></h4>



<br/>

> <h4 id=''></h4>




<br/>

> <h4 id=''></h4>



<br/>

> <h4 id=''></h4>


<br/>

***
<br/>
<br/>



 
># <h1 id='Categoryåˆ†ç±»'>Categoryåˆ†ç±»</h1>

**ç”¨å¤„:**
- å¯ä»¥æ·»åŠ ç±»æ–¹æ³•, åè®®, å±æ€§(åªæœ‰getå’Œsetæ–¹æ³•çš„å£°æ˜, æ²¡æœ‰å¯¹å…¶å®ç°);


<br/>


**ç‰¹ç‚¹**
- è¿è¡Œæ—¶å†³è®®
	- åˆ†ç±»æ–‡ä»¶åœ¨ç¼–è¯‘å, å¹¶æ²¡æœ‰ç«‹å³æŠŠå…¶æ·»åŠ çš„å†…å®¹æ·»åŠ åˆ°åŸç±»ä¸­, è€Œæ˜¯åœ¨è¿è¡Œæ—¶, åŠ¨æ€çš„æŠŠæ–¹æ³•,åè®®ç­‰å†…å®¹æ·»åŠ åˆ°åŸç±»ä¸­
- å¯ä»¥ä¸ºç³»ç»Ÿç±»æ·»åŠ æ–¹æ³•


<br/>
<br/>

> <h2 id='ä»£ç åŸç†'>ä»£ç åŸç†</h2>



<br/><br/>

> <h2 id='åˆ†ç±»ç»“æ„ä½“'>åˆ†ç±»ç»“æ„ä½“</h2>

- **1.åˆ†ç±»åº•å±‚æ˜¯ä¸ªC++çš„ç»“æ„ä½“, å†…éƒ¨å­˜å‚¨äº†åˆ†ç±»çš„å„ç§ä¿¡æ¯:**

```
struct category_t {
    const char *name;   // åˆ†ç±»å
    classref_t cls;     // åŸç±»å¯¹è±¡
    WrappedPtr<method_list_t, PtrauthStrip> instanceMethods;    // å®ä¾‹æ–¹æ³•åˆ—è¡¨
    WrappedPtr<method_list_t, PtrauthStrip> classMethods;       // ç±»æ–¹æ³•åˆ—è¡¨
    struct protocol_list_t *protocols;                          // åè®®æ–¹æ³•åˆ—è¡¨
    struct property_list_t *instanceProperties;                 // propertyå±æ€§åˆ—è¡¨
    // Fields below this point are not always present on disk.
    struct property_list_t *_classProperties;

    method_list_t *methodsForMeta(bool isMeta) {
        if (isMeta) return classMethods;
        else return instanceMethods;
    }

    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);
    
    protocol_list_t *protocolsForMeta(bool isMeta) {
        if (isMeta) return nullptr;
        else return protocols;
    }
};
```

<br/><br/><br/>

> <h2 id='åˆ†ç±»çš„åˆå¹¶attachCategories'>åˆ†ç±»çš„åˆå¹¶attachCategories</h2>

- **2.åˆ†ç±»çš„åˆå¹¶**

&emsp; å½“ç¨‹åºå¯åŠ¨ä¹‹å, ç³»ç»Ÿä¼šåœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ç³»åˆ—çš„å‡½æ•°è°ƒç”¨è¿›è¡Œåˆå§‹åŒ–ã€åŠ è½½é•œåƒæ–‡ä»¶ã€è¯»å–å¯æ‰§è¡Œæ–‡ä»¶ç­‰æ“ä½œ.

&emsp; åˆ†ç±»ä¸­çš„å®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³•ä¼šé€šè¿‡è¿è¡Œæ—¶æœºåˆ¶**Runtime**åˆ†åˆ«åˆå¹¶åˆ°ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¸­

- objc_init
- map_2_images
- map_images_nolock
- _read_images()
- remethodizeClass()
- attachCategories()

ä¹‹åè°ƒç”¨äº†remethodizeClasså‡½æ•°æ¥å¤„ç†åˆ†ç±»é€»è¾‘

```
static void remethodizeClass(Class cls) {
    category_list *cats;
    bool isMeta;
    runtimeLock.assertWriting();
    // åˆ¤æ–­å½“å‰ç±»æ˜¯å¦ä¸ºå…ƒç±»å¯¹è±¡
    // å¦‚æœæ·»åŠ çš„æ˜¯ç±»æ–¹æ³•,åˆ™ä¸ºYES, å®ä¾‹æ–¹æ³•ä¸ºNO
    isMeta = cls->isMetaClass();
    // Re-methodizing: check for more categories
    // è¿™é‡Œè·å–äº†æœªæ‹¼æ¥çš„æ‰€æœ‰åˆ†ç±»
    // æ³¨æ„: è¿™é‡Œæ˜¯è¿è¡Œæ—¶æ‰§è¡Œ, å³åˆ†ç±»çš„è¿è¡Œæ—¶å†³è®®ç‰¹ç‚¹, åœ¨è¿è¡Œæ—¶æ·»åŠ 
    if ((cats = unattachedCategoriesForClass(cls, false/*not realizing*/))) {
        if (PrintConnecting) {
            _objc_inform("CLASS: attaching categories to class '%s' %s", 
                         cls->nameForLogging(), isMeta ? "(meta)" : "");
        }
        // æŠŠåˆ†ç±»æ‹¼æ¥åˆ°åŸç±»ä¸Š
        attachCategories(cls, cats, true /*flush caches*/);        
        free(cats);
    }
}

```


<br/>

**æŠŠåˆ†ç±»çš„å†…å®¹åŠ¨æ€æ‹¼æ¥:** éå†åˆ†ç±»æ•°ç»„,è¿™ä¸ªåˆ†ç±»æ•°ç»„æ˜¯æŒ‰ç…§å…ˆç¼–è¯‘çš„åˆ†ç±»å…ˆå­˜æ”¾.ä½†æ˜¯åœ¨éå†çš„æ—¶å€™æ˜¯æŒ‰ç…§ä»åå¾€å‰å–å‡ºçš„éå†ç±»(ç±»ä¼¼å †),ç„¶åæŠŠå–å‡ºçš„æ‰€æœ‰åˆ†ç±»å±æ€§ã€æ–¹æ³•ã€åè®®æ”¾åœ¨3ä¸ªæ•°ç»„ä¸­,æœ€åå†åˆ†åˆ«æ·»åŠ åˆ°ç±»å¯¹è±¡ä¸­.

```
static void attachCategories(Class cls, category_list *cats, bool flush_caches) {//cls ç±»å¯¹è±¡  cats åˆ†ç±»åˆ—è¡¨  
    if (!cats) return;
    if (PrintReplacedMethods) printReplacements(cls, cats);

    bool isMeta = cls->isMetaClass();

    // fixme rearrange to remove these intermediate allocations
    //æ–¹æ³•åˆ—è¡¨æ•°ç»„
    /*
    [
        [method_t, method_t],
        [method_t, method_t]
    ]
    */
    // åˆ›å»ºå±€éƒ¨é›†åˆå˜é‡å­˜å‚¨åˆ†ç±»æ–¹æ³•, å±æ€§, åè®®ç­‰
    method_list_t **mlists = (method_list_t **)malloc(cats->count * sizeof(*mlists));
    //å±æ€§æ•°ç»„, ç»“æ„ä¸æ–¹æ³•åˆ—è¡¨æ•°ç»„ç±»ä¼¼
    property_list_t **proplists = (property_list_t **)
        malloc(cats->count * sizeof(*proplists));
    //åè®®æ•°ç»„, ç»“æ„åŒä¸Š
    protocol_list_t **protolists = (protocol_list_t **)
        malloc(cats->count * sizeof(*protolists));
        
           
    // Count backwards through cats to get newest categories first    
    int mcount = 0;
    int propcount = 0;
    int protocount = 0;
    int i = cats->count; // åŸç±»çš„åˆ†ç±»æ€»æ•°
    bool fromBundle = NO;
    /**
    *è¿™ä¸€ç‚¹æ˜¯é‡ç‚¹,è§£é‡Šäº†åˆ†ç±»å†…å®¹ä»€ä¹ˆæ—¶å€™è¢«æ‹¼æ¥åˆ°åŸç±»å¯¹è±¡ä¸Š, ä»¥åŠå¦‚æœå¤šä¸ªåˆ†ç±»æœ‰åŒåæ–¹æ³•, ç³»ç»Ÿä¼šè°ƒç”¨å“ªä¸ªæ–¹æ³•, å³å“ªä¸ªæ–¹æ³•æœ€ç»ˆä¼šç”Ÿæ•ˆ
    */
    // å€’åºéå†æ‰€æœ‰åˆ†ç±», æœ€å…ˆè®¿é—®æœ€åç¼–è¯‘çš„åˆ†ç±»
    // æ¢å¥è¯è¯´, åˆ†ç±»ç¼–è¯‘çš„è¶Šæ—©, è¢«éå†åˆ°çš„è¶Šæ™š
    while (i--) {
        //å–å‡ºæŸä¸ªåˆ†ç±»
        auto& entry = cats->list[i];
        //å–å‡ºåˆ†ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•åˆ—è¡¨
        method_list_t *mlist = entry.cat->methodsForMeta(isMeta);
      
        if (mlist) {
            // æœ€åç¼–è¯‘çš„åˆ†ç±», æœ€å…ˆè¢«æ·»åŠ åˆ°åˆ†ç±»æ•°ç»„ä¸­
            mlists[mcount++] = mlist;
            fromBundle |= entry.hi->isBundle();
        }

        property_list_t *proplist = 
            entry.cat->propertiesForMeta(isMeta, entry.hi);
        if (proplist) {
            proplists[propcount++] = proplist;
        }

        protocol_list_t *protolist = entry.cat->protocols;
        if (protolist) {
            protolists[protocount++] = protolist;
        }
    }
    
    //å–å‡ºç±»å¯¹è±¡ä¸­æ•°æ®
    // è¯»å–åŸç±»æ•°æ®,åŒ…å«æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯
    auto rw = cls->data();
    
    // å¯¹è¦æ·»åŠ çš„åˆ†ç±»å†…å®¹ä½œä¸€äº›å†…å­˜æ–¹é¢çš„å¤„ç†, ä¸ºåç»­æ‹¼æ¥åšå‡†å¤‡
    prepareMethodLists(cls, mlists, mcount, NO, fromBundle);
  
	  // æ³¨æ„:
   	// è¿™é‡Œ, å°†åŒ…æ‹¬mcountä¸ªå…ƒç´ çš„mlistsæ‹¼æ¥åˆ°åŸç±»çš„methodsæ–¹æ³•åˆ—è¡¨ä¸­
    //å°†æ‰€æœ‰åˆ†ç±»çš„å¯¹è±¡é™„åŠ åˆ°ç±»å¯¹è±¡æ–¹æ³•åˆ—è¡¨ä¸­
    rw->methods.attachLists(mlists, mcount);
    free(mlists);
    if (flush_caches  &&  mcount > 0) flushCaches(cls);
  
    //å°†æ‰€æœ‰åˆ†ç±»çš„å±æ€§é™„åŠ åˆ°ç±»å¯¹è±¡å±æ€§åˆ—è¡¨ä¸­
    rw->properties.attachLists(proplists, propcount);
    free(proplists);
  
    //å°†æ‰€æœ‰åˆ†ç±»çš„åè®®é™„åŠ åˆ°ç±»å¯¹è±¡åè®®åˆ—è¡¨ä¸­
    rw->protocols.attachLists(protolists, protocount);
    free(protolists);
}
```


<br/>
<br/>


 æœ€åçš„ç»„è£…, éœ€è¦æ³¨æ„çš„æ˜¯, å…¶ä»–åˆ†ç±»çš„æ·»åŠ çš„å†…å®¹, å¦‚æ–¹æ³•, å¹¶éæ˜¯è¢«è¦†ç›–äº†, è€Œæ˜¯å› ä¸ºæ–¹æ³•çš„ä½ç½®å¹¶éåœ¨é¦–ä½. æ‰€ä»¥è¯¥æ–¹æ³•æ²¡æœ‰æœºä¼šè°ƒç”¨, è€Œé€ æˆäº†è¢«è¦†ç›–çš„å‡è±¡.

åŒç†, '**åŸç±»ä¸­æ–¹æ³•è¢«åˆ†ç±»ä¸­æ–¹æ³•<è¦†ç›–å®ç°>**'çš„åŸå› ä¹Ÿæ˜¯è¿™æ ·.
 
```
void attachLists(List* const * addedLists, uint32_t addedCount) {
    if (addedCount == 0) return;

    if (hasArray()) {
        // many lists -> many lists
        // è·å–åŸç±»ä¸­å…ƒç´ æ€»æ•°
        uint32_t oldCount = array()->count;
        // æ‹¼æ¥ä¹‹åçš„å…ƒç´ æ€»æ•°
        uint32_t newCount = oldCount + addedCount;
        
        // æ ¹æ®æ‹¼æ¥åçš„å†…å®¹, æ·»åŠ åˆ†ç±»å…ƒç´ , é‡æ–°åˆ†é…å†…å­˜(ç”³è¯·æ–°çš„ç©ºé—´)
        setArray((array_t *)realloc(array(), array_t::byteSize(newCount)));
        
        // è®¾ç½®æ€»æ•°
        array()->count = newCount;
        
             
        /**é‡ç‚¹æ¥äº†
	       *å…ˆæŠŠå†…å­˜ç§»åŠ¨å¥½, ç»™åˆ†ç±»å…ƒç´ è…¾å‡ºç©ºé—´ 
         * [[],[],[åŸæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ],[åŸæœ‰ç¬¬äºŒä¸ªå…ƒç´ ]....]
        */
        //å°†åŸæ¥å†…å­˜çš„ä½ç½®çš„æ•°æ®æŒªåŠ¨åé¢ï¼Œarray()->listsä¸ºåŸæ¥çš„æ–¹æ³•åˆ—è¡¨
        memmove(array()->lists + addedCount, array()->lists, 
                oldCount * sizeof(array()->lists[0]));
        
        //æ‹·è´å°†æ–°çš„æ•°æ®ï¼Œä»å†…å­˜é¦–ç«¯å¼€å§‹
        æŠŠåˆ†ç±»å…ƒç´ æ·»åŠ åˆ°åŸç±»å…ƒç´ åˆ—è¡¨ä¸­ 
        /**
         *[
	        [addedListsä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ],
	        [addedListsä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ]...
	        [åŸæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ],
	        [åŸæœ‰ç¬¬äºŒä¸ªå…ƒç´ ]....
        ]
         * åˆ°æ­¤, å› ä¸ºaddedListsä¸­çš„å…ƒç´ æ·»åŠ è§„åˆ™æ˜¯æœ€åç¼–è¯‘çš„æœ€å…ˆè¢«æ·»åŠ 
         * æ‰€ä»¥, ä»¥æ–¹æ³•ä¸ºä¾‹,æœ€åç¼–è¯‘çš„åˆ†ç±»çš„æ–¹æ³•æœ€ç»ˆæ’å…¥åˆ°åŸç±»æ–¹æ³•åˆ—è¡¨çš„ç¬¬0ä¸ªä½ç½®
         * ä¹Ÿå°±æ˜¯, è¯¥æ–¹æ³•åœ¨è¿è¡Œæ—¶è°ƒç”¨æ—¶, æœ€ç»ˆè¢«æ‰§è¡Œ
         */
         memcpy(array()->lists, addedLists, 
   addedCount * sizeof(array()->lists[0]));
    }
}
```


![ios_oc1_89.png](./../../Pictures/ios_oc1_89.png)

- old_method ä¸ºåŸç±»æ–¹æ³•æ‰€å ç”¨çš„å†…å­˜ï¼Œnew_malloc ä¸ºæ–°ç”³è¯·çš„å†…å­˜åŒºåŸŸ
- ç„¶å old_method å¤åˆ¶åˆ°æ‰€ç”³è¯·æ–°çš„å†…å­˜åŒºåŸŸçš„æœ€æœ«ç«¯
- æœ€åæ·»åŠ åˆ†ç±»çš„æ–¹æ³• new_method ï¼Œä»æ•´ä¸ªæ–¹æ³•çš„å†…å­˜ä»é¦–ç«¯å¼€å§‹è¦†ç›–
- ç¼–è¯‘é¡ºåºè¶Šé åçš„åˆ†ç±»æ–¹æ³•çš„ä¼˜å…ˆçº§è¶Šé«˜

&emsp; æ‰€ä»¥åœ¨è°ƒç”¨å®ä¾‹å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»ä¸­çš„å®ä¾‹å¯¹è±¡æ–¹æ³•ï¼Œå…·ä½“çš„åˆ†ç±»é¡ºåºéœ€è¦åœ¨ XCode ä¸­è®¾ç½®åˆ†ç±»æ–‡ä»¶çš„ç¼–è¯‘é¡ºåºï¼Œåœ¨ **Project-BuildPhases-Compile Sources** ä¸­è¿›è¡Œè®¾ç½®


<br/>
<br/>

> <h2 id='å…³è”å¯¹è±¡AssociatedObject'>å…³è”å¯¹è±¡AssociatedObject</h2>

- **1.æ˜¯ä»€ä¹ˆ**

&emsp; ç™½è¯è¯´å°±æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡å…³è”åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Š, å¦‚ç»™åˆ†ç±»æ·»åŠ å…³è”çš„æˆå‘˜å˜é‡. ä½†æ˜¯, åªæ˜¯å…³è”, å¹¶éè¢«å…³è”çš„å¯¹è±¡å±äºå…³è”å¯¹è±¡.

<br/>

- **2.å¦‚ä½•ä½¿ç”¨**

å°±3ä¸ªæ–¹æ³•: **è®¾å®šå…³è”å€¼ã€å–å…³è”å€¼ã€ç§»é™¤å€¼**

**2.1 è®¾å®šå…³è”å€¼**

```
// è®¾å®šå€¼,å¹¶é€šè¿‡ç»™å®šçš„å…³è”ç­–ç•¥å»ºç«‹keyå’Œvalueçš„å…³è”å…³ç³»å…³è”åˆ°è¢«å…³è”å¯¹è±¡objectä¸Š(æœ‰ç‚¹ç»•)
objc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key, id _Nullable value, objc_AssociationPolicy policy)
```

- id object ï¼šå…³è”çš„æºå¯¹è±¡
- const void *keyï¼šå…³è”çš„key
- id valueï¼šå…³è”å¯¹è±¡ï¼Œé€šè¿‡å°†æ­¤ä¸ªå€¼ç½®æˆnilæ¥æ¸…é™¤å…³è”ã€‚
- objc_AssociationPolicy policyï¼šå…³è”çš„ç­–ç•¥

**å…³é”®ç­–ç•¥æ˜¯ä¸€ä¸ªenumå€¼**

```
OBJC_ASSOCIATION_ASSIGN = 0,      <æŒ‡å®šä¸€ä¸ªå¼±å¼•ç”¨å…³è”çš„å¯¹è±¡>
OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,<æŒ‡å®šä¸€ä¸ªå¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡>
OBJC_ASSOCIATION_COPY_NONATOMIC = 3,  <æŒ‡å®šç›¸å…³çš„å¯¹è±¡å¤åˆ¶>
OBJC_ASSOCIATION_RETAIN = 01401,      <æŒ‡å®šå¼ºå‚è€ƒ>
OBJC_ASSOCIATION_COPY = 01403    <æŒ‡å®šç›¸å…³çš„å¯¹è±¡å¤åˆ¶>
```

<br/>

**2.2 å–å…³è”å€¼**

```
// æ ¹æ®æŒ‡å®šçš„keyè·å–å¯¹åº”çš„å…³è”å¯¹è±¡å€¼, å¹¶è¿”å›
id objc_getAssociatedObject(id object, const void *key)
```


<br/>

**2.3 ç§»é™¤å…³è”å€¼**

```
// ç§»é™¤è¯¥å¯¹è±¡çš„æ‰€æœ‰å…³è”å¯¹è±¡
void objc_removeAssociatedObjects(id object)
```



<br/>
<br/>

> <h3 id='å…³è”å¯¹è±¡æœ¬è´¨'>å…³è”å¯¹è±¡æœ¬è´¨</h3>


&emsp; ç³»ç»Ÿç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„AssociationsManagerå•ä¾‹ç®¡ç†ç±», è¯¥ç±»çš„ç”Ÿå‘½å‘¨æœŸå’Œç¨‹åºåŒå±ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ, AssociationsManagerç®¡ç†è€…ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„AssociationsHashMapå“ˆå¸Œè¡¨å­˜å‚¨å®¹å™¨, æ‰€æœ‰å¯¹è±¡çš„å…³è”å†…å®¹å­˜å‚¨åœ¨è¿™ä¸ªå®¹å™¨ä¸­.æ‰€ä»¥è¯´, å‡å¦‚ç»™åˆ†ç±»æ·»åŠ äº†ä¸€ä¸ªå…³è”å¯¹è±¡, é‚£ä¹ˆè¯¥å…³è”å†…å®¹æ—¢ä¸éœ€è¦åˆ†ç±»ç®¡ç†, ä¹Ÿä¸æ˜¯ç”±åŸç±»ç®¡ç†.

```
class AssociationsManager {
    static spinlock_t _lock;
    static AssociationsHashMap *_map;               // associative references:  object pointer -> PtrPtrHashMap.
public:
    AssociationsManager()   { _lock.lock(); }
    ~AssociationsManager()  { _lock.unlock(); }
    
    AssociationsHashMap &associations() {
        if (_map == NULL)
            _map = new AssociationsHashMap();
        return *_map;
    }
};
```


<br/>

AssociationsHashMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªObjectAssociationMapå“ˆå¸Œè¡¨

```
class AssociationsHashMap : public unordered_map<disguised_ptr_t, ObjectAssociationMap *, DisguisedPointerHash, DisguisedPointerEqual, AssociationsHashMapAllocator> {
    public:
        void *operator new(size_t n) { return ::malloc(n); }
        void operator delete(void *ptr) { ::free(ptr); }
    };


```

<br/>

ObjectAssociationMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªObjcAssociationå“ˆå¸Œè¡¨

```
class ObjectAssociationMap : public std::map<void *, ObjcAssociation, ObjectPointerLess, ObjectAssociationMapAllocator> {
    public:
        void *operator new(size_t n) { return ::malloc(n); }
        void operator delete(void *ptr) { ::free(ptr); }
    };

```


<br/>


**å…³ç³»å¦‚ä¸‹å›¾:**

![ios_oc1_91.png](./../../Pictures/ios_oc1_91.png)



hashç»“æ„å›¾:

![ios_oc1_92.png](./../../Pictures/ios_oc1_92.png)





<br/>
<br/>

> <h3 id='Demo'>Demo</h3>


```
- (void) personTest {
    
    
    static char overviewKey;
    NSArray *array = [[NSArray alloc] initWithObjects:@"one", @"two", nil];
    NSString * overview = [[NSString alloc] initWithFormat:@"%@",@"First three numbers"];
    objc_setAssociatedObject(array, &overviewKey, overview, OBJC_ASSOCIATION_RETAIN);
    NSString *associatedObject = (NSString *)objc_getAssociatedObject(array, &overviewKey);
    NSLog(@"ğŸ associatedObject:%@", associatedObject);
    
    objc_setAssociatedObject(array, &overviewKey, nil, OBJC_ASSOCIATION_ASSIGN);
    NSString *associatedObject2 = (NSString *)objc_getAssociatedObject(array, &overviewKey);

    NSLog(@"ğŸŠ associatedObject:%@", associatedObject2);
}
```

æ‰“å°ï¼š

```
 ğŸ associatedObject:First three numbers
 ğŸŠ associatedObject:(null)
```


<br/>
<br/>


> <h3 id='æ·»åŠ å±æ€§'>æ·»åŠ å±æ€§</h3>



`NSStringåˆ†ç±».hæ–‡ä»¶`

```
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface NSString (Tool)


/// åˆ†ç±»æ·»åŠ å±æ€§(ä½¿ç”¨è¿è¡Œæ—¶)
@property(nonatomic, copy)NSString *name;

/// ä½¿ç”¨ä¸´æ—¶å…¨å±€å˜é‡æ¥æ›¿ä»£æˆå‘˜å˜é‡
@property (nonatomic, strong) NSString *title;


@end
```
<br/>

`.mæ–‡ä»¶`

```
#import "NSString+Tool.h"
#import <objc/runtime.h>

static const void *nameKey = &nameKey;
//***ä¸´æ—¶å…¨å±€å˜é‡***
static NSString *_title;

@implementation NSString (Tool)


- (void)setName:(NSString *)name {
    
    
   /**
    *  æ ¹æ®æŸä¸ªå¯¹è±¡ï¼Œè¿˜æœ‰keyï¼Œè¿˜æœ‰å¯¹åº”çš„ç­–ç•¥(copy,strongç­‰) åŠ¨æ€çš„å°†å€¼è®¾ç½®åˆ°è¿™ä¸ªå¯¹è±¡çš„keyä¸Š
    *
    *  @param object æŸä¸ªå¯¹è±¡
    *  @param key    å±æ€§å,æ ¹æ®keyå»è·å–å…³è”çš„å¯¹è±¡, æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œæ˜¯ä¸€ä¸ªåœ°å€(è¿™é‡Œæ³¨æ„ï¼Œåœ°å€å¿…é¡»æ˜¯ä¸å˜çš„ï¼Œåœ°å€ä¸åŒä½†æ˜¯å†…å®¹ç›¸åŒçš„ä¹Ÿä¸ç®—åŒä¸€ä¸ªkey)
    *  @param value  è¦è®¾ç½®çš„å€¼
    *  @param policy ç­–ç•¥(copy,strongï¼Œassignç­‰)
    */
    objc_setAssociatedObject(self, &nameKey, name, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

- (NSString *)name {
    return objc_getAssociatedObject(self, nameKey);
}

- (void)setTitle:(NSString *)title {
    _title = title;
}

- (NSString *)title {
    return _title;
}

@end



//è°ƒç”¨
 NSString *test = @"å¤§å¤´çˆ¸çˆ¸";
 test.name = @"å¼ å…‰åŒ—";
 NSLog(@"å­—ç¬¦ä¸²åˆ†ç±»å±æ€§nameå€¼ï¼š %@", test.name);
```
æ‰“å°ï¼š

`2019-11-16 19:36:41.693406+0800 HGSWB[19518:789236] å­—ç¬¦ä¸²åˆ†ç±»å±æ€§nameå€¼ï¼š å¼ å…‰åŒ—
`


<br/>

> <h3 id='åˆ†ç±»ä¸­çš„loadæ–¹æ³•å’Œinitializeæ–¹æ³•'>åˆ†ç±»ä¸­çš„loadæ–¹æ³•å’Œinitializeæ–¹æ³•</h3>



<br/><br/>

> <h4 id='1.loadæ–¹æ³•'>**1.loadæ–¹æ³•**</h4>




&emsp; load() æ–¹æ³•ä¼šåœ¨runtimeåŠ è½½ ç±»ï¼Œåˆ†ç±» æ—¶è°ƒç”¨ï¼Œæ— è®ºè¿™äº› ç±» æˆ– åˆ†ç±» æ˜¯å¦åŒ…å«äº main() å‡½æ•°çš„æ–‡ä»¶ä¸­æˆ–åŒ…å«äºå…¶ä»–çš„ç±»æ–‡ä»¶ä¸­ï¼Œå®ƒä»¬å„è‡ªçš„load() æ–¹æ³•éƒ½ä¼šåœ¨å†…å­˜ä¸­è¢«æ‰§è¡Œï¼Œä¸” load() æ–¹æ³•ä¸ä¼šé€šè¿‡æ¶ˆæ¯çš„å‘é€æœºåˆ¶è¿›è¡Œè°ƒç”¨ã€‚

<br/>


**1.1 loadæ–¹æ³•çš„è°ƒç”¨é¡ºåº**

**1.1.1 åˆ†ç±»ä¸­çš„loadæ–¹æ³•**

&emsp; å’Œåˆ†ç±»ä¸­çš„å®ä¾‹æ–¹æ³• ç›¸å ï¼Œload() æ–¹æ³•çš„å†…å­˜ä½ç½®å¹¶ä¸ä¼šè¢«åç¼–è¯‘çš„ åˆ†ç±» ä¸­çš„ load() æ‰€è¦†ç›–ï¼Œåªä¸ åˆ†ç±» æ–‡ä»¶çš„ç¼–è¯‘é¡ºåºæœ‰å…³ï¼Œç¼–è¯‘è¶Šé å‰çš„åˆ†ç±»è¶Šä¼˜å…ˆè°ƒç”¨ã€‚

&emsp; **è°ƒç”¨æ–¹å¼ï¼š** æ¶ˆæ¯æœºåˆ¶objc_msgSendå‡½æ•°è°ƒç”¨ã€‚

**1.1.2 ç»§æ‰¿ä¸­çš„loadæ–¹æ³•**

&emsp; å…ˆæŸ¥æ‰¾åˆ°å…¶æºç ï¼Œåœ¨ objc-runtime-new.mm ä¸­çš„prepare_load_methods() æ–¹æ³•ä¸­è°ƒç”¨äº†schedule_class_load() æ–¹æ³•ã€‚

```
static void schedule_class_load(Class cls)
{
    if (!cls) return;
    assert(cls->isRealized());  // _read_images should realize

    if (cls->data()->flags & RW_LOADED) return;

    // Ensure superclass-first ordering
    schedule_class_load(cls->superclass);

    add_class_to_loadable_list(cls);
    cls->setInfo(RW_LOADED); 
}
```

&emsp; å…¶ä¸­æœ‰ä¸€ä¸ªé€’å½’çš„è°ƒç”¨ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºcls->superclassï¼Œä¸”æ³¨é‡Šè¯´æ˜å…¶ç”¨æ„æ˜¯ç¡®ä¿çˆ¶ç±»æœ€ä¼˜å…ˆè°ƒç”¨ã€‚



<br/>
<br/>

> <h4 id='2.initializeæ–¹æ³•'>**2.initializeæ–¹æ³•**</h4>


&emsp; OC ä¸­çš„æ–¹æ³•è°ƒç”¨ï¼ˆä¹Ÿç§°æ¶ˆæ¯å‘é€ï¼‰ï¼Œå…¶å®éƒ½æ˜¯è½¬æ¢ä¸ºobjc_msgSend()å‡½æ•°çš„è°ƒç”¨ã€‚+initializeæ–¹æ³•ä¼šåœ¨ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è°ƒç”¨ï¼Œè¯´æ˜åœ¨objc_msgSend()å‡½æ•°å†…éƒ¨ä¼šåˆ¤æ–­æ˜¯ä¸æ˜¯ç¬¬ä¸€æ¬¡å‘é€æ¶ˆæ¯ï¼Œæ˜¯çš„è¯å°±è°ƒç”¨+initializeæ–¹æ³•ã€‚ å…³äºobjc_msgSend()å‡½æ•°çš„å…·ä½“è°ƒç”¨æµç¨‹å¯ä»¥æŸ¥çœ‹æˆ‘çš„æ–‡ç«  [**æ·±å…¥æµ…å‡º Runtimeï¼ˆä¸‰ï¼‰**](https://www.jianshu.com/p/a5d818d90a6e)ï¼šobjc_msgSendæ–¹æ³•è°ƒç”¨æµç¨‹ã€‚



<br/>


- **å‡½æ•°è°ƒç”¨æ ˆ:**

- objc-msg-arm64.s 
	- â‘  _objc_msgSend

- objc-runtime-new.mm 
	- â‘¡ class_getInstanceMethodï¼šè°ƒç”¨æ–¹æ³•ä¹‹å‰éœ€è¦å…ˆè·å–æ–¹æ³• 
	- â‘¢ lookUpImpOrNil 
	- â‘£ lookUpImpOrForward 
	- â‘¤ _class_initializeï¼šåˆå§‹åŒ–ç±»çš„å‡½æ•° 
	- â‘¥ callInitialize 
	- â‘¦ objc_msgSend(cls, SEL_initialize)ï¼šç»™ cls å¯¹è±¡å‘é€ initialize æ¶ˆæ¯



<br/><br/>

> <h5 id='lookUpImpOrForward'>lookUpImpOrForward</h5>

&emsp; æ‰“å¼€æºç ï¼Œåœ¨ objc-runtime-new.mm æ–‡ä»¶ä¸­

&emsp; ä»…åœ¨ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ initialize() æ–¹æ³•ï¼Œå¦‚æœåˆ†ç±»ä¸­å®ç°äº† initialize() ï¼Œä¼šç›´æ¥è¦†ç›–æœ¬èº«çš„initialize()æ–¹æ³•ã€‚

```
IMP lookUpImpOrForward(Class cls, SEL sel, id inst, 
                       bool initialize, bool cache, bool resolver)
{
    ......
 
    // âš ï¸å¦‚æœ receiverClass éœ€è¦åˆå§‹åŒ–ä¸”è¿˜æœªåˆå§‹åŒ–ï¼Œå°±è¿›è¡Œåˆå§‹åŒ–æ“ä½œ
    // è°ƒç”¨ _class_initialize(cls)ï¼Œè¯¥å‡½æ•°ä¸­ä¼šé€’å½’éå†çˆ¶ç±»ï¼Œåˆ¤æ–­çˆ¶ç±»æ˜¯å¦å­˜åœ¨ä¸”è¿˜æœªåˆå§‹åŒ– _class_initialize(cls->superclass)
    // è°ƒç”¨ callInitialize(cls) ï¼Œç»™ cls å‘é€ä¸€æ¡ initialize æ¶ˆæ¯((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize)
    // æ‰€ä»¥ +initialize æ–¹æ³•ä¼šåœ¨ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è°ƒç”¨
    // è°ƒç”¨æ–¹å¼ï¼šobjc_msgSend()
    // è°ƒç”¨é¡ºåºï¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„ +initializeï¼Œå†è°ƒç”¨å­ç±»çš„ +initialize (å…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼Œå†åˆå§‹åŒ–å­ç±»ï¼Œæ¯ä¸ªç±»åªä¼šåˆå§‹åŒ–1æ¬¡ï¼‰
    if (initialize  &&  !cls->isInitialized()) {//å…¶ä¸­å¯¹ç±»æ˜¯å¦åˆå§‹åŒ–è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–åˆ™è¿›å…¥ _class_initialize() æ–¹æ³•
        runtimeLock.unlockRead();
        _class_initialize (_class_getNonMetaClass(cls, inst));
        runtimeLock.read();
        // If sel == initialize, _class_initialize will send +initialize and 
        // then the messenger will send +initialize again after this 
        // procedure finishes. Of course, if this is not being called 
        // from the messenger then it won't happen. 2778172
    }
    ......
}

```




<br/><br/>

> <h5 id='_class_initialize'>_class_initialize</h5>

äºæ˜¯æ‰¾åˆ°æ–¹æ³•æ‰€åœ¨çš„æ–‡ä»¶ objc-initialize.mm

```
void _class_initialize(Class cls)
{
    assert(!cls->isMetaClass());

    Class supercls;
    bool reallyInitialize = NO;

    // Make sure super is done initializing BEFORE beginning to initialize cls.
    // See note about deadlock above.
    supercls = cls->superclass;
    //ä¼šå¯¹ä¼ å…¥çš„çˆ¶ç±»å…ˆè¿›è¡Œ initialize çš„åˆ¤æ–­ï¼Œç„¶åå†å¯¹å­ç±»è¿›è¡Œ initialize
    //é€’å½’è°ƒç”¨ å¦‚æœå­˜åœ¨çˆ¶ç±»ä¸”çˆ¶ç±»æœªåˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–çˆ¶ç±»
    if (supercls  &&  !supercls->isInitialized()) 
        _class_initialize(supercls);
    }
    
    // Try to atomically set CLS_INITIALIZING.
    {
        monitor_locker_t lock(classInitLock);
        if (!cls->isInitialized() && !cls->isInitializing()) {
            cls->setInitializing();
            reallyInitialize = YES;
        }
    }
    
    ......
 
#if __OBJC2__
        @try
#endif
        {
            // è°ƒç”¨ callInitialize
            callInitialize(cls);
 
					    ......
		    }
		    
		    ......
}
```


&emsp; æ‰€ä»¥å¦‚æœæ˜¯ç»§æ‰¿å…³ç³»çš„ç±»ï¼Œåœ¨å­ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„ initialize() æ–¹æ³•ï¼Œç„¶åå†è°ƒç”¨å­ç±»çš„ initialize() æ–¹æ³•


<br/>

callInitialize è°ƒç”¨objc_msgSendå‡½æ•°ï¼Œç»™ cls å¯¹è±¡å‘é€ initialize æ¶ˆæ¯ã€‚

```
void callInitialize(Class cls)
{
    ((void(*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);
    asm("");
}
```




<br/>
<br/>


**æ€»ç»“**

- è°ƒç”¨æ–¹å¼
	- **load**â€‹
		- â‘  ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨+loadæ–¹å¼ä¸ºç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨ï¼›
		- â‘¡ å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨+loadæ–¹å¼ä¸ºæ¶ˆæ¯æœºåˆ¶objc_msgSendå‡½æ•°è°ƒç”¨ã€‚
	
	- 	**initialize**
		- â€‹ initialize() æ˜¯é€šè¿‡ objc_msgSend() è°ƒç”¨

<br/>

- è°ƒç”¨æ—¶åˆ»

	- load() æ˜¯è¿è¡Œæ—¶åœ¨åŠ è½½ç±»ï¼Œåˆ†ç±»çš„æ—¶å€™è°ƒç”¨(åªä¼šè°ƒç”¨1æ¬¡)
	
	- initialize() æ˜¯ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç°+initializeæ–¹æ³•ï¼Œä¼šè°ƒç”¨çˆ¶ç±»çš„+initializeï¼Œæ‰€ä»¥çˆ¶ç±»çš„+initializeæ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†ä¸ä»£è¡¨çˆ¶ç±»åˆå§‹åŒ–å¤šæ¬¡ï¼Œæ¯ä¸ªç±»åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ã€‚


<br/>

- è°ƒç”¨é¡ºåº

	- load

		- å…ˆè°ƒç”¨ç±»çš„ load()
		- å…ˆç¼–è¯‘çš„ç±»ï¼Œä¼˜å…ˆè°ƒç”¨ load()
		- è°ƒç”¨å­ç±»çš„ load() ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„ load()
		- å†è°ƒç”¨åˆ†ç±»çš„ load()
		- å…ˆç¼–è¯‘çš„åˆ†ç±»ï¼Œä¼˜å…ˆè°ƒç”¨ load()

	- initialize
	
		- å…ˆåˆå§‹åŒ–çˆ¶ç±»
		- å†åˆå§‹åŒ–å­ç±»(å¯èƒ½æœ€ç»ˆè°ƒç”¨çš„æ˜¯çˆ¶ç±»çš„initializeæ–¹æ³•)



<br/>

**ç›¸å…³é¢è¯•é¢˜**

- Qï¼šCategory ä¸­æœ‰ +load æ–¹æ³•å—ï¼Ÿ+load æ–¹æ³•æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿ+load æ–¹æ³•èƒ½ç»§æ‰¿å—ï¼Ÿ

	- åˆ†ç±»ä¸­æœ‰+loadæ–¹æ³•ï¼›
	- +loadæ–¹æ³•åœ¨RuntimeåŠ è½½ç±»ã€åˆ†ç±»çš„æ—¶å€™è°ƒç”¨ï¼›
	- +loadæ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šæ‰‹åŠ¨å»è°ƒç”¨+loadæ–¹æ³•ï¼Œéƒ½æ˜¯è®©ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ã€‚

<br/>

- Qï¼šæ‰‹åŠ¨è°ƒç”¨ Student ç±»çš„ +load æ–¹æ³•ï¼Œä½†æ˜¯ Student ç±»æ²¡æœ‰å®ç°è¯¥æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆä¼šå»è°ƒç”¨çˆ¶ç±»çš„ +load æ–¹æ³•ï¼Œä¸”æ˜¯è°ƒç”¨çˆ¶ç±»çš„åˆ†ç±»çš„ +load æ–¹æ³•å‘¢ï¼Ÿ

å› ä¸º+loadæ–¹æ³•å¯ä»¥ç»§æ‰¿ï¼Œ[Student load]æ‰‹åŠ¨è°ƒç”¨æ–¹å¼ä¸ºæ˜¯æ¶ˆæ¯æœºåˆ¶objc_msgSendå‡½æ•°çš„è°ƒç”¨ï¼Œä¼šå»ç±»æ–¹æ³•åˆ—è¡¨é‡Œæ‰¾å¯¹åº”çš„æ–¹æ³•ï¼Œç”±äº Student ç±»æ²¡æœ‰å®ç°ï¼Œå°±ä¼šå»çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œä¸”ä¼˜å…ˆè°ƒç”¨åˆ†ç±»çš„+loadæ–¹æ³•ã€‚è€Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨çš„+loadæ–¹æ³•æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°åœ°å€è°ƒç”¨çš„ã€‚



<br/>

***
<br/>
<br/>

># <h1 id='Extensionæ‰©å±•'>Extensionæ‰©å±•</h1>


**Extensionæ‰©å±•å’Œåˆ†ç±»æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«?**

æ‰©å±•å¯ä»¥ä¸ºç±»æ·»åŠ ç§æœ‰å±æ€§, ç§æœ‰æ–¹æ³•, å£°æ˜ç§æœ‰å˜é‡.

- æ‰©å±•æ˜¯åœ¨ç¼–è¯‘æ—¶å†³è®®çš„, ç±»æ‰©å±•ä¸­çš„æ–¹æ³•å±æ€§, åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«æ·»åŠ åˆ°ç±»ä¸­, å› æ­¤æ‰©å±•ä¸­çš„æ–¹æ³•æ²¡æœ‰å®ç°, ç¼–è¯‘å™¨ä¼šæŠ¥è­¦å‘Š;
- ç±»æ‰©å±•æ²¡æœ‰ç‹¬ç«‹çš„å®ç°(@implementation), å³ç±»æ‰©å±•æ‰€å£°æ˜çš„æ–¹æ³•å¿…é¡»ä¾æ‰˜å¯¹åº”ç±»çš„å®ç°éƒ¨åˆ†æ¥å®ç°;
- ç±»æ‰©å±•å³å¯ä»¥å£°æ˜å±æ€§, åˆå¯ä»¥å£°æ˜ç§æœ‰æˆå‘˜å˜é‡;

<br/>

***
<br/>


># <h1 id='NSProxy(ä¼ªå¤šç»§æ‰¿)'>NSProxy(ä¼ªå¤šç»§æ‰¿)</h1>

># 

[NSProxy](https://www.jianshu.com/p/923f119333d8)






<br/>

***
<br/>


![è¯­è¨€åˆ†ç±»å›¾ ios_oc1_79](./../../Pictures/ios_oc1_79.jpg)


<br/>

***
<br/>
<br/>

># <h1 id='iOSåŸç”Ÿç³»ç»Ÿæ¶æ„'>iOSåŸç”Ÿç³»ç»Ÿæ¶æ„</h1>

<br/>

> <h2 id='iOSçš„ç³»ç»Ÿæ¶æ„æˆ'>iOSçš„ç³»ç»Ÿæ¶æ„æˆ</h2>

- Application Layerï¼ˆåº”ç”¨å±‚ï¼‰ã€
- Cocoa Touch Layerï¼ˆè§¦æ‘¸å±‚ï¼‰ã€
- Media Layer ï¼ˆåª’ä½“å±‚ï¼‰ã€
- Core Services Layerï¼ˆæ ¸å¿ƒæœåŠ¡å±‚ï¼‰ã€
- Core OS Layer ï¼ˆæ ¸å¿ƒç³»ç»Ÿæ“ä½œå±‚ï¼‰ã€
- The Kernel and Device Drivers layerï¼ˆå†…æ ¸å’Œé©±åŠ¨å±‚ï¼‰ã€‚



![ç³»ç»Ÿæ¶æ„å±‚çº§](./../../Pictures/ios_oc1_80.jpg)


<br/>


>## <h2 id='Cocoa'>**Cocoa**</h2>


<br/>


**æ¥æºï¼š**
>æ—©äº›å¹´ï¼Œè‹¹æœå…¬å¸å¯åŠ¨Coplandè®¡åˆ’ï¼Œè‡´åŠ›äºå¼€å‘å‡ºè‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œå¯æƒœåæ¥Coplandè®¡åˆ’é€æ¸å¤±æ§äº†ï¼Œè‹¹æœå…¬å¸æœ€ç»ˆå†³å®šæ”¾å¼ƒå¼€å‘ï¼Œè½¬å‘ä»åˆ«çš„å…¬å¸è´­ä¹°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„Mac OSã€‚åœ¨ç»è¿‡è°ƒæŸ¥ç°å­˜çš„æ“ä½œç³»ç»Ÿä¹‹åï¼Œè‹¹æœå…¬å¸é€‰æ‹©äº†NextSTEPï¼Œå› ä¸ºNextSTEPå¾ˆå°ï¼Œè‹¹æœ1996å¹´æ”¶è´­äº†Nextæ•´ä¸ªå…¬å¸ã€‚

>NextStepå†…ç½®è®¸å¤šåº“å’Œå·¥å…·ï¼Œèƒ½å”ç¨‹åºå‘˜ä»¥ä¸€ç§ä¼˜é›…çš„æ–¹å¼ä¸çª—å£ç®¡ç†å™¨è¿›è¡Œç›‘æŠ¤ï¼Œè¿™äº›åº“å«åšFrameworkï¼Œåœ¨1993å¹´è¿™äº›frameworkså’Œå·¥å…·è¢«é‡æ–°ä¿®æ”¹å¹¶é‡å‘½åOpenStepï¼Œåæ¥è¢«é‡å‘½åä¸ºCocoaï¼Œæ‰€ä»¥Cocoaçš„ç±»éƒ½æœ‰ç€NSçš„å‰ç¼€ã€‚

<br/>

**ä»€ä¹ˆæ˜¯Cocoaï¼Ÿ**
>äº‹å®ä¸Šï¼ŒCocoaï¼ˆiOSä¸Šçš„å«Cocoa Touchï¼‰æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„è½¯ä»¶ç»„ä»¶---ç±»çš„é›†æˆå¥—ä»¶ï¼Œå®ƒä½¿å¼€å‘è€…å¯ä»¥å¿«é€Ÿåˆ›å»ºå’Œå¥å£®å…¨åŠŸèƒ½çš„Mac OS Xå’ŒiOSåº”ç”¨ç¨‹åºã€‚

>Cocoa æ˜¯ä¸€å¥—æ¡†æ¶å’Œè¿è¡Œæ—¶æ”¯æŒï¼Œç®€å•æ¥è¯´å°±æ˜¯ API åº”ç”¨ç¨‹åºæ¥å£ã€‚


<br/>


> <h2 id='Cocoaå’ŒCocoaTouch'>Cocoaå’ŒCocoaTouch</h2>

>Cocoaæ˜¯Mac OS X çš„å¼€å‘ç¯å¢ƒ Â  Â  Â  Â  Â  Â  Â  Cocoa Touchæ˜¯iPhone OS çš„å¼€å‘ç¯å¢ƒã€‚

>CocoaåŒ…å«äº†å¾ˆå¤šæ¡†æ¶ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯Foundationæ¡†æ¶å’ŒApplication Kit æ¡†æ¶

>Cocoa ToouchåŒ…å«äº†å¾ˆå¤šæ¡†æ¶ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯Foundationæ¡†æ¶å’ŒUIKit æ¡†æ¶



<br/>

**æ¡†æ¶**

>Foundationæ¡†æ¶ä»¥Core Foundationæ¡†æ¶ä¸ºåŸºç¡€ï¼ŒCore Foundationæ¡†æ¶æä¾›çš„æ˜¯è¿‡ç¨‹åŒ–ï¼ˆANSI Cï¼‰æ¥å£ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ AppKit å’ŒUIKit æ¡†æ¶å¼€å‘åº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ¥å£ã€‚äºŒè€…ç”¨é€”ç›¸åŒï¼Œä½†æ˜¯é’ˆå¯¹å¹³å°ä¸åŒã€‚



<br/>


> **`æ¶æ„å±‚çº§ç»†åˆ†`**


![iOS8.3åŸç”Ÿæ¶æ„ç»†åˆ† ios_oc1_81](./../../Pictures/ios_oc1_81.png)

<br/>

**Core OSå±‚ï¼š**ç³»ç»Ÿæ ¸å¿ƒå±‚åŒ…å«å¤§å¤šæ•°ä½çº§åˆ«æ¥è¿‘ç¡¬ä»¶çš„åŠŸèƒ½ï¼Œå®ƒæ‰€åŒ…å«çš„æ¡†æ¶å¸¸å¸¸è¢«å…¶å®ƒæ¡†æ¶æ‰€ä½¿ç”¨ã€‚

- Accelerateæ¡†æ¶åŒ…å«æ•°å­—ä¿¡å·ï¼Œçº¿æ€§ä»£æ•°ï¼Œå›¾åƒå¤„ç†çš„æ¥å£ã€‚é’ˆå¯¹æ‰€æœ‰çš„iOSè®¾å¤‡ç¡¬ä»¶ä¹‹é—´çš„å·®å¼‚åšä¼˜åŒ–ï¼Œä¿è¯å†™ä¸€æ¬¡ä»£ç åœ¨æ‰€æœ‰iOSè®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œã€‚
- CoreBluetoothæ¡†æ¶åˆ©ç”¨è“ç‰™å’Œå¤–è®¾äº¤äº’ï¼ŒåŒ…æ‹¬æ‰«æè¿æ¥è“ç‰™è®¾å¤‡ï¼Œä¿å­˜è¿æ¥çŠ¶æ€ï¼Œæ–­å¼€è¿æ¥ï¼Œè·å–å¤–è®¾çš„æ•°æ®æˆ–è€…ç»™å¤–è®¾ä¼ è¾“æ•°æ®ç­‰ç­‰ã€‚
- Securityæ¡†æ¶æä¾›ç®¡ç†è¯ä¹¦ï¼Œå…¬é’¥å’Œç§é’¥ä¿¡ä»»ç­–ç•¥ï¼Œkeychain,hashè®¤è¯æ•°å­—ç­¾åç­‰ç­‰ä¸å®‰å…¨ç›¸å…³çš„è§£å†³æ–¹æ¡ˆã€‚


<br/>

**Core Services Layer**:ç³»ç»ŸæœåŠ¡å±‚æä¾›ç»™åº”ç”¨æ‰€éœ€è¦çš„åŸºç¡€çš„ç³»ç»ŸæœåŠ¡ã€‚

- Accounts: è´¦æˆ·æ¡†æ¶ï¼Œå¹¿å‘Šæ¡†æ¶ï¼Œæ•°æ®å­˜å‚¨æ¡†æ¶ï¼Œç½‘ç»œè¿æ¥æ¡†æ¶ï¼Œåœ°ç†ä½ç½®æ¡†æ¶ï¼Œè¿åŠ¨æ¡†æ¶ç­‰ç­‰ã€‚è¿™äº›æœåŠ¡ä¸­çš„æœ€æ ¸å¿ƒçš„æ˜¯CoreFoundationå’ŒFoundationæ¡†æ¶ï¼Œå®šä¹‰äº†æ‰€æœ‰åº”ç”¨ä½¿ç”¨çš„æ•°æ®ç±»å‹ã€‚
- CoreFoundationæ˜¯åŸºäºCçš„ä¸€ç»„æ¥å£ï¼ŒFoundationæ˜¯å¯¹CoreFoundationçš„OCå°è£…ã€‚

<br/>

**Media Layer**: åª’ä½“å±‚æä¾›åº”ç”¨ä¸­è§†å¬æ–¹é¢çš„æŠ€æœ¯ï¼Œå¦‚å›¾å½¢å›¾åƒç›¸å…³çš„:
- 	CoreGraphics,CoreImage,GLKit,OpenGL ES,CoreText,ImageIOç­‰ç­‰ã€‚

å£°éŸ³æŠ€æœ¯ç›¸å…³çš„:
- 	CoreAudio,OpenAL,AVFoundation,

è§†é¢‘ç›¸å…³çš„:
- 	CoreMedia,Media Playeræ¡†æ¶ï¼ŒéŸ³è§†é¢‘ä¼ è¾“çš„AirPlayæ¡†æ¶ç­‰ç­‰ã€‚


<br/>

**Cocoa Touch Layer:**è§¦æ‘¸å±‚æä¾›åº”ç”¨åŸºç¡€çš„å…³é”®æŠ€æœ¯æ”¯æŒå’Œåº”ç”¨çš„å¤–è§‚ã€‚
- NotificationCenterçš„æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€æœåŠ¡;
- iAdå¹¿å‘Šæ¡†æ¶;
- GameKitæ¸¸æˆå·¥å…·æ¡†æ¶;
- æ¶ˆæ¯UIæ¡†æ¶;
- å›¾ç‰‡UIæ¡†æ¶;
- åœ°å›¾æ¡†æ¶;
- è¿æ¥æ‰‹è¡¨æ¡†æ¶;
- è‡ªåŠ¨é€‚é…ç­‰ç­‰





<br/>


åŸç”Ÿæ¶æ„ç»†åˆ†æ¥å—ï¼Œè¯·çœ‹[è¿™é‡Œ](https://www.jianshu.com/p/80a27d111605)


```
NSå‡½æ•°å½’å±äºCocoa Foundationæ¡†æ¶ï¼›

CFå‡½æ•°å½’å±äºCore Foundationæ¡†æ¶ï¼›

CGå‡½æ•°å½’å±äºCoreGraphics.frameworksæ¡†æ¶ï¼›

CAå‡½æ•°å½’å±äºCoreAnimation.frameworksæ¡†æ¶ï¼›

UIå‡½æ•°å½’å±äºUIKitæ¡†æ¶ã€‚

UIKitç»§æ‰¿è‡ª Core Animation å’ŒCore Graphicsï¼›
Core Animationï¼šæ ¸å¿ƒåŠ¨ç”»ï¼› 
Core Graphicsï¼šæ ¸å¿ƒç»˜åˆ¶ ï¼›
UIkitï¼šiOSåŸºç¡€è§†å›¾æ¡†æ¶.

```



<br/>

***
<br/>

># <h1 id='NSObjectç»§æ‰¿å…³ç³»å›¾'>NSObjectç»§æ‰¿å…³ç³»å›¾</h1>


<br/>
<br/>

> <h2 id='Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»'>Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»</h2>

&emsp; ä¸‹é¢ä¸‰ä¸ªå›¾ï¼ŒåŒ…æ‹¬äº†Foundationæ‰€ä»¥çš„ç±»ï¼Œå›¾ä¸­ç°è‰²çš„æ˜¯iOSä¸æ”¯æŒçš„ï¼Œç°è‰²éƒ¨åˆ†æ˜¯OS Xç³»ç»Ÿçš„ã€‚

![<br/>](./../../Pictures/z56.jpg)


![<br/>](./../../Pictures/z57.jpg)


![<br/>](./../../Pictures/z58.jpg)


&emsp; **å°†ä¸Šå›¾Foundationæ¡†æ¶ä¸­çš„ç±»è¿›è¡Œé€»è¾‘åˆ†ç±»å¦‚ä¸‹ï¼š**
- å€¼å¯¹è±¡
- é›†åˆ
- æ“ä½œç³»ç»ŸæœåŠ¡ åŒ…æ‹¬ä¸‹é¢ä¸‰ä¸ªï¼šæ–‡ä»¶ç³»ç»Ÿå’ŒURLè¿›ç¨‹é—´é€šè®¯ã€‚
	- è¿™ä¸ªèŒƒç•´ä¸­çš„å¤§éƒ¨åˆ†ç±»ä»£è¡¨ä¸åŒçš„ç³»ç»Ÿç«¯å£ã€å¥—æ¥å­—ã€å’Œåå­—æœåŠ¡å™¨ï¼Œå¯¹å®ç°åº•å±‚çš„IPCå¾ˆæœ‰ç”¨ã€‚
	- NSPipeä»£è¡¨ä¸€ä¸ªBSDç®¡é“ï¼Œå³ä¸€ç§è¿›ç¨‹é—´çš„å•å‘é€šè®¯é€šé“ã€‚
	- çº¿ç¨‹å’Œå­ä»»åŠ¡:NSThreadç±»ä½¿æ‚¨å¯ä»¥åˆ›å»ºå¤šçº¿ç¨‹çš„ç¨‹åºï¼Œè€Œå„ç§é”ï¼ˆlockï¼‰ç±»åˆ™ä¸ºå½¼æ­¤ç«äº‰çš„çº¿ç¨‹åœ¨è®¿é—®è¿›ç¨‹èµ„æºæ—¶æä¾›å„ç§æ§åˆ¶æœºåˆ¶ã€‚é€šè¿‡NSTaskï¼Œæ‚¨çš„ç¨‹åºå¯ä»¥åˆ†å‡º Â  Â  Â ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå…¶å®ƒå·¥ä½œæˆ–è¿›è¡Œè¿›åº¦ç›‘æ§ã€‚
- é€šçŸ¥
- å½’æ¡£å’Œåºåˆ—åŒ–
- è¡¨è¾¾å¼å’Œæ¡ä»¶åˆ¤æ–­
- Objective-Cè¯­è¨€æœåŠ¡



<br/>
<br/>


![NSObject å…³ç³»å›¾](./../../Pictures/ios_oc1_82.jpg)


**Objective-Cæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€:**

&emsp; Objective-Cå’ŒJava C++ä¸€æ ·ï¼Œæœ‰å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ï¼Œé‡ç”¨ã€‚ä½†æ˜¯å®ƒä¸åƒC++é‚£æ ·æœ‰é‡è½½æ“ä½œæ³•ã€æ¨¡ç‰ˆå’Œå¤šç»§æ‰¿ï¼Œä¹Ÿæ²¡æœ‰Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶


<br/>

**Objective-Cçš„ä¼˜ç‚¹:**

- Objective-Cè¯­è¨€æœ‰C++ Javaç­‰é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹ï¼Œé‚£æ˜¯è¿œè¿œä¸èƒ½ä½“ç°å®ƒçš„ä¼˜ç‚¹çš„ã€‚Objective-Cçš„ä¼˜ç‚¹æ˜¯å®ƒæ˜¯åŠ¨æ€çš„ã€‚åŠ¨æ€èƒ½åŠ›æœ‰ä¸‰ç§ï¼š
- åŠ¨æ€ç±»-è¿è¡Œæ—¶ç¡®å®šç±»çš„å¯¹è±¡
- åŠ¨æ€ç»‘å®š-è¿è¡Œæ—¶ç¡®å®šè¦è°ƒç”¨çš„æ–¹æ³•
- åŠ¨æ€åŠ è½½--è¿è¡Œæ—¶ä¸ºç¨‹åºåŠ è½½æ–°çš„æ¨¡å—



<br/>
<br/>

![NSObject ç»§æ‰¿å…³ç³»å›¾ ios_oc1_84](./../../Pictures/ios_oc1_84.png)


<br/>

># <h1 id='UIResponderç»§æ‰¿å…³ç³»å›¾'>UIResponder ç»§æ‰¿å…³ç³»å›¾</h1>

<br/>
<br/>

> <h2 id=''></h2>



![UIResponder ç»§æ‰¿å…³ç³»å›¾ ios_oc1_85](./../../Pictures/ios_oc1_85.png)


<br/>

***
<br/>



> <h1 id='æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾'>æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾</h1>


![æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾](./../../Pictures/ios_oc1_86.png)

