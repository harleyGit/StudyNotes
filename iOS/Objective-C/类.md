
> <h2 id=''></h2>
- [**ç±»**](#ç±»)
- [**Categoryåˆ†ç±»**](#Categoryåˆ†ç±»)
	- [ä»£ç åŸç†](#ä»£ç åŸç†)
	- [å…³è”å¯¹è±¡AssociatedObject](#å…³è”å¯¹è±¡AssociatedObject)
		- [å…³è”å¯¹è±¡æœ¬è´¨](#å…³è”å¯¹è±¡æœ¬è´¨)
		- [**Demo**](#Demo)
		- [**æ·»åŠ å±æ€§**](#æ·»åŠ å±æ€§)
- [**Extensionæ‰©å±•**](#Extensionæ‰©å±•)
- [**NSProxy(ä¼ªå¤šç»§æ‰¿)**](#NSProxy(ä¼ªå¤šç»§æ‰¿))
- [**iOSåŸç”Ÿç³»ç»Ÿæ¶æ„**](#iOSåŸç”Ÿç³»ç»Ÿæ¶æ„)
	- [iOSçš„ç³»ç»Ÿæ¶æ„æˆ](#iOSçš„ç³»ç»Ÿæ¶æ„æˆ)
	-  [Cocoa](#Cocoa)
	- [Cocoaå’ŒCocoaTouch](#Cocoaå’ŒCocoaTouch)
	-  [æ¶æ„å±‚çº§ç»†åˆ†](#æ¶æ„å±‚çº§ç»†åˆ†)
- [**NSObject ç»§æ‰¿å…³ç³»å›¾**](#NSObjectç»§æ‰¿å…³ç³»å›¾)
	-  [Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»](#Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»)
- [**UIResponder ç»§æ‰¿å…³ç³»å›¾**](#UIResponderç»§æ‰¿å…³ç³»å›¾)
- [**æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾**](#æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾)
- **èµ„æ–™**
	- [iOSåˆ†ç±»ä¸èƒ½æ·»åŠ å±æ€§åŸå› çš„æ¢ç´¢](https://blog.csdn.net/u012409247/article/details/80206229)
	- [ç±»çš„åŸç†(ä¸Š)](https://juejin.cn/post/6974962306530672670)
	- [ç±»çš„åŸç†(ä¸­)](https://juejin.cn/post/6975813381060034574)
	- [ç±»çš„åŸç†(ä¸‹)](https://juejin.cn/post/6978374430267457573)



<br/>

***
<br/>
<br/>


> <h1 id='ç±»'>ç±»</h1>



```
LGTeacter *lg = [LGTeacter new];
```

&emsp; å®åŠ›å¯¹è±¡çš„isaæŒ‡å‘çš„æ˜¯æœ¬ç±»,å³æ¶ˆæ¯æ¥æ”¶è€…æ˜¯[LGTeacheræœ¬ç±»](https://juejin.cn/post/6949585271692197925#heading-1);





<br/>

***
<br/>
<br/>



 
># <h1 id='Categoryåˆ†ç±»'>Categoryåˆ†ç±»</h1>

**ç”¨å¤„:**
- å¯ä»¥æ·»åŠ ç±»æ–¹æ³•, åè®®, å±æ€§(åªæœ‰getå’Œsetæ–¹æ³•çš„å£°æ˜, æ²¡æœ‰å¯¹å…¶å®ç°);


<br/>


**ç‰¹ç‚¹**
- è¿è¡Œæ—¶å†³è®®
	- åˆ†ç±»æ–‡ä»¶åœ¨ç¼–è¯‘å, å¹¶æ²¡æœ‰ç«‹å³æŠŠå…¶æ·»åŠ çš„å†…å®¹æ·»åŠ åˆ°åŸç±»ä¸­, è€Œæ˜¯åœ¨è¿è¡Œæ—¶, åŠ¨æ€çš„æŠŠæ–¹æ³•,åè®®ç­‰å†…å®¹æ·»åŠ åˆ°åŸç±»ä¸­
- å¯ä»¥ä¸ºç³»ç»Ÿç±»æ·»åŠ æ–¹æ³•


<br/>
<br/>

> <h2 id='ä»£ç åŸç†'>ä»£ç åŸç†</h2>


- **1.åˆ†ç±»åº•å±‚æ˜¯ä¸ªC++çš„ç»“æ„ä½“, å†…éƒ¨å­˜å‚¨äº†åˆ†ç±»çš„å„ç§ä¿¡æ¯:**

```
struct category_t {
    const char *name;   // åˆ†ç±»å
    classref_t cls;     // åŸç±»å¯¹è±¡
    WrappedPtr<method_list_t, PtrauthStrip> instanceMethods;    // å®ä¾‹æ–¹æ³•åˆ—è¡¨
    WrappedPtr<method_list_t, PtrauthStrip> classMethods;       // ç±»æ–¹æ³•åˆ—è¡¨
    struct protocol_list_t *protocols;                          // åè®®æ–¹æ³•åˆ—è¡¨
    struct property_list_t *instanceProperties;                 // propertyå±æ€§åˆ—è¡¨
    // Fields below this point are not always present on disk.
    struct property_list_t *_classProperties;

    method_list_t *methodsForMeta(bool isMeta) {
        if (isMeta) return classMethods;
        else return instanceMethods;
    }

    property_list_t *propertiesForMeta(bool isMeta, struct header_info *hi);
    
    protocol_list_t *protocolsForMeta(bool isMeta) {
        if (isMeta) return nullptr;
        else return protocols;
    }
};
```

<br/>

- **2.åˆ†ç±»çš„åˆå¹¶**

&emsp; å½“ç¨‹åºå¯åŠ¨ä¹‹å, ç³»ç»Ÿä¼šåœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ç³»åˆ—çš„å‡½æ•°è°ƒç”¨è¿›è¡Œåˆå§‹åŒ–ã€åŠ è½½é•œåƒæ–‡ä»¶ã€è¯»å–å¯æ‰§è¡Œæ–‡ä»¶ç­‰æ“ä½œ.

&emsp; åˆ†ç±»ä¸­çš„å®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³•ä¼šé€šè¿‡è¿è¡Œæ—¶æœºåˆ¶**Runtime**åˆ†åˆ«åˆå¹¶åˆ°ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¸­

- objc_init
- map_2_images
- map_images_nolock
- _read_images()
- remethodizeClass()
- attachCategories()

ä¹‹åè°ƒç”¨äº†remethodizeClasså‡½æ•°æ¥å¤„ç†åˆ†ç±»é€»è¾‘

```
static void remethodizeClass(Class cls) {
    category_list *cats;
    bool isMeta;
    runtimeLock.assertWriting();
    // åˆ¤æ–­å½“å‰ç±»æ˜¯å¦ä¸ºå…ƒç±»å¯¹è±¡
    // å¦‚æœæ·»åŠ çš„æ˜¯ç±»æ–¹æ³•,åˆ™ä¸ºYES, å®ä¾‹æ–¹æ³•ä¸ºNO
    isMeta = cls->isMetaClass();
    // Re-methodizing: check for more categories
    // è¿™é‡Œè·å–äº†æœªæ‹¼æ¥çš„æ‰€æœ‰åˆ†ç±»
    // æ³¨æ„: è¿™é‡Œæ˜¯è¿è¡Œæ—¶æ‰§è¡Œ, å³åˆ†ç±»çš„è¿è¡Œæ—¶å†³è®®ç‰¹ç‚¹, åœ¨è¿è¡Œæ—¶æ·»åŠ 
    if ((cats = unattachedCategoriesForClass(cls, false/*not realizing*/))) {
        if (PrintConnecting) {
            _objc_inform("CLASS: attaching categories to class '%s' %s", 
                         cls->nameForLogging(), isMeta ? "(meta)" : "");
        }
        // æŠŠåˆ†ç±»æ‹¼æ¥åˆ°åŸç±»ä¸Š
        attachCategories(cls, cats, true /*flush caches*/);        
        free(cats);
    }
}

```


<br/>

**æŠŠåˆ†ç±»çš„å†…å®¹åŠ¨æ€æ‹¼æ¥:**

```
static void attachCategories(Class cls, category_list *cats, bool flush_caches) {//cls ç±»å¯¹è±¡  cats åˆ†ç±»åˆ—è¡¨  
    if (!cats) return;
    if (PrintReplacedMethods) printReplacements(cls, cats);

    bool isMeta = cls->isMetaClass();

    // fixme rearrange to remove these intermediate allocations
    //æ–¹æ³•åˆ—è¡¨æ•°ç»„
    /*
    [
        [method_t, method_t],
        [method_t, method_t]
    ]
    */
    // åˆ›å»ºå±€éƒ¨é›†åˆå˜é‡å­˜å‚¨åˆ†ç±»æ–¹æ³•, å±æ€§, åè®®ç­‰
    method_list_t **mlists = (method_list_t **)malloc(cats->count * sizeof(*mlists));
    //å±æ€§æ•°ç»„, ç»“æ„ä¸æ–¹æ³•åˆ—è¡¨æ•°ç»„ç±»ä¼¼
    property_list_t **proplists = (property_list_t **)
        malloc(cats->count * sizeof(*proplists));
    //åè®®æ•°ç»„, ç»“æ„åŒä¸Š
    protocol_list_t **protolists = (protocol_list_t **)
        malloc(cats->count * sizeof(*protolists));
        
           
    // Count backwards through cats to get newest categories first    
    int mcount = 0;
    int propcount = 0;
    int protocount = 0;
    int i = cats->count; // åŸç±»çš„åˆ†ç±»æ€»æ•°
    bool fromBundle = NO;
    /**
    *è¿™ä¸€ç‚¹æ˜¯é‡ç‚¹,è§£é‡Šäº†åˆ†ç±»å†…å®¹ä»€ä¹ˆæ—¶å€™è¢«æ‹¼æ¥åˆ°åŸç±»å¯¹è±¡ä¸Š, ä»¥åŠå¦‚æœå¤šä¸ªåˆ†ç±»æœ‰åŒåæ–¹æ³•, ç³»ç»Ÿä¼šè°ƒç”¨å“ªä¸ªæ–¹æ³•, å³å“ªä¸ªæ–¹æ³•æœ€ç»ˆä¼šç”Ÿæ•ˆ
    */
    // å€’åºéå†æ‰€æœ‰åˆ†ç±», æœ€å…ˆè®¿é—®æœ€åç¼–è¯‘çš„åˆ†ç±»
    // æ¢å¥è¯è¯´, åˆ†ç±»ç¼–è¯‘çš„è¶Šæ—©, è¢«éå†åˆ°çš„è¶Šæ™š
    while (i--) {
        //å–å‡ºæŸä¸ªåˆ†ç±»
        auto& entry = cats->list[i];
        //å–å‡ºåˆ†ç±»ä¸­çš„å¯¹è±¡æ–¹æ³•åˆ—è¡¨
        method_list_t *mlist = entry.cat->methodsForMeta(isMeta);
      
        if (mlist) {
            // æœ€åç¼–è¯‘çš„åˆ†ç±», æœ€å…ˆè¢«æ·»åŠ åˆ°åˆ†ç±»æ•°ç»„ä¸­
            mlists[mcount++] = mlist;
            fromBundle |= entry.hi->isBundle();
        }

        property_list_t *proplist = 
            entry.cat->propertiesForMeta(isMeta, entry.hi);
        if (proplist) {
            proplists[propcount++] = proplist;
        }

        protocol_list_t *protolist = entry.cat->protocols;
        if (protolist) {
            protolists[protocount++] = protolist;
        }
    }
    
    //å–å‡ºç±»å¯¹è±¡ä¸­æ•°æ®
    // è¯»å–åŸç±»æ•°æ®,åŒ…å«æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯
    auto rw = cls->data();
    
    // å¯¹è¦æ·»åŠ çš„åˆ†ç±»å†…å®¹ä½œä¸€äº›å†…å­˜æ–¹é¢çš„å¤„ç†, ä¸ºåç»­æ‹¼æ¥åšå‡†å¤‡
    prepareMethodLists(cls, mlists, mcount, NO, fromBundle);
  
	  // æ³¨æ„:
   	// è¿™é‡Œ, å°†åŒ…æ‹¬mcountä¸ªå…ƒç´ çš„mlistsæ‹¼æ¥åˆ°åŸç±»çš„methodsæ–¹æ³•åˆ—è¡¨ä¸­
    //å°†æ‰€æœ‰åˆ†ç±»çš„å¯¹è±¡é™„åŠ åˆ°ç±»å¯¹è±¡æ–¹æ³•åˆ—è¡¨ä¸­
    rw->methods.attachLists(mlists, mcount);
    free(mlists);
    if (flush_caches  &&  mcount > 0) flushCaches(cls);
  
    //å°†æ‰€æœ‰åˆ†ç±»çš„å±æ€§é™„åŠ åˆ°ç±»å¯¹è±¡å±æ€§åˆ—è¡¨ä¸­
    rw->properties.attachLists(proplists, propcount);
    free(proplists);
  
    //å°†æ‰€æœ‰åˆ†ç±»çš„åè®®é™„åŠ åˆ°ç±»å¯¹è±¡åè®®åˆ—è¡¨ä¸­
    rw->protocols.attachLists(protolists, protocount);
    free(protolists);
}
```


<br/>
<br/>


 æœ€åçš„ç»„è£…, éœ€è¦æ³¨æ„çš„æ˜¯, å…¶ä»–åˆ†ç±»çš„æ·»åŠ çš„å†…å®¹, å¦‚æ–¹æ³•, å¹¶éæ˜¯è¢«è¦†ç›–äº†, è€Œæ˜¯å› ä¸ºæ–¹æ³•çš„ä½ç½®å¹¶éåœ¨é¦–ä½. æ‰€ä»¥è¯¥æ–¹æ³•æ²¡æœ‰æœºä¼šè°ƒç”¨, è€Œé€ æˆäº†è¢«è¦†ç›–çš„å‡è±¡.

åŒç†, '**åŸç±»ä¸­æ–¹æ³•è¢«åˆ†ç±»ä¸­æ–¹æ³•<è¦†ç›–å®ç°>**'çš„åŸå› ä¹Ÿæ˜¯è¿™æ ·.
 
```
void attachLists(List* const * addedLists, uint32_t addedCount) {
    if (addedCount == 0) return;

    if (hasArray()) {
        // many lists -> many lists
        // è·å–åŸç±»ä¸­å…ƒç´ æ€»æ•°
        uint32_t oldCount = array()->count;
        // æ‹¼æ¥ä¹‹åçš„å…ƒç´ æ€»æ•°
        uint32_t newCount = oldCount + addedCount;
        
        // æ ¹æ®æ‹¼æ¥åçš„å†…å®¹, æ·»åŠ åˆ†ç±»å…ƒç´ , é‡æ–°åˆ†é…å†…å­˜(ç”³è¯·æ–°çš„ç©ºé—´)
        setArray((array_t *)realloc(array(), array_t::byteSize(newCount)));
        
        // è®¾ç½®æ€»æ•°
        array()->count = newCount;
        
             
        /**é‡ç‚¹æ¥äº†
	       *å…ˆæŠŠå†…å­˜ç§»åŠ¨å¥½, ç»™åˆ†ç±»å…ƒç´ è…¾å‡ºç©ºé—´ 
         * [[],[],[åŸæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ],[åŸæœ‰ç¬¬äºŒä¸ªå…ƒç´ ]....]
        */
        //å°†åŸæ¥å†…å­˜çš„ä½ç½®çš„æ•°æ®æŒªåŠ¨åé¢ï¼Œarray()->listsä¸ºåŸæ¥çš„æ–¹æ³•åˆ—è¡¨
        memmove(array()->lists + addedCount, array()->lists, 
                oldCount * sizeof(array()->lists[0]));
        
        //æ‹·è´å°†æ–°çš„æ•°æ®ï¼Œä»å†…å­˜é¦–ç«¯å¼€å§‹
        æŠŠåˆ†ç±»å…ƒç´ æ·»åŠ åˆ°åŸç±»å…ƒç´ åˆ—è¡¨ä¸­ 
        /**
         *[
	        [addedListsä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ],
	        [addedListsä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ]...
	        [åŸæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ],
	        [åŸæœ‰ç¬¬äºŒä¸ªå…ƒç´ ]....
        ]
         * åˆ°æ­¤, å› ä¸ºaddedListsä¸­çš„å…ƒç´ æ·»åŠ è§„åˆ™æ˜¯æœ€åç¼–è¯‘çš„æœ€å…ˆè¢«æ·»åŠ 
         * æ‰€ä»¥, ä»¥æ–¹æ³•ä¸ºä¾‹,æœ€åç¼–è¯‘çš„åˆ†ç±»çš„æ–¹æ³•æœ€ç»ˆæ’å…¥åˆ°åŸç±»æ–¹æ³•åˆ—è¡¨çš„ç¬¬0ä¸ªä½ç½®
         * ä¹Ÿå°±æ˜¯, è¯¥æ–¹æ³•åœ¨è¿è¡Œæ—¶è°ƒç”¨æ—¶, æœ€ç»ˆè¢«æ‰§è¡Œ
         */
         memcpy(array()->lists, addedLists, 
   addedCount * sizeof(array()->lists[0]));
    }
}
```


![ios_oc1_89.png](./../../Pictures/ios_oc1_89.png)

- old_method ä¸ºåŸç±»æ–¹æ³•æ‰€å ç”¨çš„å†…å­˜ï¼Œnew_malloc ä¸ºæ–°ç”³è¯·çš„å†…å­˜åŒºåŸŸ
- ç„¶å old_method å¤åˆ¶åˆ°æ‰€ç”³è¯·æ–°çš„å†…å­˜åŒºåŸŸçš„æœ€æœ«ç«¯
- æœ€åæ·»åŠ åˆ†ç±»çš„æ–¹æ³• new_method ï¼Œä»æ•´ä¸ªæ–¹æ³•çš„å†…å­˜ä»é¦–ç«¯å¼€å§‹è¦†ç›–
- ç¼–è¯‘é¡ºåºè¶Šé åçš„åˆ†ç±»æ–¹æ³•çš„ä¼˜å…ˆçº§è¶Šé«˜

&emsp; æ‰€ä»¥åœ¨è°ƒç”¨å®ä¾‹å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»ä¸­çš„å®ä¾‹å¯¹è±¡æ–¹æ³•ï¼Œå…·ä½“çš„åˆ†ç±»é¡ºåºéœ€è¦åœ¨ XCode ä¸­è®¾ç½®åˆ†ç±»æ–‡ä»¶çš„ç¼–è¯‘é¡ºåºï¼Œåœ¨ **Project-BuildPhases-Compile Sources** ä¸­è¿›è¡Œè®¾ç½®


<br/>
<br/>

> <h2 id='å…³è”å¯¹è±¡AssociatedObject'>å…³è”å¯¹è±¡AssociatedObject</h2>

- **1.æ˜¯ä»€ä¹ˆ**

&emsp; ç™½è¯è¯´å°±æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡å…³è”åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸Š, å¦‚ç»™åˆ†ç±»æ·»åŠ å…³è”çš„æˆå‘˜å˜é‡. ä½†æ˜¯, åªæ˜¯å…³è”, å¹¶éè¢«å…³è”çš„å¯¹è±¡å±äºå…³è”å¯¹è±¡.

<br/>

- **2.å¦‚ä½•ä½¿ç”¨**

å°±3ä¸ªæ–¹æ³•: **è®¾å®šå…³è”å€¼ã€å–å…³è”å€¼ã€ç§»é™¤å€¼**

**2.1 è®¾å®šå…³è”å€¼**

```
// è®¾å®šå€¼,å¹¶é€šè¿‡ç»™å®šçš„å…³è”ç­–ç•¥å»ºç«‹keyå’Œvalueçš„å…³è”å…³ç³»å…³è”åˆ°è¢«å…³è”å¯¹è±¡objectä¸Š(æœ‰ç‚¹ç»•)
objc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key, id _Nullable value, objc_AssociationPolicy policy)
```

- id object ï¼šå…³è”çš„æºå¯¹è±¡
- const void *keyï¼šå…³è”çš„key
- id valueï¼šå…³è”å¯¹è±¡ï¼Œé€šè¿‡å°†æ­¤ä¸ªå€¼ç½®æˆnilæ¥æ¸…é™¤å…³è”ã€‚
- objc_AssociationPolicy policyï¼šå…³è”çš„ç­–ç•¥

**å…³é”®ç­–ç•¥æ˜¯ä¸€ä¸ªenumå€¼**

```
OBJC_ASSOCIATION_ASSIGN = 0,      <æŒ‡å®šä¸€ä¸ªå¼±å¼•ç”¨å…³è”çš„å¯¹è±¡>
OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1,<æŒ‡å®šä¸€ä¸ªå¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡>
OBJC_ASSOCIATION_COPY_NONATOMIC = 3,  <æŒ‡å®šç›¸å…³çš„å¯¹è±¡å¤åˆ¶>
OBJC_ASSOCIATION_RETAIN = 01401,      <æŒ‡å®šå¼ºå‚è€ƒ>
OBJC_ASSOCIATION_COPY = 01403    <æŒ‡å®šç›¸å…³çš„å¯¹è±¡å¤åˆ¶>
```

<br/>

**2.2 å–å…³è”å€¼**

```
// æ ¹æ®æŒ‡å®šçš„keyè·å–å¯¹åº”çš„å…³è”å¯¹è±¡å€¼, å¹¶è¿”å›
id objc_getAssociatedObject(id object, const void *key)
```


<br/>

**2.3 ç§»é™¤å…³è”å€¼**

```
// ç§»é™¤è¯¥å¯¹è±¡çš„æ‰€æœ‰å…³è”å¯¹è±¡
void objc_removeAssociatedObjects(id object)
```



<br/>
<br/>

> <h3 id='å…³è”å¯¹è±¡æœ¬è´¨'>å…³è”å¯¹è±¡æœ¬è´¨</h3>


&emsp; ç³»ç»Ÿç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„AssociationsManagerå•ä¾‹ç®¡ç†ç±», è¯¥ç±»çš„ç”Ÿå‘½å‘¨æœŸå’Œç¨‹åºåŒå±ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ, AssociationsManagerç®¡ç†è€…ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„AssociationsHashMapå“ˆå¸Œè¡¨å­˜å‚¨å®¹å™¨, æ‰€æœ‰å¯¹è±¡çš„å…³è”å†…å®¹å­˜å‚¨åœ¨è¿™ä¸ªå®¹å™¨ä¸­.æ‰€ä»¥è¯´, å‡å¦‚ç»™åˆ†ç±»æ·»åŠ äº†ä¸€ä¸ªå…³è”å¯¹è±¡, é‚£ä¹ˆè¯¥å…³è”å†…å®¹æ—¢ä¸éœ€è¦åˆ†ç±»ç®¡ç†, ä¹Ÿä¸æ˜¯ç”±åŸç±»ç®¡ç†.

```
class AssociationsManager {
    static spinlock_t _lock;
    static AssociationsHashMap *_map;               // associative references:  object pointer -> PtrPtrHashMap.
public:
    AssociationsManager()   { _lock.lock(); }
    ~AssociationsManager()  { _lock.unlock(); }
    
    AssociationsHashMap &associations() {
        if (_map == NULL)
            _map = new AssociationsHashMap();
        return *_map;
    }
};
```


<br/>

AssociationsHashMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªObjectAssociationMapå“ˆå¸Œè¡¨

```
class AssociationsHashMap : public unordered_map<disguised_ptr_t, ObjectAssociationMap *, DisguisedPointerHash, DisguisedPointerEqual, AssociationsHashMapAllocator> {
    public:
        void *operator new(size_t n) { return ::malloc(n); }
        void operator delete(void *ptr) { ::free(ptr); }
    };


```

<br/>

ObjectAssociationMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªObjcAssociationå“ˆå¸Œè¡¨

```
class ObjectAssociationMap : public std::map<void *, ObjcAssociation, ObjectPointerLess, ObjectAssociationMapAllocator> {
    public:
        void *operator new(size_t n) { return ::malloc(n); }
        void operator delete(void *ptr) { ::free(ptr); }
    };

```


<br/>


**å…³ç³»å¦‚ä¸‹å›¾:**

![ios_oc1_91.png](./../../Pictures/ios_oc1_91.png)



hashç»“æ„å›¾:

![ios_oc1_92.png](./../../Pictures/ios_oc1_92.png)





<br/>
<br/>

> <h3 id='Demo'>Demo</h3>


```
- (void) personTest {
    
    
    static char overviewKey;
    NSArray *array = [[NSArray alloc] initWithObjects:@"one", @"two", nil];
    NSString * overview = [[NSString alloc] initWithFormat:@"%@",@"First three numbers"];
    objc_setAssociatedObject(array, &overviewKey, overview, OBJC_ASSOCIATION_RETAIN);
    NSString *associatedObject = (NSString *)objc_getAssociatedObject(array, &overviewKey);
    NSLog(@"ğŸ associatedObject:%@", associatedObject);
    
    objc_setAssociatedObject(array, &overviewKey, nil, OBJC_ASSOCIATION_ASSIGN);
    NSString *associatedObject2 = (NSString *)objc_getAssociatedObject(array, &overviewKey);

    NSLog(@"ğŸŠ associatedObject:%@", associatedObject2);
}
```

æ‰“å°ï¼š

```
 ğŸ associatedObject:First three numbers
 ğŸŠ associatedObject:(null)
```


<br/>
<br/>


> <h3 id='æ·»åŠ å±æ€§'>æ·»åŠ å±æ€§</h3>



`NSStringåˆ†ç±».hæ–‡ä»¶`

```
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

@interface NSString (Tool)


/// åˆ†ç±»æ·»åŠ å±æ€§(ä½¿ç”¨è¿è¡Œæ—¶)
@property(nonatomic, copy)NSString *name;

/// ä½¿ç”¨ä¸´æ—¶å…¨å±€å˜é‡æ¥æ›¿ä»£æˆå‘˜å˜é‡
@property (nonatomic, strong) NSString *title;


@end
```
<br/>

`.mæ–‡ä»¶`

```
#import "NSString+Tool.h"
#import <objc/runtime.h>

static const void *nameKey = &nameKey;
//***ä¸´æ—¶å…¨å±€å˜é‡***
static NSString *_title;

@implementation NSString (Tool)


- (void)setName:(NSString *)name {
    
    
   /**
    *  æ ¹æ®æŸä¸ªå¯¹è±¡ï¼Œè¿˜æœ‰keyï¼Œè¿˜æœ‰å¯¹åº”çš„ç­–ç•¥(copy,strongç­‰) åŠ¨æ€çš„å°†å€¼è®¾ç½®åˆ°è¿™ä¸ªå¯¹è±¡çš„keyä¸Š
    *
    *  @param object æŸä¸ªå¯¹è±¡
    *  @param key    å±æ€§å,æ ¹æ®keyå»è·å–å…³è”çš„å¯¹è±¡, æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œæ˜¯ä¸€ä¸ªåœ°å€(è¿™é‡Œæ³¨æ„ï¼Œåœ°å€å¿…é¡»æ˜¯ä¸å˜çš„ï¼Œåœ°å€ä¸åŒä½†æ˜¯å†…å®¹ç›¸åŒçš„ä¹Ÿä¸ç®—åŒä¸€ä¸ªkey)
    *  @param value  è¦è®¾ç½®çš„å€¼
    *  @param policy ç­–ç•¥(copy,strongï¼Œassignç­‰)
    */
    objc_setAssociatedObject(self, &nameKey, name, OBJC_ASSOCIATION_COPY_NONATOMIC);
}

- (NSString *)name {
    return objc_getAssociatedObject(self, nameKey);
}

- (void)setTitle:(NSString *)title {
    _title = title;
}

- (NSString *)title {
    return _title;
}

@end



//è°ƒç”¨
 NSString *test = @"å¤§å¤´çˆ¸çˆ¸";
 test.name = @"å¼ å…‰åŒ—";
 NSLog(@"å­—ç¬¦ä¸²åˆ†ç±»å±æ€§nameå€¼ï¼š %@", test.name);
```
æ‰“å°ï¼š

`2019-11-16 19:36:41.693406+0800 HGSWB[19518:789236] å­—ç¬¦ä¸²åˆ†ç±»å±æ€§nameå€¼ï¼š å¼ å…‰åŒ—
`





<br/>

***
<br/>

># <h1 id='Extensionæ‰©å±•'>Extensionæ‰©å±•</h1>


**Extensionæ‰©å±•å’Œåˆ†ç±»æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«?**

æ‰©å±•å¯ä»¥ä¸ºç±»æ·»åŠ ç§æœ‰å±æ€§, ç§æœ‰æ–¹æ³•, å£°æ˜ç§æœ‰å˜é‡.

- æ‰©å±•æ˜¯åœ¨ç¼–è¯‘æ—¶å†³è®®çš„, ç±»æ‰©å±•ä¸­çš„æ–¹æ³•å±æ€§, åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«æ·»åŠ åˆ°ç±»ä¸­, å› æ­¤æ‰©å±•ä¸­çš„æ–¹æ³•æ²¡æœ‰å®ç°, ç¼–è¯‘å™¨ä¼šæŠ¥è­¦å‘Š;
- ç±»æ‰©å±•æ²¡æœ‰ç‹¬ç«‹çš„å®ç°(@implementation), å³ç±»æ‰©å±•æ‰€å£°æ˜çš„æ–¹æ³•å¿…é¡»ä¾æ‰˜å¯¹åº”ç±»çš„å®ç°éƒ¨åˆ†æ¥å®ç°;
- ç±»æ‰©å±•å³å¯ä»¥å£°æ˜å±æ€§, åˆå¯ä»¥å£°æ˜ç§æœ‰æˆå‘˜å˜é‡;

<br/>

***
<br/>


># <h1 id='NSProxy(ä¼ªå¤šç»§æ‰¿)'>NSProxy(ä¼ªå¤šç»§æ‰¿)</h1>

># 

[NSProxy](https://www.jianshu.com/p/923f119333d8)






<br/>

***
<br/>


![è¯­è¨€åˆ†ç±»å›¾ ios_oc1_79](./../../Pictures/ios_oc1_79.jpg)


<br/>

***
<br/>
<br/>

># <h1 id='iOSåŸç”Ÿç³»ç»Ÿæ¶æ„'>iOSåŸç”Ÿç³»ç»Ÿæ¶æ„</h1>

<br/>

> <h2 id='iOSçš„ç³»ç»Ÿæ¶æ„æˆ'>iOSçš„ç³»ç»Ÿæ¶æ„æˆ</h2>

- Application Layerï¼ˆåº”ç”¨å±‚ï¼‰ã€
- Cocoa Touch Layerï¼ˆè§¦æ‘¸å±‚ï¼‰ã€
- Media Layer ï¼ˆåª’ä½“å±‚ï¼‰ã€
- Core Services Layerï¼ˆæ ¸å¿ƒæœåŠ¡å±‚ï¼‰ã€
- Core OS Layer ï¼ˆæ ¸å¿ƒç³»ç»Ÿæ“ä½œå±‚ï¼‰ã€
- The Kernel and Device Drivers layerï¼ˆå†…æ ¸å’Œé©±åŠ¨å±‚ï¼‰ã€‚



![ç³»ç»Ÿæ¶æ„å±‚çº§](./../../Pictures/ios_oc1_80.jpg)


<br/>


>## <h2 id='Cocoa'>**Cocoa**</h2>


<br/>


**æ¥æºï¼š**
>æ—©äº›å¹´ï¼Œè‹¹æœå…¬å¸å¯åŠ¨Coplandè®¡åˆ’ï¼Œè‡´åŠ›äºå¼€å‘å‡ºè‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œå¯æƒœåæ¥Coplandè®¡åˆ’é€æ¸å¤±æ§äº†ï¼Œè‹¹æœå…¬å¸æœ€ç»ˆå†³å®šæ”¾å¼ƒå¼€å‘ï¼Œè½¬å‘ä»åˆ«çš„å…¬å¸è´­ä¹°ä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„Mac OSã€‚åœ¨ç»è¿‡è°ƒæŸ¥ç°å­˜çš„æ“ä½œç³»ç»Ÿä¹‹åï¼Œè‹¹æœå…¬å¸é€‰æ‹©äº†NextSTEPï¼Œå› ä¸ºNextSTEPå¾ˆå°ï¼Œè‹¹æœ1996å¹´æ”¶è´­äº†Nextæ•´ä¸ªå…¬å¸ã€‚

>NextStepå†…ç½®è®¸å¤šåº“å’Œå·¥å…·ï¼Œèƒ½å”ç¨‹åºå‘˜ä»¥ä¸€ç§ä¼˜é›…çš„æ–¹å¼ä¸çª—å£ç®¡ç†å™¨è¿›è¡Œç›‘æŠ¤ï¼Œè¿™äº›åº“å«åšFrameworkï¼Œåœ¨1993å¹´è¿™äº›frameworkså’Œå·¥å…·è¢«é‡æ–°ä¿®æ”¹å¹¶é‡å‘½åOpenStepï¼Œåæ¥è¢«é‡å‘½åä¸ºCocoaï¼Œæ‰€ä»¥Cocoaçš„ç±»éƒ½æœ‰ç€NSçš„å‰ç¼€ã€‚

<br/>

**ä»€ä¹ˆæ˜¯Cocoaï¼Ÿ**
>äº‹å®ä¸Šï¼ŒCocoaï¼ˆiOSä¸Šçš„å«Cocoa Touchï¼‰æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„è½¯ä»¶ç»„ä»¶---ç±»çš„é›†æˆå¥—ä»¶ï¼Œå®ƒä½¿å¼€å‘è€…å¯ä»¥å¿«é€Ÿåˆ›å»ºå’Œå¥å£®å…¨åŠŸèƒ½çš„Mac OS Xå’ŒiOSåº”ç”¨ç¨‹åºã€‚

>Cocoa æ˜¯ä¸€å¥—æ¡†æ¶å’Œè¿è¡Œæ—¶æ”¯æŒï¼Œç®€å•æ¥è¯´å°±æ˜¯ API åº”ç”¨ç¨‹åºæ¥å£ã€‚


<br/>


> <h2 id='Cocoaå’ŒCocoaTouch'>Cocoaå’ŒCocoaTouch</h2>

>Cocoaæ˜¯Mac OS X çš„å¼€å‘ç¯å¢ƒ Â  Â  Â  Â  Â  Â  Â  Cocoa Touchæ˜¯iPhone OS çš„å¼€å‘ç¯å¢ƒã€‚

>CocoaåŒ…å«äº†å¾ˆå¤šæ¡†æ¶ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯Foundationæ¡†æ¶å’ŒApplication Kit æ¡†æ¶

>Cocoa ToouchåŒ…å«äº†å¾ˆå¤šæ¡†æ¶ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯Foundationæ¡†æ¶å’ŒUIKit æ¡†æ¶



<br/>

**æ¡†æ¶**

>Foundationæ¡†æ¶ä»¥Core Foundationæ¡†æ¶ä¸ºåŸºç¡€ï¼ŒCore Foundationæ¡†æ¶æä¾›çš„æ˜¯è¿‡ç¨‹åŒ–ï¼ˆANSI Cï¼‰æ¥å£ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ AppKit å’ŒUIKit æ¡†æ¶å¼€å‘åº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ¥å£ã€‚äºŒè€…ç”¨é€”ç›¸åŒï¼Œä½†æ˜¯é’ˆå¯¹å¹³å°ä¸åŒã€‚



<br/>


> **`æ¶æ„å±‚çº§ç»†åˆ†`**


![iOS8.3åŸç”Ÿæ¶æ„ç»†åˆ† ios_oc1_81](./../../Pictures/ios_oc1_81.png)

<br/>

**Core OSå±‚ï¼š**ç³»ç»Ÿæ ¸å¿ƒå±‚åŒ…å«å¤§å¤šæ•°ä½çº§åˆ«æ¥è¿‘ç¡¬ä»¶çš„åŠŸèƒ½ï¼Œå®ƒæ‰€åŒ…å«çš„æ¡†æ¶å¸¸å¸¸è¢«å…¶å®ƒæ¡†æ¶æ‰€ä½¿ç”¨ã€‚

- Accelerateæ¡†æ¶åŒ…å«æ•°å­—ä¿¡å·ï¼Œçº¿æ€§ä»£æ•°ï¼Œå›¾åƒå¤„ç†çš„æ¥å£ã€‚é’ˆå¯¹æ‰€æœ‰çš„iOSè®¾å¤‡ç¡¬ä»¶ä¹‹é—´çš„å·®å¼‚åšä¼˜åŒ–ï¼Œä¿è¯å†™ä¸€æ¬¡ä»£ç åœ¨æ‰€æœ‰iOSè®¾å¤‡ä¸Šé«˜æ•ˆè¿è¡Œã€‚
- CoreBluetoothæ¡†æ¶åˆ©ç”¨è“ç‰™å’Œå¤–è®¾äº¤äº’ï¼ŒåŒ…æ‹¬æ‰«æè¿æ¥è“ç‰™è®¾å¤‡ï¼Œä¿å­˜è¿æ¥çŠ¶æ€ï¼Œæ–­å¼€è¿æ¥ï¼Œè·å–å¤–è®¾çš„æ•°æ®æˆ–è€…ç»™å¤–è®¾ä¼ è¾“æ•°æ®ç­‰ç­‰ã€‚
- Securityæ¡†æ¶æä¾›ç®¡ç†è¯ä¹¦ï¼Œå…¬é’¥å’Œç§é’¥ä¿¡ä»»ç­–ç•¥ï¼Œkeychain,hashè®¤è¯æ•°å­—ç­¾åç­‰ç­‰ä¸å®‰å…¨ç›¸å…³çš„è§£å†³æ–¹æ¡ˆã€‚


<br/>

**Core Services Layer**:ç³»ç»ŸæœåŠ¡å±‚æä¾›ç»™åº”ç”¨æ‰€éœ€è¦çš„åŸºç¡€çš„ç³»ç»ŸæœåŠ¡ã€‚

- Accounts: è´¦æˆ·æ¡†æ¶ï¼Œå¹¿å‘Šæ¡†æ¶ï¼Œæ•°æ®å­˜å‚¨æ¡†æ¶ï¼Œç½‘ç»œè¿æ¥æ¡†æ¶ï¼Œåœ°ç†ä½ç½®æ¡†æ¶ï¼Œè¿åŠ¨æ¡†æ¶ç­‰ç­‰ã€‚è¿™äº›æœåŠ¡ä¸­çš„æœ€æ ¸å¿ƒçš„æ˜¯CoreFoundationå’ŒFoundationæ¡†æ¶ï¼Œå®šä¹‰äº†æ‰€æœ‰åº”ç”¨ä½¿ç”¨çš„æ•°æ®ç±»å‹ã€‚
- CoreFoundationæ˜¯åŸºäºCçš„ä¸€ç»„æ¥å£ï¼ŒFoundationæ˜¯å¯¹CoreFoundationçš„OCå°è£…ã€‚

<br/>

**Media Layer**: åª’ä½“å±‚æä¾›åº”ç”¨ä¸­è§†å¬æ–¹é¢çš„æŠ€æœ¯ï¼Œå¦‚å›¾å½¢å›¾åƒç›¸å…³çš„:
- 	CoreGraphics,CoreImage,GLKit,OpenGL ES,CoreText,ImageIOç­‰ç­‰ã€‚

å£°éŸ³æŠ€æœ¯ç›¸å…³çš„:
- 	CoreAudio,OpenAL,AVFoundation,

è§†é¢‘ç›¸å…³çš„:
- 	CoreMedia,Media Playeræ¡†æ¶ï¼ŒéŸ³è§†é¢‘ä¼ è¾“çš„AirPlayæ¡†æ¶ç­‰ç­‰ã€‚


<br/>

**Cocoa Touch Layer:**è§¦æ‘¸å±‚æä¾›åº”ç”¨åŸºç¡€çš„å…³é”®æŠ€æœ¯æ”¯æŒå’Œåº”ç”¨çš„å¤–è§‚ã€‚
- NotificationCenterçš„æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€æœåŠ¡;
- iAdå¹¿å‘Šæ¡†æ¶;
- GameKitæ¸¸æˆå·¥å…·æ¡†æ¶;
- æ¶ˆæ¯UIæ¡†æ¶;
- å›¾ç‰‡UIæ¡†æ¶;
- åœ°å›¾æ¡†æ¶;
- è¿æ¥æ‰‹è¡¨æ¡†æ¶;
- è‡ªåŠ¨é€‚é…ç­‰ç­‰





<br/>


åŸç”Ÿæ¶æ„ç»†åˆ†æ¥å—ï¼Œè¯·çœ‹[è¿™é‡Œ](https://www.jianshu.com/p/80a27d111605)


```
NSå‡½æ•°å½’å±äºCocoa Foundationæ¡†æ¶ï¼›

CFå‡½æ•°å½’å±äºCore Foundationæ¡†æ¶ï¼›

CGå‡½æ•°å½’å±äºCoreGraphics.frameworksæ¡†æ¶ï¼›

CAå‡½æ•°å½’å±äºCoreAnimation.frameworksæ¡†æ¶ï¼›

UIå‡½æ•°å½’å±äºUIKitæ¡†æ¶ã€‚

UIKitç»§æ‰¿è‡ª Core Animation å’ŒCore Graphicsï¼›
Core Animationï¼šæ ¸å¿ƒåŠ¨ç”»ï¼› 
Core Graphicsï¼šæ ¸å¿ƒç»˜åˆ¶ ï¼›
UIkitï¼šiOSåŸºç¡€è§†å›¾æ¡†æ¶.

```



<br/>

***
<br/>

># <h1 id='NSObjectç»§æ‰¿å…³ç³»å›¾'>NSObjectç»§æ‰¿å…³ç³»å›¾</h1>


<br/>
<br/>

> <h2 id='Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»'>Foundationæ¡†æ¶ç±»ç»§æ‰¿ä½“ç³»</h2>

&emsp; ä¸‹é¢ä¸‰ä¸ªå›¾ï¼ŒåŒ…æ‹¬äº†Foundationæ‰€ä»¥çš„ç±»ï¼Œå›¾ä¸­ç°è‰²çš„æ˜¯iOSä¸æ”¯æŒçš„ï¼Œç°è‰²éƒ¨åˆ†æ˜¯OS Xç³»ç»Ÿçš„ã€‚

![<br/>](./../../Pictures/z56.jpg)


![<br/>](./../../Pictures/z57.jpg)


![<br/>](./../../Pictures/z58.jpg)


&emsp; **å°†ä¸Šå›¾Foundationæ¡†æ¶ä¸­çš„ç±»è¿›è¡Œé€»è¾‘åˆ†ç±»å¦‚ä¸‹ï¼š**
- å€¼å¯¹è±¡
- é›†åˆ
- æ“ä½œç³»ç»ŸæœåŠ¡ åŒ…æ‹¬ä¸‹é¢ä¸‰ä¸ªï¼šæ–‡ä»¶ç³»ç»Ÿå’ŒURLè¿›ç¨‹é—´é€šè®¯ã€‚
	- è¿™ä¸ªèŒƒç•´ä¸­çš„å¤§éƒ¨åˆ†ç±»ä»£è¡¨ä¸åŒçš„ç³»ç»Ÿç«¯å£ã€å¥—æ¥å­—ã€å’Œåå­—æœåŠ¡å™¨ï¼Œå¯¹å®ç°åº•å±‚çš„IPCå¾ˆæœ‰ç”¨ã€‚
	- NSPipeä»£è¡¨ä¸€ä¸ªBSDç®¡é“ï¼Œå³ä¸€ç§è¿›ç¨‹é—´çš„å•å‘é€šè®¯é€šé“ã€‚
	- çº¿ç¨‹å’Œå­ä»»åŠ¡:NSThreadç±»ä½¿æ‚¨å¯ä»¥åˆ›å»ºå¤šçº¿ç¨‹çš„ç¨‹åºï¼Œè€Œå„ç§é”ï¼ˆlockï¼‰ç±»åˆ™ä¸ºå½¼æ­¤ç«äº‰çš„çº¿ç¨‹åœ¨è®¿é—®è¿›ç¨‹èµ„æºæ—¶æä¾›å„ç§æ§åˆ¶æœºåˆ¶ã€‚é€šè¿‡NSTaskï¼Œæ‚¨çš„ç¨‹åºå¯ä»¥åˆ†å‡º Â  Â  Â ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå…¶å®ƒå·¥ä½œæˆ–è¿›è¡Œè¿›åº¦ç›‘æ§ã€‚
- é€šçŸ¥
- å½’æ¡£å’Œåºåˆ—åŒ–
- è¡¨è¾¾å¼å’Œæ¡ä»¶åˆ¤æ–­
- Objective-Cè¯­è¨€æœåŠ¡



<br/>
<br/>


![NSObject å…³ç³»å›¾](./../../Pictures/ios_oc1_82.jpg)


**Objective-Cæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€:**

&emsp; Objective-Cå’ŒJava C++ä¸€æ ·ï¼Œæœ‰å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ï¼Œé‡ç”¨ã€‚ä½†æ˜¯å®ƒä¸åƒC++é‚£æ ·æœ‰é‡è½½æ“ä½œæ³•ã€æ¨¡ç‰ˆå’Œå¤šç»§æ‰¿ï¼Œä¹Ÿæ²¡æœ‰Javaçš„åƒåœ¾å›æ”¶æœºåˆ¶


<br/>

**Objective-Cçš„ä¼˜ç‚¹:**

- Objective-Cè¯­è¨€æœ‰C++ Javaç­‰é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹ï¼Œé‚£æ˜¯è¿œè¿œä¸èƒ½ä½“ç°å®ƒçš„ä¼˜ç‚¹çš„ã€‚Objective-Cçš„ä¼˜ç‚¹æ˜¯å®ƒæ˜¯åŠ¨æ€çš„ã€‚åŠ¨æ€èƒ½åŠ›æœ‰ä¸‰ç§ï¼š
- åŠ¨æ€ç±»-è¿è¡Œæ—¶ç¡®å®šç±»çš„å¯¹è±¡
- åŠ¨æ€ç»‘å®š-è¿è¡Œæ—¶ç¡®å®šè¦è°ƒç”¨çš„æ–¹æ³•
- åŠ¨æ€åŠ è½½--è¿è¡Œæ—¶ä¸ºç¨‹åºåŠ è½½æ–°çš„æ¨¡å—


<br/>

**åŠ¨æ€èƒ½åŠ›ç›¸å…³çš„isaæŒ‡é’ˆ:**

æ¯ä¸ªObjective-Cå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšè—çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„æ˜¯Objective-Cå¯¹è±¡çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå®ƒå°±æ˜¯isaæŒ‡é’ˆã€‚

`è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å“ªå‘¢ï¼Ÿ`

å®ƒæŒ‡å‘ä¸€ä¸ªç±»å¯¹è±¡(class objectè®°ä½å®ƒæ˜¯ä¸ªå¯¹è±¡ï¼Œæ˜¯å ç”¨å†…å­˜ç©ºé—´çš„ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ç¼–è¯‘çš„æ—¶å€™ç¼–è¯‘å™¨å°±ç”Ÿæˆäº†ï¼Œä¸“é—¨æ¥æè¿°æŸä¸ªç±»çš„å®šä¹‰)ï¼Œè¿™ä¸ªç±»å¯¹è±¡åŒ…å«äº†Objective-Cå¯¹è±¡çš„ä¸€äº›ä¿¡æ¯ï¼ˆä¸ºäº†åŒºåˆ†ä¸¤ä¸ªå¯¹è±¡ï¼Œæˆ‘æŠŠå‰é¢æåˆ°çš„å¯¹è±¡å«Objective-Cå¯¹è±¡ï¼‰ï¼ŒåŒ…æ‹¬Objective-Cå¯¹è±¡çš„æ–¹æ³•è°ƒåº¦è¡¨ï¼Œå®ç°äº†ä»€ä¹ˆåè®®ç­‰ç­‰ã€‚è¿™ä¸ªåŒ…å«ä¿¡æ¯å°±æ˜¯Objective-CåŠ¨æ€èƒ½åŠ›çš„æ ¹æºäº†ã€‚

`é‚£æˆ‘ä»¬çœ‹çœ‹isaæŒ‡é’ˆç±»å‹çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ`

å¦‚æœæŠ›å¼€NSObjectå¯¹è±¡çš„å…¶ä»–çš„æˆå‘˜æ•°æ®å’Œå˜é‡ï¼ŒNSObjectå¯ä»¥çœ‹æˆè¿™æ ·ï¼š

```
@interface NSObject  {

Class    isa;

}

```

ä¸è€ƒè™‘@interfaceå…³é”®å­—åœ¨ç¼–è¯‘æ—¶çš„ä½œç”¨ï¼Œå¯ä»¥æŠŠNSObjectæ›´æ¥è¿‘Cè¯­è¨€ç»“æ„è¡¨ç¤ºä¸ºï¼š

```
struct NSObject{

ClassÂ isa;

}
```

Classæ˜¯ç”¨typedefå®šä¹‰çš„`typedef struct objc_classÂ *Class;`

é‚£NSObjectå¯ä»¥è¿™æ ·å†™äº†

```
struct NSObject{

objc_classÂ *isa

}
```


é‚£objc_classçš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```



structobjc_classÂ {

ClassÂ isa;

ClassÂ super_class;

const char*name;

long version;

long info;

long instance_size;

struct objc_ivar_listÂ *ivars;

struct objc_method_listÂ **methodLists;

struct objc_cacheÂ *cache;

struct objc_protocol_listÂ *protocols;

}



```


&emsp; è¿™é‡Œä¼šçœ‹åˆ°ï¼Œåœ¨è¿™ä¸ªç»“æ„ä½“é‡Œè¿˜æœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼Œåˆæ˜¯ä¸€é‡æŒ‡å‘ï¼Œæ˜¯ä¸æ˜¯æœ‰ç§åˆ°äº†ç›—æ¢¦ç©ºé—´çš„æ„Ÿè§‰ã€‚ä¸ç”¨ç´§å¼ ï¼Œä¸ä¼šæœ‰é‚£ä¹ˆå¤šå±‚æ¬¡çš„ï¼Œè¿™é‡Œçš„isaæŒ‡é’ˆæŒ‡å‘çš„æ˜¯å…ƒç±»å¯¹è±¡(metaclass
 object)ï¼Œå¸¦æœ‰å…ƒå­—ï¼Œè¯æ˜å¿«åˆ°å¤´äº†ã€‚
 
 `é‚£å…ƒå¯¹è±¡æœ‰å•¥ç”¨å‘¢ï¼Ÿ`
 
 å®ƒç”¨æ¥å­˜å‚¨çš„å…³äºç±»çš„ç‰ˆæœ¬ï¼Œåå­—ï¼Œç±»æ–¹æ³•ç­‰ä¿¡æ¯ã€‚æ‰€æœ‰çš„å…ƒç±»å¯¹è±¡(metaclass object)éƒ½æŒ‡å‘NSObjectçš„å…ƒç±»å¯¹è±¡ï¼Œåˆ°å¤´è¿˜æ˜¯NSObjectã€‚ä¸€å…±ä¸‰æ¬¡ï¼šç±»å¯¹è±¡->å…ƒç±»å¯¹è±¡->NSObjectå…ƒç±»å¯¹è±¡ã€‚

ä¸ºäº†å¾—åˆ°æ•´ä¸ªç±»ç»„ç»‡æ¶æ„çš„ä¿¡æ¯ï¼Œobjc_classç»“æ„é‡Œå®šä¹‰äº†ç¬¬äºŒä¸ªæˆå‘˜å˜é‡Class super_classï¼Œå®ƒæŒ‡å‘çˆ¶ç±»çš„ç±»å¯¹è±¡ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œå¯èƒ½å…³ç³»ç¼•ä¸æ¸…æ¥šï¼Œæœ‰é“æ˜¯ä¸€å¼ å›¾èƒœè¿‡åƒè¨€ä¸‡è¯­:


![<br/>](./../../Pictures/z59.jpg)


å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒD3ç»§æ‰¿D2,D2ç»§æ‰¿D1,D1æœ€ç»ˆç»§æ‰¿NSObjectã€‚ä¸‹å›¾ä»D3çš„ä¸€ä¸ªå¯¹è±¡å¼€å§‹ï¼Œæ’åˆ—å‡ºD3 D2 D1 NSObject ç±»å¯¹è±¡ï¼Œå…ƒç±»å¯¹è±¡ç­‰å…³ç³»ã€‚

![<br/>](./../../Pictures/z60.png)

ç›¸å½“äº 

![ios_oc1_83](./../../Pictures/ios_oc1_83.png)








<br/>
<br/>

![NSObject ç»§æ‰¿å…³ç³»å›¾ ios_oc1_84](./../../Pictures/ios_oc1_84.png)


<br/>

># <h1 id='UIResponderç»§æ‰¿å…³ç³»å›¾'>UIResponder ç»§æ‰¿å…³ç³»å›¾</h1>

<br/>
<br/>

> <h2 id=''></h2>



![UIResponder ç»§æ‰¿å…³ç³»å›¾ ios_oc1_85](./../../Pictures/ios_oc1_85.png)


<br/>

***
<br/>



> <h1 id='æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾'>æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾</h1>


![æ‰‹åŠ¿ç»§æ‰¿å…³ç³»å›¾](./../../Pictures/ios_oc1_86.png)

