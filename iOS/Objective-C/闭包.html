<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—­åŒ…</title>
    <style type="text/css" media="all">
      body {
        margin: 0;
        font-family: "Helvetica Neue", Helvetica, Arial, "Hiragino Sans GB", sans-serif;
        font-size: 14px;
        line-height: 20px;
        color: #777;
        background-color: white;
      }
      .container {
        width: 700px;
        margin-right: auto;
        margin-left: auto;
      }

      .post {
        font-family: Georgia, "Times New Roman", Times, "SimSun", serif;
        position: relative;
        padding: 70px;
        bottom: 0;
        overflow-y: auto;
        font-size: 16px;
        font-weight: normal;
        line-height: 25px;
        color: #515151;
      }

      .post h1{
        font-size: 50px;
        font-weight: 500;
        line-height: 60px;
        margin-bottom: 40px;
        color: inherit;
      }

      .post p {
        margin: 0 0 35px 0;
      }

      .post img {
        border: 1px solid #D9D9D9;
      }

      .post a {
        color: #28A1C5;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="post">
        <h1 class="title">é—­åŒ…</h1>
        <div class="show-content">
          <p>Â Â Â Â é—­åŒ…çš„åŸºç¡€æˆ‘å°±ä¸è¯´äº†ï¼Œç½‘ä¸Šå¤šå¦‚ç‰›æ¯›ï¼Œç°åœ¨æ¥ä»‹ç»å‡ ç§ä½¿ç”¨çš„åå‘ä¼ å€¼çš„æ–¹æ³•ã€‚</p><p>https://www.cnblogs.com/MrTao/p/5290088.html</p><p>ç¬¬ä¸€ç§ï¼š</p><p>ViewController.swift</p><blockquote>
<p> @objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â Â Â Â Â Â Â Â weak var weakSelf = self</p>
<p>Â  Â  Â  Â  aaa.getBackValue(title: "nextViewController", backgroundColor: UIColor.gray) { (backColor, title) in</p>
<p>Â  Â  Â  Â  Â  Â  weakSelf.view.backgroundColor = backColor</p>
<p>Â  Â  Â  Â  Â  Â  weakSelf.title = title</p>
<p>Â  Â  Â  Â  Â  Â  print("selft.title: \(String(describing:Â  weakSelf.title ))")</p>
<p>Â  Â  Â  Â  }</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>}</p>
</blockquote><p><br></p><p>AAAViewController.swiftÂ </p><blockquote>
<p>func getBackValue(title: String? = "AAAViewController", backgroundColor: UIColor, lastControllerValue: (_ backgroundColor: UIColor, _ title: String?) -&gt; Void)  {</p>
<p>Â  Â  Â  Â  selfÂ .title = title</p>
<p>Â  Â  Â  Â selfÂ .view.backgroundColor =Â  backgroundColor</p>
<p>Â  Â  Â  Â  lastControllerValue(UIColor.green, "ViewController")</p>
<p>Â  Â  }</p>
<p>deinit {
        print("22222222222æˆ‘é‡Šæ”¾äº†æ— ç”¨çš„å†…å­˜ï¼ï¼")
    }</p>
</blockquote><p>è¿™æ ·å°±å¯ä»¥æŠŠé—­åŒ…ä¸­çš„å€¼ä¼ é€’è¿‡å»ï¼Œä½†æ˜¯å½“Â lastControllerValue(UIColor.green, "ViewController") ä¸­çš„Â Â "ViewController" æ¢ä¸ºÂ self.textField.text æ—¶ï¼Œåœ¨è¿”å›å€¼ä¸­ä¼ é€’çš„æ˜¯ç©ºå€¼ã€‚å› ä¸ºåœ¨ è¿˜æ²¡è·³è½¬åˆ°AAAViewControllerä¸­æ—¶ï¼Œå°±å°†å€¼è¿”å›å»äº†ã€‚æ‰€ä»¥ Â  Â lastControllerValue é—­åŒ…ä¸­çš„Â Â self.textField.text ä¸º nilã€‚</p><hr><p>ç¬¬äºŒç§ï¼š</p><p>ViewController.swift Â ä¸­</p><blockquote>
<p> @objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.changeTitleAndClosure = {</p>
<p>Â  Â  Â  Â  Â  Â  (color: UIColor, title: String) in</p>
<p>Â  Â  Â  Â  Â  Â  self.view.backgroundColor = UIColor.red</p>
<p>Â  Â  Â  Â  Â  Â  self.title = title</p>
<p>Â  Â  Â  Â  Â  Â  }Â </p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>}</p>
</blockquote><p><br></p><p>AAAViewController.swiftÂ </p><blockquote>
<p> var changeTitleAndClosure:((_ color:UIColor, _ title:String) -&gt; Void)?</p>
<p> @objc func lastController()  {</p>
<p>Â  Â  Â  Â  self.dismiss(animated: true, completion: nil)</p>
<p>Â  Â  Â  Â  self.changeTitleAndClosure?(UIColor.green, self.textField.text!)</p>
<p>}</p>
</blockquote><p>å¯ä»¥å°† TextField ä¸­çš„å€¼ä¼ é€’è¿‡å»ï¼Œä½†æ˜¯ å®šä¹‰é—­åŒ…æ—¶å‚æ•°ä¸€å®šä¸è¦ä¸ºå¯é€‰å€¼ï¼ŒğŸ”ï¼š</p><blockquote><p>var changeTitleAndClosure:((_ color:UIColor?, Â _ title:String?) -&gt; Void)?</p></blockquote><p>å¦åˆ™ï¼Œåœ¨ ViewController ä¸­çš„é—­åŒ…ä¸æ‰§è¡Œã€‚è‹¥éè¦ç©ºï¼Œå¯ç»™å®ƒè®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼ŒğŸ”ï¼š</p><blockquote><p>var changeTitleAndClosure:((_ color:UIColor? = UIColor.orange, Â _ title:String? = "12345") -&gt; Void)?</p></blockquote><hr><p>ç¬¬ä¸‰ç§:</p><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345") { (title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("title: \(title)")</p>
<p>Â  Â  Â  Â  }</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p>AAAViewController.swift</p><blockquote>
<p>func loadData(color: UIColor, title: String,completion: Â (_ result:String) -&gt; ()) -&gt; () {</p>
<p>Â  Â  Â  Â  self.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p> Â  Â  Â  Â  Â  completion(self.textField.text!)</p>
<p>Â  Â  }</p>
</blockquote><hr><p>ç¬¬å››ç§ï¼šå°¾éšé—­åŒ…</p><p>å¢åŠ ä»£ç çš„å¯è¯»æ€§</p><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345", completion: {</p>
<p>Â  Â  Â  Â  Â  Â  (title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("~~~~~~~&gt; \(title)")</p>
<p>Â  Â  Â  Â  })</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p>AAAViewController.swift</p><blockquote>
<p>func loadData(color: UIColor, title: String,completion: Â  (_ result:String) -&gt; ()) -&gt; () {</p>
<p>Â  Â  Â  Â  self.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p>Â  Â  Â  Â  Â  Â  print("è€—æ—¶æ“ä½œ \(Thread.current)")</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  //å›è°ƒå¼‚æ­¥è·å–çš„ç»“æœ</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  completion("æ­¦æ¾æ‰“è™")</p>
<p>Â  Â  }</p>
</blockquote><hr><p>ç¬¬äº”ç§: é€ƒé€¸é—­åŒ…</p><blockquote>
<p>å…³é”®å­—:Â @escaping</p>
<p>Â Â Â Â Â Â Â Â ä¼ é€’ç»™å‡½æ•°çš„é—­åŒ…å¦‚æœä¸æ˜¯åœ¨å‡½æ•°å†…è°ƒç”¨ï¼Œè€Œæ˜¯åœ¨å‡½æ•°å†…ç”¨å¤–éƒ¨å˜é‡ä¿å­˜å½“å‰çš„é—­åŒ…ï¼Œåœ¨åˆé€‚çš„æ—¶é—´å†è¿›è¡Œè°ƒç”¨,éœ€è¦åœ¨é—­åŒ…å‚æ•°å‰åŠ å…¥@escapingå…³é”®å­—ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™</p>
</blockquote><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345", completion: {</p>
<p>Â  Â  Â  Â  Â  Â  [unowned self](title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("~~~~~~~&gt; \(title)")</p>
<p>Â  Â  Â  Â  Â  Â  print("weadSelf.view: \(self.view ?? nil)")</p>
<p>Â  Â  Â  Â  })</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p>AAAViewController.swift</p><blockquote>
<p>//å®šä¹‰ä¸€ä¸ªé—­åŒ…å±æ€§</p>
<p>Â var completions : ((_ title: String) -&gt; ())?</p>
<p><br></p>
<p>@objc func lastController()  {</p>
<p>Â  Â  Â  Â  self.dismiss(animated: true, completion: nil)</p>
<p>Â  Â  Â  Â  self.completions?(self.textField.text!)</p>
<p>Â  Â  }</p>
<p><br></p>
<p>func loadData(color: UIColor, title: String,completion: @escaping (_ result:String) -&gt; ()) -&gt; () {</p>
<p>Â  Â  Â  Â  self.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p>Â  Â  Â  Â  self.completions = completion</p>
<p>Â  Â  }</p>
<p><br></p>
<p>Â  Â  deinit {</p>
<p>Â  Â  Â  Â  print("22222222222æˆ‘é‡Šæ”¾äº†æ— ç”¨çš„å†…å­˜ï¼ï¼")</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p><br></p><p><br></p><hr><p>ç¬¬å…­ç§ï¼š æ‡’åŠ è½½</p><blockquote><p>æ‡’åŠ è½½åªä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰§è¡Œåˆ›å»ºå¯¹è±¡ï¼Œåé¢å¦‚æœå¯¹è±¡è¢«é‡Šæ”¾äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åˆ›å»ºã€‚è€Œocä¸­ä¼šå†æ¬¡åˆ›å»ºã€‚</p></blockquote><blockquote>
<p>1.</p>
<p>lazyÂ varÂ personÂ :Â HumanÂ =Â {Â Â </p>
<p>Â Â Â Â Â Â Â Â print("æ‡’åŠ è½½çš„å®šä¹‰")Â Â </p>
<p>Â Â Â Â Â Â Â Â returnÂ Human()Â Â </p>
<p>Â Â Â Â }()Â Â </p>
<p><br></p>
<p>//2ã€æ‡’åŠ è½½æ”¹å†™ä¸ºé—­åŒ…å½¢å¼ Â </p>
<p>Â letÂ personFuncÂ =Â {Â ()Â -&gt;Â HumanÂ in Â </p>
<p>Â Â Â Â Â Â Â Â print("æ‡’åŠ è½½Â --&gt;Â é—­åŒ…")Â Â </p>
<p>Â Â Â Â Â Â Â Â returnÂ Human()Â Â </p>
<p>Â Â Â Â }Â Â </p>
<p>Â Â Â Â lazyÂ varÂ personDemoÂ :Â HumanÂ =self.personFunc() Â </p>
<p><br></p>
<p>//3ã€æ‡’åŠ è½½çš„ç®€å•å†™æ³•Â Â </p>
<p>lazyÂ varÂ person2Â :Â HumanÂ =Â Human() Â </p>
</blockquote><hr><p><br></p><p>é—®é¢˜ï¼š è§£å†³é—­åŒ…ä¸­å­˜åœ¨çš„å¾ªç¯å¼•ç”¨</p><p>è®°ä½è¿™ä¸€ç‚¹:</p><blockquote>
<p>VC --strong -- é—­åŒ…;</p>
<p>é—­åŒ…- strong -- VCï¼›</p>
<p>å°±é€ æˆäº†å¾ªç¯å¼•ç”¨ï¼ŒÂ Swift å±æ€§çš„é»˜è®¤ å°±æ˜¯å¼ºå¼•ç”¨ï¼šè®°å½•äº†é—­åŒ…å±æ€§ï¼Œç„¶ååœ¨é—­åŒ…ä¸­åˆä½¿ç”¨äº†selfï¼Œåˆ™äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨Â </p>
<p>åœ¨ARCä¸­ï¼Œweakæœ¬è´¨æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼ï¼Œä¸€æ—¦å¯¹è±¡é‡Šæ”¾ï¼Œåˆ™æŠŠå¯¹è±¡ç½®ä¸ºnil Â </p>
<p>åœ¨MRCä¸­ï¼Œæ˜¯é€šè¿‡assignè¿›è¡Œè‹¥å¼•ç”¨çš„ï¼Œå¦‚æœå¯¹è±¡é‡Šæ”¾ï¼Œassignçš„æŒ‡é’ˆè¿˜æ˜¯æŒ‡å‘è¯¥å†…åœ°åœ°å€ï¼Œä¼šé€ æˆé‡æŒ‡é’ˆÂ </p>
<p>Â __weakÂ typeof(self)Â weakSelfÂ =Â self;Â </p>
<p>Â //__unsafe_unretainedç›¸å½“äºassignï¼ŒÂ </p>
<p>Â __unsafe_unretainedÂ typeof(self)Â weak1SelfÂ =Â self;Â Â </p>
</blockquote><p>æ–¹å¼ä¸€ï¼š</p><blockquote>
<p>å…³é”®å­—ï¼š weak</p>
<p>æ³¨æ„ï¼šweakåªèƒ½ä¿®é¥°varï¼Œä¸èƒ½ä¿®é¥°letï¼Œå› ä¸ºå¦‚æœweakçš„æŒ‡é’ˆåœ¨è¿è¡Œæ—¶ä¼šè¢«ä¿®æ”¹ï¼Œä¼šè‡ªåŠ¨è®¾ç½®ä¸ºnilÂ Â </p>
</blockquote><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345", completion: {</p>
<p>Â  Â  Â  Â  Â  Â  (title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("~~~~~~~&gt; \(title)")</p>
<p>Â  Â  Â  Â  Â  Â  print("weadSelf.view: \(self.view ?? nil)")</p>
<p>Â  Â  Â  Â  })</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p>AAAViewController.swift</p><blockquote>
<p>//    å®šä¹‰ä¸€ä¸ªé—­åŒ…å±æ€§</p>
<p> var completion : ((_ title: String) -&gt; ())?</p>
<p>func loadData(color: UIColor, title: String,completion: @escaping (_ result:String) -&gt; ()) -&gt; () {</p>
<p>Â  Â  Â  Â  weak var weakSelf = self</p>
<p>Â  Â  Â  Â  weakSelf?.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p>Â  Â  Â  Â  completion("æ­¦æ¾æ‰“è™")</p>
<p>Â  Â  }</p>
<p><br></p>
<p>Â  Â  deinit {</p>
<p>Â  Â  Â  Â  print("22222222222æˆ‘é‡Šæ”¾äº†æ— ç”¨çš„å†…å­˜ï¼ï¼")</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p>æ–¹å¼äºŒï¼š</p><blockquote>
<p>æ¨èï¼š</p>
<p>[weakÂ self]è¡¨ç¤ºé—­åŒ…ä¸­çš„selféƒ½æ˜¯è‹¥å¼•ç”¨</p>
</blockquote><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345", completion: {</p>
<p>Â  Â  Â  Â  Â  Â  [weak self](title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("~~~~~~~&gt; \(title)")</p>
<p>Â  Â  Â  Â  Â  Â  print("weadSelf.view: \(self?.view ?? nil)")</p>
<p>Â  Â  Â  Â  })</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p>AAAViewController.swift</p><blockquote>
<p>//å®šä¹‰ä¸€ä¸ªé—­åŒ…å±æ€§</p>
<p>var completion : ((_ title: String) -&gt; ())?</p>
<p>func loadData(color: UIColor, title: String,completion: @escaping (_ result:String) -&gt; ()) -&gt; () {</p>
<p><br></p>
<p>Â  Â  Â  Â  self.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p>Â  Â  Â  Â  completion("æ­¦æ¾æ‰“è™")</p>
<p>Â  Â  }</p>
<p><br></p>
<p>Â  Â  deinit {</p>
<p>Â  Â  Â  Â  print("22222222222æˆ‘é‡Šæ”¾äº†æ— ç”¨çš„å†…å­˜ï¼ï¼")</p>
<p>Â  Â  }</p>
</blockquote><hr><p>æ–¹å¼ä¸‰ï¼š</p><blockquote>
<p>å…³é”®å­—ï¼š</p>
<p>[unownedÂ self]ï¼šè¡¨ç¤ºé—­åŒ…ä¸­çš„selfä¸ºassignï¼Œå¦‚æœselfè¢«é‡Šæ”¾ï¼Œåˆ™æŒ‡é’ˆåœ°å€ä¸ä¼šè¢«é‡Šæ”¾ï¼Œå®¹æ˜“å¯¼è‡´å‡ºç°é‡æŒ‡é’ˆÂ </p>
</blockquote><p>ViewController.swift</p><blockquote>
<p>@objc func nextController()  {</p>
<p>Â  Â  Â  Â  let aaa = AAAViewController()</p>
<p>Â  Â  Â  Â  aaa.loadData(color: UIColor.red, title: "12345", completion: {</p>
<p>Â  Â  Â  Â  Â  Â  [unowned self](title) in</p>
<p>Â  Â  Â  Â  Â  Â  print("~~~~~~~&gt; \(title)")</p>
<p>Â  Â  Â  Â  Â  Â  print("weadSelf.view: \(self.view ?? nil)")</p>
<p>Â  Â  Â  Â  })</p>
<p>Â  Â  Â  Â  self.present(aaa, animated: true, completion: nil)</p>
<p>Â  Â  }</p>
</blockquote><p><br></p><p>Â  AAAViewController.swift</p><blockquote>
<p>//å®šä¹‰ä¸€ä¸ªé—­åŒ…å±æ€§</p>
<p>Â var completion : ((_ title: String) -&gt; ())?</p>
<p>func loadData(color: UIColor, title: String,completion: @escaping (_ result:String) -&gt; ()) -&gt; () {</p>
<p><br></p>
<p>Â  Â  Â  Â  self.view.backgroundColor = color</p>
<p>Â  Â  Â  Â  print("-----&gt;title: \(title)")</p>
<p>Â  Â  Â  Â  completion("æ­¦æ¾æ‰“è™")</p>
<p>Â  Â  }</p>
<p><br></p>
<p>Â  Â  deinit {</p>
<p>Â  Â  Â  Â  print("22222222222æˆ‘é‡Šæ”¾äº†æ— ç”¨çš„å†…å­˜ï¼ï¼")</p>
<p>Â  Â  }</p>
</blockquote>
        </div>
      </div>
    </div>
  </body>
</html>
