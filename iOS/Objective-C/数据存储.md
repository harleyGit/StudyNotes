> <h2 id=''></h2>
- [**æ–‡ä»¶æ“ä½œ**](#æ–‡ä»¶æ“ä½œ)
	- [æ²™ç›’](#æ²™ç›’)
- [**CoreData**](#CoreData)
	- [åŸºç¡€ä½¿ç”¨](#åŸºç¡€ä½¿ç”¨)
- [**æŒä¹…åŒ–**](#æŒä¹…åŒ–)
	- [åºåˆ—åŒ–å’Œååºåˆ—åŒ–](#åºåˆ—åŒ–å’Œååºåˆ—åŒ–)
- **å‚è€ƒèµ„æ–™**
	- [CoreDataæŒä¹…åŒ–å­˜å‚¨æ•°æ®è‡³ SQLite](https://www.jianshu.com/p/f4d0f42398df)
	- [æ·»åŠ ä¸æŸ¥è¯¢æ•°æ®](https://yq.aliyun.com/articles/39426)
	- [CoreDataå…¥é—¨](https://www.cnblogs.com/mjios/archive/2013/02/26/2932999.html)


<br/>
<br/>

***
<br/>


> <h1 id='æ–‡ä»¶æ“ä½œ'>æ–‡ä»¶æ“ä½œ</h1>

<br/>

> <h2 id='æ²™ç›’'>æ²™ç›’</h2>

**æ²™ç›’æœºåˆ¶**

&emsp; æ¯ä¸€ä¸ªiOSåº”ç”¨ç¨‹åºéƒ½ä¼šä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œè¿™ä¸ªç‹¬ç«‹ã€å°é—­ã€å®‰å…¨çš„ç©ºé—´å«åšæ²™ç›’ã€‚æ²™ç›’å°±æ˜¯ä¸€ç§å®‰å…¨ä½“ç³»ï¼Œå®ƒè§„å®šäº†åº”ç”¨ç¨‹åºåªèƒ½åœ¨è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•å†…è®¿é—®æ–‡ä»¶ï¼Œä¸å¯ä»¥è®¿é—®å…¶ä»–åº”ç”¨æ²™ç›’å†…çš„å†…å®¹ã€‚æ‰€æœ‰çš„éä»£ç æ–‡ä»¶éƒ½ä¿å­˜åœ¨è¿™ä¸ªåœ°æ–¹ã€‚

**æ²™ç›’æ ¹ç›®å½•ç»“æ„ï¼šDocumentsã€Libraryã€temp**


![ios_oc1_48.jpeg](./../../Pictures/ios_oc1_48.jpeg)


<br/>

- **Documents**

	- ä¿å­˜åº”ç”¨è¿è¡Œæ—¶ç”Ÿæˆçš„éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ï¼ŒiTuneså¤‡ä»½å’Œæ¢å¤çš„æ—¶å€™ä¼šåŒ…æ‹¬æ­¤ç›®å½•ï¼Œæ‰€ä»¥è‹¹æœå»ºè®®å°†ç¨‹åºä¸­å»ºç«‹çš„æˆ–åœ¨ç¨‹åºä¸­æµè§ˆåˆ°çš„æ–‡ä»¶æ•°æ®ä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹ã€‚


<br/>

- **Library**

	- **Caches**ï¼šå­˜æ”¾ç¼“å­˜æ–‡ä»¶ï¼ŒiTunesä¸ä¼šå¤‡ä»½æ­¤ç›®å½•ï¼Œæ­¤ç›®å½•ä¸‹æ–‡ä»¶ä¸ä¼šåœ¨åº”ç”¨é€€å‡ºååˆ é™¤ ã€‚ä¸€èˆ¬å­˜æ”¾ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œä¸æ˜¯ç‰¹åˆ«é‡è¦çš„èµ„æºã€‚
	- 	**Preferences**ï¼šä¿å­˜APPçš„æ‰€æœ‰åå¥½è®¾ç½®ï¼ŒiOSçš„Settingsï¼ˆè®¾ç½®ï¼‰åº”ç”¨ä¼šåœ¨è¯¥ç›®å½•ä¸­æŸ¥æ‰¾åº”ç”¨çš„è®¾ç½®ä¿¡æ¯ï¼ŒiTunesä¼šè‡ªåŠ¨å¤‡ä»½è¯¥ç›®å½•ã€‚æ³¨æ„ï¼šé€šè¿‡NSUserDefaultsç±»æ¥è¯»å–å’Œè®¾ç½®ã€‚

<br/>

- **tmp**
	- ä¿å­˜åº”ç”¨è¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶æ•°æ®ï¼Œè¿™ä¸ªå¯ä»¥æ”¾ä¸€äº›å½“APPé€€å‡ºåä¸å†éœ€è¦çš„æ–‡ä»¶ã€‚åº”ç”¨æ²¡æœ‰è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¹Ÿæœ‰å¯èƒ½ä¼šæ¸…é™¤è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼ŒiTunesä¸ä¼šåŒæ­¥è¯¥ç›®å½•ã€‚iPhoneé‡å¯æ—¶ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šè¢«åˆ é™¤ã€‚






<br/>
<br/>

***
<br/>


> <h1 id='CoreData'>CoreData</h1>

![ios_oc1_22.png](./../../Pictures/ios_oc1_22.png)

- **NSManagedObjectContextï¼š** æ•°æ®åº“æ“ä½œï¼Œ ç®¡ç†å¯¹è±¡çš„ä¸Šä¸‹æ–‡ï¼Œç±»ä¼¼äºåº”ç”¨ç¨‹åºå’Œæ•°æ®å­˜å‚¨é—´çš„ä¸€å—ç¼“å†²åŒºï¼Œä½ å¯ä»¥å¢åˆ æ”¹æŸ¥ç®¡ç†å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œä»æŒä¹…åŒ–å­˜å‚¨ï¼ˆæ–‡ä»¶ï¼‰ä¸­æŸ¥è¯¢çš„æ•°æ®åœ¨è¿™ä¸ªå®¹å™¨ä¸­å½¢æˆå¯¹è±¡å›¾ï¼Œå¯¹è¿™äº›å¯¹è±¡å›¾ä¸­çš„å¯¹è±¡æ“ä½œéƒ½ä¼šå­˜å‚¨åœ¨è¿™ä¸ªå®¹å™¨é‡Œï¼Œç›´åˆ°å‘å‡ºæŒ‡ä»¤è®©å®¹å™¨ä¸­çš„å†…å®¹åŒæ­¥åˆ°ç£ç›˜ã€‚

- **NSManagedObjectContext:** å‘èµ·saveæ“ä½œï¼Œæ‰ä¼šé€šè¿‡NSPersistentStoreCoordinateä¸æ•°æ®äº¤äº’å¹¶æ‰§è¡Œæ•°æ®åº“æ“ä½œï¼Œè¿™æ ·é¿å…äº†å› æ•°æ®æ“ä½œè€Œå¸¦æ¥çš„I/Oæ“ä½œï¼Œæé«˜äº†æ•ˆç‡

- **NSManagedObjectï¼š** è¡¨è®°å½•ï¼Œä¸€ä¸ªç®¡ç†å¯¹è±¡ä»£è¡¨ä½ æƒ³è¦ä¿å­˜åˆ°æ•°æ®å­˜å‚¨ä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œç±»ä¼¼äºSQLä¸­çš„ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”åŒ…å«ä¸€äº›å¯¹è±¡å±æ€§ã€‚ç®€å•ç‚¹æ¥è¯´ï¼ŒNSManagedObject å°±æ˜¯NSManagedObjectContextå¯¹è±¡å›¾ä¸­çš„å®é™…å¯¹è±¡ã€‚ç”±NSManagedObjectContextç®¡ç†ã€‚NSManagedObjectContextä¼šå­˜å‚¨è¿™äº›å¯¹è±¡çš„å˜åŒ–æ¥æ”¯æŒé‡åšå’Œæ’¤é”€ã€‚

- **NSPersistentStoreCoordinatorï¼š** æ•°æ®åº“å­˜å‚¨æ–¹å¼ï¼Œ æŒä¹…åŒ–å­˜å‚¨åè°ƒè€… ï¼ŒåŒ…å«æ•°æ®å­˜å‚¨çš„åå­—å’Œä½ç½®ï¼Œç®€å•ç‚¹æ¥è¯´å®ƒæ˜¯è¿æ¥ä¸¤ç«¯çš„çº½å¸¦ã€‚æ‰€ä»¥æ•´ä¸ªæµç¨‹å°±æ˜¯ï¼š
	- 1ã€æ•°æ®ï¼ˆNSManagedObjectï¼‰è¢«åˆ›å»ºä¿®æ”¹æˆ–åˆ é™¤ç­‰ç­‰ï¼Œè¿™äº›éƒ½è¢«contextçœ‹åœ¨çœ¼é‡Œï¼Œç„¶åä½ è¦ä¿å­˜äº†ï¼ŒcontextæŠŠä¿®æ”¹çš„ä¿¡æ¯æäº¤ç»™ï¼Œcontextæ ¹æ®æ•°æ®ä¿¡æ¯æ‰¾åˆ°æ­£ç¡®çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæ ¹æ®æ•°æ®æ¨¡å‹ï¼Œæ­£ç¡®çš„æŠŠæ•°æ®å†™å…¥åˆ°æ•°æ®åº“æ–‡ä»¶é‡Œã€‚
	- 2ã€æŸ¥è¯¢æ—¶ï¼ŒcontextæŠŠæŸ¥è¯¢æ¡ä»¶æäº¤ç»™Coordinatorï¼Œå®ƒå»æ•°æ®åº“æ–‡ä»¶é‡ŒæŠŠæ•°æ®æŸ¥å‡ºæ¥ï¼Œç»™context,contextå†æŠŠè¿™äº›æ•°æ®å’Œä»¥åœ¨å®ƒç®¡ç†å†…çš„ç»“åˆã€‚

- **NSPersistentStoreï¼š** æ˜¯æŒä¹…åŒ–å­˜å‚¨æ ¸å¿ƒæ•°æ®çš„æŠ½è±¡ç±»ï¼Œå¯ä»¥ç†è§£ä¸ºæŒä¹…åŒ–å­˜å‚¨åŒºï¼Œå®ƒçš„ä¸»è¦è´£ä»»æ˜¯æŠŠå¯¹è±¡å›¾ä¸­çš„ä¿¡æ¯mapåˆ°å®é™…çš„å­˜å‚¨ä¿¡æ¯ã€‚æŒä¹…åŒ–å­˜å‚¨åŒºæ”¯æŒçš„æ•°æ®ç±»å‹ä¸ºSQLiteã€äºŒè¿›åˆ¶ã€XMLå’Œå†…å­˜ã€‚

<br/>

&emsp; SQLite å’ŒFileSystemå°±æ˜¯ä¿å­˜åˆ°æŒä¹…åŒ–å­˜å‚¨çš„æ–‡ä»¶ï¼ŒCoreDataæ”¯æŒSQLiteçš„æ•°æ®æ ¼å¼ã€‚ä½†æ˜¯æ³¨æ„ï¼ŒcoreDataä¸æ˜¯DBMSï¼Œå¹¶ä¸èƒ½ç®¡ç†SQLite 



<br/>

> <h2 id='åŸºç¡€ä½¿ç”¨'>åŸºç¡€ä½¿ç”¨</h2>


- **1.åˆ›å»ºNSManagedObjectModel**

```
// åŠ è½½ï¼šModel.xcdatamodeld æ–‡ä»¶
lazy var managedObjectModel: NSManagedObjectModel = {

	if self.isTestMode {
	
	    return NSManagedObjectModel.mergedModel(from: Bundle.allBundles)! //è¿æ¥é¡¹ç›®ä¸­æ‰€æœ‰çš„ .xcdatamodeld æ–‡ä»¶ä¸ºä¸€ä¸ªdatamodelï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ï¼ŒæŠŠå¤šä¸ªentityæ”¾åœ¨å„è‡ªçš„xcodemodelæ–‡ä»¶ä¸­åˆ†å¼€ç®¡ç†ï¼Œç„¶åç”¨è¿™ä¸ªå‡½æ•°è¿æ¥èµ·æ¥ç”Ÿæˆä¸€ä¸ªdatamodel
	
	}
	
	let modelURL = Bundle.main.url(forResource: "Model", withExtension: "momd")!
	
	return NSManagedObjectModel(contentsOf: modelURL)!

}()
```




<br/>
<br/>




> <h2 id=''></h2>


<br/>
<br/>



> <h2 id=''></h2>


<br/>
<br/>


<br/>
<br/>

***
<br/>


> <h1 id='æŒä¹…åŒ–'>æŒä¹…åŒ–</h1>

- **æŒä¹…åŒ–ä¸‰ä¸ªå¸¸è§æ–¹æ³•**
	- plist
	- NSUserDefault
	- æ•°æ®åº“

&emsp; ä¸ç®¡æ˜¯å“ªä¸€ç§æ–¹æ¡ˆï¼Œéƒ½ä¸å¯èƒ½ç›´æ¥å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å°†è‡ªå®šä¹‰çš„å¯¹è±¡åºåˆ—åŒ–æˆNSDataï¼Œæ‰èƒ½æŒä¹…åŒ–ã€‚

&emsp; éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå°±ç”¨æ•°æ®åº“ä¸­å–å‡ºï¼Œç„¶åååºåˆ—åŒ–ï¼Œæ¢å¤æˆå¯¹è±¡

<br/>

> <h2 id='åºåˆ—åŒ–å’Œååºåˆ—åŒ–'>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2>

&emsp; å¦‚æœè‡ªå®šä¹‰å¯¹è±¡è¦æƒ³è½¬æˆNSDataï¼Œéœ€è¦æœä»NSCodingåè®®ã€‚å¹¶å®ç°å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ã€‚

![ios_oc1_31](./../../Pictures/ios_oc1_31.webp)

<br/>

&emsp; iOS6ä¸­ï¼Œè‹¹æœå¼•å…¥äº†ä¸€ä¸ªæ–°çš„åè®®ï¼Œæ˜¯åŸºäºNSCodingçš„ï¼Œå«åšNSSecureCodingã€‚NSSecureCodingå’ŒNSCodingæ˜¯ä¸€æ ·çš„ï¼Œé™¤äº†åœ¨è§£ç æ—¶è¦åŒæ—¶æŒ‡å®škeyå’Œè¦è§£ç çš„å¯¹è±¡çš„ç±»ï¼Œå¦‚æœè¦æ±‚çš„ç±»å’Œä»æ–‡ä»¶ä¸­è§£ç å‡ºçš„å¯¹è±¡çš„ç±»ä¸åŒ¹é…ï¼ŒNSCoderä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå‘Šè¯‰ä½ æ•°æ®å·²ç»è¢«ç¯¡æ”¹äº†ã€‚å¤§éƒ¨åˆ†æ”¯æŒNSCodingçš„ç³»ç»Ÿå¯¹è±¡éƒ½å·²ç»å‡çº§åˆ°æ”¯æŒNSSecureCodingã€‚

**DEMO**

**Person.h**

```
@interface Person : NSObject<NSSecureCoding>

@property (nonatomic, copy) NSString *name;

@property (nonatomic, assign) float *numberID;
```

<br/>

**Person.m**

```
@implementation Foo

- (void)encodeWithCoder:(nonnull NSCoder *)aCoder {
    [aCoder encodeObject:self.name forKey:NSStringFromSelector(@selector(name))];
    [aCoder encodeFloat:self.numberID forKey:NSStringFromSelector(@selector(numberID))];
}

- (nullable instancetype)initWithCoder:(nonnull NSCoder *)aDecoder {
    if (self = [super init]) {
        self.name = [aDecoder decodeObjectForKey:NSStringFromSelector(@selector(name))];
        self.numberID = [aDecoder decodeFloatForKey:NSStringFromSelector(@selector(numberID))];
    }    return self;
}

+ (BOOL)supportsSecureCoding
{
    return YES;
}

-(NSString *)description{
    return [NSString stringWithFormat:@"bar:%@ ; baz:%f",self.bar, self.baz];
}

@end

```

<br/>

**ä½¿ç”¨:**

```
+ (void) testHandelData {
    HGHandleData *handleData = [[HGHandleData alloc] init];
    handleData.name = @"ç¥ˆæ±‚è€…Kael";
    handleData.numberID = 24;
    
    //è·å–å®¶ç›®å½•è·¯å¾„çš„å‡½æ•°ï¼š
    NSString *homeDir = NSHomeDirectory();
    NSString *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES).firstObject;
    NSString *archievePath = [paths stringByAppendingPathComponent:@"HGHandleData.txt"];
    SLog(@"ç›®å½•è·¯å¾„:%@ \n archievePath:%@", homeDir, archievePath);
    
    
    
    
    
    //æ–¹å¼ä¸€:åºåˆ—åŒ–æ•°æ®
    NSError *error0;
    NSData *archiverData;
    if (@available(iOS 11.0, *)) {//åºåˆ—åŒ–
        archiverData = [NSKeyedArchiver archivedDataWithRootObject:handleData requiringSecureCoding:YES error:&error0];
        //å†™å…¥æŒ‡å®šè·¯å¾„æˆ–è€…å­˜å…¥NSUserDefaults
        [archiverData writeToFile:archievePath atomically:YES];
        SLog(@"data --- %@", archiverData);
        
    } else {
        archiverData = [NSKeyedArchiver archivedDataWithRootObject:handleData];
    }
    
    NSString *archiverString1 = [archiverData base64EncodedStringWithOptions:0];
    [[NSUserDefaults standardUserDefaults] setObject:archiverString1 forKey:@"cacheData"];
    [[NSUserDefaults standardUserDefaults] synchronize];
    
    
    
    
    //ååºåˆ—åŒ–
    NSString *archiverString = [[NSUserDefaults standardUserDefaults] objectForKey:@"cacheData"];
    NSError *error = nil;
    if (archiverString) {
        @try {
            NSData *archiverData = [NSData dataWithContentsOfFile:archievePath];
            //æˆ–è€…
            //NSData *archiverData = [[NSData alloc] initWithBase64EncodedString:archiverString options:0];
            HGHandleData *handleData = nil;
            if (@available(iOS 11.0, *)) {
                handleData = (HGHandleData*)[NSKeyedUnarchiver unarchivedObjectOfClass:[HGHandleData class] fromData:archiverData error:&error];
                //handleData = [NSKeyedUnarchiver unarchiveTopLevelObjectWithData:archiverData error:&error];
            } else {
                handleData = [NSKeyedUnarchiver unarchiveObjectWithData:archiverData];
            }
        } @catch (NSException *exception) {
            [[NSUserDefaults standardUserDefaults] removeObjectForKey:@"cacheData"];
        }
        SLog(@"ååºåˆ—åŒ–æ•°æ®:%@ \n error:%@", handleData, error);
        
        
        
        //æ–¹å¼äºŒ:åºåˆ—åŒ–æ•°æ®
        BOOL isSuccess = [NSKeyedArchiver archiveRootObject:handleData toFile:@"/Users/harleyhuang/Desktop/Stu.txt"];
        if(isSuccess) {
            SLog(@"åºåˆ—åŒ–æˆåŠŸ");
        }else{
            SLog(@"åºåˆ—åŒ–å¤±è´¥");
        }
        
        
        HGHandleData *handleData1 = [NSKeyedUnarchiver unarchiveObjectWithFile:@"/Users/harleyhuang/Desktop/Stu.txt"];
        SLog(@"handleData1 = %@", handleData1);
        
    }
}

```


æ‰“å°:

```
ğŸ ğŸ  +[HGHandleData testHandelData][47] 
 ç›®å½•è·¯å¾„:/Users/harleyhuang/Library/Developer/CoreSimulator/Devices/9272805F-0992-4ED3-9C3B-953A3DC33370/data/Containers/Data/Application/F146CDCF-39B5-440B-94C0-ACB0FB539C16 
 archievePath:/Users/harleyhuang/Library/Developer/CoreSimulator/Devices/9272805F-0992-4ED3-9C3B-953A3DC33370/data/Containers/Data/Application/F146CDCF-39B5-440B-94C0-ACB0FB539C16/Documents/HGHandleData.txt

2022-10-27 14:32:22.403673+0800 MLC[80338:1304890] ğŸ ğŸ  +[HGHandleData testHandelData][60] 
 data --- {length = 268, bytes = 0x62706c69 73743030 d4010203 04050607 ... 00000000 000000d1 }

2022-10-27 14:32:22.414001+0800 MLC[80338:1304890] [general] *** -[NSKeyedUnarchiver validateAllowedClass:forKey:] allowed unarchiving safe plist type ''NSString' (0x10e0b17f0) [/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Library/Developer/CoreSimulator/Profiles/Runtimes/iOS.simruntime/Contents/Resources/RuntimeRoot/System/Library/Frameworks/Foundation.framework]' for key 'name', even though it was not explicitly included in the client allowed classes set: '{(
    "'HGHandleData' (0x1028ab3c0) [/Users/harleyhuang/Library/Developer/CoreSimulator/Devices/9272805F-0992-4ED3-9C3B-953A3DC33370/data/Containers/Bundle/Application/4AEE75C1-74F4-4454-91C6-9286E445F552/MLC.app]"
)}'. This will be disallowed in the future.
2022-10-27 14:32:22.414187+0800 MLC[80338:1304890] ğŸ ğŸ  +[HGHandleData testHandelData][89] 
 ååºåˆ—åŒ–æ•°æ®:name:ç¥ˆæ±‚è€…Kael ; NumberID:24.000000 
 error:(null)

2022-10-27 14:32:22.414933+0800 MLC[80338:1304890] ğŸ ğŸ  +[HGHandleData testHandelData][96] 
 åºåˆ—åŒ–æˆåŠŸ

2022-10-27 14:32:22.417283+0800 MLC[80338:1304890] ğŸ ğŸ  +[HGHandleData testHandelData][103] 
 handleData1 = name:ç¥ˆæ±‚è€…Kael ; NumberID:24.000000

```

<br/>

```
///æµ‹è¯•å±æ€§@selectorå’Œåºåˆ—å·å’Œååºåˆ—åŒ–
-(void) testUUIDMethod {
    self.testUUID = [NSUUID UUID].UUIDString;
    
    NSLog(@"ğŸ‡¨ğŸ‡« testUUID: %@,  @selector(testUUID): %@", self.testUUID, NSStringFromSelector(@selector(testUUID)));
}
```

æ‰“å°:

```
2022-09-17 11:39:36.619385+0800 MLC[54350:1043294] ğŸ‡¨ğŸ‡« testUUID: 503BBFA7-CA58-4CC0-BFDE-50F2925F897D,  @selector(testUUID): testUUID
(lldb) po @selector(testUUID)
"testUUID"

(lldb) p @selector(testUUID)
(SEL) $1 = "testUUID"
(lldb) 
```



<br/>
<br/>




<br/>
<br/>

***
<br/>


> <h1 id=''></h1>

<br/>

> <h2 id=''></h2>


<br/>
<br/>






<br/>
<br/>

***
<br/>

> <h1 id=''></h1>

