> <h2 id=''></h2>
- [**æ„é€ æ–¹æ³•**](#æ„é€ æ–¹æ³•)
- [**å±æ€§**](#å±æ€§)
	- [å±æ€§åŒ…è£…å™¨](#å±æ€§åŒ…è£…å™¨)
	- [å±æ€§åŒ…è£…å™¨ä¸­çš„ `projectedValue`ï¼ˆå‘ˆç°å€¼ï¼‰](#å±æ€§åŒ…è£…å™¨ä¸­çš„projectedValueå‘ˆç°å€¼)
	- [BleDeviceModelæ•°æ®æ¨¡å‹çš„å±æ€§åŒ…è£…å™¨](#BleDeviceModelæ•°æ®æ¨¡å‹çš„å±æ€§åŒ…è£…å™¨)
	- [@UserDefaultå±æ€§åŒ…è£…å™¨](#@UserDefaultå±æ€§åŒ…è£…å™¨)
- [**æ•°ç»„**](#æ•°ç»„)
	- [ä¸€ä¸ªæ•°ç»„å¯¹è±¡å…ƒç´ idå’Œå¦ä¸€ä¸ªæ•°ç»„å¯¹è±¡ä¸­çš„ProductNoç›¸ç­‰åï¼Œå°†å…¶å¯¹è±¡å±æ€§èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡å±æ€§](#ä¸€ä¸ªæ•°ç»„å¯¹è±¡å…ƒç´ idå’Œå¦ä¸€ä¸ªæ•°ç»„å¯¹è±¡ä¸­çš„ProductNoç›¸ç­‰åï¼Œå°†å…¶å¯¹è±¡å±æ€§èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡å±æ€§)
	- [æ•°ç»„çš„compactMapå’Œfilterä½¿ç”¨](#æ•°ç»„çš„compactMapå’Œfilterä½¿ç”¨)
	- [æ•°ç»„mapã€firstæ–¹æ³•è¯¦è§£](#æ•°ç»„mapã€firstæ–¹æ³•è¯¦è§£)
	- [`contains(where:)`ä½¿ç”¨](#`contains(where:)`ä½¿ç”¨)
- [Dictionary](#Dictionary)
	- [æŒ‰æŒ‡å®šå­—æ®µåˆ†ç»„](#æŒ‰æŒ‡å®šå­—æ®µåˆ†ç»„)
- [**ç±»**](#ç±»)
	- [æµå¼API](#æµå¼API)
- [**å€¼å¼•ç”¨ç±»å‹**](#å€¼å¼•ç”¨ç±»å‹)
	- [**å¼•ç”¨ç±»å‹**](#å¼•ç”¨ç±»å‹)
		- [å¼•ç”¨ç±»å‹ä½¿ç”¨intoutå‚æ•°ï¼Œæ„ä¹‰ä¸å¤§](#å¼•ç”¨ç±»å‹ä½¿ç”¨intoutå‚æ•°ï¼Œæ„ä¹‰ä¸å¤§)
		- [ä½¿ç”¨intoutæ³¨æ„äº‹é¡¹](#ä½¿ç”¨intoutæ³¨æ„äº‹é¡¹)
		- [inout å‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸èƒ½ä¸ºå¯å˜å‚æ•°](#inoutå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸èƒ½ä¸ºå¯å˜å‚æ•°)
		- [inout å‚æ•°ä¼ é€’è¿‡ç¨‹](#inoutå‚æ•°ä¼ é€’è¿‡ç¨‹)
	- [**åµŒå¥—ç±»å‹**](#åµŒå¥—ç±»å‹)
		- [å€¼ç±»å‹åµŒå¥—å€¼ç±»å‹](#å€¼ç±»å‹åµŒå¥—å€¼ç±»å‹)
		- [å€¼ç±»å‹åµŒå¥—å¼•ç”¨ç±»å‹](#å€¼ç±»å‹åµŒå¥—å¼•ç”¨ç±»å‹)
		- [å¼•ç”¨ç±»å‹åµŒå¥—å€¼ç±»å‹](#å¼•ç”¨ç±»å‹åµŒå¥—å€¼ç±»å‹)
- [**æšä¸¾**](#æšä¸¾)
	- [æšä¸¾åŸå§‹å€¼](#æšä¸¾åŸå§‹å€¼)
	- [æšä¸¾å…³è”å€¼](#æšä¸¾å…³è”å€¼)
	- [æšä¸¾èŒƒå‹è°ƒç”¨](#æšä¸¾èŒƒå‹è°ƒç”¨)
	- [æšä¸¾è¿ç®—](#æšä¸¾è¿ç®—)
	- [äºŒè¿›åˆ¶æšä¸¾ä½ç§»æ©ç åŸç†ç»†è§£](#äºŒè¿›åˆ¶æšä¸¾ä½ç§»æ©ç åŸç†ç»†è§£)
	- [ä½ç§»æ©ç æšä¸¾ä»£ç è½å®](#ä½ç§»æ©ç æšä¸¾ä»£ç è½å®) 
	- [ä¸åŒä½ç§»æ©ç æšä¸¾ç±»å‹è½¬æ¢](#ä¸åŒä½ç§»æ©ç æšä¸¾ç±»å‹è½¬æ¢)
	- [ä¸»æšä¸¾åŒ…å«å¤šä¸ªå­æšä¸¾](#ä¸»æšä¸¾åŒ…å«å¤šä¸ªå­æšä¸¾)
	- [å­—ç¬¦ä¸²è½¬æšä¸¾](#å­—ç¬¦ä¸²è½¬æšä¸¾)
- [**ç»“æ„ä½“**](#ç»“æ„ä½“)
	- [OCå¯¹è±¡è½¬æ¢æˆç»“æ„ä½“](#OCå¯¹è±¡è½¬æ¢æˆç»“æ„ä½“)
- [**é›†åˆ**](#é›†åˆ)
	- [Seté›†åˆä¸NSArrayã€DictionaryåŒºåˆ«](#Seté›†åˆä¸NSArrayã€DictionaryåŒºåˆ«)
	- [enumeratedï¼ˆï¼‰é›†åˆ(å¦‚æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰)éå†](#enumeratedï¼ˆï¼‰é›†åˆ(å¦‚æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰)éå†)
	- [compactMap-æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤ï¼Œå»é™¤nilå…ƒç´ ](#compactMap-æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤ï¼Œå»é™¤nilå…ƒç´ )
- [**å‡½æ•°**](#å‡½æ•°)
	- [**å‡½æ•°ä½¿ç”¨**](#å‡½æ•°ä½¿ç”¨)
	- [å†…éƒ¨å‚æ•°å’Œå¤–éƒ¨å‚æ•°](#å†…éƒ¨å‚æ•°å’Œå¤–éƒ¨å‚æ•°)
	- [é»˜è®¤å‚æ•°](#é»˜è®¤å‚æ•°)
	- [åˆ¤æ–­æ˜¯å¦ä¸ºç©º](#åˆ¤æ–­æ˜¯å¦ä¸ºç©º)
	- [å¯å˜å‚æ•°](#å¯å˜å‚æ•°)
	- [å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰](#å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰)
	- [mapå’ŒflatMapåŒºåˆ«](#mapå’ŒflatMapåŒºåˆ«)
- [**å‡½æ•°ä½œä¸ºå‚æ•°**](#å‡½æ•°ä½œä¸ºå‚æ•°)
	- 	[å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼](#å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼)
	- 	[å‡½æ•°ä¹Ÿå¯ä»¥å½“åšå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°](#å‡½æ•°ä¹Ÿå¯ä»¥å½“åšå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°)
- [**é—­åŒ…**](#é—­åŒ…)
	- [**é—­åŒ…å˜é‡**](#é—­åŒ…å˜é‡)
	- [**é—­åŒ…å‚æ•°**](#é—­åŒ…å‚æ•°)
	- [**é—­åŒ…æ•è·**](#é—­åŒ…æ•è·)
	- [**é—­åŒ…çš„æŸ¯è¥¿ç‰¹æ€§**](#é—­åŒ…çš„æŸ¯è¥¿ç‰¹æ€§)
	- [ç«‹å³æ‰§è¡Œé—­åŒ…](#ç«‹å³æ‰§è¡Œé—­åŒ…)
	- [ç±»ä¼¼RxSwiftæ•°æ®è½¬æ¢](#ç±»ä¼¼RxSwiftæ•°æ®è½¬æ¢)
- [**å¼‚å¸¸**](#å¼‚å¸¸)
	- [throwingå‡½æ•°](#throwingå‡½æ•°)
	- [**ä¸‰è€…åŒºåˆ«**](#ä¸‰è€…åŒºåˆ«)
		- [try? çš„ä½¿ç”¨](#try?çš„ä½¿ç”¨)
		-	[try!](#try!)
		-	[try](#try)
	-	[**æ³›å‹åè®®**](#æ³›å‹åè®®)
		-	[æ³›å‹](#æ³›å‹)
			-	[èŒƒå‹çš„é«˜çº§ä½¿ç”¨-ç±»å‹æ“¦é™¤](#èŒƒå‹çš„é«˜çº§ä½¿ç”¨-ç±»å‹æ“¦é™¤)
				-	[åè®®æ“¦é™¤](#åè®®æ“¦é™¤)
				-	[èŒƒå‹æ“¦é™¤](#èŒƒå‹æ“¦é™¤)
			-	[å¤„ç†2ç§æ•°æ®ç±»å‹çš„èŒƒå‹-RxSwiftçš„Signal](#å¤„ç†2ç§æ•°æ®ç±»å‹çš„èŒƒå‹-RxSwiftçš„Signal)
			-	[whereçº¦æŸå’ŒèŒƒå‹è”åˆä½¿ç”¨å®è·µ(å¯ä»¥åŠ æ·±ç†è§£)](./../ProjectDesc/mtbp.md#å…³é”®å­—whereçº¦æŸå’ŒèŒƒå‹çš„è”åˆ)
	-	[**åè®®**](#åè®®)
		-	[NSObjectProtocolåè®®](#NSObjectProtocolåè®®)
		-	[Sequenceåè®®](#Sequenceåè®®)
		-	[AsyncSequence åè®®](#AsyncSequenceåè®®)
-	[**å¹¶å‘**](#å¹¶å‘)
	-	**èµ„æ–™**
		-	[Swiftå¹¶å‘ä½“éªŒ](https://juejin.cn/post/7054058830304870414)
	-	[å¼‚æ­¥å‡½æ•°å®šä¹‰](#å¼‚æ­¥å‡½æ•°å®šä¹‰)
		- [å¼‚æ­¥å‡½æ•°æ‰ç”¨æµç¨‹](#å¼‚æ­¥å‡½æ•°æ‰ç”¨æµç¨‹)
		- [å¼‚æ­¥åºåˆ—](#å¼‚æ­¥åºåˆ—)
		- [å¹¶è¡Œçš„è°ƒç”¨å¼‚æ­¥æ–¹æ³•](#å¹¶è¡Œçš„è°ƒç”¨å¼‚æ­¥æ–¹æ³•)
		- [éç»“æ„åŒ–å¹¶å‘](#éç»“æ„åŒ–å¹¶å‘)
- **å‚è€ƒèµ„æ–™**
	- [Swiftä¸‹å¦‚ä½•ä½¿ç”¨#ifæ¡ä»¶ç¼–è¯‘](https://blog.csdn.net/guoxulieying/article/details/134665622)
	- [**swiftçš„å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹**](https://www.cnblogs.com/luoxiaofu/p/8528383.html)
	- [**æšä¸¾ç”±æµ…å…¥æ·±**](https://blog.csdn.net/qq_34047841/article/details/78489380)
	- [**è‡ªå®šä¹‰å†™UIViewControllerçš„åˆå§‹åŒ–æ–¹æ³•**](https://www.jianshu.com/p/433afbb0f510)
	- [**åˆå§‹åŒ–è¯´èµ·**](https://www.jianshu.com/p/fb1a91600468)
	- [Swiftçš„initæ–¹æ³•](https://www.jianshu.com/p/61fb73de4fcd)
	- [**@autoclosureè‡ªåŠ¨é—­åŒ…**](https://juejin.cn/post/6844903424413138958)
	- [é—­åŒ…](https://zhuanlan.zhihu.com/p/92464947)
	- [Swift ä¸­çš„åè®®ã€æ³›å‹ã€ä¸é€æ˜ç±»å‹](https://zzzw.cool/Swift-ä¸­çš„åè®®)
	- [Swift æ€§èƒ½ä¼˜åŒ–(1)â€”â€”åŸºæœ¬æ¦‚å¿µ(æ¥šæƒçš„ä¸–ç•Œ)](http://chuquan.me/2020/02/15/swift-performance-optimization-basic-concepts/)







<br/><br/><br/>

***
<br/>

> <h1 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h1>

åœ¨ Swift ä¸­ï¼Œæ„é€ æ–¹æ³•ï¼ˆåˆå§‹åŒ–æ–¹æ³•ï¼‰ç”¨äºåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚æ„é€ æ–¹æ³•æœ‰å¤šç§ç±»å‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

1. **é»˜è®¤æ„é€ å™¨** (Default Initializer)
2. **è‡ªå®šä¹‰æ„é€ å™¨** (Custom Initializer)
3. **ä¾¿åˆ©æ„é€ å™¨** (Convenience Initializer)
4. **æŒ‡å®šæ„é€ å™¨** (Designated Initializer)
5. **ç»§æ‰¿æ„é€ å™¨** (Inherited Initializer)
6. **è¦æ±‚æ„é€ å™¨** (Required Initializer)
7. **èšåˆæ„é€ å™¨** (Failable Initializer)

### 1. **é»˜è®¤æ„é€ å™¨** (Default Initializer)
å¦‚æœä½ æ²¡æœ‰æ˜¾å¼å®šä¹‰æ„é€ å™¨ï¼ŒSwift ä¼šæä¾›ä¸€ä¸ªé»˜è®¤çš„æ„é€ å™¨ã€‚é»˜è®¤æ„é€ å™¨ä¼šä¸ºæ‰€æœ‰å­˜å‚¨å±æ€§æä¾›é»˜è®¤å€¼ï¼Œæˆ–è€…è®©å®ƒä»¬å…·æœ‰åˆå§‹å€¼ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Person {
    var name: String
    var age: Int
    
    // Swiftä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤æ„é€ å™¨
}
let person = Person() // è‡ªåŠ¨æä¾›
```

### 2. **è‡ªå®šä¹‰æ„é€ å™¨** (Custom Initializer)
ä½ å¯ä»¥æ‰‹åŠ¨å®šä¹‰åˆå§‹åŒ–æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–ç±»æˆ–ç»“æ„ä½“çš„å®ä¾‹ã€‚è‡ªå®šä¹‰æ„é€ å™¨å…è®¸ä½ åˆå§‹åŒ–å¯¹è±¡å¹¶å¯¹å±æ€§è¿›è¡Œé…ç½®ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Person {
    var name: String
    var age: Int
    
    // è‡ªå®šä¹‰æ„é€ å™¨
    init(name: String, age: Int) {
        self.name = name
        self.age = age
    }
}

let person = Person(name: "John", age: 30)
```

### 3. **ä¾¿åˆ©æ„é€ å™¨** (Convenience Initializer)
ä¾¿åˆ©æ„é€ å™¨æ˜¯ç±»ä¸­çš„è¾…åŠ©æ„é€ å™¨ï¼Œç”¨äºç®€åŒ–åˆå§‹åŒ–è¿‡ç¨‹ã€‚å®ƒé€šå¸¸ç”¨äºæä¾›æ›´ç®€æ´çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæˆ–è€…ä¸ºå·²æœ‰æ„é€ å™¨æä¾›é»˜è®¤å€¼ã€‚ä¾¿åˆ©æ„é€ å™¨éœ€è¦è°ƒç”¨æŒ‡å®šæ„é€ å™¨ï¼ˆ`designated initializer`ï¼‰ã€‚

#### ç‰¹ç‚¹ï¼š
- éœ€è¦ä½¿ç”¨ `convenience` å…³é”®å­—
- å¿…é¡»è°ƒç”¨åŒä¸€ç±»ä¸­çš„æŒ‡å®šæ„é€ å™¨ï¼ˆ`designated initializer`ï¼‰

#### ç¤ºä¾‹ï¼š
```swift
class Person {
    var name: String
    var age: Int
    
    // æŒ‡å®šæ„é€ å™¨
    init(name: String, age: Int) {
        self.name = name
        self.age = age
    }
    
    // ä¾¿åˆ©æ„é€ å™¨
    convenience init(name: String) {
        self.init(name: name, age: 18) // é»˜è®¤å¹´é¾„
    }
}

let person1 = Person(name: "John", age: 30)
let person2 = Person(name: "Alice") // ä¾¿åˆ©æ„é€ å™¨
```

### 4. **æŒ‡å®šæ„é€ å™¨** (Designated Initializer)
æŒ‡å®šæ„é€ å™¨æ˜¯ç±»ä¸­çš„ä¸»è¦æ„é€ å™¨ï¼Œè´Ÿè´£ä¸ºç±»çš„æ‰€æœ‰å±æ€§èµ‹åˆå§‹å€¼ï¼Œå¹¶è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæŒ‡å®šæ„é€ å™¨ï¼Œå®ƒå¯ä»¥æ˜¯ç›´æ¥å®šä¹‰çš„ï¼Œä¹Ÿå¯ä»¥ç”±çˆ¶ç±»æä¾›ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Animal {
    var name: String
    
    init(name: String) {
        self.name = name
    }
}

class Dog: Animal {
    var breed: String
    
    // Dog çš„æŒ‡å®šæ„é€ å™¨
    init(name: String, breed: String) {
        self.breed = breed
        super.init(name: name) // è°ƒç”¨çˆ¶ç±»æ„é€ å™¨
    }
}
```

### 5. **ç»§æ‰¿æ„é€ å™¨** (Inherited Initializer)
å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨ã€‚ç»§æ‰¿çš„æ„é€ å™¨å¯ä»¥æ˜¯æŒ‡å®šæ„é€ å™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¾¿åˆ©æ„é€ å™¨ã€‚ä½ å¯ä»¥é‡å†™è¿™äº›æ„é€ å™¨ä»¥é€‚åº”å­ç±»çš„éœ€æ±‚ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Animal {
    var name: String
    
    init(name: String) {
        self.name = name
    }
}

class Dog: Animal {
    var breed: String
    
    // ç»§æ‰¿çˆ¶ç±»çš„æ„é€ å™¨
    init(name: String, breed: String) {
        self.breed = breed
        super.init(name: name)
    }
}
```

### 6. **è¦æ±‚æ„é€ å™¨** (Required Initializer)
`required` æ„é€ å™¨æ˜¯æŒ‡å­ç±»å¿…é¡»å®ç°çš„æ„é€ å™¨ã€‚ä»»ä½•ç»§æ‰¿è¯¥ç±»çš„å­ç±»éƒ½å¿…é¡»å®ç°è¯¥æ„é€ å™¨ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Animal {
    var name: String
    
    // éœ€è¦å­ç±»å¿…é¡»å®ç°çš„æ„é€ å™¨
    required init(name: String) {
        self.name = name
    }
}

class Dog: Animal {
    var breed: String
    
    // å­ç±»å¿…é¡»å®ç°çˆ¶ç±»çš„ required æ„é€ å™¨
    required init(name: String) {
        self.breed = "Unknown"
        super.init(name: name)
    }
}
```

### 7. **èšåˆæ„é€ å™¨** (Failable Initializer)
èšåˆæ„é€ å™¨å…è®¸ä½ åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å¤±è´¥ã€‚å®ƒè¿”å›ä¸€ä¸ªå¯é€‰ç±»å‹çš„å®ä¾‹ï¼Œå¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œæ„é€ å™¨è¿”å› `nil`ã€‚å¸¸ç”¨äºåˆå§‹åŒ–å¯èƒ½å¤±è´¥çš„åœºæ™¯ï¼Œä¾‹å¦‚åŠ è½½æ•°æ®æ—¶é‡åˆ°é”™è¯¯ã€‚

#### ç¤ºä¾‹ï¼š
```swift
class Person {
    var name: String
    var age: Int
    
    // èšåˆæ„é€ å™¨
    init?(name: String, age: Int) {
        guard !name.isEmpty else { return nil }
        self.name = name
        self.age = age
    }
}

if let person = Person(name: "John", age: 30) {
    print("åˆå§‹åŒ–æˆåŠŸ")
} else {
    print("åˆå§‹åŒ–å¤±è´¥")
}
```

### æ€»ç»“ä¸åŒºåˆ«ï¼š

| æ„é€ å™¨ç±»å‹           | è¯´æ˜                                                         |
|----------------------|--------------------------------------------------------------|
| é»˜è®¤æ„é€ å™¨           | è‡ªåŠ¨ç”Ÿæˆï¼Œé€‚ç”¨äºæ‰€æœ‰å­˜å‚¨å±æ€§éƒ½æœ‰é»˜è®¤å€¼çš„æƒ…å†µã€‚                |
| è‡ªå®šä¹‰æ„é€ å™¨         | ç”±å¼€å‘è€…æ‰‹åŠ¨å®šä¹‰ï¼Œæä¾›çµæ´»çš„åˆå§‹åŒ–æ–¹å¼ã€‚                      |
| ä¾¿åˆ©æ„é€ å™¨           | è¾…åŠ©æ„é€ å™¨ï¼Œç”¨äºç®€åŒ–åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¿…é¡»è°ƒç”¨æŒ‡å®šæ„é€ å™¨ã€‚           |
| æŒ‡å®šæ„é€ å™¨           | ç±»çš„ä¸»è¦æ„é€ å™¨ï¼Œè´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰å±æ€§ï¼Œå¯èƒ½ä¼šè°ƒç”¨çˆ¶ç±»æ„é€ å™¨ã€‚     |
| ç»§æ‰¿æ„é€ å™¨           | å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»æ„é€ å™¨ã€‚                                     |
| è¦æ±‚æ„é€ å™¨           | å­ç±»å¿…é¡»å®ç°çš„æ„é€ å™¨ï¼Œç¡®ä¿ç»§æ‰¿ç±»å…·å¤‡è¯¥æ„é€ å™¨ã€‚               |
| èšåˆæ„é€ å™¨ï¼ˆFailableï¼‰| åˆå§‹åŒ–å¯èƒ½å¤±è´¥ï¼Œè¿”å›å¯é€‰ç±»å‹ `nil`ã€‚                        |

é€šè¿‡ä¸åŒçš„æ„é€ æ–¹æ³•ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„åˆå§‹åŒ–æ–¹å¼æ¥ç¡®ä¿å¯¹è±¡åˆ›å»ºçš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚


***
<br/><br/><br/>
> <h2 id="BleDeviceModelæ•°æ®æ¨¡å‹çš„å±æ€§åŒ…è£…å™¨">BleDeviceModelæ•°æ®æ¨¡å‹çš„å±æ€§åŒ…è£…å™¨</h2>

Swift çš„ **å±æ€§åŒ…è£…å™¨ï¼ˆProperty Wrapperï¼‰** é€‚åˆè¿™ç§åœºæ™¯ï¼Œæ¯”å¦‚ï¼š

* ç»™å±æ€§ä¸€ä¸ªé»˜è®¤å€¼
* è‡ªåŠ¨è¿›è¡Œåˆæ³•åŒ–ï¼ˆæ¯”å¦‚ RSSI èŒƒå›´é™å®šï¼‰
* è‡ªåŠ¨æŒä¹…åŒ–ï¼ˆæ¯”å¦‚å­˜åˆ° `UserDefaults`ï¼‰
* æ§åˆ¶åªè¯»å±æ€§

---

**1.å®šä¹‰å‡ ä¸ªå¸¸ç”¨åŒ…è£…å™¨**

```swift
import Foundation

/// æä¾›é»˜è®¤å€¼
@propertyWrapper
struct Default<Value> {
    private var value: Value
    private let defaultValue: Value
    
    init(wrappedValue: Value) {
        self.value = wrappedValue
        self.defaultValue = wrappedValue
    }
    
    var wrappedValue: Value {
        get { value }
        set { value = newValue }
    }
}

/// RSSI åŒ…è£…å™¨ï¼ˆé™åˆ¶èŒƒå›´ï¼‰
@propertyWrapper
struct RSSIValue {
    private var value: Int?
    
    var wrappedValue: Int? {
        get { value }
        set {
            if let rssi = newValue, (-100...0).contains(rssi) {
                value = rssi
            } else {
                value = nil // è¶…å‡ºèŒƒå›´åˆ™ç½®ç©º
            }
        }
    }
    
    init(wrappedValue: Int?) {
        self.wrappedValue = wrappedValue
    }
}

/// åªè¯»åŒ…è£…å™¨
@propertyWrapper
struct Readonly<Value> {
    private var value: Value
    
    init(wrappedValue: Value) {
        self.value = wrappedValue
    }
    
    var wrappedValue: Value {
        get { value }
    }
}
```

<br/>

**2.åº”ç”¨åˆ° `BleDeviceModel`**

```swift
import CoreBluetooth

struct BleDeviceModel: Codable {
    /// è“ç‰™å¤–è®¾å¯¹è±¡ï¼ˆä¸ç¼–ç ï¼‰
    var peripheral: CBPeripheral? = nil
    
    /// è“ç‰™åç§°
    @Default("") var name: String
    
    /// ä¿¡å·å¼ºåº¦ï¼ˆè‡ªåŠ¨æ ¡éªŒèŒƒå›´ï¼‰
    @RSSIValue var rssi: Int?
    
    /// UUID
    @Default("") var uuid: String
    
    /// å”¯ä¸€æ ‡è¯†ç¬¦
    @Default("") var uid: String
    
    /// æ˜¯å¦å·²æ³¨å†Œç»‘å®šï¼ˆåªè¯»ï¼‰
    @Readonly(false) var isRegistered: Bool
    
    /// æ˜¯å¦æ“ä½œï¼ˆSolicitedï¼Œåªè¯»ï¼‰
    @Readonly(false) var isSolicited: Bool
    
    /// æ˜¯å¦å¯ç»‘å®šï¼ˆåªè¯»ï¼‰
    @Readonly(false) var isEnableBind: Bool
    
    /// mac åœ°å€
    @Default("") var macAddr: String
    
    /// æ˜¯å¦è¿æ¥
    @Default(false) var isConnect: Bool
    
    /// æµç¨‹çŠ¶æ€ï¼ˆåªè¯»ï¼‰
    @Readonly(0) var processStatus: UInt8
    
    /// äº§å“ IDï¼ˆåªè¯»ï¼‰
    @Readonly(0) var productId: Int
    
    enum CodingKeys: String, CodingKey {
        case name, rssi, uuid, uid, isRegistered, isSolicited,
             isEnableBind, macAddr, isConnect, processStatus, productId
    }
}
```

<br/>

**3.ä½¿ç”¨ç¤ºä¾‹**

```swift
var device = BleDeviceModel()
device.name = "MyDevice"
device.rssi = -60   // âœ… åˆæ³•
device.rssi = -120  // âŒ è¶…å‡ºèŒƒå›´ -> è‡ªåŠ¨å˜æˆ nil

print(device.name)       // "MyDevice"
print(device.rssi)       // Optional(-60)
print(device.isRegistered) // falseï¼ˆåªè¯»ï¼‰
```

<br/>

è¿™æ ·ï¼Œä½ å°±èƒ½é€šè¿‡å±æ€§åŒ…è£…å™¨ï¼š

* `@Default` â†’ ç»™å±æ€§æä¾›é»˜è®¤å€¼ï¼Œé¿å… nil
* `@RSSIValue` â†’ è‡ªåŠ¨æ ¡éªŒæ•°å€¼èŒƒå›´
* `@Readonly` â†’ åœ¨æ¨¡å‹å¤–éƒ¨ä¸å¯ä¿®æ”¹


***
<br/><br/><br/>
> <h2 id="@UserDefaultå±æ€§åŒ…è£…å™¨">@UserDefaultå±æ€§åŒ…è£…å™¨</h2>

å†™ä¸€ä¸ªé€šç”¨çš„ `@UserDefault` å±æ€§åŒ…è£…å™¨ï¼Œè®©å±æ€§å’Œ **`UserDefaults`** è‡ªåŠ¨ç»‘å®šï¼Œè¯»å†™å±æ€§å°±ç­‰äºè¯»å†™æŒä¹…åŒ–å­˜å‚¨ã€‚

---
<br/>

**é€šç”¨å®ç°**

```swift
import Foundation

@propertyWrapper
public struct UserDefault<Value> {
    private let key: String
    private let defaultValue: Value
    private let container: UserDefaults
    
    public init(_ key: String, defaultValue: Value, container: UserDefaults = .standard) {
        self.key = key
        self.defaultValue = defaultValue
        self.container = container
    }
    
    public var wrappedValue: Value {
        get {
            return container.object(forKey: key) as? Value ?? defaultValue
        }
        set {
            container.set(newValue, forKey: key)
        }
    }
}
```

<br/>

**ä½¿ç”¨ç¤ºä¾‹**

æ¯”å¦‚åœ¨ `BleDeviceModel` é‡Œå¸Œæœ› **`macAddr`** æ°¸ä¹…ä¿å­˜ï¼š

```swift
public struct BleDeviceModel {
    public var name: String?
    public var rssi: Int?
    
    @UserDefault("macAddr", defaultValue: "")
    public var macAddr: String
}
```

<br/>

è¿™æ ·ä½¿ç”¨ï¼š

```swift
var device = BleDeviceModel()
device.macAddr = "11:22:33:44:55:66"   // âœ… è‡ªåŠ¨å†™å…¥ UserDefaults

print(device.macAddr)  // âœ… ä¸‹æ¬¡é‡å¯ App è¿˜èƒ½æ‹¿åˆ°
```

---
<br/>

**ğŸš€ è¿›é˜¶ï¼ˆæ”¯æŒ `Codable` å¯¹è±¡ï¼‰**

è‹¥æƒ³ä¿å­˜çš„ä¸æ˜¯ `String/Int/Bool`ï¼Œè€Œæ˜¯è‡ªå®šä¹‰æ¨¡å‹ï¼Œå¯ä»¥æ‰©å±•ä¸º **æ”¯æŒ `Codable`**ï¼š

```swift
@propertyWrapper
public struct CodableUserDefault<Value: Codable> {
    private let key: String
    private let defaultValue: Value
    private let container: UserDefaults
    
    public init(_ key: String, defaultValue: Value, container: UserDefaults = .standard) {
        self.key = key
        self.defaultValue = defaultValue
        self.container = container
    }
    
    public var wrappedValue: Value {
        get {
            guard let data = container.data(forKey: key) else { return defaultValue }
            return (try? JSONDecoder().decode(Value.self, from: data)) ?? defaultValue
        }
        set {
            let data = try? JSONEncoder().encode(newValue)
            container.set(data, forKey: key)
        }
    }
}
```

è¿™æ ·å°±å¯ä»¥æŒä¹…åŒ–æ•´ä¸ª `BleDeviceModel` æˆ–è€…åˆ«çš„ `Codable` æ¨¡å‹ã€‚



<br/><br/><br/>

***
<br/>

> <h1 id="æ•°ç»„">æ•°ç»„</h1>


***
<br/>
> <h2 id="ä¸€ä¸ªæ•°ç»„å¯¹è±¡å…ƒç´ idå’Œå¦ä¸€ä¸ªæ•°ç»„å¯¹è±¡ä¸­çš„ProductNoç›¸ç­‰åï¼Œå°†å…¶å¯¹è±¡å±æ€§èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡å±æ€§">ä¸€ä¸ªæ•°ç»„å¯¹è±¡å…ƒç´ idå’Œå¦ä¸€ä¸ªæ•°ç»„å¯¹è±¡ä¸­çš„ProductNoç›¸ç­‰åï¼Œå°†å…¶å¯¹è±¡å±æ€§èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡å±æ€§</h2>

**æ•°æ®ç»“æ„å¯¹è±¡ï¼š**

```swift
public struct DeviceProductInfo {
    var productNo: String
    var name: String
    var icon: String
}

public struct DeviceCategoryInfo {
    var id: Int
    var title: String
}

public struct DeviceProductSection {
    var section: DeviceCategoryInfo
    var items: [DeviceProductInfo]
}

public class SurroundingDeviceViewModel {
    var productId: String
    var displayName: String = ""
    var iconUrl: String = ""
    
    init(productId: String) {
        self.productId = productId
    }
}

```

<br/>

**åŒ¹é…å¯¹åº”ï¼š**

```swift
func mapDeviceInfoToViewModelsFast(
    dataModels: [DeviceProductSection],
    surroundingDevices: [SurroundingDeviceViewModel]
) {
    // å»ºç«‹ productNo -> DeviceProductInfo æ˜ å°„è¡¨
    let productMap = dataModels
        .flatMap { $0.items }
        .reduce(into: [String: DeviceProductInfo]()) { result, product in
            result[product.productNo] = product
        }
    
    for viewModel in surroundingDevices {
        if let product = productMap[viewModel.productId] {
            viewModel.displayName = product.name
            viewModel.iconUrl = product.icon
        }
    }
}

```

- **æ€»ç»“**
	- ä½¿ç”¨ flatMap å°†åµŒå¥—æ•°ç»„æ‹‰å¹³
	- ç”¨ first(where:) æˆ– Dictionary åŒ¹é…æ›´é«˜æ•ˆ
	- èµ‹å€¼æ—¶ç›´æ¥å¯¹ ViewModel æˆå‘˜è¿›è¡Œè®¾ç½®

<br/>

```swift
let productMap = dataModels
    .flatMap { $0.items }
    .reduce(into: [String: DeviceProductInfo]()) { result, product in
        result[product.productNo] = product
    }
```

**ä½œç”¨ï¼š**
&emsp; ä» dataModels ä¸­æå–å‡ºæ‰€æœ‰çš„ DeviceProductInfoï¼Œç„¶åæŠŠå®ƒä»¬æŒ‰ç…§ productNo å»ºç«‹æˆä¸€ä¸ªå­—å…¸ï¼Œæ–¹ä¾¿åç»­é€šè¿‡ productNo å¿«é€ŸæŸ¥æ‰¾ã€‚


å½“ç„¶å¯ä»¥ï¼Œè¿™è¡Œä»£ç æ¯”è¾ƒæµ“ç¼©ï¼Œæˆ‘ä»¬æ¥ **åˆ†æ®µè§£é‡Š** å¹¶ç»™å‡º **ç®€å•ä¾‹å­** æ¥å¸®åŠ©ä½ ç†è§£ã€‚

<br/><br/>

**1.`dataModels.flatMap { $0.items }`**

```swift
let dataModels = [
    DeviceProductSection(section: ..., items: [p1, p2]),
    DeviceProductSection(section: ..., items: [p3])
]
```

æ‰§è¡Œ `flatMap { $0.items }` åï¼š

```swift
let allProducts = [p1, p2, p3]  // å±•å¹³æˆä¸€ä¸ªæ•°ç»„
```

<br/>

**2.`.reduce(into: [:]) { result, product in ... }`**

è¿™ä¸€æ­¥æ˜¯å°† `[DeviceProductInfo]` è½¬æˆå­—å…¸ï¼š

```swift
var result: [String: DeviceProductInfo] = [:]
for product in allProducts {
    result[product.productNo] = product
}
```

<br/>

æœ€ç»ˆç»“æœæ˜¯ï¼š

```swift
[
  "abc123": DeviceProductInfo(productNo: "abc123", ...),
  "def456": DeviceProductInfo(productNo: "def456", ...)
]
```

<br/>

å‡è®¾æˆ‘ä»¬æœ‰è¿™ä¸ªç»“æ„ï¼š

```swift
struct DeviceProductInfo {
    let productNo: String
    let name: String
}

struct DeviceProductSection {
    let section: String
    let items: [DeviceProductInfo]
}
```

<br/>

ç„¶åè¿™æ ·ç”¨ï¼š

```swift
let dataModels = [
    DeviceProductSection(section: "A", items: [
        DeviceProductInfo(productNo: "p1", name: "ç¯æ³¡"),
        DeviceProductInfo(productNo: "p2", name: "ç©ºè°ƒ")
    ]),
    DeviceProductSection(section: "B", items: [
        DeviceProductInfo(productNo: "p3", name: "é£æ‰‡")
    ])
]
```


<br/>

ä½¿ç”¨é‚£ä¸€è¡Œä»£ç ï¼š

```swift
let productMap = dataModels
    .flatMap { $0.items }
    .reduce(into: [String: DeviceProductInfo]()) { result, product in
        result[product.productNo] = product
    }
```


<br/>

æœ€ç»ˆ `productMap` æ˜¯è¿™ä¸ªå­—å…¸ï¼š

```swift
[
    "p1": DeviceProductInfo(productNo: "p1", name: "ç¯æ³¡"),
    "p2": DeviceProductInfo(productNo: "p2", name: "ç©ºè°ƒ"),
    "p3": DeviceProductInfo(productNo: "p3", name: "é£æ‰‡")
]
```

<br/>

è¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡ï¼š

```swift
let fan = productMap["p3"]
```

å¿«é€Ÿæ‹¿åˆ°é£æ‰‡ä¿¡æ¯äº†ã€‚

<br/>

**æœ€åç»è¿‡ä¿®æ”¹æœ€ç»ˆçš„ä»£ç ï¼š**

```swift
// å‡è®¾ä½ å·²æœ‰çš„æ¨¡å‹
public struct DeviceProductInfo {
    public var productNo: Int?
    public var name: String
}

public struct DeviceProductSection {
    var section: String
    var items: [DeviceProductInfo]
}

// ç¤ºä¾‹æ•°æ®
let dataModels: [DeviceProductSection] = [
    .init(section: "A", items: [
        .init(productNo: 101, name: "A1"),
        .init(productNo: nil, name: "A2")
    ]),
    .init(section: "B", items: [
        .init(productNo: 202, name: "B1")
    ])
]

// æ„å»ºæ˜ å°„å…³ç³»ï¼šproductNo => DeviceProductInfo
let productMap = dataModels
    .flatMap { $0.items } // âœ… è¿™ä¸€è¡Œå¿…é¡»è¿”å›æ•°ç»„
    .compactMap { product -> (Int, DeviceProductInfo)? in
        guard let no = product.productNo else { return nil }
        return (no, product)
    }
    .reduce(into: [Int: DeviceProductInfo]()) { result, pair in
        let (no, product) = pair
        result[no] = product
    }

print(productMap)
```






***
<br/><br/><br/>
> <h2 id="æ•°ç»„çš„compactMapå’Œfilterä½¿ç”¨">æ•°ç»„çš„compactMapå’Œfilterä½¿ç”¨</h2>

 **1) æ¦‚å¿µé€Ÿè§ˆ**

* `compactMap`ï¼šå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œé—­åŒ…ï¼Œé—­åŒ…è¿”å›å¯é€‰ï¼ˆ`T?`ï¼‰ã€‚`compactMap` ä¼šæŠŠé `nil` çš„ç»“æœæ”¶é›†æˆæ–°çš„æ•°ç»„ï¼Œè‡ªåŠ¨å»æ‰ `nil` â€”â€” å¸¸ç”¨æ¥æŠŠ `String` è½¬ä¸º `Enum?` å¹¶ç§»é™¤æ— æ³•è½¬æ¢çš„é¡¹ã€‚
* `filter`ï¼šå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œå¸ƒå°”é—­åŒ…ï¼Œè¿”å› `true` çš„å…ƒç´ ä¿ç•™ï¼Œ`false` çš„å…ƒç´ ä¸¢å¼ƒã€‚

<br/>

**2)ç¤ºä¾‹**

```swift
let arr = ["1", "2", "three", "4"]

// compactMapï¼šæŠŠå­—ç¬¦ä¸²è½¬æˆ Intï¼Œè½¬æ¢å¤±è´¥çš„ä¼šå˜æˆ nilï¼ŒcompactMap ä¼šä¸¢å¼ƒ nil
let ints = arr.compactMap { Int($0) }
print(ints) // [1, 2, 4]

// filterï¼šåªä¿ç•™å¶æ•°
let evens = ints.filter { $0 % 2 == 0 }
print(evens) // [2, 4]
```

<br/>

**3) ç»„åˆä½¿ç”¨**

æƒ…å½¢ï¼šå¤–éƒ¨ä¼ æ¥ `ways: [String]`ï¼Œæƒ³æŠŠèƒ½è½¬æˆ `ProvisioningMethod` çš„é¡¹ä¿ç•™ä¸‹æ¥ï¼Œå¹¶ä¸”åªä¿ç•™ App æ”¯æŒçš„é‚£äº›æšä¸¾ã€‚

å…ˆå®šä¹‰æšä¸¾ï¼ˆä½ ä¹‹å‰çš„ï¼‰ï¼š

```swift
enum ProvisioningMethod: String {
    case ap = "AP"
    case wired = "WN"
    case ble = "BLUETOOTH"

    static var supportedMethods: [ProvisioningMethod] {
        return [.ap, .wired, .ble]
    }
}
```

<br/>

**æ–¹æ³• Aï¼šå…ˆ `compactMap` å† `filter`ï¼ˆå¸¸è§ï¼‰**

```swift
let ways = ["BLUETOOTH", "WN", "SN"]

let methods = ways
    .compactMap { str -> ProvisioningMethod? in
        return ProvisioningMethod(rawValue: str)
    }
    .filter { ProvisioningMethod.supportedMethods.contains($0) }

print(methods) // [.ble, .wired]
```

è§£é‡Šï¼š

* `compactMap` æŠŠ `"SN"` æ— æ³•è½¬æˆæšä¸¾ï¼Œä¼šè¿”å› `nil`ï¼Œè¢«ä¸¢å¼ƒã€‚
* `filter` å†ç¡®ä¿è¿™äº›æšä¸¾åœ¨ `supportedMethods` ä¸­ï¼ˆæ­¤ä¾‹éƒ½åœ¨ï¼Œæ‰€ä»¥éƒ½ä¿ç•™ï¼‰ã€‚

<br/>

**æ–¹æ³• Bï¼šå…ˆ `filter`ï¼ˆå­—ç¬¦ä¸²ä¸Šè¿‡æ»¤ï¼‰å† `compactMap`ï¼ˆå‡å°‘æšä¸¾åˆ›å»ºï¼‰**

```swift
let supportedRawValues = Set(ProvisioningMethod.supportedMethods.map { $0.rawValue }) // {"AP","WN","BLUETOOTH"}

let methods2 = ways
    .filter { supportedRawValues.contains($0) }         // å…ˆæŠŠä¸åœ¨ supportedRawValues çš„å­—ç¬¦ä¸²å»æ‰ï¼ˆå‡å°‘åç»­å·¥ä½œï¼‰
    .compactMap { ProvisioningMethod(rawValue: $0) }    // ç„¶åå†è½¬æˆæšä¸¾

print(methods2) // [.ble, .wired]
```

ä¼˜ç‚¹ï¼šå¦‚æœ `ways` å¾ˆå¤§ã€å¹¶ä¸”å¤§å¤šæ•°å­—ç¬¦ä¸²æ˜¯ä¸æ”¯æŒçš„ï¼Œç”¨ `filter` å…ˆæ·˜æ±°ä¸å¿…è¦çš„å­—ç¬¦ä¸²å¯ä»¥é¿å…å¤§é‡å¤±è´¥çš„æšä¸¾æ„é€ ï¼Œæé«˜æ€§èƒ½ã€‚

<br/>

 **4) é¡ºåºé‡è¦å—ï¼Ÿä»€ä¹ˆæ—¶å€™å…ˆ `filter` æ›´å¥½ï¼Ÿ**

* **æ­£ç¡®æ€§**ï¼šåœ¨å¤§å¤šæ•°åœºæ™¯ï¼Œ`compactMap` â†’ `filter` ä¸ `filter` â†’ `compactMap` å¾—åˆ°çš„æœ€ç»ˆç»“æœä¸€è‡´ï¼ˆå¦‚æœ `filter` çš„åˆ¤æ–­åªåŸºäºå·²è½¬æ¢åçš„æšä¸¾æˆ–åŸºäºåŸå§‹å­—ç¬¦ä¸²çš„æ”¯æŒé›†åˆï¼‰ã€‚
* **æ€§èƒ½**ï¼šå¦‚æœ `ways` å¾ˆå¤§ï¼Œä¸” `ProvisioningMethod(rawValue:)` çš„å¼€é”€ä¸ç®—æå°ï¼Œæˆ– `supported` é›†åˆå¯ä»¥ç”¨å­—ç¬¦ä¸²æ¯”è¾ƒå¿«é€Ÿç­›æ‰å¤§é‡ä¸ç›¸å…³é¡¹æ—¶ï¼Œå…ˆå¯¹å­—ç¬¦ä¸²åš `filter`ï¼ˆä½¿ç”¨ `Set`ï¼‰é€šå¸¸æ›´å¿«ã€‚
* **å¯è¯»æ€§**ï¼š`compactMap` â†’ `filter` æ›´ç›´è§‚ï¼ˆå…ˆæŠŠä¸å¯è½¬æ¢çš„å»æ‰ï¼Œå†åšä¸šåŠ¡è¿‡æ»¤ï¼‰ï¼›`filter` â†’ `compactMap` æ›´é«˜æ•ˆä½†éœ€è¦å…ˆå‡†å¤‡ `supportedRawValues`ã€‚

<br/>

**5) ç»™å‡ºçš„é‚£è¡Œä»£ç çš„æ­£ç¡®å†™æ³•ï¼ˆå®Œæ•´é—­åŒ…æ ·å¼ï¼‰**

```swift
return ways.compactMap { LinkWayType(rawValue: $0) in
            
}
```

è¿™æ˜¯ä¸æ­£ç¡®çš„å†™æ³•ï¼ˆ`compactMap` çš„é—­åŒ…è¦è¿”å›ä¸€ä¸ªå¯é€‰å€¼ï¼‰ã€‚æ­£ç¡®çš„å®Œæ•´é—­åŒ…å†™æ³•å¦‚ä¸‹ï¼š

```swift
return ways.compactMap { str -> LinkWayType? in
    // è¿™é‡Œå¯ä»¥å†™å¤æ‚é€»è¾‘ï¼Œç„¶å return æšä¸¾æˆ– nil
    return LinkWayType(rawValue: str)
}
.filter { LinkWayType.supportWays.contains($0) }
```

<br/>

å¦‚æœä½ æƒ³ç”¨æ›´ç´§å‡‘çš„ä¸€è¡Œå†™æ³•ï¼š

```swift
return ways.compactMap { LinkWayType(rawValue: $0) }
            .filter { LinkWayType.supportWays.contains($0) }
```

<br/>

æˆ–æŒ‰æ€§èƒ½ä¼˜åŒ–ï¼ˆå…ˆå­—ç¬¦ä¸²è¿‡æ»¤å†æ˜ å°„ï¼‰ï¼š

```swift
let supportedValues = Set(LinkWayType.supportWays.map { $0.rawValue })
return ways.filter { supportedValues.contains($0) }
           .compactMap { LinkWayType(rawValue: $0) }
```

<br/>

**6) ä¸ `isAppSupported` ç»“åˆçš„å®Œæ•´ç¤ºä¾‹ï¼ˆå®ç”¨ç‰ˆï¼‰**

```swift
enum LinkWayType: String {
    case none = "None"
    case ap = "AP"
    case wired = "WN"
    case ble = "BLUETOOTH"
    case wifi = "WIFI"
    case sn = "SN"

    static var supportWays: [LinkWayType] { [.ap, .wired, .ble] }
}

func isAppSupported(_ way: LinkWayType) -> Bool {
    // å‡è®¾ä½ç‰ˆæœ¬ä¸æ”¯æŒ wired
    if way == .wired { return false }
    return true
}

func supportedWaysFromDevice(ways: [String]) -> [LinkWayType] {
    // æ¨èï¼šå­—ç¬¦ä¸²å…ˆè¿‡æ»¤ï¼ˆå¿«é€Ÿï¼‰â†’ å†è½¬æ¢æˆæšä¸¾ â†’ å†ç”¨ isAppSupported è¿‡æ»¤
    let supportedRaw = Set(LinkWayType.supportWays.map { $0.rawValue })

    return ways
        .filter { supportedRaw.contains($0) }              // å…ˆæŠŠä¸åœ¨ app æ”¯æŒ raw å€¼çš„å­—ç¬¦ä¸²å»æ‰
        .compactMap { LinkWayType(rawValue: $0) }         // å†è½¬æ¢æˆæšä¸¾ï¼ˆä¸ä¼š nilï¼‰
        .filter { isAppSupported($0) }                    // æœ€ç»ˆæ’é™¤ app ç‰ˆæœ¬ä¸æ”¯æŒçš„æšä¸¾
}

// ä½¿ç”¨
let device = ["BLUETOOTH", "WN", "SN"]
let final = supportedWaysFromDevice(ways: device)
print(final) // ç»“æœå¯èƒ½åªæ˜¯ [.ble]ï¼Œå› ä¸º .wired è¢« isAppSupported æ‹’ç»
```

<br/>

**æ€»ç»“ï¼ˆå®ç”¨å»ºè®®ï¼‰**

- 1.å½“ä½ éœ€è¦æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæšä¸¾å¹¶å»æ‰æ— æ³•è½¬æ¢çš„é¡¹ï¼Œä½¿ç”¨ `compactMap`ã€‚
- 2.å½“ä½ éœ€è¦åŸºäºæŸä¸ªæ¡ä»¶ç­›é€‰å…ƒç´ ï¼Œä½¿ç”¨ `filter`ã€‚
- 3.è‹¥å…³å¿ƒæ€§èƒ½ï¼šè‹¥èƒ½åœ¨å­—ç¬¦ä¸²å±‚é¢ç”¨ `Set` å¿«é€Ÿå‰”é™¤å¤§é‡ä¸å¯èƒ½çš„é¡¹ï¼Œå…ˆ `filter`ï¼ˆå­—ç¬¦ä¸²ï¼‰å† `compactMap`ï¼ˆæšä¸¾ï¼‰é€šå¸¸æ›´å¿«ã€‚
- 4.å¯è¯»æ€§ï¼šå…ˆ `compactMap` å† `filter` å†™æ³•æ›´ç›´è§‚ï¼Œé€‚åˆæ•°æ®é‡å°æˆ–æ¸…æ™°å±•ç¤ºé€»è¾‘ã€‚
- 5.ä½ ç»™çš„é‚£è¡Œä»£ç åº”æ”¹æˆ `compactMap { str -> LinkWayType? in return LinkWayType(rawValue: str) }` æˆ–ç›´æ¥ `compactMap { LinkWayType(rawValue: $0) }`ï¼Œç„¶åé“¾ `filter`ã€‚



***
<br/><br/><br/>
> <h2 id="æ•°ç»„mapã€firstæ–¹æ³•è¯¦è§£">æ•°ç»„mapã€firstæ–¹æ³•è¯¦è§£</h2>


**`map` æ˜¯ä»€ä¹ˆï¼Ÿ**

> **å¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åšå¤„ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„**

åƒâ€œæ‰¹é‡åŠ å·¥â€ã€‚

<br/>

ä¾‹å­ï¼šæ‰€æœ‰æ•°å­— * 2

```swift
let numbers = [1, 2, 3]
let doubled = numbers.map { $0 * 2 }
print(doubled)  // [2, 4, 6]
```

ğŸ“Œå«ä¹‰ï¼š

| åŸæ•°ç»„ | å¤„ç†å |
| --- | --- |
| 1   | 2   |
| 2   | 4   |
| 3   | 6   |

<br/>

**ä¾‹å­ï¼šæå–å¯¹è±¡ä¸­çš„å­—æ®µ**

```swift
struct User { let name: String }

let users = [User(name: "Tom"), User(name: "Jerry")]
let names = users.map { $0.name }
print(names)  // ["Tom", "Jerry"]
```
<br/>

**`first(where:)` æ˜¯ä»€ä¹ˆï¼Ÿ**

> åœ¨æ•°ç»„é‡Œ **æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ **ï¼ˆæ‰¾ä¸åˆ°è¿”å› nilï¼‰

åƒâ€œä»åå•é‡Œæ‰¾äººâ€ã€‚

<br/>

**ğŸ“Œä¾‹å­ï¼šæŸ¥æ‰¾å¤§äº 3 çš„ç¬¬ä¸€ä¸ªæ•°**

```swift
let numbers = [1, 2, 4, 3, 5]
let result = numbers.first(where: { $0 > 3 })
print(result) // 4
```

<br/>

**ğŸ“Œä¾‹å­ï¼šæŸ¥æ‰¾æŒ‡å®š id çš„è®¾å¤‡**

```swift
struct Device { let id: Int }

let list = [Device(id: 1), Device(id: 2)]
let match = list.first(where: { $0.id == 2 })
print(match?.id ?? "Not found") // 2
```

<br/>

```swift
return list.map { element in
    if let match = data.first(where: { $0.iotId == element.iotId }) {
        return match  // æ‰¾åˆ°äº† â†’ ç”¨ data çš„æ–°æ•°æ®æ›¿æ¢
    }
    return element    // æ‰¾ä¸åˆ° â†’ åŸæ ·è¿”å›
}
```

ğŸ“Œé€»è¾‘æ€»ç»“ï¼š

* `map`ï¼šå¯¹ `list` æ¯ä¸ªè®¾å¤‡è¿›è¡Œæ›´æ–°æ£€æŸ¥
* `first(where:)`ï¼šæŸ¥æ‰¾ `data` ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ›´æ–°æ•°æ®

---

# ğŸ¯ç›´è§‚ç†è§£è¡¨æ ¼

| æ–¹æ³•              | ä½œç”¨         | è¾“å…¥ | è¾“å‡º      | å¸¸ç”¨åœºæ™¯               |
| --------------- | ---------- | -- | ------- | ------------------ |
| `map`           | æ‰¹é‡åŠ å·¥æ•°æ®     | æ•°ç»„ | æ–°æ•°ç»„     | UI Model è½¬æ¢ã€æ›´æ–°æ•´ä¸ªåˆ—è¡¨ |
| `first(where:)` | æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ª | æ•°ç»„ | å…ƒç´ æˆ– nil | æ ¹æ® id æŸ¥æ‰¾ã€å»é‡ã€åŒ¹é…è“ç‰™è®¾å¤‡ |


<br/><br/><br/>
> <h2 id="contains(where:)ä½¿ç”¨">contains(where:)ä½¿ç”¨</h2>

**â€œæœ€åŸå§‹çš„ for å¾ªç¯â€ç†è§£é€»è¾‘**

å‡è®¾æ¨¡å‹ï¼š

```swift
class UpgradeDeviceInfo {
    var iotId: String?
    var channel: Int?

    init(iotId: String?, channel: Int?) {
        self.iotId = iotId
        self.channel = channel
    }
}
```

<br/>

æ•°æ®ï¼š

```swift
let list = [
    UpgradeDeviceInfo(iotId: "A", channel: 1),
    UpgradeDeviceInfo(iotId: "B", channel: 1)
]

let data = [
    UpgradeDeviceInfo(iotId: "A", channel: 1), // åŒ¹é…
    UpgradeDeviceInfo(iotId: "B", channel: 2)  // channel ä¸åŒ
]
```

<br/>


**ç”¨ for å¾ªç¯â€œæ‰‹å†™**

```swift
for element in list {
    var found = false

    for item in data {
        if item.iotId == element.iotId &&
           item.channel == element.channel {
            found = true
            break
        }
    }

    if found {
        print("æ‰¾åˆ°åŒ¹é…çš„")
    } else {
        print("æ²¡æ‰¾åˆ°")
    }
}
``` äºŒ**`contains(where:)` æ˜¯ä¸Šé¢ä»£ç çš„â€œå‡½æ•°å¼`**# å†™æ³•

```swift
let exists = data.contains { item in
    item.iotId == element.iotId &&
    item.channel == element.channel
}
```

### å®ƒç­‰ä»·äºä»€ä¹ˆï¼Ÿ

ç­‰ä»·äºï¼š

> **data é‡Œâ€œæ˜¯å¦å­˜åœ¨â€è‡³å°‘ä¸€ä¸ªå…ƒç´ ï¼Œä½¿å¾—é—­åŒ…è¿”å› true**

ä¸€æ—¦è¿”å› `true`ï¼Œ`contains` **ç«‹åˆ»åœæ­¢éå†**ã€‚

---

## ä¸‰ã€ä¸€ä¸ªæœ€å°å¯è¿è¡Œ demoï¼ˆé‡ç‚¹ï¼‰

```swift
let devices = [
    UpgradeDeviceInfo(iotId: "A", channel: 1),
    UpgradeDeviceInfo(iotId: "B", channel: 2)
]

let target = UpgradeDeviceInfo(iotId: "A", channel: 1)

let result = devices.contains { device in
    device.iotId == target.iotId &&
    device.channel == target.channel
}

print(result) // true
```

### é€æ­¥ç†è§£

1. `contains` å¼€å§‹éå† `devices`
2. ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š

   * `"A" == "A"` âœ…
   * `1 == 1` âœ…
   * é—­åŒ…è¿”å› `true`
3. `contains` ç«‹åˆ»è¿”å› `true`

---

## å››ã€`first(where:)` å’Œ `contains(where:)` çš„åŒºåˆ«ï¼ˆä¸€çœ‹å°±æ‡‚ï¼‰

### `contains(where:)`

> **åªå…³å¿ƒâ€œæœ‰æ²¡æœ‰â€**

```swift
let exists = data.contains {
    $0.iotId == element.iotId &&
    $0.channel == element.channel
}
```

è¿”å›å€¼ï¼š`Bool`

---

### `first(where:)`

> **æˆ‘è¦â€œé‚£ä¸ªå¯¹è±¡æœ¬èº«â€**

```swift
let match = data.first {
    $0.iotId == element.iotId &&
    $0.channel == element.channel
}
```

è¿”å›å€¼ï¼š
`UpgradeDeviceInfo?`

---

## äº”ã€å›åˆ°ä½ æœ€åˆçš„å‡½æ•°ï¼ˆå®Œæ•´ demoï¼‰

```swift
func updateListWithData(
    list: [UpgradeDeviceInfo],
    data: [UpgradeDeviceInfo]
) -> [UpgradeDeviceInfo] {

    return list.map { element in
        data.first {
            $0.iotId == element.iotId &&
            $0.channel == element.channel
        } ?? element
    }
}
```

### è°ƒç”¨æ–¹å¼

```swift
let result = updateListWithData(list: list, data: data)
```

### ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

* `("A", 1)` â†’ è¢« `data` ä¸­çš„æ–°å¯¹è±¡æ›¿æ¢
* `("B", 1)` â†’ å› ä¸ºæ²¡åŒ¹é…ä¸Šï¼Œä¿ç•™åŸå¯¹è±¡

---

## å…­ã€ä¸€å¥è¯è®°ä½å®ƒä»¬

* `contains(where:)`
  ğŸ‘‰ **â€œæœ‰æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ï¼Ÿâ€**
* `first(where:)`
  ğŸ‘‰ **â€œç»™æˆ‘ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ â€**
* é—­åŒ…é‡Œçš„ä»£ç 
  ğŸ‘‰ **å°±æ˜¯ä½ ä»¥å‰å†™åœ¨ if é‡Œçš„åˆ¤æ–­æ¡ä»¶**

---

## ä¸ƒã€ä½ å¯ä»¥è¿™æ ·ç»ƒä¹ ï¼ˆéå¸¸æ¨èï¼‰

```swift
let numbers = [1, 3, 5, 7]

let hasEven = numbers.contains { $0 % 2 == 0 }
print(hasEven) // false

let firstGreaterThan4 = numbers.first { $0 > 4 }
print(firstGreaterThan4) // Optional(5)
```

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠ **`map / filter / contains / first`** ç”¨ä¸€å¼ â€œå¯¹ç…§ for å¾ªç¯è¡¨â€å¸®ä½ å½»åº•åƒé€ï¼Œä¹‹åä½ çœ‹ Swift ä»£ç ä¼šéå¸¸è½»æ¾ã€‚





<br/><br/><br/>

***
<br/>

> <h1 id="Dictionary">Dictionary</h1>

<br/>

> <h2 id="æŒ‰æŒ‡å®šå­—æ®µåˆ†ç»„">æŒ‰æŒ‡å®šå­—æ®µåˆ†ç»„</h2>

```json
result = (
	{
		errorMesg = "";
		channel = 0;
		currentVersionName = "0.1";
		status = 0;
		upgradeType = 0;
		iotId = "fe11111";
		versionName = "0.03";
		copywriting = "ç‰ˆæœ¬0.1";
		percentage = 0;
		
	},
	{
		errorMesg = "";
		channel = 9;
		currentVersionName = "3.0.0_0002";
		status = 0;
		upgradeType = 0;
		iotId = "ab22222";
		versionName = "3.0.0_0012";
		copywriting =  "ç‰ˆæœ¬0.2";
		percentage = 1;
	}

);
```
<br/>

```swift
let grouped = Dictionary(grouping: list, by: { $0.iotId })
```
<br/>

å®ƒä¼šæŠŠåŸæ¥çš„æ•°ç»„ **æŒ‰æŒ‡å®šå­—æ®µåˆ†ç»„**ã€‚

> å°±æ˜¯â€œæŠŠç›¸åŒ iotId çš„å›ºä»¶å…¨éƒ¨æ”¾ä¸€èµ·â€ã€‚

æ¯”å¦‚ä½ çš„ `result` æ•°ç»„æ˜¯ï¼š

| iotId | channel | versionName |
| ----- | ------- | ----------- |
| A     | 0       | v001        |
| A     | 9       | v002        |
| B     | 1       | v005        |

æ‰§è¡Œåï¼š

```swift
grouped == [
    "A": [ç¬¬ä¸€ä¸ªå›ºä»¶, ç¬¬äºŒä¸ªå›ºä»¶],
    "B": [ç¬¬ä¸‰ä¸ªå›ºä»¶]
]
```

å˜æˆäº† **å­—å…¸**ï¼š

* key = iotIdï¼ˆç›¸åŒçš„æ”¾ä¸€ä¸ª key ä¸‹ï¼‰
* value = å¯¹åº”çš„å›ºä»¶æ•°ç»„

<br/>

## ğŸ“Œ æœ‰å•¥ç”¨ï¼Ÿ

å› ä¸ºä½ éœ€è¦ â€”â€”

> å°† result ä¸­ **iotId ç›¸åŒçš„æ•°æ®åˆå¹¶å¤„ç†**
> ï¼ˆç‰ˆæœ¬å·æ‹¼æ¥/æ–‡æ¡ˆåˆå¹¶/è¿›åº¦åˆå¹¶ï¼‰

å¦‚æœä¸åˆ†ç»„çš„è¯ï¼Œä½ å°±æ²¡åŠæ³•çŸ¥é“å“ªäº›å›ºä»¶å±äºåŒä¸€ä¸ª **è®¾å¤‡**ã€‚

<br/>

ä½ æœ‰ 10 ä¸ªå­¦ç”Ÿæˆç»©æ•°æ®ï¼š

| å§“å | ç§‘ç›® | æˆç»© |
| -- | -- | -- |
| å¼ ä¸‰ | æ•°å­¦ | 90 |
| å¼ ä¸‰ | è‹±è¯­ | 88 |
| æå›› | è¯­æ–‡ | 80 |

ä½ æƒ³æŠŠåŒä¸€ä¸ªå­¦ç”Ÿçš„æ•°æ®æ”¾ä¸€èµ·ï¼š

```swift
let grouped = Dictionary(grouping: students, by: { $0.name })
```

ç»“æœå°±æ˜¯ğŸ‘‡

```
"å¼ ä¸‰": [æ•°å­¦90, è‹±è¯­88]
"æå››": [è¯­æ–‡80]
```

ä¹‹åä½ å°±èƒ½ç®—å¹³å‡åˆ†ã€æ€»åˆ†ç­‰ â€”â€”
**è¿™ä¸ªåˆ†ç»„å°±æ˜¯ä¸ºäº†åé¢å¥½å¤„ç†ã€‚**

<br/>

| åŠŸèƒ½                       | æè¿°                          |
| ------------------------ | --------------------------- |
| Dictionary(grouping:by:) | è®©æ•°ç»„æŒ‰æŒ‡å®šå±æ€§åˆ†ç±»æˆå­—å…¸               |
| è§£å†³é—®é¢˜                     | æŠŠå±äºåŒä¸€å°è®¾å¤‡ï¼ˆç›¸åŒ iotIdï¼‰çš„å¤šä¸ªå›ºä»¶æ±‡æ€»å¤„ç† |

> æ²¡æœ‰å®ƒï¼Œä½ å°±ä¸çŸ¥é“å“ªäº›æ•°æ®æ˜¯åŒä¸€è®¾å¤‡æ¥çš„
> å°±ä¸èƒ½åšä½ çš„åˆå¹¶é€»è¾‘å’Œè¿›åº¦è®¡ç®—







<br/><br/><br/>

***
<br/>

> <h1 id="ç±»">ç±»</h1>
> <h2 id="æµå¼API">æµå¼API</h2>

```
public func asObser() -> SonClass<Element> { self }
```
&emsp; è¿™ä¸ªæ–¹æ³• **è¿”å›å½“å‰å®ä¾‹æœ¬èº«**ï¼Œé€šå¸¸ç”¨äº **æµå¼ API è®¾è®¡**ï¼Œè®©è°ƒç”¨è€…å¯ä»¥ç»§ç»­æ“ä½œ `SonClass` å®ä¾‹ã€‚  

<br/>

- **ğŸŒŸ ç¤ºä¾‹ï¼šå°è£…ä¸€ä¸ªæ•°æ®å¤„ç†ç±»**
	- 1.**`SonClass<Element>`** è´Ÿè´£å­˜å‚¨æ•°æ®ï¼Œå¹¶æ”¯æŒæµå¼è°ƒç”¨ã€‚  
	- 2.**`asObser()` è¿”å›è‡ªèº«**ï¼Œç”¨äºé“¾å¼è°ƒç”¨ï¼Œè®©è°ƒç”¨æ›´æµç•…ã€‚  

---

- **ğŸŒ ä»£ç ç¤ºä¾‹**

```swift
// 1ï¸âƒ£ å®šä¹‰ SonClassï¼Œæ”¯æŒæ³›å‹
class SonClass<Element> {
    var value: Element
    
    init(value: Element) {
        self.value = value
    }
    
    // 2ï¸âƒ£ è¿”å›è‡ªèº«ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
    public func asObser() -> SonClass<Element> {
        self  // ç›´æ¥è¿”å›å½“å‰å®ä¾‹
    }
    
    // 3ï¸âƒ£ ç¤ºä¾‹æ–¹æ³•ï¼Œä¿®æ”¹ value å¹¶è¿”å›è‡ªèº«
    public func updateValue(_ newValue: Element) -> SonClass<Element> {
        self.value = newValue
        return self  // ç»§ç»­è¿”å›è‡ªèº«ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
    }
}

// 4ï¸âƒ£ åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨ asObser()
let obj = SonClass(value: 10)
    .asObser()
    .updateValue(20)  // æ›´æ–°å€¼
    .asObser()  // ç»§ç»­é“¾å¼è°ƒç”¨

print(obj.value)  // è¾“å‡ºï¼š20
```

---

- **ğŸ“Œ ä»£ç è§£æ**
	- 1.**`SonClass<Element>`**ï¼š
		- å­˜å‚¨æ³›å‹ `value`ï¼Œå¯ä»¥å¤„ç†ä»»æ„ç±»å‹çš„æ•°æ®ã€‚
	- 2.**`asObser()`**ï¼š
		- ç›´æ¥è¿”å› `self`ï¼Œç”¨äºæ”¯æŒæµå¼ APIã€‚
	- 3.**`updateValue(_:)`**ï¼š
		- ä¿®æ”¹ `value` åï¼Œç»§ç»­è¿”å› `self`ï¼Œè®©è°ƒç”¨è€…å¯ä»¥ç»§ç»­æ“ä½œã€‚
	- 4.**é“¾å¼è°ƒç”¨æ•ˆæœ**ï¼š
		- `SonClass(value: 10).asObser().updateValue(20).asObser()`  

---
- **âœ… é€‚ç”¨åœºæ™¯**
	- **RxSwift é£æ ¼ API è®¾è®¡**ï¼š`Observable`ã€`Observer`  
	- **Builder æ¨¡å¼**ï¼šæµå¼é…ç½®å¯¹è±¡å±æ€§  
	- **é“¾å¼æ•°æ®å¤„ç†**ï¼šå¦‚ JSON è§£æã€UI é…ç½®

<br/><br/><br/>

***
<br/>

> <h1 id="å±æ€§">å±æ€§</h1>
> <h2 id="å±æ€§åŒ…è£…å™¨">å±æ€§åŒ…è£…å™¨</h2>

[å±æ€§åŒ…è£…](https://juejin.cn/post/6844904202834034696#heading-11)

**Swift å±æ€§åŒ…è£…å™¨ï¼ˆProperty Wrappersï¼‰è§£æ**

å±æ€§åŒ…è£…å™¨ï¼ˆ`@propertyWrapper`ï¼‰æ˜¯ **Swift 5.1** å¼•å…¥çš„ä¸€é¡¹å¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å°è£…å±æ€§çš„**é€»è¾‘**ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€æ˜“è¯»ï¼Œå¹¶é¿å…é‡å¤ä»£ç ã€‚

---

- **1.ä»£ç è§£æ**

```swift
@propertyWrapper
struct TwelveOrLess {
    private var number = 0  // ç§æœ‰å­˜å‚¨å˜é‡ï¼Œé»˜è®¤å€¼ä¸º 0
    var wrappedValue: Int {  // é€šè¿‡ wrappedValue è®¿é—®å’Œä¿®æ”¹å€¼
        get { return number } 
        set { number = min(newValue, 12) }  // è®¾å®šå€¼æ—¶ï¼Œé™åˆ¶æœ€å¤§å€¼ä¸º 12
    }
}
```
- **ğŸ”¹ `@propertyWrapper` å…³é”®ç‚¹**
1. `TwelveOrLess` æ˜¯ä¸€ä¸ª **å±æ€§åŒ…è£…å™¨**ï¼Œå®ƒé™åˆ¶ `wrappedValue` çš„æœ€å¤§å€¼ä¸º `12`ã€‚
2. `wrappedValue`ï¼š
   - **`get` è¯»å–å€¼** â†’ è¿”å› `number`
   - **`set` èµ‹å€¼æ—¶** â†’ é™åˆ¶æœ€å¤§å€¼ä¸º `12`
3. **å­˜å‚¨å˜é‡ `number` é»˜è®¤å€¼ä¸º `0`**ã€‚

---

## **2. ä½¿ç”¨å±æ€§åŒ…è£…å™¨**

```swift
struct SmallRectangle {
    @TwelveOrLess var height: Int
    @TwelveOrLess var width: Int
}
```
### **ğŸ”¹ ä½œç”¨**
1. **åœ¨ `SmallRectangle` ç»“æ„ä½“ä¸­**ï¼Œ`height` å’Œ `width` ç°åœ¨éƒ½ä½¿ç”¨ `@TwelveOrLess` ä½œä¸ºå±æ€§åŒ…è£…å™¨ã€‚
2. **è‡ªåŠ¨é™åˆ¶èµ‹å€¼**ï¼š
   - `height = 10` âœ… â†’ å­˜å‚¨ 10
   - `height = 24` âŒ â†’ è¶…è¿‡ 12ï¼Œå®é™…å­˜å‚¨ **12**

---

## **3. è¿è¡Œç¤ºä¾‹**

```swift
var rectangle = SmallRectangle()
print(rectangle.height)  // 0ï¼ˆé»˜è®¤å€¼ï¼‰

rectangle.height = 10
print(rectangle.height)  // 10

rectangle.height = 24
print(rectangle.height)  // 12ï¼ˆè¶…å‡ºé™åˆ¶ï¼Œè¢«ä¿®æ”¹ä¸º 12ï¼‰
```

### **ğŸ”¹ è¿è¡Œç»“æœ**

```
0
10
12
```
**è§£é‡Šï¼š**
- é»˜è®¤ `height = 0`
- èµ‹å€¼ `10`ï¼Œç¬¦åˆæ¡ä»¶ï¼ŒæˆåŠŸå­˜å‚¨
- èµ‹å€¼ `24`ï¼Œè¶…è¿‡ `12`ï¼Œè¢« `min(24, 12)` é™åˆ¶ä¸º `12`

---

## **4. `@TwelveOrLess` åº•å±‚å®ç°**
åœ¨ `SmallRectangle` ç»“æ„ä½“ä¸­ï¼š

```swift
struct SmallRectangle {
    @TwelveOrLess var height: Int
}
```
å®é™…ä¸Š Swift **ä¼šè‡ªåŠ¨æ‰©å±•** ä»£ç ä¸ºï¼š

```swift
struct SmallRectangle {
    private var _height = TwelveOrLess()  // å±æ€§åŒ…è£…å™¨å®ä¾‹
    var height: Int {
        get { _height.wrappedValue }
        set { _height.wrappedValue = newValue }
    }
}
```
ğŸ”¹ **Swift è‡ªåŠ¨ç®¡ç† `wrappedValue`ï¼Œå¼€å‘è€…åªéœ€ç®€å•å£°æ˜ `@TwelveOrLess`ã€‚**

---

## **5. è¿›é˜¶ï¼šæä¾›é»˜è®¤å€¼**
æˆ‘ä»¬å¯ä»¥å…è®¸ç”¨æˆ·è®¾ç½®**é»˜è®¤å€¼**ï¼š

```swift
@propertyWrapper
struct TwelveOrLess {
    private var number: Int
    var wrappedValue: Int {
        get { return number }
        set { number = min(newValue, 12) }
    }
    
    // è‡ªå®šä¹‰åˆå§‹åŒ–ï¼Œå…è®¸è®¾ç½®é»˜è®¤å€¼
    init(wrappedValue: Int) {
        self.number = min(wrappedValue, 12)
    }
}
```
**ä½¿ç”¨æ–¹å¼ï¼š**

```swift
struct SmallRectangle {
    @TwelveOrLess var height: Int = 8  // é»˜è®¤å€¼ 8
    @TwelveOrLess var width: Int = 15  // 15 è¶…å‡ºé™åˆ¶ï¼Œå®é™…å­˜å‚¨ 12
}

let rectangle = SmallRectangle()
print(rectangle.height) // 8
print(rectangle.width)  // 12ï¼ˆ15 è¶…å‡ºé™åˆ¶ï¼‰
```
**è§£é‡Šï¼š**
- `height` èµ‹å€¼ `8`ï¼Œç¬¦åˆé™åˆ¶ï¼Œå­˜å‚¨ `8`
- `width` èµ‹å€¼ `15`ï¼Œè¶…è¿‡ `12`ï¼Œè¢« `min(15, 12)` é™åˆ¶ä¸º `12`

---

## **6. è¿›é˜¶ï¼šä½¿ç”¨ `projectedValue`**

`projectedValue` æä¾›**é¢å¤–åŠŸèƒ½**ï¼Œå…è®¸è®¿é—®å†…éƒ¨çŠ¶æ€ï¼š

```swift
@propertyWrapper
struct TwelveOrLess {
    private var number = 0
    var wrappedValue: Int {
        get { return number }
        set { number = min(newValue, 12) }
    }

    var projectedValue: String {
        return "å½“å‰å€¼: \(number)"
    }
}

struct SmallRectangle {
    @TwelveOrLess var height: Int
}

var rect = SmallRectangle()
rect.height = 9
print(rect.$height)  // è¾“å‡º "å½“å‰å€¼: 9"
```
### **ğŸ”¹ å…³é”®ç‚¹**
1. `projectedValue` è¿”å›é¢å¤–çš„ä¿¡æ¯ï¼ˆå½“å‰å€¼ï¼‰ã€‚
2. é€šè¿‡ `$height` è®¿é—® **`projectedValue`**ã€‚

---

## **7. æ€»ç»“**
âœ… **`@propertyWrapper` å¯ä»¥å°è£…å±æ€§é€»è¾‘ï¼Œæé«˜ä»£ç å¤ç”¨æ€§**  
âœ… **`wrappedValue` æ§åˆ¶å±æ€§çš„å­˜å–è¡Œä¸º**  
âœ… **å¯ä»¥ä½¿ç”¨ `init(wrappedValue:)` è®¾ç½®é»˜è®¤å€¼**  
âœ… **å¯ä»¥ä½¿ç”¨ `projectedValue` è®¿é—®é¢å¤–ä¿¡æ¯**  

ğŸš€ **ç¤ºä¾‹æœ€ç»ˆä¼˜åŒ–ç‰ˆæœ¬**

```swift
@propertyWrapper
struct TwelveOrLess {
    private var number: Int
    var wrappedValue: Int {
        get { return number }
        set { number = min(newValue, 12) }
    }
    
    var projectedValue: String {
        return "å½“å‰å€¼: \(number)"
    }

    init(wrappedValue: Int) {
        self.number = min(wrappedValue, 12)
    }
}

struct SmallRectangle {
    @TwelveOrLess var height: Int = 8
    @TwelveOrLess var width: Int = 15
}

var rect = SmallRectangle()
print(rect.height)  // 8
print(rect.width)   // 12ï¼ˆ15 è¶…å‡ºé™åˆ¶ï¼‰
print(rect.$height) // "å½“å‰å€¼: 8"
```


<br/><br/><br/>
> <h2 id="å±æ€§åŒ…è£…å™¨ä¸­çš„projectedValueå‘ˆç°å€¼">å±æ€§åŒ…è£…å™¨ä¸­çš„ `projectedValue`ï¼ˆå‘ˆç°å€¼ï¼‰</h2>

### **Swift å±æ€§åŒ…è£…å™¨ä¸­çš„ `projectedValue`ï¼ˆå‘ˆç°å€¼ï¼‰è¯¦è§£**
åœ¨ Swift **å±æ€§åŒ…è£…å™¨** (`@propertyWrapper`) ä¸­ï¼Œé™¤äº† `wrappedValue` ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ **`projectedValue`** æ¥æä¾›é¢å¤–çš„ä¿¡æ¯æˆ–åŠŸèƒ½ã€‚

---

## **1. `projectedValue` åŸºæœ¬æ¦‚å¿µ**
- **`wrappedValue`**ï¼šå­˜å–å±æ€§çš„å€¼ï¼ˆå¿…é¡»å®ç°ï¼‰ã€‚
- **`projectedValue`**ï¼ˆå‘ˆç°å€¼ï¼‰ï¼šæä¾›é¢å¤–çš„å€¼æˆ–åŠŸèƒ½ï¼Œé€šå¸¸ç”¨ `self` æˆ–å…¶ä»–æ´¾ç”Ÿå€¼è¿”å›ã€‚

**è¯­æ³•ï¼š**

```swift
@propertyWrapper
struct WrapperExample {
    var wrappedValue: Int  // ä¸»è¦å­˜å‚¨çš„å€¼
    var projectedValue: String {  // é¢å¤–çš„å‘ˆç°å€¼
        return "å½“å‰å€¼: \(wrappedValue)"
    }
}
```
**è®¿é—®æ–¹å¼ï¼š**
- ç›´æ¥è®¿é—®å±æ€§ï¼š`instance.property` è·å– `wrappedValue`
- é€šè¿‡ **`$property`** è®¿é—® `projectedValue`

---

## **2. ä¸¾ä¸ªä¾‹å­ï¼šè‡ªåŠ¨è®°å½•ä¿®æ”¹æ¬¡æ•°**
### **ğŸ”¹ ä»£ç ç¤ºä¾‹**

```swift
@propertyWrapper
struct TrackedValue {
    private var value: Int = 0
    private(set) var updateCount: Int = 0  // è®°å½•å€¼è¢«ä¿®æ”¹çš„æ¬¡æ•°
    
    var wrappedValue: Int {
        get { value }
        set {
            value = newValue
            updateCount += 1
        }
    }
    
    var projectedValue: String {
        return "å€¼å·²ä¿®æ”¹ \(updateCount) æ¬¡"
    }
}

struct Example {
    @TrackedValue var number: Int
}

var example = Example()

example.number = 5
example.number = 10
example.number = 15

print(example.number)   // è¾“å‡º: 15
print(example.$number)  // è¾“å‡º: "å€¼å·²ä¿®æ”¹ 3 æ¬¡"
```

---

## **3. ä»£ç è¯¦è§£**
### **(1) `TrackedValue` ç»“æ„ä½“**

```swift
@propertyWrapper
struct TrackedValue {
    private var value: Int = 0
    private(set) var updateCount: Int = 0  
```
- `value` å­˜å‚¨å®é™…å€¼ï¼Œé»˜è®¤ `0`ã€‚
- `updateCount` è®°å½•**å€¼è¢«ä¿®æ”¹çš„æ¬¡æ•°**ï¼Œé»˜è®¤ `0`ã€‚

### **(2) `wrappedValue`**

```swift
var wrappedValue: Int {
    get { value }
    set {
        value = newValue
        updateCount += 1  // æ¯æ¬¡ä¿®æ”¹å¢åŠ è®¡æ•°
    }
}
```
- è¯»å–æ—¶è¿”å› `value`ã€‚
- èµ‹å€¼æ—¶ **å¢åŠ  `updateCount` è®°å½•ä¿®æ”¹æ¬¡æ•°**ã€‚

### **(3) `projectedValue`**

```swift
var projectedValue: String {
    return "å€¼å·²ä¿®æ”¹ \(updateCount) æ¬¡"
}
```
- **è¿”å›ä¸€ä¸ª `String`**ï¼Œæ˜¾ç¤ºå€¼è¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚

---

## **4. `projectedValue` å¦‚ä½•ä½¿ç”¨**
åœ¨ `Example` ç»“æ„ä½“ä¸­ï¼š

```swift
struct Example {
    @TrackedValue var number: Int
}
```
ç­‰ä»·äºï¼š

```swift
struct Example {
    private var _number = TrackedValue()
    var number: Int {
        get { _number.wrappedValue }
        set { _number.wrappedValue = newValue }
    }
    var $number: String {
        return _number.projectedValue
    }
}
```
- ç›´æ¥è®¿é—® `example.number` è®¿é—® `wrappedValue`
- é€šè¿‡ `$number` è®¿é—® `projectedValue`

---

## **5. `projectedValue` çš„å®é™…åº”ç”¨**
### **(1) è®°å½•ç”¨æˆ·è¾“å…¥**

```swift
@propertyWrapper
struct TrackedString {
    private var value: String = ""
    private(set) var history: [String] = []

    var wrappedValue: String {
        get { value }
        set {
            history.append(newValue)
            value = newValue
        }
    }

    var projectedValue: [String] {
        return history
    }
}

struct User {
    @TrackedString var name: String
}

var user = User()
user.name = "Alice"
user.name = "Bob"
user.name = "Charlie"

print(user.name)     // è¾“å‡º: Charlie
print(user.$name)    // è¾“å‡º: ["Alice", "Bob", "Charlie"]
```
**è§£é‡Šï¼š**
- æ¯æ¬¡ä¿®æ”¹ `name`ï¼Œéƒ½ä¼šæŠŠæ—§å€¼å­˜å…¥ `history`ã€‚
- `projectedValue` è¿”å› **ä¿®æ”¹å†å²**ã€‚
- é€šè¿‡ `$name` è®¿é—®ç”¨æˆ·æ‰€æœ‰è¾“å…¥çš„å†å²ã€‚

---

## **6. ç»“è®º**
âœ… **`wrappedValue`** æ˜¯**ä¸»å±æ€§**ï¼Œæ§åˆ¶å­˜å‚¨å’Œè®¿é—®ã€‚  
âœ… **`projectedValue`** ç”¨ `$` è®¿é—®ï¼Œæä¾›**é¢å¤–åŠŸèƒ½**ï¼ˆå¦‚ä¿®æ”¹æ¬¡æ•°ã€å†å²è®°å½•ï¼‰ã€‚  
âœ… `projectedValue` å¯ä»¥è¿”å› **å…¶ä»–æ•°æ®ç±»å‹**ï¼ˆå¦‚ `String`ã€`Array`ã€`Bool`ï¼‰ã€‚  
âœ… **ä½¿ç”¨åœºæ™¯ï¼š**
   - **è®°å½•å±æ€§ä¿®æ”¹æ¬¡æ•°**
   - **æä¾›é¢å¤–åŠŸèƒ½ï¼ˆæ—¥å¿—ã€å†å²è®°å½•ï¼‰**
   - **ç®€åŒ–é€»è¾‘ï¼ˆå¦‚è¾“å…¥éªŒè¯ã€è‡ªåŠ¨ä¿®æ­£ï¼‰**  







<br/><br/><br/>

***
<br/>
># <h1 id='å€¼å¼•ç”¨ç±»å‹'>å€¼å¼•ç”¨ç±»å‹</h1>

```
class SwiftClass {
    var name: String?
    var height = 0.0
    var width = 0.0
    
    var description: String {
        return "ResolutionClass(height: \(height), width: \(width))"
    }
    
    func printString(alert: String) -> Void {
        print("\(alert)")
    }
}

struct SwiftStruct {
    var height = 0.0
    var width = 0.0
}
```

<br/><br/><br/>
><h2 id='å¼•ç”¨ç±»å‹'>å¼•ç”¨ç±»å‹</h2>
<br/>
><h3 id='å¼•ç”¨ç±»å‹ä½¿ç”¨intoutå‚æ•°ï¼Œæ„ä¹‰ä¸å¤§'>å¼•ç”¨ç±»å‹ä½¿ç”¨intoutå‚æ•°ï¼Œæ„ä¹‰ä¸å¤§</h3>

```
func swap(clss: inout SwiftClass) {
    //æ‰“å°å¼•ç”¨ç±»å‹å˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€
    print("During calling: \(Unmanaged.passUnretained(clss).toOpaque())")
    let temp = clss.height
    clss.height = clss.width
    clss.width = temp
}


sc.height = 1080
sc.width = 1920
print(sc)
print("Before calling: \(Unmanaged.passUnretained(sc).toOpaque())")
swap(clss: &sc)
print(sc)
print("After calling: \(Unmanaged.passUnretained(sc).toOpaque())")
```

æ‰“å°ï¼š

```
SwiftTest.SwiftClass

Before calling: 0x000000010284b5d0

During calling: 0x000000010284b5d0

SwiftTest.SwiftClass

After calling: 0x000000010284b5d0
```

<br/><br/>
<h3 id='ä½¿ç”¨intoutæ³¨æ„äº‹é¡¹'>ä½¿ç”¨intoutæ³¨æ„äº‹é¡¹ï¼š</h3>

- ä½¿ç”¨ inout å…³é”®å­—çš„å‡½æ•°ï¼Œåœ¨è°ƒç”¨æ—¶éœ€è¦åœ¨è¯¥å‚æ•°å‰åŠ ä¸Š & ç¬¦å·;
- inout å‚æ•°åœ¨ä¼ å…¥æ—¶å¿…é¡»ä¸ºå˜é‡ï¼Œä¸èƒ½ä¸ºå¸¸é‡æˆ–å­—é¢é‡ï¼ˆliteralï¼‰;

```
//å¸¸é‡ä½¿ç”¨å…³é”®å­— let æ¥å£°æ˜
æ ¼å¼ï¼šlet constantName = <initial value>
å¦‚ï¼šlet constA = 42

//å­—é¢é‡ï¼šå°±æ˜¯æŒ‡èƒ½å¤Ÿç›´æ¥äº†å½“åœ°æŒ‡å‡ºè‡ªå·±çš„ç±»å‹å¹¶ä¸ºå˜é‡è¿›è¡Œèµ‹å€¼çš„å€¼ï¼Œä¸å¸¸é‡æ— å¼‚ã€‚
//å­—ç¬¦ä¸²å‹å­—é¢å¸¸é‡
let name = "DevZhang"
```


<br/><br/>
> <h3 id='inoutå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸èƒ½ä¸ºå¯å˜å‚æ•°'>inout å‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ï¼Œä¸èƒ½ä¸ºå¯å˜å‚æ•°</h3>

```
//å¯å˜å‚æ•°ï¼Œæœ‰å¤šä¸ªå‚æ•°ç”¨çœç•¥å·è¡¨ç¤º
func add(a:Int, b:Int ,others:Int ...) -> Int {
	var result = a + b
	
	for num in others {
		result += num
	}
    return result
}

let number = add(2, b: 5, others: 2, 50, 4)
print(number)  //63
```

-  inout å‚æ•°ä¸ç­‰åŒäºå‡½æ•°è¿”å›å€¼ï¼Œæ˜¯ä¸€ç§ä½¿å‚æ•°çš„ä½œç”¨åŸŸè¶…å‡ºå‡½æ•°ä½“çš„æ–¹å¼
-  å¤šä¸ª inout å‚æ•°ä¸èƒ½åŒæ—¶ä¼ å…¥åŒä¸€ä¸ªå˜é‡ï¼Œå› ä¸ºæ‹·å…¥æ‹·å‡ºçš„é¡ºåºä¸å®šï¼Œé‚£ä¹ˆæœ€ç»ˆå€¼ä¹Ÿä¸èƒ½ç¡®å®š

<br/>

```
struct Point {
    var x = 0.0
    var y = 0.0
}

struct Rectangle {
    var width = 0.0
    var height = 0.0
    var origin = Point()
    
    var center: Point {
        get {
            print("center GETTER call")
            return Point(x: origin.x + width / 2,
                         y: origin.y + height / 2)
        }
        
        set {
            print("center SETTER call")
            origin.x = newValue.x - width / 2
            origin.y = newValue.y - height / 2
        }
    }
    
    func reset(center: inout Point) {
        center.x = 0.0
        center.y = 0.0
    }
    
}

var rect = Rectangle(width: 100, height: 100, origin: Point(x: -100, y: -100))
print("rect.center å€¼ï¼š\(rect.center)\n")
rect.reset(center: &rect.center)
print("rect.center é‡ç½®åçš„å€¼ï¼š\(rect.center)")

```

æ‰“å°ï¼š

```
center GETTER call
rect.center å€¼ï¼šPoint(x: -50.0, y: -50.0)

center GETTER call
center SETTER call
center GETTER call
rect.center é‡ç½®åçš„å€¼ï¼šPoint(x: 0.0, y: 0.0)
```

<br/><br/>
<h3 id='inoutå‚æ•°ä¼ é€’è¿‡ç¨‹'>inout å‚æ•°ä¼ é€’è¿‡ç¨‹</h3>

-  å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå‚æ•°å€¼è¢«æ‹·è´
-  åœ¨å‡½æ•°ä½“å†…ï¼Œè¢«æ‹·è´çš„å‚æ•°ä¿®æ”¹
-  å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ‹·è´çš„å‚æ•°å€¼è¢«èµ‹å€¼ç»™åŸæœ‰çš„å˜é‡

&emsp;  å®˜æ–¹ç§°è¿™ä¸ªè¡Œä¸ºä¸ºï¼šcopy-in copy-out æˆ– call by value resultã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ KVO æˆ–è®¡ç®—å±æ€§æ¥è·Ÿè¸ªè¿™ä¸€è¿‡ç¨‹ï¼Œè¿™é‡Œä»¥è®¡ç®—å±æ€§ä¸ºä¾‹ã€‚æ’é™¤åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰ä¸ä¹‹åçš„ center GETTER callï¼Œä»ä¸­å¯ä»¥å‘ç°ï¼šå‚æ•°å€¼å…ˆè¢«è·å–åˆ°ï¼ˆsetter è¢«è°ƒç”¨ï¼‰ï¼Œæ¥ç€è¢«è®¾å€¼ï¼ˆsetter è¢«è°ƒç”¨ï¼‰ã€‚

&emsp;  æ ¹æ® inout å‚æ•°çš„ä¼ é€’è¿‡ç¨‹ï¼Œå¯ä»¥å¾—çŸ¥ï¼šinout å‚æ•°çš„æœ¬è´¨ä¸å¼•ç”¨ç±»å‹çš„ä¼ å‚å¹¶ä¸æ˜¯åŒä¸€å›äº‹ã€‚inout å‚æ•°æ‰“ç ´äº†å…¶ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯ä¸€ä¸ªå¯å˜æµ…æ‹·è´ã€‚åœ¨ Swift 3.0 ä¸­ï¼Œä¹Ÿå½»åº•æ‘’é™¤äº†åœ¨é€ƒé€¸é—­åŒ…ï¼ˆEscape Closureï¼‰ä¸­è¢«æ•è·ã€‚


<br/><br/><br/>
> <h2 id='åµŒå¥—ç±»å‹'>åµŒå¥—ç±»å‹</h2>
<br/>
> <h3 id='å€¼ç±»å‹åµŒå¥—å€¼ç±»å‹'>å€¼ç±»å‹åµŒå¥—å€¼ç±»å‹</h3>


<br/><br/>
> <h3 id='å€¼ç±»å‹åµŒå¥—å¼•ç”¨ç±»å‹'>å€¼ç±»å‹åµŒå¥—å¼•ç”¨ç±»å‹</h3>




<br/><br/>
> <h3 id='å¼•ç”¨ç±»å‹åµŒå¥—å€¼ç±»å‹'>å¼•ç”¨ç±»å‹åµŒå¥—å€¼ç±»å‹</h3>




<br/><br/><br/>

***
<br/>
># <h1 id='æšä¸¾'>æšä¸¾</h1>

```
enum WeekDay {

   case Monday

   case Tuesday

   case Wednesday

   case Thursday

   case Friday

   case Saturday

   case Sunday

}
```

<br/>

```
func enumTest () {
    let day:WeekDay = .Wednesday

    switch day {
    case .Wednesday:
        print("ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰")
        
    case .Saturday:
        print(":)")
        
    case .Sunday:
        print(":)")
        
    default:  //ä½¿ç”¨æšä¸¾è¡¨ç¤ºæ¥è¡¨ç¤ºå…¶å®ƒçš„é€‰é¡¹ï¼Œå¦åˆ™ç¼–è¯‘can't é€šè¿‡
        print(":(")
     
    }
}

//è°ƒç”¨
self.enumTest()
```

æ‰“å°ï¼š

```
ä»Šå¤©æ˜¯æ˜ŸæœŸä¸‰
```

&emsp;  ä½†æ˜¯è¿™æ ·ä¼šæŠ¥å‡ºä¸€ä¸ªä¸‘é™‹çš„é»„è‰²è­¦å‘Šâš ï¸:`Switch condition evaluates to a constant`ï¼Œè¿™å¯èƒ½æ˜¯ç¼–è¯‘å™¨è®¤ä¸ºå˜é‡åœ¨å‡½æ•°å†…éƒ¨æ˜¯ä¸å˜é€ æˆçš„ã€‚å¯ä»¥æŠŠè¿™ä¸ªå˜é‡ä½œä¸ºç±»çš„å¸¸é‡å±æ€§å°±ä¸ä¼šæŠ¥é”™äº†ã€‚

```
class ViewController: UIViewController {
      let day:WeekDay = .Wednesday
}
```

&emsp;  å¦‚æœæ²¡æœ‰`default`æˆ‘ä»¬éœ€è¦æŠŠæšä¸¾çš„æ¯ä¸€é¡¹éƒ½è¦åˆ—ä¸¾å‡ºæ¥ï¼Œå¦åˆ™ä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ç”¨defaultæ¥è¿›è¡Œå·æ‡’ï¼Œæ¥è¡¨ç¤ºå…¶ä»–caseæƒ…å†µã€‚



<br/>
<br/>


> <h2 id='æšä¸¾åŸå§‹å€¼'>æšä¸¾åŸå§‹å€¼</h2>


**`æšä¸¾åŸå§‹å€¼:`** æ¯ä¸€ä¸ªæšä¸¾é¡¹æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™ä¸ªé»˜è®¤å€¼æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ç¡®å®šçš„ã€‚

```
enum WeekDayWithRaw : String {  //åé¢æœ‰ä¸€ä¸ªStringï¼Œè¡¨ç¤ºæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æšä¸¾
 
    case Monday = "1. Monday"

    case Tuesday = "2. Tuesday"

    case Wednesday = "3. Wednesday"

    case Thursday = "4. Thursday"

    case Friday = "5. Friday"

    case Saturday = "6. Saturday"

    case Sunday = "7. Sunday"
 
}
```

<br/>

é€šè¿‡åŸå§‹å€¼è¿›è¡Œåˆå§‹åŒ–ï¼š

```
let day = WeekDayWithRaw(rawValue: "3. Wednesday") //æ˜¯ä¸€ä¸ªå¯é€‰çš„æšä¸¾,ä¹Ÿå°±æ˜¯Optionals çš„ç±»å‹
       
if let tday = day {
   print("è¿™ä¸ª day æ˜¯ï¼š \(tday)")
}else{
   print("init fail")
}

```
æ‰“å°

```
è¿™ä¸ª day æ˜¯ï¼š Wednesday
```

<br/>

æšä¸¾è¾“å‡º

```
let day = WeekDayWithRaw.Saturday.rawValue
print("è¿™ä¸ª day æ˜¯ï¼š \(day)")
```

æ‰“å°ï¼š

```
è¿™ä¸ª day æ˜¯ï¼š 6. Saturday
```

<br/>

åˆå§‹åŒ–ä¸å­˜åœ¨çš„å€¼ï¼Œç”¨å¯é€‰åˆ¤å®š

```
let day = WeekDayWithRaw(rawValue: "No Exist Value")
if let thisDay = day {
    print("this day is: \(thisDay)")
}else {
    print("ä¸çŸ¥æ˜¯ä½•å¹´ä½•æœˆ")
}
```


<br/><br/>
> <h2 id='æšä¸¾å…³è”å€¼'>æšä¸¾å…³è”å€¼</h2>
**`å…³è”å€¼`ï¼š** æšä¸¾çš„æšä¸¾é¡¹æ¯ä¸€ä¸ªéƒ½æœ‰é™„åŠ ä¿¡æ¯ï¼Œæ¥æ‰©å……è¿™ä¸ªæšä¸¾é¡¹çš„ä¿¡æ¯è¡¨ç¤º,å¦‚ä¸‹ï¼š

```
//å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºå­¦ç”Ÿç±»å‹çš„æšä¸¾ç±»å‹ StudentTypeï¼Œä»–æœ‰ä¸‰ä¸ªæˆå‘˜åˆ†åˆ«æ˜¯pupilã€middleSchoolStudentã€collegeStudents
enum StudentType {
    case pupil(String)
    case middleSchoolStudent(Int, String)
    case collegeStudents(Int, String)
}
```

<br/>

è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸ºStudentTypeçš„æˆå‘˜æä¾›å…·ä½“çš„å€¼ï¼Œè€Œæ˜¯ä¸ºä»–ä»¬ç»‘å®šäº†ä¸åŒçš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯pupilç»‘å®šStringç±»å‹ã€middleSchoolStudentå’ŒcollegeStudentsç»‘å®šï¼ˆIntï¼Œ Stringï¼‰å…ƒç¥–ç±»å‹ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºä¸åŒStudentTypeæšä¸¾å®ä¾‹å¹¶ä¸ºå¯¹åº”çš„æˆå‘˜èµ‹å€¼äº†ã€‚

```
//student1 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºpupilï¼ˆå°å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯"have fun"ï¼ˆæ€»æ˜¯åœ¨ç©è€ï¼‰
let student1 = StudentType.pupil("have fun")

//student2 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºmiddleSchoolStudentï¼ˆä¸­å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯ 7, "always study"ï¼ˆä¸€å‘¨7å¤©æ€»æ˜¯åœ¨å­¦ä¹ ï¼‰
let student2 = StudentType.middleSchoolStudent(7, "always study")

//student3 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºcollegeStudentï¼ˆå¤§å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯ 7, "always LOL"ï¼ˆä¸€å‘¨7å¤©æ€»æ˜¯åœ¨æ’¸å•Šæ’¸ï¼‰
let student3 = StudentType.middleSchoolStudent(7, "always LOL")
```

<br/>

è¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦åˆ¤æ–­æŸä¸ªStudentTypeå®ä¾‹çš„å…·ä½“çš„å€¼å°±éœ€è¦è¿™æ ·åšäº†ï¼š

```
switch student3 {
      case .pupil(let things):
          print("is a pupil and \(things)")
      case .middleSchoolStudent(let day, let things):
          print("is a middleSchoolStudent and \(day) days \(things)")
      case .collegeStudent(let day, let things):
          print("is a collegeStudent and \(day) days \(things)")
    }
```  
æ§åˆ¶å°è¾“å‡ºï¼š

```
is a collegeStudent and 7 days always LOL
```


&emsp; çœ‹åˆ°è¿™ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ˜¯å¦å¯ä»¥ä¸ºä¸€ä¸ªæšä¸¾æˆå‘˜æä¾›åŸå§‹å€¼å¹¶ä¸”ç»‘å®šç±»å‹å‘¢ï¼Œç­”æ¡ˆæ˜¯ä¸èƒ½çš„ï¼

&emsp; å› ä¸ºé¦–å…ˆç»™æˆå‘˜æä¾›äº†å›ºå®šçš„åŸå§‹å€¼ï¼Œé‚£ä»–ä»¥åå°±ä¸èƒ½æ”¹å˜äº†ï¼›

&emsp; è€Œä¸ºæˆå‘˜æä¾›å…³è”å€¼(ç»‘å®šç±»å‹)å°±æ˜¯ä¸ºäº†åˆ›å»ºæšä¸¾å®ä¾‹çš„æ—¶å€™èµ‹å€¼ã€‚è¿™ä¸æ˜¯äº’ç›¸çŸ›ç›¾å—ã€‚


<br/><br/><br/>
> <h2 id="æšä¸¾èŒƒå‹è°ƒç”¨">æšä¸¾èŒƒå‹è°ƒç”¨</h2>

-  **ğŸ”¹ ä»£ç ç¤ºä¾‹**

```swift
import Foundation

// 1ï¸âƒ£ å®šä¹‰ Event æšä¸¾
enum Event<Element> {
    case next(Element)
    case error(Error)
    case completed
}

// 2ï¸âƒ£ AppleClass è´Ÿè´£äº‹ä»¶å¤„ç†
class AppleClass<Element> {
    private var isStopped = false  // æ˜¯å¦å·²ç»åœæ­¢
    
    // 3ï¸âƒ£ è§¦å‘ .completed äº‹ä»¶
    public func onCompleted() {
        self.on(.completed)  // è°ƒç”¨ on(_ event:) æ–¹æ³•
    }

    // 4ï¸âƒ£ å¤„ç†äº‹ä»¶
    func on(_ event: Event<Element>) {
        switch event {
        case .next(let value):
            print("ğŸ”¹ å¤„ç† next äº‹ä»¶: \(value)")
            self.forwardOn(event)
        case .error(let err):
            print("âŒ å‘ç”Ÿé”™è¯¯: \(err)")
            if fetchOr(&isStopped, true) == false {
                self.forwardOn(event)
            }
        case .completed:
            print("âœ… å¤„ç† completed äº‹ä»¶")
            if fetchOr(&isStopped, true) == false {
                self.forwardOn(event)
            }
        }
    }

    // 5ï¸âƒ£ å®é™…å¤„ç†äº‹ä»¶
    func forwardOn(_ event: Event<Element>) {
        print("â¡ï¸ äº‹ä»¶å·²è½¬å‘: \(event)")
    }
}

// 6ï¸âƒ£ åŸå­æ“ä½œæ¨¡æ‹Ÿ (fetchOr)
func fetchOr(_ value: inout Bool, _ newValue: Bool) -> Bool {
    let oldValue = value
    value = newValue
    return oldValue
}

// 7ï¸âƒ£ æµ‹è¯•è°ƒç”¨ onCompleted()
let apple = AppleClass<String>()
apple.onCompleted()

```

- **ğŸ”¹ è¿è¡Œç»“æœ**

```
âœ… å¤„ç† completed äº‹ä»¶
â¡ï¸ äº‹ä»¶å·²è½¬å‘: completed
```

---

>**ğŸ”¹ ä»£ç è§£æ:**
1. **å®šä¹‰ `Event<Element>` æšä¸¾**ï¼š
   - äº‹ä»¶ç±»å‹åŒ…æ‹¬ `.next(Element)`ã€`.error(Error)` å’Œ `.completed`ã€‚
2. **åœ¨ `AppleClass` å†…éƒ¨**ï¼š
   - `onCompleted()` **è§¦å‘ `.completed` äº‹ä»¶** â†’ è°ƒç”¨ `on(.completed)`
   - `on(_ event:)` å¤„ç†äº‹ä»¶ï¼š
     - `next(value)` ç›´æ¥è°ƒç”¨ `forwardOn(_:)`
     - `error(err)` å’Œ `completed` **åªä¼šæ‰§è¡Œä¸€æ¬¡**ï¼Œé˜²æ­¢é‡å¤è§¦å‘
   - `forwardOn(_:)` è´Ÿè´£æœ€ç»ˆçš„äº‹ä»¶å¤„ç†ï¼ˆå¦‚ä¼ é€’ç»™ä¸‹æ¸¸ï¼‰
3. **`fetchOr` ä½œç”¨**ï¼š
   - é˜²æ­¢ `.completed` å’Œ `.error` äº‹ä»¶å¤šæ¬¡è§¦å‘ï¼ˆ`isStopped` åªèƒ½ä» `false` å˜ `true`ï¼Œä¸ä¼šå˜å›å»ï¼‰ã€‚
4. **æµ‹è¯• `apple.onCompleted()`**ï¼š
   - `onCompleted()` è§¦å‘ `.completed` â†’ `on(_ event:)` å¤„ç† â†’ `forwardOn(_ event:)` **è½¬å‘äº‹ä»¶**ã€‚

---
>**ğŸ”¹ é€‚ç”¨åœºæ™¯**
- **äº‹ä»¶æµ**ï¼šå¦‚ `RxSwift` ä¸­ `Observer` å¤„ç† `.completed` äº‹ä»¶
- **æ•°æ®æµç®¡ç†**ï¼šé¿å… `.completed` æˆ– `.error` äº‹ä»¶è¢«é‡å¤è§¦å‘
- **å¼‚æ­¥ä»»åŠ¡æ§åˆ¶**ï¼šé˜²æ­¢ä»»åŠ¡å®Œæˆåå¤šæ¬¡å›è°ƒ

***
<br/><br/><br/>
> <h2 id="æšä¸¾è¿ç®—">æšä¸¾è¿ç®—</h2>

| æšä¸¾æˆå‘˜                    | äºŒè¿›åˆ¶        | åè¿›åˆ¶ |
| ----------------------- | ---------- | --- |
| `functionA`             | `00000001` | 1   |
| `functionB`             | `00000010` | 2   |
| `functionC`             | `00000100` | 4   |
| `functionA + functionC` | `00000101` | 5   |

<br/>

- **âœ… ä¸€ã€ä½¿ç”¨ `enum` + æ‰‹åŠ¨ä½è¿ç®—ç»„åˆç¤ºä¾‹**

```swift
enum DisplacementFunction: UInt8, CaseIterable, CustomStringConvertible {
    case none      = 0
    case functionA = 1 << 0  // 00000001 = 1
    case functionB = 1 << 1  // 00000010 = 2
    case functionC = 1 << 2  // 00000100 = 4

    var description: String {
        switch self {
        case .none: return "None"
        case .functionA: return "Function A"
        case .functionB: return "Function B"
        case .functionC: return "Function C"
        }
    }
}
```

- **ğŸ“ è§£è¯»ï¼š**
	- RawValue æ˜¯ UInt8ï¼Œä»£è¡¨äºŒè¿›åˆ¶æ ‡å¿—ã€‚

	- ç”¨ä½ç§» 1 << n åˆ†åˆ«è®¾ç½®æ¯ä¸ªåŠŸèƒ½çš„å”¯ä¸€ä½ã€‚

	- .description æ˜¯ç»™äººçœ‹çš„åå­—ã€‚

<br/>

- **âœ… äºŒã€å®šä¹‰ç»„åˆç±»å‹ï¼ˆæ‰‹åŠ¨ç»„åˆ `UInt8`ï¼‰**

```swift
struct DisplacementFunctionSet: CustomStringConvertible {
    private(set) var rawValue: UInt8 = 0

    init(_ functions: [DisplacementFunction]) {
        for function in functions {
            rawValue |= function.rawValue  // ç”¨æˆ–è¿ç®—ç´¯åŠ 
        }
    }

    func contains(_ function: DisplacementFunction) -> Bool {
        return (rawValue & function.rawValue) != 0  // åˆ¤æ–­æŸä½æ˜¯å¦è¢«è®¾ç½®
    }

    mutating func insert(_ function: DisplacementFunction) {
        rawValue |= function.rawValue  // æ·»åŠ åŠŸèƒ½
    }

    mutating func remove(_ function: DisplacementFunction) {
        rawValue &= ~function.rawValue // ç§»é™¤åŠŸèƒ½
    }

    var description: String {
        if rawValue == 0 { return "None" }
        return DisplacementFunction.allCases
            .filter { $0 != .none && self.contains($0) }
            .map { $0.description }
            .joined(separator: ", ")
    }
    
    // è¿™æ˜¯16è¿›åˆ¶çš„äºŒè¿›åˆ¶æ˜¾ç¤º
    var binaryString: String {
        let bin = String(rawValue, radix: 2)
        return String(repeating: "0", count: 16 - bin.count) + bin
    }
}
```

- **ğŸ“ è§£è¯»ï¼š**
	- rawValue æ˜¯å½“å‰çš„ç»„åˆçŠ¶æ€ï¼Œä¾‹å¦‚å€¼ä¸º 5 å°±ä»£è¡¨ A+Cã€‚

	- insert() é€šè¿‡æˆ–è¿ç®— | æ·»åŠ åŠŸèƒ½ã€‚

	- remove() é€šè¿‡ä¸åç  & ~ ç§»é™¤åŠŸèƒ½ã€‚

	- contains() æ£€æŸ¥åŠŸèƒ½æ˜¯å¦åŒ…å«ã€‚

---
<br/>

- **âœ… ä¸‰ã€ä½¿ç”¨ç¤ºä¾‹**

```swift
var activeFunctions = DisplacementFunctionSet([.functionA, .functionC])

print("å¯ç”¨åŠŸèƒ½: \(activeFunctions)") // è¾“å‡º: å¯ç”¨åŠŸèƒ½: Function A, Function C
print("åŸå§‹å€¼: \(activeFunctions.rawValue)") // è¾“å‡º: åŸå§‹å€¼: 5

// åˆ¤æ–­åŠŸèƒ½
if activeFunctions.contains(.functionB) {
    print("åŒ…å« B")
} else {
    print("ä¸åŒ…å« B")
}

// æ·»åŠ åŠŸèƒ½ B
activeFunctions.insert(.functionB)
print("æ·»åŠ å: \(activeFunctions)") // è¾“å‡º: Function A, Function B, Function C
```

---

- **âœ… å››ã€é¢å¤–è¯´æ˜**

	* ä½ ä½¿ç”¨ `enum` çš„å¥½å¤„æ˜¯ç±»å‹å®‰å…¨ã€å¯æšä¸¾ã€‚
	* `DisplacementFunctionSet` å°±æ˜¯ä½ çš„ç»„åˆç»“æ„ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç®€æ˜“ç‰ˆ `OptionSet`ã€‚
	* åŸå§‹å€¼æ“ä½œ `rawValue` æ˜¯ `UInt8`ï¼Œæ”¯æŒæœ€å¤š 8 ä¸ªåŠŸèƒ½ã€‚

---

- **âœ… äº”ã€å®Œæ•´è¾“å‡ºç¤ºä¾‹**

```swift
let combination = DisplacementFunctionSet([.functionA, .functionC])
print("ç»„åˆåŠŸèƒ½å€¼: \(combination.rawValue)")      // è¾“å‡º: 5
print("åŠŸèƒ½åˆ—è¡¨: \(combination)")                // è¾“å‡º: Function A, Function C
```


***
<br/><br/><br/>
> <h2 id="äºŒè¿›åˆ¶æšä¸¾ä½ç§»æ©ç åŸç†ç»†è§£">äºŒè¿›åˆ¶æšä¸¾ä½ç§»æ©ç åŸç†ç»†è§£</h2>

-  **äºŒè¿›åˆ¶æ©ç ä½** å¦‚ä½•å®ç°çš„ï¼Ÿ

åŠŸèƒ½ç»„åˆæ˜¯é€šè¿‡ **æ¯ä¸ªåŠŸèƒ½ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„â€œäºŒè¿›åˆ¶ä½â€** æ¥è¡¨ç¤ºæ˜¯å¦å¯ç”¨ã€‚æˆ‘ä»¬ä½¿ç”¨ `UInt8`ï¼ˆ8 ä½æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œæ¯ä¸€ä½éƒ½å¯ä»¥è¡¨ç¤ºä¸€ä¸ªåŠŸèƒ½ï¼š

```
UInt8 çš„æ¯ä¸ªä½ï¼š

ä½ç´¢å¼•:  7 6 5 4 3 2 1 0
å€¼:      128 64 32 16 8 4 2 1
```

---

**âœ… ç¤ºä¾‹ï¼šå®šä¹‰åŠŸèƒ½æ©ç ï¼ˆbitmaskï¼‰**

| åŠŸèƒ½å         | è¡¨ç¤ºä½        | äºŒè¿›åˆ¶        | åè¿›åˆ¶ |
| ----------- | ---------- | ---------- | --- |
| `functionA` | bit 0      | `00000001` | 1   |
| `functionB` | bit 1      | `00000010` | 2   |
| `functionC` | bit 2      | `00000100` | 4   |
| ç»„åˆ A + C    | bits 0+2   | `00000101` | 5   |
| å…¨éƒ¨åŠŸèƒ½ï¼ˆABCï¼‰   | bits 0+1+2 | `00000111` | 7   |

---
<br/>

- **ğŸ”§ åŸç†è§£é‡Šï¼šæ©ç  + æŒ‰ä½è¿ç®—**

	- **âœ… 1. æ·»åŠ åŠŸèƒ½ï¼ˆOR `|=`ï¼‰**

```swift
rawValue |= function.rawValue
```

* ç¤ºä¾‹ï¼šå·²æœ‰ `00000100`ï¼ˆfunctionCï¼‰
* æ’å…¥ `.functionA`ï¼ˆå€¼æ˜¯ `00000001`ï¼‰
* è¿ç®—åç»“æœï¼š`00000100 | 00000001 = 00000101`ï¼ˆA+Cï¼‰

<br/>

- **âœ… 2. åˆ¤æ–­åŠŸèƒ½æ˜¯å¦å­˜åœ¨ï¼ˆAND `&`ï¼‰**

```swift
(rawValue & function.rawValue) != 0
```

* å½“å‰çŠ¶æ€ï¼š`00000101`ï¼ˆA+Cï¼‰
* æ£€æŸ¥æ˜¯å¦åŒ…å« `functionA`ï¼ˆ`00000001`ï¼‰
* `00000101 & 00000001 = 00000001` â‰  0 â†’ è¡¨ç¤ºåŒ…å«

<br/>

- **âœ… 3. ç§»é™¤åŠŸèƒ½ï¼ˆAND åç  `& ~`ï¼‰**

```swift
rawValue &= ~function.rawValue
```

* å½“å‰çŠ¶æ€ï¼š`00000101`ï¼ˆA+Cï¼‰
* ç§»é™¤ `functionA`ï¼ˆåç æ˜¯ `11111110`ï¼‰
* `00000101 & 11111110 = 00000100` â†’ åªå‰© C

<br/>

- **ğŸ¯ ä¸ºä»€ä¹ˆæ©ç ä½å¯ä»¥ç»„åˆå¤šä¸ªåŠŸèƒ½ï¼Ÿ**

å› ä¸ºæ¯ä¸€ä¸ªåŠŸèƒ½åªå ä¸€ä½ï¼ˆbitï¼‰ï¼Œä¸ä¼šé‡å ï¼Œæ‰€ä»¥ä½ å¯ä»¥**ç”¨ä¸€ä¸ªæ•´æ•°åŒæ—¶è¡¨ç¤ºå¤šä¸ªåŠŸèƒ½**æ˜¯å¦å¼€å¯ï¼š

```swift
// åŒæ—¶æ‰“å¼€ A + C
rawValue = functionA.rawValue | functionC.rawValue // = 1 | 4 = 5
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç”¨ä½è¿ç®—çš„æšä¸¾ï¼ˆæˆ–è€… `OptionSet`ï¼‰å¯ä»¥è½»æ¾è¡¨è¾¾ç»„åˆçŠ¶æ€çš„æ ¸å¿ƒåŸç†ã€‚

---

- **âœ… ä¸¾ä¾‹ï¼šæ©ç ä½è¡¨ç¤ºæ³•å¯æ‰©å±•åˆ°å‡ ä½ï¼Ÿ**

	* `UInt8`ï¼šæœ€å¤š 8 ä¸ªåŠŸèƒ½ï¼ˆä½¿ç”¨ 8 ä½ï¼‰
	* `UInt16`ï¼šæœ€å¤š 16 ä¸ªåŠŸèƒ½
	* `UInt32`ï¼šæœ€å¤š 32 ä¸ªåŠŸèƒ½
	* `UInt64`ï¼šæœ€å¤š 64 ä¸ªåŠŸèƒ½

å¯ä»¥ä¿®æ”¹æšä¸¾åŸå§‹å€¼ç±»å‹æ¥æ”¯æŒæ›´å¤šåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š

```swift
enum MyFunction: UInt16 { ... } // æ”¯æŒæœ€å¤š 16 ä¸ªåŠŸèƒ½
```

<br/>

- **ğŸ§ª è¡¥å……è°ƒè¯•å‡½æ•°ï¼ˆæ‰“å°äºŒè¿›åˆ¶ï¼‰**

ä¸ºäº†æ›´æ¸…æ™°åœ°çœ‹åˆ°æ¯ä¸ªç»„åˆçš„æ©ç ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªå·¥å…·å‡½æ•°æ¥æ‰“å° rawValue çš„äºŒè¿›åˆ¶ï¼š

```swift
extension DisplacementFunctionSet {
    var binaryString: String {
        let binary = String(rawValue, radix: 2)
        return String(repeating: "0", count: 8 - binary.count) + binary
    }
}
```

ä½¿ç”¨ï¼š

```swift
print("å½“å‰åŠŸèƒ½äºŒè¿›åˆ¶: \(functionSet.binaryString)") 
// è¾“å‡º: å½“å‰åŠŸèƒ½äºŒè¿›åˆ¶: 00000101 ï¼ˆè¡¨ç¤º functionA + functionCï¼‰
```

---

**âœ… æ€»ç»“ä¸€ä¸‹**

| æ“ä½œ    | å¯¹åº”ä½è¿ç®—                        | ä½œç”¨è¯´æ˜       |          |
| ----- | ---------------------------- | ---------- | -------- |
| æ·»åŠ åŠŸèƒ½  | \`                           | =\`        | æŠŠæŸä½è®¾ç½®ä¸º 1 |
| æ£€æŸ¥åŠŸèƒ½  | `&`                          | æ£€æŸ¥æŸä½æ˜¯å¦ä¸º 1  |          |
| ç§»é™¤åŠŸèƒ½  | `& ~`                        | æŠŠæŸä½æ¸…é›¶ï¼ˆç½® 0ï¼‰ |          |
| åŠŸèƒ½ç»„åˆ  | å¤šä¸ª \`                        | \`         | å¤šåŠŸèƒ½åˆæˆä¸€ä¸ªå€¼ |
| äºŒè¿›åˆ¶è¡¨ç¤º | `String(rawValue, radix: 2)` | ç›´è§‚æ˜¾ç¤ºæ©ç çŠ¶æ€   |          |


***
<br/><br/><br/>
> <h2 id="ä½ç§»æ©ç æšä¸¾ä»£ç è½å®"> ä½ç§»æ©ç æšä¸¾ä»£ç è½å® </h2>

Swift **æœ¬èº«çš„ enum** ä¸æ”¯æŒ `|` è¿™ç§ä½è¿ç®—ç¬¦ç»„åˆï¼Œå› ä¸ºæšä¸¾æ˜¯å•å€¼ç±»å‹ã€‚

ä½†ä½ æƒ³è¦çš„æ•ˆæœï¼Œ**ç”¨ç±»ä¼¼ `.scan | .pair` è¿™æ ·å†™æ³•**ï¼Œåœ¨ Swift é‡Œæ˜¯ç”¨ `OptionSet` ç±»å‹å®ç°çš„ã€‚

<br/>

- **ç”¨ `OptionSet` å®ç° `.scan | .pair` ç»„åˆç¤ºä¾‹**

```swift
struct ProcessStatus: OptionSet {
    let rawValue: UInt8

    static let none      = ProcessStatus(rawValue: 0)
    static let scan      = ProcessStatus(rawValue: 1 << 0) // 1
    static let pair      = ProcessStatus(rawValue: 1 << 1) // 2
    static let bind      = ProcessStatus(rawValue: 1 << 2) // 4
    static let reconnect = ProcessStatus(rawValue: 1 << 3) // 8
    static let activator = ProcessStatus(rawValue: 1 << 4) // 16
}
```

---

- **ä½¿ç”¨ï¼š**

```swift
let aa: ProcessStatus = [.scan, .pair]       // Swift æ¨èå†™æ³•ï¼Œè¯­æ³•ç³–
// æˆ–è€…ç”¨ä½è¿ç®—ç¬¦
let bb = ProcessStatus.scan.union(.pair)     // ç”¨ union()
let cc = ProcessStatus.scan.formUnion(.pair) // æ”¹å˜å˜é‡
let dd = ProcessStatus.scan.rawValue | ProcessStatus.pair.rawValue // å¾—åˆ°åŸå§‹ä½å€¼ UInt8

// ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œæ‰‹åŠ¨ç”¨ä½è¿ç®—ç¬¦ï¼š
let ee = ProcessStatus(rawValue: ProcessStatus.scan.rawValue | ProcessStatus.pair.rawValue)
```

---

- **åˆ¤æ–­æ˜¯å¦åŒ…å«ï¼š**

```swift
if aa.contains(.scan) {
    print("åŒ…å« scan")
}
```

---

- **å°ç»“**

	* `enum` ä¸æ”¯æŒ `|`ï¼Œå› ä¸ºå®ƒæ˜¯å•å€¼
	* `OptionSet` æ˜¯ Swift ä¸“é—¨è®¾è®¡çš„ä½æ©ç ç»“æ„ï¼Œæ”¯æŒä½è¿ç®—ç¬¦ç»„åˆå’Œå¤šé€‰
	* ä½¿ç”¨æ—¶æ¨è `.scan, .pair` å†™æ³•æˆ–æ‰‹åŠ¨ç”¨ `.union()`ï¼Œæˆ–è€…ç›´æ¥æ“ä½œ `.rawValue`

---
<br/>

**æ­£ç¡®å†™æ³•ç¤ºä¾‹:**

```swift
public struct ProcessStatus: OptionSet {
    public let rawValue: UInt8

    // è¿™é‡Œå¿…é¡»å†™æˆ publicï¼Œæ»¡è¶³ public åè®®è¦æ±‚
    public init(rawValue: UInt8) {
        self.rawValue = rawValue
    }

    public static let none      = ProcessStatus(rawValue: 0)
    public static let scan      = ProcessStatus(rawValue: 1 << 0)
    public static let pair      = ProcessStatus(rawValue: 1 << 1)
    public static let bind      = ProcessStatus(rawValue: 1 << 2)
}
```

---

- **é‡ç‚¹æ€»ç»“**

	* ç»“æ„ä½“ã€å±æ€§ã€æ–¹æ³•ã€åˆå§‹åŒ–å™¨åªè¦æƒ³å…¬å¼€ç»™æ¨¡å—å¤–ä½¿ç”¨ï¼Œéƒ½è¦å£°æ˜ `public`
	* `OptionSet` åè®®è¦æ±‚å¿…é¡»å®ç° `init(rawValue:)`ï¼Œæ‰€ä»¥å®ƒçš„è®¿é—®çº§åˆ«ä¹Ÿå¿…é¡»å’Œç»“æ„ä½“ä¸€è‡´ï¼ˆ`public`ï¼‰
	* è¿™æ¡è§„åˆ™æ˜¯ Swift çš„è®¿é—®æ§åˆ¶æœºåˆ¶å†³å®šçš„

***
<br/><br/><br/>
> <h2 id="ä¸åŒä½ç§»æ©ç æšä¸¾ç±»å‹è½¬æ¢"> ä¸åŒä½ç§»æ©ç æšä¸¾ç±»å‹è½¬æ¢ </h2>

ä¸åŒä½ç§»æ©ç æšä¸¾ç±»å‹è½¬æ¢é”™è¯¯ï¼š

> `Cannot convert value of type 'ProcessStatus' to expected argument type 'ModelProcessStatus'`

æ„æ€æ˜¯ï¼šæˆ‘æƒ³æŠŠä¸€ä¸ª `ProcessStatus` ç±»å‹ä¼ ç»™ä¸€ä¸ªè¦æ±‚æ˜¯ `ModelProcessStatus` ç±»å‹çš„å‚æ•°ï¼Œä½†å®ƒä»¬æ˜¯**ä¸¤ä¸ªä¸åŒçš„ç±»å‹**ï¼Œå³ä½¿ç»“æ„ç›¸ä¼¼ï¼Œ**Swift ä¸å…è®¸éšå¼è½¬æ¢**ã€‚

---

- **âœ… è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿ç»Ÿä¸€ä½¿ç”¨åŒä¸€ä¸ªç±»å‹ï¼**

	- **âœ… æ–¹æ³• 1ï¼šæ”¹æ–¹æ³•å‚æ•°ä¸ºåŒä¸€ä¸ªç±»å‹**

å¦‚æœ `ProcessStatus` å’Œ `ModelProcessStatus` å…¶å®æ˜¯ä¸€æ ·çš„ç»“æ„ï¼ˆä¾‹å¦‚éƒ½æ˜¯ `OptionSet<UInt8>`ï¼‰ï¼Œé‚£å»ºè®®åªä¿ç•™ä¸€ä¸ªï¼Œæ¯”å¦‚ç»Ÿä¸€ä½¿ç”¨ `ProcessStatus`ï¼š

```swift
// å®šä¹‰ OptionSet
public struct ProcessStatus: OptionSet {
    public let rawValue: UInt8

    public init(rawValue: UInt8) {
        self.rawValue = rawValue
    }

    public static let none      = ProcessStatus(rawValue: 0)
    public static let scan      = ProcessStatus(rawValue: 1 << 0)
    public static let pair      = ProcessStatus(rawValue: 1 << 1)
    public static let bind      = ProcessStatus(rawValue: 1 << 2)
}

// ä½¿ç”¨ç»Ÿä¸€ç±»å‹
public func willBindBlePeripheral(needProcess: ProcessStatus) {
    Peripheral(needProcess: needProcess)
}

func Peripheral(needProcess: ProcessStatus) {
    // ç»§ç»­ä½¿ç”¨ needProcess
}
```

---
<br/>

- **âœ… æ–¹æ³• 2ï¼šå¦‚æœå¿…é¡»ä¿ç•™ä¸¤ä¸ªç±»å‹ï¼ˆä¾‹å¦‚ç”¨äºå…¼å®¹ OC ä¸ Swiftï¼‰**

```swift
public struct ModelProcessStatus: OptionSet {
   
    public let rawValue: UInt8
    public init(rawValue: UInt8) {
        self.rawValue = rawValue
    }

    public static let none      = ModelProcessStatus(rawValue: 0)
    public static let scan      = ModelProcessStatus(rawValue: 1 << 0)
    public static let pair      = ModelProcessStatus(rawValue: 1 << 1)
    public static let bind      = ModelProcessStatus(rawValue: 1 << 2)
}

// æ˜¾å¼è½¬æ¢ rawValue
public func willBindBlePeripheral(needProcess: ProcessStatus) {
    
    let converted = ModelProcessStatus(rawValue: needProcess.rawValue)
    Peripheral(needProcess: converted)
}

func Peripheral(needProcess: ModelProcessStatus) {
    print(needProcess)
}
```



***
<br/><br/><br/>
> <h2 id="ä¸»æšä¸¾åŒ…å«å¤šä¸ªå­æšä¸¾">ä¸»æšä¸¾åŒ…å«å¤šä¸ªå­æšä¸¾</h2>

è‹¥æ˜¯æƒ³å®ç°â€œ**ä¸€ä¸ªä¸»æšä¸¾ä¸‹é¢åŒ…å«å¤šä¸ªå­æšä¸¾**â€ï¼Œä¾‹å¦‚ï¼š

```swift
enum DeviceCategory {
    enum Phone: String {
        case iPhone = "iPhone"
        case android = "Android"
    }

    enum Tablet: String {
        case iPad = "iPad"
        case androidPad = "AndroidPad"
    }
}
```

è¿™ç§è¯­æ³•**æ˜¯å…è®¸çš„**ï¼Œä½†ä½ æ— æ³•ç›´æ¥ä½¿ç”¨ `DeviceCategory` æœ¬èº«æ¥éå†æ‰€æœ‰å­æšä¸¾çš„ caseï¼ŒSwift ä¸æ”¯æŒå¤šå±‚åµŒå¥—çš„æšä¸¾åš CaseIterableã€‚

---
<br/>

- **âœ… æ¨èåšæ³•ä¸€ï¼šæ‰å¹³åŒ–è®¾è®¡ + å±æ€§åˆ†ç»„ï¼š â€œçˆ¶åˆ†ç±»+å­é¡¹â€çš„ç»“æ„**

-  **1.å®šä¹‰å¸¦ä¸»åˆ†ç±»çš„æšä¸¾**

```swift
enum DeviceType: String, CaseIterable {
    // Phone ç±»åˆ«
    case iPhone = "iPhone"
    case androidPhone = "Android Phone"
    
    // Tablet ç±»åˆ«
    case iPad = "iPad"
    case androidTablet = "Android Tablet"
    
    // Laptop ç±»åˆ«
    case macBook = "MacBook"
    case windowsLaptop = "Windows Laptop"

    // è¿”å›ä¸»åˆ†ç±»
    var category: Category {
        switch self {
        case .iPhone, .androidPhone:
            return .phone
        case .iPad, .androidTablet:
            return .tablet
        case .macBook, .windowsLaptop:
            return .laptop
        }
    }

    enum Category: String {
        case phone = "Phone"
        case tablet = "Tablet"
        case laptop = "Laptop"
    }
}
```

<br/>

**ä½¿ç”¨:**

```swift
let device: DeviceType = .iPad
print(device.rawValue)           // è¾“å‡º: iPad
print(device.category.rawValue)  // è¾“å‡º: Tablet
```

---
<br/>


- **âœ… æ¨èåšæ³•äºŒï¼šä¸»æšä¸¾ + å…³è”å€¼ï¼ˆæ›´æ¥è¿‘åµŒå¥—ï¼‰**

å¦‚æœä½ ç¡®å®æƒ³æ¨¡æ‹Ÿâ€œå­æšä¸¾â€ç»“æ„ï¼Œå¯ä»¥ç”¨ä¸»æšä¸¾ + å…³è”å€¼æ¥å®ç°ï¼š

```swift
enum DeviceCategory {
    case phone(PhoneType)
    case tablet(TabletType)

    enum PhoneType: String {
        case iPhone = "iPhone"
        case android = "Android"
    }

    enum TabletType: String {
        case iPad = "iPad"
        case androidPad = "AndroidPad"
    }

    var rawValue: String {
        switch self {
        case .phone(let type): return type.rawValue
        case .tablet(let type): return type.rawValue
        }
    }
}
```

**ä½¿ç”¨ï¼š**

```swift
let myDevice = DeviceCategory.phone(.iPhone)
print(myDevice.rawValue)  // è¾“å‡º: iPhone
```

> âš ï¸ ä¸æ”¯æŒ `CaseIterable` è‡ªåŠ¨åˆ—å‡ºæ‰€æœ‰æƒ…å†µï¼Œä½ å¯ä»¥æ‰‹åŠ¨ç»´æŠ¤é™æ€æ–¹æ³•åˆ—å‡ºæ‰€æœ‰ç»„åˆã€‚

---
<br/>

- **âœ…å­—å…¸ + åˆ†ç»„æšä¸¾ï¼ˆç”¨äº UI æ˜¾ç¤ºç»“æ„ï¼‰**

```swift
let allGrouped: [DeviceType.Category: [DeviceType]] = Dictionary(
    grouping: DeviceType.allCases,
    by: \.category
)

for (category, items) in allGrouped {
    print("Category: \(category.rawValue)")
    for item in items {
        print(" - \(item.rawValue)")
    }
}
```

---
<br/>

- **âœ… æ€»ç»“**

| éœ€æ±‚        | æ¨èåšæ³•                               |
| --------- | ---------------------------------- |
| æ‰å¹³ç»“æ„ + åˆ†ç»„ | å•ä¸€æšä¸¾ + `.category` å±æ€§              |
| å­æšä¸¾åµŒå¥—     | ä½¿ç”¨ä¸»æšä¸¾ + å…³è”å€¼                        |
| è·å–æ‰€æœ‰é¡¹     | ä½¿ç”¨ `CaseIterable` + `.allCases` åˆ†ç»„ |
| å¤æ‚ç»“æ„      | ç”¨ struct/class + enum åšç»„åˆ          |



***
<br/><br/><br/>
> <h2 id="å­—ç¬¦ä¸²è½¬æšä¸¾">å­—ç¬¦ä¸²è½¬æšä¸¾</h2>

åœ¨ `compactMap` é‡Œç›´æ¥æŠŠ `mode` è½¬æˆ `LinkWayType`ï¼Œ
æœ€åè¿”å›å»é‡åçš„ `[LinkWayType]`ã€‚

å¯ä»¥è¿™æ ·å†™ï¼š

```swift
private func getPairModes(models: [DevicePairingNetGuideModel]?) -> [LinkWayType] {
    guard let models = models else { return [] }
    let uniqueModes: Set<LinkWayType> = Set(
        models.compactMap { model in
            guard let modeStr = model.mode else { return nil }
            return LinkWayType(linkWay: modeStr)
        }
    )
    return Array(uniqueModes)
}
```

<br/>

**ä½ çš„æšä¸¾ `LinkWayType` è¦æ”¹æˆæ”¯æŒæ‰€æœ‰æƒ…å†µ**

ç›®å‰ä½ çš„ `init(linkWay:)` é‡Œåªå†™äº†éƒ¨åˆ† caseï¼Œè€Œä¸”è¿˜æ²¡æœ‰ `sn` å’Œ `ble` çš„ case å®šä¹‰ã€‚
æˆ‘å¸®ä½ è¡¥å®Œæ•´ï¼š

```swift
internal enum LinkWayType: String {
    case none = "None"
    case ap = "AP"
    case wired = "WN"
    case sn = "SN"
    case ble = "BLUETOOTH"

    init(linkWay: String) {
        switch linkWay.uppercased() {
        case "SN":
            self = .sn
        case "BLUETOOTH":
            self = .ble
        case "AP":
            self = .ap
        case "WN":
            self = .wired
        default:
            self = .none
        }
    }
}
```

è¿™æ ·ä½ çš„ `getPairModes` æ–¹æ³•å°±èƒ½ç›´æ¥è¿”å›ä¸€ä¸ªå»é‡åçš„ `[LinkWayType]`ï¼Œ
è€Œä¸” nil å’Œéæ³•å­—ç¬¦ä¸²éƒ½ä¼šè‡ªåŠ¨å˜æˆ `.none`ã€‚




<br/><br/><br/>

***
<br/>

> <h1 id='ç»“æ„ä½“'>ç»“æ„ä½“</h1>

ç»“æ„ä½“æ˜¯ç”±ä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç±»å‹æˆ–ä¸åŒç±»å‹çš„æ•°æ®æ„æˆçš„æ•°æ®é›†åˆã€‚

ç»“æ„ä½“æ˜¯ä¸€ç§å€¼ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œåœ¨Swiftä¸­å¸¸å¸¸ä½¿ç”¨ç»“æ„ä½“å°è£…ä¸€äº›å±æ€§ç”šè‡³æ˜¯æ–¹æ³•æ¥ç»„æˆæ–°çš„å¤æ‚ç±»å‹ï¼Œç›®çš„æ˜¯ç®€åŒ–è¿ç®—ã€‚

```
//å®šä¹‰ä¸€ä¸ª Studentï¼ˆå­¦ç”Ÿï¼‰ç±»å‹çš„ç»“æ„ä½“ç”¨äºè¡¨ç¤ºä¸€ä¸ªå­¦ç”Ÿï¼ŒStudentçš„æˆå‘˜åˆ†åˆ«æ˜¯è¯­ã€æ•°ã€å¤–ä¸‰ç§‘`Int`ç±»å‹çš„æˆç»©
 struct Student {
    var chinese: Int
    var math: Int
    var english: Int
    
    
    init() {}
    init(chinese: Int, math: Int, english: Int) {
          self.chinese = chinese
          self.math = math
         self.english = english
    }
    
    /// è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•
    init(stringScore: String) {
             let cme = stringScore.characters.split(separator: ",")
             chinese = Int(atoi(String(cme.first!)))
             math = Int(atoi(String(cme[1])))
             english = Int(atoi(String(cme.last!)))
        }
 }
```


çœ‹åˆ°ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯èƒ½å·²ç»å‘ç°äº†ä¸€ç‚¹ç»“æ„ä½“å’Œç±»çš„åŒºåˆ«äº†ï¼š**å®šä¹‰ç»“æ„ä½“ç±»å‹æ—¶å…¶æˆå‘˜å¯ä»¥æ²¡æœ‰åˆå§‹å€¼**ã€‚

å¦‚æœä½¿ç”¨è¿™ç§æ ¼å¼å®šä¹‰ä¸€ä¸ªç±»ï¼Œç¼–è¯‘å™¨æ˜¯ä¼šæŠ¥é”™çš„ï¼Œä»–ä¼šæé†’ä½ è¿™ä¸ªç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚

<br/>
ç»“æ„ä½“åˆå§‹åŒ–:

```
//ä½¿ç”¨Studentç±»å‹çš„ç»“æ„ä½“åˆ›å»ºStudentç±»å‹çš„å®ä¾‹ï¼ˆå˜é‡æˆ–å¸¸é‡ï¼‰å¹¶åˆå§‹åŒ–ä¸‰ä¸ªæˆå‘˜ï¼ˆè¿™ä¸ªå­¦ç”Ÿçš„æˆç»©ä¼šä¸ä¼šå¤ªå¥½äº†ç‚¹ï¼‰
let student2 = Student(chinese: 90, math: 80, english: 70)

let student7 = Student(chinese: 90, math: 80, english: 70)

//è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•
let student8 = Student(stringScore: "70,80,90")
```


***
<br/><br/><br/>
> <h2 id="OCå¯¹è±¡è½¬æ¢æˆç»“æ„ä½“">OCå¯¹è±¡è½¬æ¢æˆç»“æ„ä½“</h2>

å†™ä¸€ä¸ª **è½¬æ¢æ–¹æ³•**ï¼ŒæŠŠ Objective-C çš„ `BleModel` è½¬æ¢æˆ Swift çš„ `BleDeviceModel`ã€‚

<br/> 

**`BleDeviceModel` ç»“æ„ä½“æ˜¯è¿™æ ·çš„ï¼š**

```swift
import CoreBluetooth

struct BleDeviceModel: Codable {
    var peripheral: CBPeripheral? = nil
    var name: String?
    var rssi: Int?
    private(set) var isRegistered: Bool = false


    enum CodingKeys: String, CodingKey {
        case name, rssi, isRegistered,
    }
}
```

<br/>

åœ¨ Swift ä¸­æ‰©å±• `BleDeviceModel`ï¼Œå†™ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼š

```swift
extension BleDeviceModel {
    static func from(_ model: BleModel) -> BleDeviceModel {
        return BleDeviceModel(
            peripheral: model.cbPeripheral,
            name: model.name,
            rssi: model.RSSI?.intValue,
            isRegistered: model.isRegistered,
        )
    }

    // ä¸ºäº†æ”¯æŒä¸Šé¢çš„å·¥å‚æ–¹æ³•ï¼Œè¡¥ä¸€ä¸ªå¸¦å‚æ•° init
    init(
        name: String?,
        rssi: Int?,
        isRegistered: Bool,
    ) {
        self.peripheral = peripheral
        self.name = name
        self.rssi = rssi
        self.isRegistered = isRegistered
    }
}
```

<br/>

**ä½¿ç”¨ç¤ºä¾‹**

```swift
let objcModel = BleModel()
// objcModel å·²ç»è¢« CoreBluetooth æ‰«æèµ‹å€¼è¿‡

let swiftModel = BleDeviceModel.from(objcModel)

print(swiftModel.name ?? "No Name")
print(swiftModel.rssi ?? 0)
print(swiftModel.isRegistered)
```



<br/>

***
<br/><br/><br/>

> <h1 id='é›†åˆ'>é›†åˆ</h1>
> <h2 id='Seté›†åˆä¸NSArrayã€DictionaryåŒºåˆ«'>Seté›†åˆä¸NSArrayã€DictionaryåŒºåˆ«</h2>


- **1.Seté›†åˆç‰¹æ€§:**
	- **æ— åºæ€§:** Set ä¸ä¿è¯å…¶å…ƒç´ çš„ä»»ä½•ç‰¹å®šé¡ºåºã€‚è¿™æ„å‘³ç€å½“ä½ éå†ä¸€ä¸ª Set æˆ–æ‰“å°å…¶å†…å®¹æ—¶ï¼Œå…ƒç´ å¯èƒ½å‡ºç°çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯æ¬¡å¯èƒ½éƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚
	
	- **å”¯ä¸€æ€§:** Set ä¿è¯å…¶å†…ä¸åŒ…å«é‡å¤å…ƒç´ .è¿™ä¸€ç‰¹æ€§ä½¿å¾— Set éå¸¸é€‚ç”¨äºéœ€è¦æ£€æŸ¥æˆå‘˜èµ„æ ¼ï¼ˆæ˜¯å¦å­˜åœ¨æŸå…ƒç´ ï¼‰ã€å»é‡ã€ä»¥åŠè®¡ç®—é›†åˆäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰æ“ä½œçš„åœºæ™¯ã€‚
	
<br/>


- **2.åˆ›å»ºå’Œåˆå§‹åŒ–å‡ ç§æ–¹å¼:**


```
ä½¿ç”¨ç©ºçš„æ„é€ å™¨åˆ›å»ºä¸€ä¸ªæŒ‡å®šç±»å‹å…ƒç´ çš„ç©ºé›†åˆï¼švar mySet: Set<Int> = Set()

é€šè¿‡æ•°ç»„å­—é¢é‡åˆå§‹åŒ–ï¼švar mySet: Set<String> = ["apple", "banana", "orange"]

ä»ç°æœ‰é›†åˆã€æ•°ç»„æˆ–å…¶ä»–åºåˆ—ç±»å‹åˆ›å»ºï¼šlet array = ["a", "b", "c"]; let setFromArray = Set(array)

ä½¿ç”¨ Set(arrayLiteral:) æ„é€ å™¨ï¼šlet set2 = Set(arrayLiteral: 1, 2, 3)
```


<br/>
**3.å¸¸ç”¨æ“ä½œ: Set æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•å’Œæ“ä½œç¬¦ç”¨äºç®¡ç†é›†åˆå†…å®¹å’Œæ‰§è¡Œé›†åˆé—´è¿ç®—ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š**

```
æ·»åŠ å…ƒç´ ï¼šmySet.insert(element)

åˆ é™¤å…ƒç´ ï¼šmySet.remove(element)

æ£€æŸ¥æˆå‘˜èµ„æ ¼ï¼šif mySet.contains(element) { ... }

åˆå¹¶ï¼ˆå¹¶é›†ï¼‰ï¼šlet unionSet = set1.union(set2)

äº¤é›†ï¼šlet intersectionSet = set1.intersection(set2)

å·®é›†ï¼ˆå»é™¤ç›¸åŒå…ƒç´ ï¼‰ï¼šlet differenceSet = set1.subtracting(set2)

è®¡ç®—é›†åˆå¤§å°ï¼ˆå…ƒç´ æ•°é‡ï¼‰ï¼šlet count = mySet.count

æ¸…ç©ºé›†åˆï¼šmySet.removeAll()
```


<br/><br/>
> <h2 id="enumeratedï¼ˆï¼‰é›†åˆ(å¦‚æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰)éå†">enumeratedï¼ˆï¼‰é›†åˆ(å¦‚æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰)éå†</h2>

`enumerated()` æ˜¯ Swift ä¸­ä¸€ä¸ªç”¨äºéå†é›†åˆï¼ˆå¦‚æ•°ç»„ã€å­—å…¸ã€é›†åˆç­‰ï¼‰çš„é«˜é˜¶æ–¹æ³•ã€‚å®ƒå°†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ å’Œå®ƒçš„ç´¢å¼•ä¸€èµ·è¿”å›ï¼Œä»¥ä¾¿ä½ å¯ä»¥åœ¨éå†æ—¶åŒæ—¶è®¿é—®å…ƒç´ çš„å€¼å’Œç´¢å¼•ã€‚

### ä½œç”¨
`enumerated()` æ–¹æ³•å°†é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ä¸å…¶å¯¹åº”çš„ç´¢å¼•ä¸€èµ·è¿”å›ï¼Œè¿”å›ä¸€ä¸ª `EnumeratedSequence` ç±»å‹çš„é›†åˆï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªåŒ…å« `(index, element)` å…ƒç»„çš„å…ƒç´ ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡è§£æ„å…ƒç»„æ¥åŒæ—¶è®¿é—®å…ƒç´ çš„ç´¢å¼•å’Œå®ƒçš„å€¼ã€‚

### è¯­æ³•
```swift
let array = ["a", "b", "c", "d"]
for (index, element) in array.enumerated() {
    print("Index: \(index), Element: \(element)")
}
```

### ç¤ºä¾‹
å‡è®¾ä½ æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½ å¸Œæœ›éå†æ¯ä¸ªå…ƒç´ å¹¶ä¸”è®¿é—®å®ƒçš„ç´¢å¼•ï¼š

```swift
let fruits = ["Apple", "Banana", "Cherry", "Date"]

for (index, fruit) in fruits.enumerated() {
    print("Index \(index): \(fruit)")
}
```

**è¾“å‡º**
```
Index 0: Apple
Index 1: Banana
Index 2: Cherry
Index 3: Date
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š
- `enumerated()` æ–¹æ³•è¿”å›ä¸€ä¸ªåºåˆ—ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª `(index, element)` å…ƒç»„ã€‚
- `index` æ˜¯è¯¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œ`element` æ˜¯æ•°ç»„ä¸­çš„å€¼ï¼ˆå³æ¯ä¸ªæ°´æœåç§°ï¼‰ã€‚

### ä½¿ç”¨åœºæ™¯
1. **è·å–å…ƒç´ çš„ç´¢å¼•å’Œå€¼**ï¼šå½“ä½ éœ€è¦åŒæ—¶è®¿é—®é›†åˆä¸­çš„å…ƒç´ å’Œå®ƒä»¬çš„ä½ç½®æ—¶ï¼Œ`enumerated()` æ˜¯ä¸€ä¸ªéå¸¸ä¾¿åˆ©çš„æ–¹æ³•ã€‚
2. **æ•°ç»„çš„ç´¢å¼•æ“ä½œ**ï¼šæ¯”å¦‚åœ¨ä¿®æ”¹æ•°ç»„å†…å®¹æ—¶ï¼ŒçŸ¥é“å½“å‰å…ƒç´ çš„ç´¢å¼•å¾ˆæœ‰ç”¨ã€‚
3. **å®ç°å¸¦æœ‰ç´¢å¼•çš„é€»è¾‘**ï¼šä¾‹å¦‚ï¼Œå¦‚æœä½ è¦æ ¹æ®ç´¢å¼•å¯¹æŸäº›å…ƒç´ è¿›è¡Œæ¡ä»¶å¤„ç†æˆ–æ’åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `enumerated()`ã€‚

### `enumerated()` çš„è¿”å›å€¼
`enumerated()` è¿”å›çš„æ˜¯ä¸€ä¸ª `EnumeratedSequence`ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å« `(Int, Element)` å…ƒç»„çš„åºåˆ—ï¼Œå…¶ä¸­ `Int` æ˜¯ç´¢å¼•ï¼Œ`Element` æ˜¯é›†åˆä¸­çš„å…ƒç´ ã€‚è¿™ä½¿å¾—å®ƒåœ¨éå†æ—¶å¯ä»¥è§£æ„å…ƒç»„å¹¶ç›´æ¥ä½¿ç”¨ã€‚

### æ€»ç»“
`enumerated()` æ˜¯ä¸€ä¸ªé«˜æ•ˆä¸”æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ åœ¨éå†é›†åˆæ—¶åŒæ—¶è®¿é—®åˆ°å…ƒç´ çš„ç´¢å¼•å’Œå€¼ã€‚å®ƒä½¿å¾—åœ¨å¾ªç¯ä¸­å¤„ç†å…ƒç´ æ—¶æ›´åŠ ç®€æ´å’Œç›´è§‚ï¼Œå°¤å…¶æ˜¯å½“ä½ éœ€è¦åŒæ—¶æ“ä½œç´¢å¼•å’Œå€¼æ—¶ã€‚

<br/><br/><br/>
> <h2 id="compactMap-æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤ï¼Œå»é™¤nilå…ƒç´ ">compactMap-æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤ï¼Œå»é™¤nilå…ƒç´ </h2>

åœ¨ Swift ä¸­ï¼Œ`compactMap` æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•ï¼Œç”¨æ¥å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤ã€‚å®ƒå¯ä»¥å°†æ•°ç»„ä¸­çš„ **`nil` å€¼å»é™¤**ï¼Œå¹¶åŒæ—¶å¯¹æ¯ä¸ªé `nil` å…ƒç´ åº”ç”¨ä¸€ä¸ªæ˜ å°„æ“ä½œã€‚

---

### **`compactMap` çš„å®šä¹‰**
```swift
func compactMap<ElementOfResult>(_ transform: (Element) throws -> ElementOfResult?) rethrows -> [ElementOfResult]
```

- **è¾“å…¥**ï¼šä¸€ä¸ªé—­åŒ…ï¼Œç”¨æ¥å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œè½¬æ¢ï¼Œå¹¶å¯èƒ½è¿”å› `nil`ã€‚
- **è¾“å‡º**ï¼šä¸€ä¸ªæ–°çš„æ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰é `nil` çš„æ˜ å°„ç»“æœã€‚

---

### **`compactMap` çš„ä½œç”¨**

1. **ç§»é™¤æ•°ç»„ä¸­çš„ `nil` å€¼**  
   å¦‚æœæ•°ç»„ä¸­å­˜åœ¨ `nil`ï¼Œ`compactMap` ä¼šå°†å®ƒä»¬è¿‡æ»¤æ‰ã€‚

2. **è½¬æ¢å…ƒç´ å¹¶è¿‡æ»¤ `nil`**  
   ç»“åˆè½¬æ¢å’Œè¿‡æ»¤æ“ä½œï¼Œå°†ç»“æœç›´æ¥è¾“å‡ºä¸ºä¸€ä¸ªæ–°æ•°ç»„ã€‚

---

### **å¸¸è§ç”¨æ³•**

#### **1. ç§»é™¤æ•°ç»„ä¸­çš„ `nil`**
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å« `nil` å€¼çš„æ•°ç»„ï¼Œ`compactMap` å¯ä»¥ç§»é™¤æ‰€æœ‰ `nil`ï¼š

```swift
let numbers: [Int?] = [1, nil, 3, nil, 5]
let nonNilNumbers = numbers.compactMap { $0 }
print(nonNilNumbers) // è¾“å‡º: [1, 3, 5]
```

---

#### **2. è½¬æ¢å¹¶ç§»é™¤ `nil`**
å¯ä»¥åœ¨è½¬æ¢çš„åŒæ—¶ç§»é™¤ä¸ç¬¦åˆæ¡ä»¶çš„å€¼ï¼š

```swift
let strings = ["123", "abc", "456", "def"]
let numbers = strings.compactMap { Int($0) }
print(numbers) // è¾“å‡º: [123, 456]
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰èƒ½è½¬æ¢ä¸º `Int` çš„å­—ç¬¦ä¸²æ‰ä¼šä¿ç•™ï¼Œæ— æ³•è½¬æ¢çš„å…ƒç´ è¢«è¿‡æ»¤æ‰ã€‚

---

#### **3. æ˜ å°„å¹¶è¿‡æ»¤å¤æ‚å¯¹è±¡**
å¯¹äºæ›´å¤æ‚çš„æ•°æ®æ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç”¨ `compactMap` å¤„ç†ï¼Œä¾‹å¦‚ï¼š

```swift
struct User {
    let id: Int
    let name: String?
}

let users = [
    User(id: 1, name: "Alice"),
    User(id: 2, name: nil),
    User(id: 3, name: "Bob")
]

let names = users.compactMap { $0.name }
print(names) // è¾“å‡º: ["Alice", "Bob"]
```

---

### **ä¸å…¶ä»–æ–¹æ³•çš„åŒºåˆ«**

#### **`map`**
- `map` ä¼šå¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨è½¬æ¢ï¼Œ`nil` ä¼šè¢«ä¿ç•™ã€‚
- ç¤ºä¾‹ï¼š

```swift
let numbers = [1, 2, 3]
let mappedNumbers = numbers.map { $0 * 2 }
print(mappedNumbers) // è¾“å‡º: [2, 4, 6]
```

#### **`filter`**
- `filter` åªè¿‡æ»¤ï¼Œä¸ä¼šè½¬æ¢å…ƒç´ ã€‚
- ç¤ºä¾‹ï¼š

```swift
let numbers = [1, 2, 3, 4]
let evenNumbers = numbers.filter { $0 % 2 == 0 }
print(evenNumbers) // è¾“å‡º: [2, 4]
```

#### **`compactMap`**
- åŒæ—¶è½¬æ¢å’Œè¿‡æ»¤ `nil`ï¼Œæ˜¯ `map` å’Œ `filter` çš„ç»„åˆã€‚
- ç¤ºä¾‹ï¼š

```swift
let strings = ["1", "a", "3"]
let numbers = strings.compactMap { Int($0) }
print(numbers) // è¾“å‡º: [1, 3]
```

---

### **é€‚ç”¨åœºæ™¯**

1. **æ¸…ç†æ•°æ®**ï¼šç§»é™¤æ•°ç»„ä¸­çš„ `nil` å€¼ã€‚
2. **æ•°æ®è½¬æ¢**ï¼šå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ˜ å°„ï¼ŒåŒæ—¶å‰”é™¤æ— æ•ˆå€¼ã€‚
3. **æå‡ä»£ç ç®€æ´æ€§**ï¼šç»“åˆæ˜ å°„å’Œè¿‡æ»¤é€»è¾‘ï¼Œå‡å°‘å¤šä½™ä»£ç ã€‚

---

### **æ€»ç»“**
`compactMap` æ˜¯ Swift ä¸­éå¸¸å®ç”¨çš„é«˜é˜¶å‡½æ•°ï¼Œé€‚ç”¨äºå¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œè¿‡æ»¤å’Œæ˜ å°„çš„åœºæ™¯ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªæ—¢å»é™¤ `nil` åˆèƒ½è½¬æ¢çš„æ•°ç»„ï¼Œ`compactMap` æ˜¯é¦–é€‰å·¥å…·ï¼

<br/><br/><br/>

***
<br/>

> <h1 id='å‡½æ•°'>å‡½æ•°</h1>
<br/>
> <h2 id='å‡½æ•°ä½¿ç”¨'>å‡½æ•°ä½¿ç”¨</h2>


<br/><br/>
><h3 id='å†…éƒ¨å‚æ•°å’Œå¤–éƒ¨å‚æ•°'>å†…éƒ¨å‚æ•°å’Œå¤–éƒ¨å‚æ•°</h3>

- åœ¨å‡½æ•°å†…éƒ¨å¯ä»¥çœ‹åˆ°çš„å‚æ•°,å°±æ˜¯å†…éƒ¨å‚æ•°;

- åœ¨å‡½æ•°å¤–é¢å¯ä»¥çœ‹åˆ°çš„å‚æ•°,å°±æ˜¯å¤–éƒ¨å‚æ•°;

- é»˜è®¤æƒ…å†µä¸‹,ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹,å‚æ•°åç§°æ—¢æ˜¯å†…éƒ¨å‚æ•°ä¹Ÿæ˜¯å¤–éƒ¨å‚æ•°;

- å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæƒ³è¦æœ‰å¤–éƒ¨å‚æ•°,å¯ä»¥è®¾ç½®æ ‡ç­¾:åœ¨å˜é‡åå‰åŠ æ ‡ç­¾å³å¯;

- å¦‚æœä¸æƒ³è¦å¤–éƒ¨å‚æ•°,å¯ä»¥åœ¨å‚æ•°åç§°å‰åŠ `_`;

```
// é»˜è®¤æƒ…å†µä¸‹,ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹,å‚æ•°åç§°æ—¢æ˜¯å†…éƒ¨å‚æ•°ä¹Ÿæ˜¯å¤–éƒ¨å‚æ•°
func calculate_one(num1 : Int, num2 : Int, num3 : Int) -> Int {
   return num1 * num2 * num3
}

let result_one = self.calculate_one(num1: 1, num2: 2, num3: 3)
print("--->> calculate_one: \(result_one)")
```
æ‰“å°ï¼š

```
--->> calculate_one: 6
```


<br/>

```
// å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæƒ³è¦æœ‰å¤–éƒ¨å‚æ•°ï¼Œåœ¨å˜é‡åå‰åŠ æ ‡ç­¾å³å¯ï¼Œå¦‚æœä¸æƒ³è¦ï¼Œåœ¨å‚æ•°åå‰åŠ  _
func calculate_two(myNum1 num1 : Int, _ num2 : Int, num3 : Int) -> Int {
   return num1 * num2 * num3
}

let result_two = self.calculate_two(myNum1: 4, 5, num3: 6)
print("--->> calculate_two: \(result_two)")
```

æ‰“å°ï¼š

```
--->> calculate_two: 120
```

<br/>

```
// æ–¹æ³•çš„é‡è½½:æ–¹æ³•åç§°ç›¸åŒ,ä½†æ˜¯å‚æ•°ä¸åŒ,å¯ä»¥ç§°ä¹‹ä¸ºæ–¹æ³•çš„é‡è½½
func calculate_three(num1: Int, _ num2 :Int) -> Int {
   return num1 * num2
}

let resutl_three = self.calculate_three(num1: 7, 8)
print("--->> calculate_three: \(resutl_three)")

```

æ‰“å°ï¼š

```
--->> calculate_three: 56
```

<br/><br/>
># <h3 id='é»˜è®¤å‚æ•°'>**`é»˜è®¤å‚æ•°`**</h3>


è‹¥æ²¡æœ‰ä¼ å…¥å…·ä½“å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚

```
public init(context: MapContext? = nil, shouldIncludeNilValues: Bool = false){
		self.context = context  //é»˜è®¤å€¼ context ä¸ºnill
		self.shouldIncludeNilValues = shouldIncludeNilValues  // é»˜è®¤å€¼ shouldIncludeNilValues ä¸ºfalse
	}


public init(mappingType: MappingType, JSON: [String: Any], toObject: Bool = false, context: MapContext? = nil, shouldIncludeNilValues: Bool = false) {

}

//è°ƒç”¨ï¼ŒtoObject çœç•¥äº†
let map = Map(mappingType: .fromJSON, JSON: json, context: context1, shouldIncludeNilValues: shouldIncludeNilValues)





func makecoffee(type :String = "å¡å¸ƒå¥‡è¯º") -> String {
    return "åˆ¶ä½œä¸€æ¯\(type)å’–å•¡ã€‚"
}

print(makecoffee(type: "æ‹¿é“"))
print(makecoffee())

```
æ‰“å°ï¼š

```
åˆ¶ä½œä¸€æ¯æ‹¿é“å’–å•¡ã€‚

åˆ¶ä½œä¸€æ¯å¡å¸ƒå¥‡è¯ºå’–å•¡ã€‚
```


<br/>
<br/>

># <h3 id='åˆ¤æ–­æ˜¯å¦ä¸ºç©º'>`åˆ¤æ–­æ˜¯å¦ä¸ºç©º`</h3>


```
if response.result is NSNULL {

}

```





<br/>

> <h3 id='å¯å˜å‚æ•°'>å¯å˜å‚æ•°</h3>

å‡½æ•°çš„å‚æ•°ä¸ªæ•°å¯ä»¥ä¸ç¡®å®šï¼Œä½†å¿…é¡»æ˜¯ç›¸åŒç±»å‹ï¼Œåœ¨å‚æ•°ç±»å‹ååé¢åŠ å…¥ï¼ˆâ€¦ï¼‰æ¥æŒ‡ç¤ºè¿™æ˜¯å¯å˜å‚æ•°

```
func sum(numbers:Double...) -> Double {
    var total: Double = 0
    for number in numbers {
        total += number
    }
    return total
}


let three = sum(numbers: 100.0, 20, 30)
print("---> 3ä¸ªæ•°ä¹‹å’Œï¼š\(three)")

let two = sum(numbers: 30, 80)
print("---> 2ä¸ªæ•°ä¹‹å’Œï¼š\(two)")

```
æ‰“å°ï¼š

```
---> 3ä¸ªæ•°ä¹‹å’Œï¼š150.0

---> 2ä¸ªæ•°ä¹‹å’Œï¼š110.0
```



<br/>
<br/>

> <h3 id='å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰'>å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆä¼ é€’ï¼‰</h3>

 é»˜è®¤æƒ…å†µå‡½æ•°çš„å‚æ•°æ˜¯å€¼ä¼ é€’ï¼Œå¦‚æœæƒ³æ”¹å˜å¤–é¢çš„å˜é‡ï¼Œåˆ™éœ€è¦ä¼ é€’å˜é‡çš„åœ°å€ï¼Œswift æä¾› inoutå…³é”®å­—å°±å¯ä»¥å®ç°ã€‚æ³¨æ„ï¼šå¿…é¡»æ˜¯å˜é‡

```
func swap2( m : inout Int, n : inout Int) {
     let temp = m
     m = n
     n = temp
     print("å‡½æ•°å†…çš„å€¼ï¼šm:\(m), n:\(n)")
 }


var m = 10
var n = 20
swap2(m: &m, n: &n)

print("---->>> è°ƒç”¨åçš„å€¼ï¼šm:\(m), n:\(n)")

```
æ‰“å°ï¼š

```
å‡½æ•°å†…çš„å€¼ï¼šm:20, n:10

---->>> è°ƒç”¨åçš„å€¼ï¼šm:20, n:10
```

<br/><br/>
> <h2 id='mapå’ŒflatMapåŒºåˆ«'>mapå’ŒflatMapåŒºåˆ«</h2>
- **1).map**: å¯¹å…ƒç´ è¿›è¡Œé—­åŒ…å®šä¹‰çš„æ˜ å°„æ“ä½œ

ä»¥ä¸‹æ˜¯mapçš„å®šä¹‰,æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œä¸”ç±»å‹ä¸ºElement

```swift
@inlinable public func map<T>(_ transform: (Element) throws -> T) rethrows -> [T]
```

<br/>
mapå‡½æ•°å¸¸â½¤â½…å¼: 

```swift
let arr= [1,2,3]
let result=arr.map{ $0 *2}
let arr1 = ["HELLO","WORLD"]
let arr1Small = arr1.map{ $0.lowercased() }
let arr1StrCount = arr1.map{ $0.count }
let arr1String=arr1.map {"No. \($0)"}
```
<br/><br/>

- **2).flatMap**: æ˜¯å°†â¼€ä¸ªé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿›â¾é—­åŒ…å®šä¹‰çš„æ˜ å°„æ“ä½œï¼Œæ·»åŠ åˆ°å¦â¼€ä¸ªé›†åˆ

```swift
@inlinable public func flatMap<SegmentOfResult>(_ transform: (Element) throws ->
SegmentOfResult) rethrows -> [SegmentOfResult.Element] where SegmentOfResult
: Sequence
```
<br/>

flatMapå¸¸â½¤â½…å¼:

```swift
let str: String? ="10"
let strflat = str.flatMap{ $0 }
```

<br/><br/>


- **3).mapä¸flatMapçš„åŒºåˆ«:**

	- **3.1). mapä¸ä¼šå¯¹æ•°ç»„çš„ç»“æ„é€ æˆå½±å“ï¼›â½½flatMapä¼šå½±å“æ•°ç»„çš„ç»“æ„,ä¾‹å¦‚å°†å¤šç»´æ•°ç»„è½¬åŒ–ä¸ºâ¼€ç»´æ•°ç»„**

```swift
let arr= [[1,2,3],[4,5]]

let map = arr.map{ $0.map{ $0 * 2} }//[[2, 4, 6], [8, 10]]

letflatMap=arr.flatMap{ $0.map{ $0 *2} }//[2, 4, 6, 8, 10] 
```

<br/>


**3.2). flatMapå¯¹åªæœ‰è§£åŒ…æˆåŠŸçš„å…ƒç´ ï¼Œæ‰ä¼šæ·»åŠ åˆ°é›†åˆä¸­ï¼Œå¯å®ç°è¿‡æ»¤æ•°ç»„ä¸­çš„nilå€¼ç­‰ï¼Œå¹¶ä¸”ä¼šå¯¹æ•°ç»„ä¸­çš„å¯é€‰ç±»å‹â¾ƒåŠ¨è§£åŒ…**

```swift
let a:String? ="10"
let arr= ["a","b",nil,a]

let map = arr.map{ $0 }
//è¾“å‡º[Optional("a"), Optional("b"), nil, Optional("10")]

let flatMap = arr.flatMap{ $0 }
//è¾“å‡º["a", "b", "10"]
```



<br/><br/>
> <h2 id='å‡½æ•°ä½œä¸ºå‚æ•°'>å‡½æ•°ä½œä¸ºå‚æ•°</h2>
<br/>

> <h3 id='å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼'>å‡½æ•°å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼</h3>

```swift

func makeIncrementer() ->((Int) -> Int) {
   func addOne(number: Int) -> Int {
       return 1 + number
   }
   return addOne
}

//åˆå§‹åŒ–å½“å‰å‡½æ•°ï¼Œincrementä¸ºå½“å‰å‡½æ•°çš„è¿”å›å€¼,ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°
+ var increment = makeIncrementer()


//incrementå‡½æ•°ä¸­ä¼ å…¥å€¼
- let result = increment(7)

print(result)

```

<br/>
<br/>

> <h3 id='å‡½æ•°ä¹Ÿå¯ä»¥å½“åšå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°'>å‡½æ•°ä¹Ÿå¯ä»¥å½“åšå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°</h3>

```

func hasAnyMatches(list:[Int], condition:(Int) -> Bool) ->Bool {
  for item in list {
      if condition(item) {
          return true;
      }
  }
  return false;
}


func lessThanTen(number: Int) ->Bool {
  return number < 10
}

let number = [8, 9, 10, 11]
let result = hasAnyMatches(list: number, condition: lessThanTen)


+ //æ‰§è¡Œé¡ºåºï¼šå…ˆéå† number ä¸º item,åœ¨å°†itemä¼ å…¥ç¬¬äºŒä¸ªå‡½æ•° conditionè·å–ç»“æœ
print(result)

```







<br/>

***
<br/>
<br/>



> <h1 id='é—­åŒ…'>é—­åŒ…</h1>

<br/>

***
<br/>


># <h1 id='é—­åŒ…'>é—­åŒ…</h1>

<br/>
<br/>

> <h2 id=' é—­åŒ…å˜é‡'> é—­åŒ…å˜é‡</h2>

```
var mySecondClosure:(_ a: Int, _ b: Int) -> Int = {
        (a: Int, b: Int) -> Int in
        return a * b
    }


let c = mySecondClosure(3, 5)
print("é—­åŒ…å˜é‡ mySecondClosure çš„é—­åŒ…å€¼ï¼š\(c)")

```
æ‰“å°ï¼š

```
é—­åŒ…å˜é‡ mySecondClosure çš„é—­åŒ…å€¼ï¼š15
```

<br/>
<br/>

> <h2 id='é—­åŒ…å‚æ•°'>é—­åŒ…å‚æ•°</h2>

```
func myOperation(_ a: Int, _ b: Int, operation: (_ oa: Int, _ ob: Int) -> Int) -> Int {
        let res = operation(a, b)
        return res
    }


//ä½¿ç”¨
/*

//è¢«æ•è·çš„å‚æ•°åˆ—è¡¨ä¸­ï¼Œå«æœ‰aã€bï¼Œä¸‹æ ‡ä»0å¼€å§‹ï¼Œå¯é€šè¿‡"$"è·å–ã€‚
//ç¼–è¯‘å™¨äº¦å¯é€šè¿‡ï¼Œæ•è·åˆ—è¡¨è‡ªè¡Œæ¨æ–­å‡ºå‚æ•°ã€‚
//æ•…å¯çœç•¥å‚æ•°åˆ—è¡¨ ï¼ˆa, bï¼‰å’Œ å…³é”®å­— in 
let multipyClosure:(Int, Int) -> Int = {
      $0 * $1
}
  
//è‹¥å‡½æ•°ä½“åªåŒ…å«ä¸€å¥ return ä»£ç ï¼Œå¯çœç•¥ return      
let multipyClosure = {
      (a: Int, b: Int) in
       a * b
 }
 */

//ä¸Šè¿°ä¸¤ä¸ªé—­åŒ…çš„å†™æ³•ä¸ä¸‹åŒæ ·        
let multipyClosure = {
      (a: Int, b: Int) in
       return a * b
}
        
let d = myOperation(9, 10, operation: multipyClosure)
print("å‚æ•°é—­åŒ… operation è¿”å›å€¼ï¼š\(d)")


//é—­åŒ…çš„å±•å¼€-----------------------------------------------

func myOperation(_ a: Int, _ b: Int, operation: (_ oa: Int, _ ob: Int) -> Int) -> Int {
        let res = operation(a, b)
        return res
}

let d = self.myOperation(9, 10) { (a: Int, b: Int) -> Int in
      return a * b
 }
print("å‚æ•°é—­åŒ… operation è¿”å›å€¼:  \(d)")        

```
æ‰“å°ï¼š

```
å‚æ•°é—­åŒ… operation è¿”å›å€¼ï¼š90
```

<br/>
<br/>

> <h2 id='é—­åŒ…æ•è·'>é—­åŒ…æ•è·</h2>

```
var count = 2
let incrementCount = {
    count += 8
}

incrementCount()
print("ç¬¬ 1 æ¬¡è®¡ç®—: \(count)")

incrementCount()
print("ç¬¬ 2 æ¬¡è®¡ç®—: \(count)")
```
æ‰“å°ï¼š

```
ç¬¬ 1 æ¬¡è®¡ç®—: 10

ç¬¬ 2 æ¬¡è®¡ç®—: 18
```

&emsp;  ç”±äºé—­åŒ…å®šä¹‰å’Œå˜é‡countåœ¨åŒä¸€ä½œç”¨åŸŸä¸­ï¼Œæ•…é—­åŒ…å¯ä»¥æ•è·å¹¶è®¿é—®å˜é‡countã€‚å¯¹å˜é‡counteråšçš„ä»»ä½•æ”¹å˜ï¼Œå¯¹é—­åŒ…æ¥è¯´éƒ½æ˜¯é€æ˜å¯è§çš„ã€‚

<br/>
<br/>

> <h3 id='å‡½æ•°æ•è·å€¼'>å‡½æ•°æ•è·å€¼</h3>

```
func countingClosure() -> () -> Int {
	var counter = 0
	let incrementCounter: () -> Int = {
	    counter += 1
	    return counter
	}
	return incrementCounter
}


//è¯¥ä¾‹å­ä¸­ï¼Œé—­åŒ…æ•è·äº†å°é—­ç©ºé—´ï¼ˆå‡½æ•°å®ä½“å†…ï¼‰çš„å†…éƒ¨å˜é‡counterã€‚
let counter1 = countingClosure()  //è¿”å›çš„æ˜¯ä¸€ä¸ª () -> Int é—­åŒ… 
let counter2 = countingClosure()

let count_1 = counter1() // 1, æ‰§è¡Œ () -> Int é—­åŒ…ä¸­çš„å‡½æ•°å®šä¹‰
print("\(String(describing: count_1))")

let count_2 = counter2() // 1
print("\(String(describing: count_2))")

let count_3 = counter1() // 2
print("\(String(describing: count_3))")

let count_4 = counter1() // 3
print("\(String(describing: count_4))")

let count_5 = counter2() // 2
print("\(String(describing: count_5))")
```
æ‰“å°ï¼š

```
1
1
2
3
2
```


<br/>
<br/>

<h2 id="é—­åŒ…çš„æŸ¯è¥¿ç‰¹æ€§">é—­åŒ…çš„æŸ¯è¥¿ç‰¹æ€§</h2>

```
func keXiTest_add(adder: Int)-> (Int) -> Int {
    print("ğŸ \(adder)")
    return { num in
        print("ğŸ \(adder) å’Œ \(num)")

        return num + adder;
    }
}    
    
//ä¸Šé¢ç›¸å½“äºä¸‹é¢çš„
//å®šä¹‰ä¸€ä¸ªæ¥æ”¶å‚æ•°num1ï¼Œè¿”å›ä¸€ä¸ªæ¥æ”¶å‚æ•°num2 çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ºIntç±»å‹çš„å‡½æ•°
func keXiTest_add2(num1 : Int) -> (_ num2 : Int) -> Int {
    print("ğŸŠ \(num1)")

    //ä¸€ä¸ªæ¥æ”¶å‚æ•°num2çš„å‡½æ•°ï¼Œå¹¶ä¸”æœ‰è¿”å›ç»“æœä¸ºIntç±»å‹çš„å‡½æ•°
    return { (num2: Int) -> Int in
        print("ğŸŠ \(num1) å’Œ \(num2)")

        
        return num1 + num2
    }
}


//æ–¹æ³•è°ƒç”¨
//å®ç°ä¸€ä¸ªæ•°åŠ 2 ï¼Œè¿™é‡Œå°±æ˜¯æ¥æ”¶éœ€è¦ç›¸åŠ çš„æ•°å­—ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå‡½æ•° Int -> Int,å…¶å®è¿™å°±æ˜¯ä¸€ä¸ªé—­åŒ…
let addTwo = keXiTest_add(adder: 2)
//è¿”å›çš„å‡½æ•°å°†æ¥æ”¶è¾“å…¥çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„4.ç„¶åè¿›è¡Œæ“ä½œè¿”å›ç»“æœ
let result = addTwo(4)
print("ğŸ æŸ¯è¥¿ç‰¹æ€§æµ‹è¯• result: \(result)")


let addTwo2 = keXiTest_add2(num1: 2)
//è¿”å›çš„å‡½æ•°å°†æ¥æ”¶è¾“å…¥çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„4.ç„¶åè¿›è¡Œæ“ä½œè¿”å›ç»“æœ
let result2 = addTwo2(4)
print("ğŸŠ ----ã€‹æŸ¯è¥¿ç‰¹æ€§æµ‹è¯•2 result: \(result2)")

```

æ‰“å°:

```
ğŸ 2
ğŸ 2 å’Œ 4
ğŸ æŸ¯è¥¿ç‰¹æ€§æµ‹è¯• result: 6
ğŸŠ 2
ğŸŠ 2 å’Œ 4
ğŸŠ ----ã€‹æŸ¯è¥¿ç‰¹æ€§æµ‹è¯•2 result: 6
```


æ€»ç»“ï¼š å…¶å®æ ¹æœ¬å°±ä¸æ˜¯ä»€ä¹ˆæŸ¯è¥¿ç‰¹æ€§ï¼Œè€Œæ˜¯é—­åŒ…çš„è¿”å›ã€‚å…¶è¿”å›å€¼ä¸å†æ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹çš„å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªé—­åŒ…ã€‚


<br/><br/><br/>

> <h2 id="ç«‹å³æ‰§è¡Œé—­åŒ…">ç«‹å³æ‰§è¡Œé—­åŒ…</h2>

åœ¨ Swift ä¸­ï¼Œè¿™ç§è¯­æ³•æ˜¯ä¸€ç§**ç«‹å³æ‰§è¡Œé—­åŒ…**ï¼ˆImmediately Invoked Closure Expression, IICEï¼‰ã€‚è®©æˆ‘ä»¬æ‹†è§£ä¸€ä¸‹ï¼š

### è¯­æ³•ç»“æ„
```swift
{ 
    AClass.Path() 
}()
```

- **å¤§æ‹¬å· `{}`**ï¼šè¡¨ç¤ºä¸€ä¸ªé—­åŒ…ã€‚
- **`() -> ReturnType`**ï¼šå¯é€‰çš„é—­åŒ…å£°æ˜ï¼Œçœç•¥æ—¶ä¼šè‡ªåŠ¨æ¨å¯¼ç±»å‹ã€‚
- **`{}` å†…éƒ¨ä»£ç **ï¼šé—­åŒ…çš„ä¸»ä½“ï¼Œæ˜¯å…·ä½“çš„é€»è¾‘ä»£ç ã€‚
- **`()**`ï¼šç´§è·Ÿåœ¨é—­åŒ…åé¢çš„æ‹¬å·ï¼Œè¡¨ç¤ºè°ƒç”¨è¿™ä¸ªé—­åŒ…ã€‚

è¿™æ®µä»£ç çš„å«ä¹‰æ˜¯ï¼šå®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶ç«‹å³æ‰§è¡Œå®ƒï¼Œç»“æœå°†è¿”å›ç»™è°ƒç”¨å®ƒçš„åœ°æ–¹ã€‚

---

### ä¸ºä»€ä¹ˆç”¨è¿™ç§è¯­æ³•ï¼Ÿ
è¿™ç§è¯­æ³•çš„å¸¸è§ç”¨é€”æ˜¯ä¸ºäº†åˆå§‹åŒ–æŸäº›å¤æ‚çš„å€¼ã€‚ä¾‹å¦‚ï¼ŒæŸäº›å±æ€§éœ€è¦ç”¨å¤æ‚çš„é€»è¾‘è®¡ç®—åèµ‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªåœºæ™¯ï¼š

#### 1. åˆå§‹åŒ–å¸¸é‡æˆ–å˜é‡
```swift
let initialPath: String = {
    return AClass.Path()
}()
```

ç­‰ä»·äºï¼š
```swift
let initialPath: String
initialPath = AClass.Path()
```

ä½†ç”¨é—­åŒ…å¯ä»¥è®©åˆå§‹åŒ–é€»è¾‘çœ‹èµ·æ¥æ›´åŠ ç´§å‡‘ã€‚

---

#### 2. å±æ€§çš„æƒ°æ€§åˆå§‹åŒ–
å¯¹äºç±»æˆ–ç»“æ„ä½“ä¸­çš„å±æ€§ï¼Œä¹Ÿå¯ä»¥è¿™æ ·ç”¨ï¼š
```swift
class SomeClass {
    let path: String = {
        // å¯ä»¥åœ¨è¿™é‡Œæ”¾å¤æ‚é€»è¾‘
        return AClass.Path()
    }()
}
```

---

#### 3. é…ç½®å¯¹è±¡
å¦‚æœä½ éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–å’Œå¤æ‚é…ç½®ï¼Œä¹Ÿå¯ä»¥ç”¨è¿™ç§è¯­æ³•ï¼š
```swift
let label: UILabel = {
    let label = UILabel()
    label.text = "Hello, World!"
    label.textColor = .red
    label.textAlignment = .center
    return label
}()
```

---

### ä¼˜ç‚¹
1. **æ¸…æ™°æ€§**ï¼šåˆå§‹åŒ–é€»è¾‘è¢«å°è£…åœ¨é—­åŒ…ä¸­ï¼Œé€»è¾‘ç´§å‡‘ä¸”å®¹æ˜“ç»´æŠ¤ã€‚
2. **ç®€æ´æ€§**ï¼šé¿å…é‡å¤å†™å¤šè¡Œä»£ç ï¼Œåˆå§‹åŒ–åé©¬ä¸Šè¿”å›ã€‚
3. **ä¸€æ¬¡æ€§ä½¿ç”¨**ï¼šé€‚åˆåªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡çš„åœºæ™¯ã€‚

---

### æ³¨æ„äº‹é¡¹
1. **é—­åŒ…æ‰§è¡Œæ—¶æœº**ï¼šç«‹å³æ‰§è¡Œé—­åŒ…åœ¨å®šä¹‰æ—¶å°±ä¼šè¢«æ‰§è¡Œï¼Œä¸ä¼šå»¶è¿Ÿã€‚
2. **å¯èƒ½æ•è·å¤–éƒ¨å˜é‡**ï¼šå¦‚æœé—­åŒ…å†…éƒ¨ä½¿ç”¨äº†å¤–éƒ¨å˜é‡ï¼Œå®ƒä¼šæ•è·è¿™äº›å˜é‡ã€‚
   ```swift
   var value = 42
   let result = { value * 2 }()
   print(result) // è¾“å‡º 84
   ```

---

è¿™å°±æ˜¯ `{ ... }()` çš„ç”¨æ³•åŠå…¶åŸç†ã€‚æ˜¯å¦éœ€è¦æ›´å¤šç¤ºä¾‹ï¼Ÿ


<br/><br/><br/>
> <h2 id="ç±»ä¼¼RxSwiftæ•°æ®è½¬æ¢">ç±»ä¼¼RxSwiftæ•°æ®è½¬æ¢</h2>

**RxSwiftä¸€æ®µä»£ç ï¼š**

```
typealias SubscribeHandler = (AnyObserver<Element>) -> Disposable
```


&emsp; å¦‚æœä½ åœ¨ **`SonClass`** ä¸­ä½¿ç”¨ `typealias NetHandler = (AClass<Int>) -> BClass`ï¼Œé€šå¸¸æ˜¯ä¸ºäº† **å°è£…ç½‘ç»œè¯·æ±‚ã€æ•°æ®è½¬æ¢æˆ–è€…å¼‚æ­¥æ“ä½œ**ã€‚  

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

- **ç¤ºä¾‹åœºæ™¯**
	- 1.**`AClass<T>`** ä»£è¡¨è¾“å…¥çš„æ•°æ®ï¼Œæ¯”å¦‚è¯·æ±‚å‚æ•°æˆ–å“åº”æ•°æ®ç»“æ„ã€‚  
	- 2.**`BClass`** ä»£è¡¨å¤„ç†åçš„æ•°æ®ï¼Œæ¯”å¦‚è§£æåçš„æ¨¡å‹å¯¹è±¡ã€‚  
	- 3.**`NetHandler`** å¤„ç† `AClass<Int>` å¹¶è¿”å› `BClass`ã€‚  
	- 4.**`SonClass`** ç»´æŠ¤ `NetHandler`ï¼Œåœ¨å†…éƒ¨è°ƒç”¨å®ƒå¹¶è¿”å›ç»“æœã€‚  

---
- **ä»£ç ç¤ºä¾‹**

```swift
// 1ï¸âƒ£ å®šä¹‰ AClass<T> å’Œ BClass
class AClass<T> {
    var value: T
    init(value: T) {
        self.value = value
    }
}

class BClass {
    var result: String
    init(result: String) {
        self.result = result
    }
}

// 2ï¸âƒ£ åœ¨ SonClass ä¸­ä½¿ç”¨ typealias NetHandler
class SonClass {
    typealias NetHandler = (AClass<Int>) -> BClass  // å¤„ç†é€»è¾‘ï¼šæ¥æ”¶ AClass<Int>ï¼Œè¿”å› BClass

    let netHandler: NetHandler  // å£°æ˜å¤„ç†é€»è¾‘
    
    init(netHandler: @escaping NetHandler) {
        self.netHandler = netHandler  // èµ‹å€¼å¤„ç†é€»è¾‘
    }
    
    func processData(input: AClass<Int>) -> BClass {
        return netHandler(input)  // è§¦å‘å¤„ç†é€»è¾‘
    }
}

// 3ï¸âƒ£ ä½¿ç”¨ SonClass
let son = SonClass { input in
    let transformedValue = "å¤„ç†åçš„å€¼: \(input.value * 10)"  // ç®€å•è½¬æ¢
    return BClass(result: transformedValue)  // è¿”å› BClass å®ä¾‹
}

// 4ï¸âƒ£ ä¼ å…¥ AClass<Int> å®ä¾‹å¹¶å¤„ç†
let inputData = AClass(value: 5)
let outputData = son.processData(input: inputData)

print(outputData.result)  // è¾“å‡ºï¼š"å¤„ç†åçš„å€¼: 50"
```

---
- **ä»£ç è§£æ**
	- 1.**`AClass<T>`**ï¼šæ³›å‹ç±»ï¼Œæ¨¡æ‹Ÿè¯·æ±‚å‚æ•°æˆ–æ•°æ®å¯¹è±¡ã€‚  
	- 2.**`BClass`**ï¼šè¿”å›çš„æ•°æ®ç±»å‹ï¼Œå°è£…å¤„ç†åçš„ç»“æœã€‚  
	- 3.**`NetHandler`**ï¼š
	   - `typealias NetHandler = (AClass<Int>) -> BClass`  
	   - **è¾“å…¥ `AClass<Int>`ï¼Œè¿”å› `BClass`**ã€‚
	- 4.**`SonClass`**ï¼š
   - `netHandler` ä½œä¸º `SonClass` çš„å¤„ç†é€»è¾‘ï¼Œåœ¨ `init` æ—¶ä¼ å…¥ã€‚
   - `processData(input:)` é€šè¿‡ `netHandler` å¤„ç†æ•°æ®ï¼Œå¹¶è¿”å› `BClass`ã€‚
	- 5.**å®é™…è°ƒç”¨**ï¼š
   - `son.processData(AClass(value: 5))` å¤„ç†è¾“å…¥æ•°æ® `5`ï¼Œè¿”å› `"å¤„ç†åçš„å€¼: 50"`ã€‚

---
- **æ€»ç»“**
	- `NetHandler` **å°è£…æ•°æ®è½¬æ¢é€»è¾‘**ï¼Œ`SonClass` é€šè¿‡ `processData()` è§¦å‘å®ƒã€‚  
	- é€‚ç”¨äº **ç½‘ç»œæ•°æ®å¤„ç†ã€æ•°æ®è½¬æ¢ã€ç¼“å­˜ç®¡ç†ç­‰åœºæ™¯**ã€‚  
	- `init(netHandler: @escaping NetHandler)` è®© `SonClass` æ”¯æŒ **è‡ªå®šä¹‰å¤„ç†é€»è¾‘**ã€‚  

è¿™ç§æ¨¡å¼ **é«˜å†…èšã€ä½è€¦åˆ**ï¼Œå¯ä»¥çµæ´»æ›¿æ¢ `NetHandler` é€»è¾‘ï¼Œä½¿ `SonClass` æ›´å…·å¯æ‰©å±•æ€§ ğŸš€ã€‚


<br/><br/><br/>

***
<br/>
># <h1 id='å¼‚å¸¸'>[å¼‚å¸¸](https://gitbook.swiftgg.team/swift/swift-jiao-cheng/17_error_handling)</h1>

- Swift1.0ç‰ˆæœ¬ Cocoa Touch çš„ NSError ,Swiftå¹¶æ²¡æœ‰çœŸæ­£çš„å…·å¤‡è‡ªå·±çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼›
-  Swift2.0ç‰ˆæœ¬ åŠ å…¥ ErrorType protocolï¼›
-  Swift3.0ç‰ˆæœ¬ æ”¹å Error protocolï¼›

&emsp;  Swift3.0 Error protocol çš„ä½¿ç”¨é¦–å…ˆå®šä¹‰ä¸€ä¸ªæšä¸¾,é›†æˆåè®®Error (Swift 2.0 çš„åè®®å«åšErrorType,3.0ååè®®æ”¹åError)

```swift
enum MyError : Error {
    case one
    case two
    case three
}
```


<br/><br/>
> <h2 id='throwingå‡½æ•°'>throwingå‡½æ•°</h2>

ä»€ä¹ˆæ˜¯throwingå‡½æ•°å‡½æ•°å‘¢?

&emsp; "throwingå‡½æ•°"é€šå¸¸æ˜¯æŒ‡èƒ½å¤ŸæŠ›å‡ºé”™è¯¯çš„å‡½æ•°ã€‚Swiftä½¿ç”¨é”™è¯¯å¤„ç†æœºåˆ¶æ¥å¤„ç†åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µã€‚ä¸å…¶ä»–è¯­è¨€ä¸­ä½¿ç”¨å¼‚å¸¸å¤„ç†ç±»ä¼¼ï¼ŒSwiftä½¿ç”¨é”™è¯¯å¤„ç†æ¥å“åº”å’Œä¼ æ’­é”™è¯¯ã€‚

```swift
enum CustomError: Error {
    case someError
}

func throwingFunction() throws {
    // è¿™ä¸ªå‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯
    throw CustomError.someError
}

do {
    try throwingFunction()
    // å¦‚æœæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œæ‰§è¡Œè¿™é‡Œçš„ä»£ç 
} catch {
    // å¦‚æœæŠ›å‡ºé”™è¯¯ï¼Œæ‰§è¡Œè¿™é‡Œçš„ä»£ç 
    print(error)
}
```
åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒthrowingFunctionå‡½æ•°è¢«æ ‡è®°ä¸ºthrowsï¼Œå¹¶ä¸”æŠ›å‡ºäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„é”™è¯¯CustomError.someErrorã€‚åœ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨do-catchå—æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ**`throws`æ˜¯å°†å‡½æ•°æ ‡è®°ä¸ºå¯æŠ›å‡ºçš„æ–¹å¼æ¥è¿›è¡Œå®ç°**.`throws`å…³é”®å­—åªèƒ½ç”¨äº**å‡½æ•°ã€æ–¹æ³•å’Œé—­åŒ…çš„å£°æ˜**ä¸­ã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œä½ ä½¿ç”¨throwè¯­å¥æ¥æŠ›å‡ºå®é™…çš„é”™è¯¯ã€‚

<br/>

**æ¡ˆä¾‹:**

```swift
enum DivisionError: Error {
    case divisionByZero
}

func divide(_ numerator: Int, by denominator: Int) throws -> Int {
    if denominator == 0 {
        throw DivisionError.divisionByZero
    }
    
    return numerator / denominator
}

// ä½¿ç”¨ do-catch å—æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯
func testTryCatchExceptionn()  {
    print("æ•è·å¼‚å¸¸å¼€å§‹>>>>>>>>>")
    // ä½¿ç”¨ do-catch å—æ¥å¤„ç†å¯èƒ½çš„é”™è¯¯
    do {
        let result = try divide(10, by: 2)
        print("Result: \(result)")
        
        // å°è¯•é™¤ä»¥é›¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯
        let invalidResult = try divide(5, by: 0)
        print("This line will not be executed.")
    } catch DivisionError.divisionByZero {
        print("Error: Division by zero is not allowed.")
    } catch {
        print("An unexpected error occurred: \(error)")
    }
    print("æ•è·å¼‚å¸¸ç»“æŸ<<<<<<<<<<<<<")

}

```

æ‰“å°:

```
æ•è·å¼‚å¸¸å¼€å§‹>>>>>>>>>
Result: 5
Error: Division by zero is not allowed.
æ•è·å¼‚å¸¸ç»“æŸ<<<<<<<<<<<<<
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdivide(_:_:) å‡½æ•°é€šè¿‡æ£€æŸ¥é™¤æ•°æ˜¯å¦ä¸ºé›¶æ¥é˜²æ­¢é™¤ä»¥é›¶çš„æƒ…å†µã€‚å¦‚æœå°è¯•é™¤ä»¥é›¶ï¼Œå‡½æ•°å°†æŠ›å‡ºä¸€ä¸ª DivisionError.divisionByZero é”™è¯¯ã€‚åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ try å…³é”®å­—ï¼Œå¹¶ä½¿ç”¨ do-catch å—æ•è·å¯èƒ½çš„é”™è¯¯ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯å‘ç”Ÿï¼Œä»£ç å°†ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæŠ›å‡ºäº†é”™è¯¯ï¼Œç›¸åº”çš„ catch å—å°†è¢«æ‰§è¡Œï¼Œå¤„ç†ç‰¹å®šçš„é”™è¯¯ç±»å‹ã€‚

<br/><br/><br/>

># <h2 id='ä¸‰è€…åŒºåˆ«'>ä¸‰è€…åŒºåˆ«</h2> 

- try å‡ºç°å¼‚å¸¸å¤„ç†å¼‚å¸¸
- try? ä¸å¤„ç†å¼‚å¸¸,è¿”å›ä¸€ä¸ªå¯é€‰å€¼ç±»å‹,å‡ºç°å¼‚å¸¸è¿”å›nil
- try! ä¸è®©å¼‚å¸¸ç»§ç»­ä¼ æ’­,ä¸€æ—¦å‡ºç°å¼‚å¸¸ç¨‹åºåœæ­¢,ç±»ä¼¼NSAssert()

```swift
public static func practiceException01() {
    print("<<<<<<<<<< å¼‚å¸¸æ•è·å‰")
    do {
        let newTitle = try? self.practiceException01_00()
        if let netTitle = newTitle {
            print("ğŸ 00: \(netTitle)")
        }
        
        
        let finalTitle = try self.practiceException01_01()
        print("ğŸ 01: \(finalTitle)")
        
        print("ğŸ 02: å¸ˆå…„å•Šå¸ˆå…„- è©æç é¥°!!!!")
    }catch {
        print("âŒ æ•è·åˆ°å¼‚å¸¸é”™è¯¯:\(error.localizedDescription)")
    }
    print("<<<<<<<<<< å¼‚å¸¸æ•è·å")
    print("ğŸŒµ å¼‚å¸¸ä¸‹ç»§ç»­æ‰§è¡Œ")
}
// throwså°†å‡½æ•°æ ‡è®°ä¸ºå¯æŠ›å‡ºçš„æ–¹å¼æ¥è¿›è¡Œå®ç°
public static func practiceException01_01() throws -> String {
    let isActive: Bool = true
    
    if isActive {
        return "å¸ˆå…„å•Šå¸ˆå…„- å¤ªç™½é‡‘æ˜Ÿ!!!!"
    } else {
        throw URLError(.badServerResponse)
    }
}

public static func practiceException01_00() throws -> String {
    let isActive: Bool = false
    
    if isActive {
        return "å¸ˆå…„å•Šå¸ˆå…„- äº‘éœ„!!!!"
    } else {
        throw URLError(.appTransportSecurityRequiresSecureConnection)
    }
}
```

***
ä½¿ç”¨:

```sh
<<<<<<<<<< å¼‚å¸¸æ•è·å‰
âŒ æ•è·åˆ°å¼‚å¸¸é”™è¯¯:The operation couldnâ€™t be completed. (NSURLErrorDomain error -1011.)
<<<<<<<<<< å¼‚å¸¸æ•è·å
ğŸŒµ å¼‚å¸¸ä¸‹ç»§ç»­æ‰§è¡Œ
```

- **ç»“åˆä»£ç å’Œè¿è¡Œç»“æœçœ‹åˆ°:**
	- å¯ä»¥çœ‹åˆ°æ‰§è¡Œæ•è·å¼‚å¸¸`do{} catch{}`ä»£ç å—å,ä»£ç ä¼šç»§ç»­æ‰§è¡Œ;
	- åœ¨`do{}`ä»£ç å—å†…, å³ä½¿æˆ‘ä»¬ä½¿ç”¨`try?`æ•è·åˆ°å¼‚å¸¸å,å› ä¸º`try?`ä¼šä½¿ç»“æœä¸ºnil,æ‰€ä»¥ä»£ç å¯ä»¥ç»§ç»­æ‰§è¡Œ;
	- åœ¨æ•è·åˆ°å¼‚å¸¸å,`do{}`å†…çš„ä»£ç ä¸ä¼šå†æ‰§è¡Œäº†.


<br/><br/>
> <h2 id='try?çš„ä½¿ç”¨'>**try? çš„ä½¿ç”¨**</h2>

**`try?`**, å¦‚æœä¸æƒ³å¤„ç†å¼‚å¸¸é‚£ä¹ˆå¯ä»¥ç”¨è¿™ä¸ªå…³é”®å­—,ä½¿ç”¨è¿™ä¸ªå…³é”®å­—è¿”å›ä¸€ä¸ªå¯é€‰å€¼ç±»å‹,å¦‚æœæœ‰å¼‚å¸¸å‡ºç°,è¿”å›nil.å¦‚æœæ²¡æœ‰å¼‚å¸¸,åˆ™è¿”å›å¯é€‰å€¼

```swift
func testFunc(str: String) throws -> String  {
    if str == "one" {
        throw MyError.one
    }else if str == "two" {
        throw MyError.two
    }else if str == "three" {
        throw MyError.three
    }
    return "ok"
}

let str = try? testFunc(str: "three")
print(str)
```
æ‰“å°ï¼š

```
nil
```

<br/><br/>
> <h3 id='try!'>try!</h3>

&emsp; å¦‚æœä¸æƒ³å¤„ç†å¼‚å¸¸,è€Œä¸”ä¸æƒ³è®©å¼‚å¸¸ç»§ç»­ä¼ æ’­ä¸‹å»,å¯ä»¥ä½¿ç”¨try!.è¿™æœ‰ç‚¹å„¿ç±»ä¼¼NSAssert().ä½†æ˜¯ä¸€æ—¦ä½¿ç”¨try!å,åœ¨å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ä¸­æŠ›å‡ºäº†å¼‚å¸¸,é‚£ä¹ˆç¨‹åºä¼šç«‹åˆ»åœæ­¢.

```swift
let str = try! testFunc(str: "three")
print(str)
```

ç¨‹åºCrash

![ios_swift0_4.png](./../../Pictures/ios_swift0_4.png)

<br/><br/>
>## <h3 id='try'>**try**</h3>

```swift
do {
    let str = try testFunc(str: "three")
    let str1 = try testFunc(str: "333")
    print("++++>> \(str)")
    print("--->> \(str1)")

} catch MyError.one {
    print("MyError.one")
} catch MyError.two {
    print("MyError.two")
} catch let error as MyError {
    print(error)
} catch {

}

///æˆ–è€…å¦‚ä¸‹
do {
    let str = try testFunc(str: "three")
    let str1 = try testFunc(str: "333")
    print("++++>> \(str)")
    print("--->> \(str1)")

} catch MyError.one {
    print("MyError.one")
} catch MyError.two {
    print("MyError.two")
} catch {
    print(error)
}
```

éƒ½æ‰“å°ä¸ºï¼š

```
three
```


<br/>

***
<br/><br/><br/>

># <h1 id='æ³›å‹åè®®'>[æ³›å‹åè®®](http://chuquan.me/2021/09/25/swift-generic-protocol/)</h1>

<br/><br/>
> <h2 id='æ³›å‹'>æ³›å‹</h2>
<br/>

> <h2 id="èŒƒå‹çš„é«˜çº§ä½¿ç”¨-ç±»å‹æ“¦é™¤">èŒƒå‹çš„é«˜çº§ä½¿ç”¨-ç±»å‹æ“¦é™¤</h2>
åœ¨ Swift ä¸­ï¼Œâ€œç±»å‹æ“¦é™¤â€ï¼ˆType Erasureï¼‰æ˜¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œä¸»è¦ç”¨äºéšè—å…·ä½“çš„ç±»å‹ä¿¡æ¯ï¼Œä½¿å¾—ä»£ç èƒ½å¤Ÿåœ¨ä¿ç•™æ³›å‹çµæ´»æ€§çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œç±»å‹æŠ½è±¡ã€‚

ç±»å‹æ“¦é™¤é€šå¸¸åœ¨å¤„ç†åè®®æˆ–æ³›å‹æ—¶ä½¿ç”¨ï¼Œå› ä¸ºåè®®æœ¬èº«ä¸èƒ½ç›´æ¥ä½œä¸ºä¸€ç§ç±»å‹æ¥ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªåè®®ä¸­æœ‰ä¸å…³è”ç±»å‹æˆ– Self ç›¸å…³çš„è¦æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªåè®®å°±ä¸èƒ½ç›´æ¥ç”¨ä½œå‡½æ•°çš„å‚æ•°ç±»å‹ã€è¿”å›ç±»å‹æˆ–å­˜å‚¨å±æ€§çš„ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ç”¨åˆ°ç±»å‹æ“¦é™¤ã€‚

<br/>

- **ç±»å‹æ“¦é™¤çš„å®ç°æ­¥éª¤:**
	- å®šä¹‰ä¸€ä¸ªåè®®ï¼šåè®®ä¸­åŒ…å«éœ€è¦çš„æ–¹æ³•æˆ–å±æ€§ï¼Œå¯èƒ½åŒ…å«å…³è”ç±»å‹ã€‚
	- åˆ›å»ºç±»å‹æ“¦é™¤åŒ…è£…å™¨ï¼šä¸€ä¸ªæ³›å‹ç»“æ„ä½“æˆ–ç±»ï¼Œéµå¾ªè¯¥åè®®ã€‚
	- åœ¨åŒ…è£…å™¨ä¸­å­˜å‚¨é—­åŒ…ï¼šå°†åè®®æ–¹æ³•çš„å®ç°é€šè¿‡é—­åŒ…ä¿å­˜ï¼Œä»è€Œéšè—å…·ä½“ç±»å‹ã€‚

<br/><br/>
> <h3 id="åè®®æ“¦é™¤">åè®®æ“¦é™¤</h3>
**ç¤ºä¾‹ï¼šä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰çš„ç±»å‹æ“¦é™¤**

- **1.å®šä¹‰åè®®**
åè®® Generator åŒ…å«ä¸€ä¸ªå…³è”ç±»å‹ Value å’Œä¸€ä¸ªç”Ÿæˆä¸‹ä¸€ä¸ªå€¼çš„æ–¹æ³•ï¼š

```swift
protocol Generator {
    associatedtype Value
    mutating func next() -> Value?
}
```
<br/>

**2.åˆ›å»ºç±»å‹æ“¦é™¤åŒ…è£…å™¨**

```
struct AnyGenerator<T>: Generator {
    typealias Value = T
    private let _next: () -> T?
    
    init<G: Generator>(_ generator: G) where G.Value == T {
        var generator = generator
        _next = { generator.next() }
    }
    
    func next() -> T? {
        _next()
    }
}
```
- AnyGenerator åŒ…è£…äº†ä»»æ„éµå¾ª Generator çš„å…·ä½“ç±»å‹ã€‚
- é—­åŒ… _next æ•è·åŸå§‹ç”Ÿæˆå™¨çš„ next() æ–¹æ³•ï¼Œéšè—äº†å…·ä½“ç±»å‹ Gã€‚
<br/>

**3.å®ç°å…·ä½“ç”Ÿæˆå™¨**

ç¤ºä¾‹1ï¼šå€’è®¡æ—¶ç”Ÿæˆå™¨ï¼ˆæ•´æ•°ï¼‰

```swift
struct CountdownGenerator: Generator {
    typealias Value = Int
    var count: Int
    
    init(start: Int) {
        count = start
    }
    
    mutating func next() -> Int? {
        guard count >= 0 else { return nil }
        defer { count -= 1 }
        return count
    }
}
```
<br/>
ç¤ºä¾‹2ï¼šå­—ç¬¦ä¸²ç”Ÿæˆå™¨

```swift
struct StringGenerator: Generator {
    typealias Value = String
    var strings: [String]
    var index: Int = 0
    
    init(strings: [String]) {
        self.strings = strings
    }
    
    mutating func next() -> String? {
        guard index < strings.count else { return nil }
        defer { index += 1 }
        return strings[index]
    }
}
```
<br/>

**4.ä½¿ç”¨ç±»å‹æ“¦é™¤åŒ…è£…å™¨ï¼š**

```swift
// åŒ…è£…å€’è®¡æ—¶ç”Ÿæˆå™¨
let countdown = CountdownGenerator(start: 3)
let anyCountdown = AnyGenerator(countdown)

// åŒ…è£…å­—ç¬¦ä¸²ç”Ÿæˆå™¨
let strings = StringGenerator(strings: ["Hello", "World", "!"])
let anyStrings = AnyGenerator(strings)

// ç»Ÿä¸€å¤„ç†ä¸åŒç±»å‹ç”Ÿæˆå™¨
func printValues<T>(from generator: AnyGenerator<T>) {
    var gen = generator
    while let value = gen.next() {
        print(value)
    }
}

printValues(from: anyCountdown) // è¾“å‡º 3, 2, 1, 0
printValues(from: anyStrings)    // è¾“å‡º Hello, World, !
```
- **å…³é”®ç‚¹è§£æ**
	- éšè—å…·ä½“ç±»å‹ï¼šAnyGenerator å…è®¸å°†ä¸åŒå…·ä½“ç±»å‹çš„ Generatorï¼ˆå¦‚ CountdownGenerator å’Œ StringGeneratorï¼‰ç»Ÿä¸€å¤„ç†ã€‚
	- é—­åŒ…æ•è·ï¼šé€šè¿‡é—­åŒ… _next ä¿å­˜åŸå§‹ç”Ÿæˆå™¨çš„ next() æ–¹æ³•ï¼Œç»•è¿‡åè®®å…³è”ç±»å‹çš„é™åˆ¶ã€‚
	- æ³›å‹çº¦æŸï¼šåˆå§‹åŒ–æ—¶é€šè¿‡ where G.Value == T ç¡®ä¿å…³è”ç±»å‹ä¸€è‡´ã€‚

<br/><br/>
> <h2 id="èŒƒå‹æ“¦é™¤">èŒƒå‹æ“¦é™¤</h2>
**ä¸¾ä¾‹è¯´æ˜**
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåè®® Animalï¼Œå®ƒæœ‰ä¸€ä¸ªå…³è”ç±»å‹ Foodï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ªå–‚é£Ÿçš„å‡½æ•°

```swift
protocol Animal {
    associatedtype Food
   
    func feed(_ food: Food)
}
```
<br/>
å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªå¯ä»¥ä¿å­˜ä»»æ„ Animal çš„æ•°ç»„ï¼Œæ¯”å¦‚ï¼š

```swift
var animals: [Animal] = []  // è¿™æ˜¯ä¸å…è®¸çš„
```

ä¸Šé¢çš„ä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸º Animal åè®®æœ‰ä¸€ä¸ªå…³è”ç±»å‹ Foodï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å°† Animal ç”¨ä½œå…·ä½“çš„ç±»å‹ã€‚
<br/>

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å‹æ“¦é™¤ï¼Œæ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥å­˜å‚¨ä»»æ„ Animal çš„å®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç±»å‹æ“¦é™¤çš„åŒ…è£…å™¨ AnyAnimalï¼š

```swift
// MARK: - å®šä¹‰ç±»å‹æ“¦é™¤åŒ…è£…å™¨
class AnyAnimal<FoodType>: Animal {
    private let _feed: (FoodType) -> Void
    
    /**
     * æ³›å‹å‚æ•° <A: Animal>ï¼š
     *      è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæ³›å‹å‚æ•° Aï¼Œå¹¶è¦æ±‚ A å¿…é¡»éµå¾ª Animal åè®®ã€‚
     *      å› ä¸º Animal åè®®åŒ…å«ä¸€ä¸ªå…³è”ç±»å‹ Foodï¼Œæ‰€ä»¥ä¸åŒçš„ Animal å®ç°å¯èƒ½æœ‰ä¸åŒçš„ Food ç±»å‹ã€‚
     *
     *
     *where A.Food == FoodType çº¦æŸï¼š
     *      è¿™ä¸ª where å­å¥è¦æ±‚ä¼ å…¥çš„ Animal å®ä¾‹çš„ Food ç±»å‹å¿…é¡»ä¸ AnyAnimal æ³›å‹å‚æ•° FoodType ç›¸åŒã€‚
     *      ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰ AnyAnimal<String>ï¼Œé‚£ä¹ˆä¼ å…¥çš„ Animal å®ä¾‹å¿…é¡»æ˜¯å…¶ Food ç±»å‹ä¸º String çš„ï¼ˆæ¯”å¦‚ Dog å®ç°ä¸­ Food ä¸º Stringï¼‰ã€‚
     *
     * å‚æ•° _ animal: Aï¼š
     *      è¯¥åˆå§‹åŒ–æ–¹æ³•æ¥æ”¶ä¸€ä¸ª Animal å®ä¾‹ animalï¼Œå…¶ç±»å‹ä¸ºæ³›å‹å‚æ•° Aï¼ˆå¹¶æ»¡è¶³å‰é¢çº¦æŸï¼‰ã€‚
     */
    init<A: Animal>(_ animal: A) where A.Food == FoodType {
        _feed = animal.feed
    }
    
    func feed(_ food: FoodType) {
        _feed(food)
    }
}



// MARK: - å…·ä½“å®ç°
// ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª Dog ç»“æ„ä½“ï¼ŒAnimal çš„ Food ç±»å‹ä¸º String
struct Dog: Animal {
    typealias Food = String
    
    func feed(_ food: String) {
        LogInfo("èŒƒå‹æ“¦é™¤---- Dog is fed with \(food)")
    }
}
struct Cat: Animal {
    typealias Food = String
    
    func feed(_ food: String) {
        print("Cat is fed with \(food)")
    }
}
```
<br/>

**ä½¿ç”¨ï¼š**

```swift
@objc public static func testPatterTypeEraseAnimal() {
        
    // å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨ AnyAnimal<String> ç±»å‹çš„å¯¹è±¡
    var animals: [AnyAnimal<String>] = []
    
    let dog = Dog()
    let cat = Cat()
    
    // å°†å…·ä½“çš„ Animal å¯¹è±¡åŒ…è£…æˆ AnyAnimal<String>
    animals.append(AnyAnimal(dog))
    animals.append(AnyAnimal(cat))
    
    // éå†æ•°ç»„ï¼Œè°ƒç”¨ feed æ–¹æ³•
    for animal in animals {
        animal.feed("Bone")
    }
}
```

**logï¼š**

```
ğŸ TestTypeErase.swift: [158] - èŒƒå‹æ“¦é™¤---- Dog is fed with Bone
ğŸ TestTypeErase.swift: [165] - èŒƒå‹æ“¦é™¤---- Cat is fed with Bone
```
åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAnyAnimal ç±»é€šè¿‡ç±»å‹æ“¦é™¤éšè—äº†å…·ä½“çš„ Animal ç±»å‹ï¼Œä½¿å¾—å¯ä»¥å°†ä¸åŒçš„ Animal ç±»å‹å­˜å‚¨åœ¨åŒä¸€ä¸ªé›†åˆä¸­ã€‚

**æ€»ç»“**
&emsp; ç±»å‹æ“¦é™¤çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ä½¿ç”¨æ³›å‹æˆ–åè®®æ—¶ï¼Œéšè—ç±»å‹ä¿¡æ¯ä»¥æ»¡è¶³ API è®¾è®¡çš„éœ€æ±‚ï¼Œå¹¶ä¸”å…è®¸æ›´çµæ´»çš„ä»£ç å¤ç”¨ã€‚å®ƒåœ¨ Swift ä¸­ç»å¸¸ç”¨äºå¤„ç†æ¶‰åŠåˆ°æ³›å‹æˆ–åè®®çš„å¤æ‚åœºæ™¯ã€‚

<br/>

**ç–‘é—®ï¼šä¸ºä»€ä¹ˆåœ¨AnyAnimalæ²¡æœ‰æ˜¾å¼å£°æ˜ `typealias Food = FoodType`ï¼Ÿ**

- åœ¨è¿™é‡Œï¼ŒAnyAnimal å®ç°äº† feed(_:) æ–¹æ³•ï¼Œå…¶å‚æ•°ç±»å‹ä¸º FoodTypeã€‚
- å› ä¸º Animal åè®®è¦æ±‚çš„ feed(_:) æ–¹æ³•å¿…é¡»æ¥å—å…¶å…³è”ç±»å‹ Food çš„å‚æ•°ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨è‡ªåŠ¨æ¨æ–­å‡º AnyAnimal ä¸­çš„ Food å°±æ˜¯ FoodTypeã€‚

**è‡ªåŠ¨æ¨å¯¼**
Swift çš„ç±»å‹æ¨å¯¼æœºåˆ¶å…è®¸ä½ ä¸ç”¨æ˜¾å¼å†™å‡ºï¼š

```swift
typealias Food = FoodType
```
è€Œè®©ç¼–è¯‘å™¨è‡ªåŠ¨å°† Food ä¸ FoodType å¯¹åº”èµ·æ¥ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦ä½ æ»¡è¶³äº†åè®®æ–¹æ³•çš„ç­¾åè¦æ±‚ï¼ŒSwift å°±èƒ½çŸ¥é“ Food å°±æ˜¯ FoodTypeã€‚

å› æ­¤ï¼Œè™½ç„¶ä½ å¯ä»¥é€‰æ‹©æ˜¾å¼å£°æ˜ typealias Food = FoodType æ¥å¢å¼ºä»£ç çš„å¯è¯»æ€§ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºç¼–è¯‘å™¨å·²ç»é€šè¿‡ä½ å®ç°çš„ feed æ–¹æ³•æ¨å¯¼å‡ºäº†å…³è”ç±»å‹çš„å…·ä½“ç±»å‹ã€‚

<br/><br/>

**Demo2:èŒƒå‹ç±»å‹æ“¦é™¤**

```swift

/// å®šä¹‰åè®®
protocol Store {
    associatedtype Item
    func save(_ item: Item)
    func retrieve() -> Item?
}

/// åˆ›å»ºç±»å‹æ“¦é™¤åŒ…è£…å™¨
struct AnyStore<T>: Store {
    typealias Item = T
    private let _save: (T) -> Void
    private let _retrieve: () -> T?
    
    init<S: Store>(_ store: S) where S.Item == T {
		    // æ³¨æ„ï¼šæ­¤å¤„å¯¹äºå€¼ç±»å‹çš„ Store å¯èƒ½ä¼šå‘ç”Ÿæ‹·è´é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ class å®ç°ä»¥ç¡®ä¿å¼•ç”¨è¯­ä¹‰
        _save = { store.save($0) }
        _retrieve = { store.retrieve() }
    }
    
    func save(_ item: T) {
        _save(item)
    }
    
    func retrieve() -> T? {
        _retrieve()
    }
}

/// å®ç°å…·ä½“ç”Ÿæˆå™¨ï¼šç”¨äºä¿å­˜å­—ç¬¦ä¸²çš„ Store å®ç°
class StringStore: Store {
    typealias Item = String
    var storedItem: String?
    
    func save(_ item: String) {
        storedItem = item
    }
    
    func retrieve() -> String? {
        return storedItem
    }
}


/// æµ‹è¯•å‡½æ•°
func testProtocolTypeEraseCountdownGenerator() {
    // åˆ›å»ºå…·ä½“çš„ StringStore å¯¹è±¡
    let stringStore = StringStore()
    
    // åˆ©ç”¨ç±»å‹æ“¦é™¤åŒ…è£…æˆ AnyStore<String>
    let anyStore = AnyStore(stringStore)
    
    // ä¿å­˜ä¸€ä¸ªå­—ç¬¦ä¸²
    anyStore.save("Hello, Swift!")
    
    // å°è¯•å–å‡ºä¿å­˜çš„å­—ç¬¦ä¸²å¹¶æ‰“å°
    if let value = anyStore.retrieve() {
        print("Retrieved value: \(value)")
    } else {
        print("No value retrieved")
    }
}

// è°ƒç”¨æµ‹è¯•å‡½æ•°
testProtocolTypeEraseCountdownGenerator()
```
**log:**

```sh
Retrieved value: Hello, Swift!
```

- **è¯´æ˜ï¼š**
	- æˆ‘ä»¬é¦–å…ˆå®šä¹‰äº† Store åè®®å’Œ AnyStore ç±»å‹æ“¦é™¤åŒ…è£…å™¨ï¼ˆä¸ä½ æä¾›çš„ä»£ç ä¸€è‡´ï¼‰ã€‚
	- é€šè¿‡å®šä¹‰ä¸€ä¸ª StringStore ç±»ï¼ˆç»§æ‰¿è‡ª NSObject ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†è¿™é‡Œä½¿ç”¨ class ä»¥ç¡®ä¿å¼•ç”¨è¯­ä¹‰ï¼‰ï¼Œå®ç°äº† Store åè®®ï¼Œç”¨äºä¿å­˜å’Œè·å–ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚


<br/><br/><br/>

***
<br/>

> <h1 id='åè®®'>åè®®</h1>
[æ³›å‹å’Œåè®®å®ç°çš„åº•å±‚åŸç†](http://chuquan.me/2020/02/19/swift-performance-protocol-type-generic-type/)

<br/><br/>
> <h3 id='Sequenceåè®®'>Sequenceåè®®</h3>
Sequence æ˜¯ Swift ä¸­çš„ä¸€ä¸ªæ ‡å‡†åè®®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„å€¼ã€‚å®ƒå®šä¹‰äº†ä¸€ç»„æ“ä½œï¼Œä½¿å¾—ä½ å¯ä»¥æŒ‰ç…§ç‰¹å®šé¡ºåºå¤šæ¬¡è®¿é—®åºåˆ—çš„å…ƒç´ ï¼Œä¾‹å¦‚ä½¿ç”¨å¾ªç¯éå†æ•°ç»„æˆ–é›†åˆã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Sequence åè®®ï¼š

```swift
// å®šä¹‰ä¸€ä¸ªå®ç° Sequence åè®®çš„ç®€å•ç±»å‹
struct SimpleSequence: Sequence {
    let elements: [Int]

    // å®ç° makeIterator() æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨
    func makeIterator() -> SimpleIterator {
        return SimpleIterator(elements: elements)
    }
}

// å®šä¹‰ä¸€ä¸ªå®ç° IteratorProtocol åè®®çš„è¿­ä»£å™¨ç±»å‹
struct SimpleIterator: IteratorProtocol {
    let elements: [Int]
    var currentIndex = 0

    // å®ç° next() æ–¹æ³•ï¼Œè¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ 
    mutating func next() -> Int? {
        guard currentIndex < elements.count else {
            return nil
        }
        defer { currentIndex += 1 }
        return elements[currentIndex]
    }
}


///è°ƒç”¨
/// æµ‹è¯•Sequence
func sequenceTest() {
    // ä½¿ç”¨ Sequence åè®®
    let mySequence = SimpleSequence(elements: [1, 2, 3, 4, 5])

    for element in mySequence {
        print(element)
    }
}
```

æ‰“å°:

```
1
2
3
4
5
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒSimpleSequence ç»“æ„ä½“é‡‡ç”¨äº† Sequence åè®®ï¼Œå¹¶æä¾›äº† makeIterator() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›äº†ä¸€ä¸ªå®ç°äº† IteratorProtocol åè®®çš„è¿­ä»£å™¨ç±»å‹ SimpleIteratorã€‚é€šè¿‡å®ç° next() æ–¹æ³•ï¼ŒSimpleIterator ç±»å‹å¯ä»¥æŒ‰é¡ºåºæä¾›åºåˆ—ä¸­çš„å…ƒç´ ã€‚

<br/>

Sequence åè®®å®šä¹‰äº†ä¸€ç³»åˆ—æ“ä½œï¼Œä½¿å¾—ç±»å‹å¯ä»¥è¡¨ç¤ºä¸€ç³»åˆ—æœ‰åºå…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ for-in å¾ªç¯ç­‰è¯­æ³•å¯¹åºåˆ—è¿›è¡Œè¿­ä»£ã€‚
<br/>

**makeIteratoræ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„æ–¹æ³•å‘¢?**

makeIterator() æ˜¯ Sequence åè®®ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç¬¦åˆ IteratorProtocol åè®®çš„è¿­ä»£å™¨ï¼Œç”¨äºéå†åºåˆ—ä¸­çš„å…ƒç´ ã€‚è¿­ä»£å™¨è´Ÿè´£è¿½è¸ªåºåˆ—ä¸­çš„å½“å‰ä½ç½®ï¼Œå¹¶æä¾›æ–¹æ³•æ¥è·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚

å…·ä½“æ¥è¯´ï¼ŒmakeIterator() çš„å®šä¹‰å¦‚ä¸‹ï¼š

```swift
protocol Sequence {
    associatedtype Iterator: IteratorProtocol

    func makeIterator() -> Iterator
}
```
åœ¨è¿™é‡Œï¼ŒmakeIterator() æ–¹æ³•è¿”å›ä¸€ä¸ªä¸åºåˆ—å…³è”çš„è¿­ä»£å™¨ã€‚è¿™ä¸ªè¿­ä»£å™¨å¿…é¡»ç¬¦åˆ IteratorProtocol åè®®ï¼Œè¯¥åè®®åŒ…å«äº†ç”¨äºéå†å…ƒç´ çš„ next() æ–¹æ³•ã€‚

<br/><br/><br/>
> <h2 id="NSObjectProtocolåè®®">NSObjectProtocolåè®®</h2>

åœ¨ Swift ä¸­ï¼Œ`NSObjectProtocol` æ˜¯ä¸€ä¸ªåè®®ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„åŸºç¡€çš„è¡Œä¸ºå’Œå±æ€§ï¼Œä½¿å¾—éµå¾ªè¯¥åè®®çš„ç±»å…·å¤‡ä¸€äº›æ ¸å¿ƒåŠŸèƒ½ã€‚è¿™ä¸ªåè®®ä¸»è¦ç”¨äºæ”¯æŒä¸ Objective-C çš„äº’æ“ä½œæ€§ï¼Œè®© Swift ç±»å¯ä»¥å’Œ Objective-C ç±»æ›´å¥½åœ°å…¼å®¹ã€‚

### ä¸»è¦ç”¨é€”

1. **å®šä¹‰é€šç”¨æ¥å£**ï¼š`NSObjectProtocol` å®šä¹‰äº†ä¸€äº›å¸¸è§çš„åŸºç¡€æ¥å£å’Œå±æ€§ï¼Œæ¯”å¦‚ `isEqual(_:)`ã€`hash`ã€`description` ç­‰ï¼Œç¡®ä¿å®ç°æ­¤åè®®çš„å¯¹è±¡èƒ½å¤Ÿæ”¯æŒè¿™äº›æ“ä½œã€‚

2. **ä¸ Objective-C äº’æ“ä½œæ€§**ï¼š`NSObjectProtocol` æ˜¯ Objective-C ä¸­çš„ `NSObject` ç±»çš„ç­‰ä»·åè®®ç‰ˆæœ¬ã€‚å½“ Swift ç±»éœ€è¦ä¸ Objective-C ä»£ç ååŒå·¥ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡éµå¾ª `NSObjectProtocol` æ¥å®ç°ç±»ä¼¼ `NSObject` çš„åŸºæœ¬è¡Œä¸ºã€‚

3. **é€‚ç”¨äº Foundation æ¡†æ¶çš„ç±»å’Œæ–¹æ³•**ï¼šå¾ˆå¤š Foundation æ¡†æ¶ä¸­çš„ç±»å’Œæ–¹æ³•è¦æ±‚å¯¹è±¡éµå¾ª `NSObjectProtocol`ã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ `Selector` æˆ–ä¸ Objective-C ç±»è¿›è¡Œäº¤äº’æ—¶ï¼Œéœ€è¦éµå¾ªè¯¥åè®®ã€‚

### æ ¸å¿ƒåŠŸèƒ½

`NSObjectProtocol` å®šä¹‰äº†ä»¥ä¸‹æ ¸å¿ƒæ–¹æ³•å’Œå±æ€§ï¼š

- **æ¯”è¾ƒ**ï¼š`isEqual(_:)` ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚
- **å“ˆå¸Œå€¼**ï¼š`hash` å±æ€§ï¼Œç”¨äºè·å–å¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚
- **å­—ç¬¦ä¸²æè¿°**ï¼š`description` å±æ€§ï¼Œç”¨äºè·å–å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚
- **å“åº”é€‰æ‹©å™¨**ï¼š`responds(to:)` å’Œ `perform(_:)` ç­‰æ–¹æ³•ï¼Œç”¨äºåŠ¨æ€æ£€æŸ¥å¯¹è±¡æ˜¯å¦å“åº”æŸä¸ªæ–¹æ³•ï¼ˆé€‰æ‹©å™¨ï¼‰ã€‚

### ä½¿ç”¨ç¤ºä¾‹

å‡è®¾ä½ æƒ³æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦éµå¾ª `NSObjectProtocol`ï¼Œå¹¶è°ƒç”¨å…¶ `description`ï¼š

```swift
func printObjectDescription(_ object: AnyObject) {
    if let obj = object as? NSObjectProtocol {
        print(obj.description)  // æ‰“å°å¯¹è±¡çš„æè¿°
    } else {
        print("è¯¥å¯¹è±¡ä¸éµå¾ª NSObjectProtocol")
    }
}
```

ä¸€èˆ¬æ¥è¯´ï¼Œå¤§å¤šæ•° Foundation å’Œ UIKit ç±»éƒ½è‡ªåŠ¨éµå¾ªäº† `NSObjectProtocol`ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¦‚æœä½ çš„ç±»éœ€è¦å’Œ Objective-C å…¼å®¹ï¼Œæˆ–è€…ä½ æƒ³ç¡®ä¿ç±»å…·æœ‰ä¸€äº›åŸºæœ¬çš„å¯¹è±¡ç‰¹æ€§ï¼Œå¯ä»¥è®©å®ƒéµå¾ª `NSObjectProtocol`ã€‚


<br/><br/>

> <h3 id='AsyncSequenceåè®®'>AsyncSequence åè®®</h3>

AsyncSequence æ˜¯ Swift æ ‡å‡†åº“ä¸­å¼•å…¥çš„ç”¨äºè¡¨ç¤ºå¼‚æ­¥åºåˆ—çš„åè®®ã€‚å®ƒå…è®¸ä½ ä»¥å¼‚æ­¥çš„æ–¹å¼æŒ‰é¡ºåºè®¿é—®ä¸€ç³»åˆ—å…ƒç´ ã€‚å¼‚æ­¥åºåˆ—æ˜¯åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ç”Ÿæˆå…ƒç´ çš„åºåˆ—ï¼Œä¾‹å¦‚é€šè¿‡å¼‚æ­¥æ“ä½œæˆ–è€…åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ç”Ÿæˆå…ƒç´ ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ AsyncSequence åè®®ï¼š

```
// å®šä¹‰ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå…ƒç´ çš„åºåˆ—
/// AsyncSequenceæ˜¯swift5.5æå‡ºæ¥çš„
struct SimpleAsyncSequence: AsyncSequence {
    typealias Element = Int

    let upperBound: Int

    // å®šä¹‰å¼‚æ­¥ç”Ÿæˆå™¨
    struct AsyncIterator: AsyncIteratorProtocol {
        var current: Int = 0
        let upperBound: Int

        // å®šä¹‰å¼‚æ­¥çš„ next æ–¹æ³•
        mutating func next() async throws -> Int? {
            if current < upperBound {
                let result = current
                current += 1
                return result
            } else {
                return nil
            }
        }
    }

    // å®ç° makeAsyncIterator æ–¹æ³•
    func makeAsyncIterator() -> AsyncIterator {
        return AsyncIterator(upperBound: upperBound)
    }
}

///è°ƒç”¨
func testAsync() {
        
    // ä½¿ç”¨ AsyncSequence
    let asyncSequence = SimpleAsyncSequence(upperBound: 5)

    // å¼‚æ­¥éå†åºåˆ—
    for try await element in asyncSequence {
        print(element)
    }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå…ƒç´ çš„åºåˆ— SimpleAsyncSequenceï¼Œå®ƒé‡‡ç”¨äº† AsyncSequence åè®®ï¼Œå¹¶å®ç°äº† AsyncIteratorProtocol åè®®ä¸­çš„å¼‚æ­¥ next æ–¹æ³•ã€‚åœ¨ next æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ async å’Œ throws å…³é”®å­—è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•ï¼Œå¹¶ä¸”å¯èƒ½æŠ›å‡ºé”™è¯¯ã€‚

ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª SimpleAsyncSequence å®ä¾‹ï¼Œå¹¶ä½¿ç”¨å¼‚æ­¥ for-in å¾ªç¯éå†åºåˆ—ä¸­çš„å…ƒç´ ã€‚åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ï¼Œawait å…³é”®å­—ç”¨äºç­‰å¾…å¼‚æ­¥æ“ä½œçš„å®Œæˆï¼Œå¹¶ä¸”åºåˆ—çš„ next æ–¹æ³•ä¹Ÿä»¥å¼‚æ­¥çš„æ–¹å¼ç”Ÿæˆå…ƒç´ ã€‚


<br/>

- æ€»ä½“è€Œè¨€ï¼Œä½¿ç”¨ AsyncSequence ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªæ­¥éª¤ï¼š
	- å®šä¹‰å®ç° AsyncSequence åè®®çš„å¼‚æ­¥åºåˆ—ç±»å‹ã€‚
	- åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨å¼‚æ­¥ for-in å¾ªç¯æˆ–å…¶ä»–å¼‚æ­¥æ–¹å¼éå†è¯¥åºåˆ—ã€‚


<br/>
<br/>

**ç–‘é—®:ä¸ºä»€ä¹ˆåœ¨å¼‚æ­¥éå†åºåˆ—ä¸­æ²¡æœ‰ä½¿ç”¨try catchè¿›è¡Œæ•è·å¼‚å¸¸å¤„ç†**

åœ¨å¼‚æ­¥éå†åºåˆ—ä¸­æ²¡æœ‰ç›´æ¥ä½¿ç”¨ try-catch å—è¿›è¡Œå¼‚å¸¸å¤„ç†çš„åŸå› æ˜¯ï¼ŒSwift åœ¨å¼‚æ­¥ä»£ç ä¸­æœ‰ä¸€ç§æ›´ç›´è§‚ã€æ›´æ¸…æ™°çš„å¤„ç†å¼‚æ­¥æ“ä½œé”™è¯¯çš„æ–¹å¼ï¼Œå³ä½¿ç”¨ async å’Œ awaitã€‚

åœ¨å¼‚æ­¥ä»£ç ä¸­ï¼Œé”™è¯¯é€šå¸¸é€šè¿‡ throws å…³é”®å­—å’Œå¼‚æ­¥å‡½æ•°çš„è¿”å›ç±»å‹è¿›è¡Œä¼ é€’ã€‚å¦‚æœå¼‚æ­¥æ“ä½œä¸­å‘ç”Ÿäº†é”™è¯¯ï¼ŒSwift ä¼šé€šè¿‡å¼‚æ­¥çš„æ–¹å¼ä¼ æ’­é”™è¯¯ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¼ ç»Ÿçš„åŒæ­¥æ–¹å¼ä¸­çš„ do-catch å—ã€‚

åœ¨å¼‚æ­¥ for-in å¾ªç¯ä¸­ï¼Œä½¿ç”¨ try-catch è¯­æ³•ä¼šå˜å¾—å¤æ‚ï¼Œå› ä¸ºå¼‚æ­¥æ“ä½œå¯ä»¥åœ¨å¾ªç¯ä½“å†…çš„å¤šä¸ªå¼‚æ­¥ç‚¹å¼•å‘é”™è¯¯ã€‚ä¸ºäº†æ›´æ¸…æ™°åœ°å¤„ç†å¼‚æ­¥é”™è¯¯ï¼ŒSwift å¼•å…¥äº†å¼‚æ­¥ try-catch è¯­æ³•ï¼Œå³åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ try-awaitï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
let asyncSequence = SimpleAsyncSequence(upperBound: 5)

do {
    // å¼‚æ­¥éå†åºåˆ—
    async for element in asyncSequence {
        print(element)
    }
} catch {
    // å¤„ç†å¼‚æ­¥é”™è¯¯
    print("An error occurred: \(error)")
}
```


ä¸Šè¿°ä»£ç ä½¿ç”¨äº† try-await æ¥æ•è·å¯èƒ½åœ¨å¼‚æ­¥éå†åºåˆ—ä¸­å¼•å‘çš„é”™è¯¯ã€‚è¿™ç§æ–¹å¼æ›´ç¬¦åˆ Swift å¼‚æ­¥ä»£ç çš„é£æ ¼ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°å’Œæ˜“è¯»ã€‚å¼‚æ­¥ try-await è¯­æ³•ä½¿å¾—åœ¨å¼‚æ­¥ä»£ç ä¸­å¤„ç†é”™è¯¯å˜å¾—æ›´ä¸ºç›´è§‚ï¼Œè€Œä¸éœ€è¦åœ¨æ¯ä¸ªå¯èƒ½å¼•å‘é”™è¯¯çš„å¼‚æ­¥ç‚¹éƒ½ä½¿ç”¨ try-catchã€‚

æ€»ä¹‹ï¼ŒSwift åœ¨å¼‚æ­¥ä»£ç ä¸­å¼•å…¥äº†ä¸€ç§æ›´ç¬¦åˆå¼‚æ­¥ç‰¹æ€§çš„é”™è¯¯å¤„ç†æ–¹å¼ï¼Œå³ä½¿ç”¨ try-awaitï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ¸…æ™°åº¦ã€‚


<br/><br/><br/>
> <h2 id="å¤„ç†2ç§æ•°æ®ç±»å‹çš„èŒƒå‹-RxSwiftçš„Signal"> å¤„ç†2ç§æ•°æ®ç±»å‹çš„èŒƒå‹-RxSwiftçš„Signal </h2>

```
updateUserInfoButton.rx.tap
    .withLatestFrom(rxUserInfo)
    .flatMapLatest { userInfo -> Observable<Result<Void, Error>> in
        return update(userInfo)
            .map(Result.success)  // è½¬æ¢æˆ Result
            .catchError { error in Observable.just(Result.failure(error)) }
    }
    .observeOn(MainScheduler.instance)
    .subscribe(onNext: { result in
        switch result {           // å¤„ç† Result
        case .success:
            print("ç”¨æˆ·ä¿¡æ¯æ›´æ–°æˆåŠŸ")
        case .failure(let error):
            print("ç”¨æˆ·ä¿¡æ¯æ›´æ–°å¤±è´¥ï¼š \(error.localizedDescription)")
        }
    })
    .disposed(by: disposeBag)
```


<br/>

```
// æšä¸¾å®šä¹‰
public enum Result<Success, Failure> where Failure: Error {
    case success(Success)
    case failure(Failure)
}
```


<br/>

åœ¨ Swift ä¸­ï¼Œæ³›å‹ç±»å‹çš„ä½¿ç”¨å’Œå‚æ•°çš„ä¼ é€’æœ‰ä¸€å®šçš„çµæ´»æ€§ã€‚è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚

- **æ³›å‹ç±»å‹çš„å®šä¹‰ä¸ä½¿ç”¨**

1. **æ³›å‹å®šä¹‰**ï¼š
   å½“ä½ å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»å‹ï¼ˆå¦‚ `Result<Success, Failure>`ï¼‰ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨å£°æ˜è¿™ä¸ªç±»å‹å¯ä»¥å¤„ç†çš„ä¸¤ç§æ•°æ®ç±»å‹ï¼šæˆåŠŸç±»å‹å’Œå¤±è´¥ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`Result` æœ‰ä¸¤ä¸ªæ³›å‹å‚æ•° `Success` å’Œ `Failure`ã€‚

2. **ç±»å‹å‚æ•°çš„æŒ‡å®š**ï¼š
   å½“ä½ ä½¿ç”¨ `Result<Void, Error>` æ—¶ï¼Œä½ å®é™…ä¸Šæ˜¯åœ¨ä¸º `Result` æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼š
   - `Success` è¢«æŒ‡å®šä¸º `Void`ï¼Œè¡¨ç¤ºæˆåŠŸæ—¶ä¸è¿”å›ä»»ä½•å…·ä½“æ•°æ®ã€‚
   - `Failure` è¢«æŒ‡å®šä¸º `Error`ï¼Œè¡¨ç¤ºå¯èƒ½çš„é”™è¯¯ç±»å‹ã€‚

<br/>

**ä½¿ç”¨ `map` å‡½æ•°çš„æƒ…å†µ**

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ `map(Result.success)` æ—¶ï¼Œä½ åªéœ€ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼ˆæˆåŠŸçš„ç»“æœï¼‰ï¼š

```swift
.map(Result.success)  // è¿™é‡Œè°ƒç”¨ Result.successï¼Œåªéœ€è¦æä¾›ä¸€ä¸ªå‚æ•°
```

- `Result.success` æ˜¯ä¸€ä¸ªæ¥å—æˆåŠŸç»“æœçš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª `Result<Success, Failure>` ç±»å‹çš„å®ä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`Success` æ˜¯ `Void`ï¼Œ`Failure` æ˜¯ `Error`ã€‚

### ä¸ºä»€ä¹ˆåªéœ€ä¸€ä¸ªå‚æ•°

è¿™æ˜¯å› ä¸º `Result` æ˜¯ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªç±»å‹å‚æ•°çš„æ³›å‹ç±»å‹ï¼Œä½†å…¶æ„é€ å™¨ï¼ˆå¦‚ `success` å’Œ `failure`ï¼‰åªè¦æ±‚æä¾›å¯¹åº”çš„æˆåŠŸæˆ–å¤±è´¥å€¼ã€‚åœ¨ä½ è°ƒç”¨ `Result.success` æ—¶ï¼ŒSwift èƒ½å¤Ÿé€šè¿‡ä¸Šä¸‹æ–‡ï¼ˆå³ä½ å·²ç»ä¸º `Result` æŒ‡å®šäº† `Void` å’Œ `Error`ï¼‰æ¨æ–­å‡ºå¦ä¸€ä¸ªå‚æ•°çš„ç±»å‹ã€‚

### ç¤ºä¾‹æ€»ç»“

- **ç±»å‹æŒ‡å®š**ï¼šåœ¨ä½¿ç”¨ `Observable<Result<Void, Error>>` æ—¶ï¼ŒæŒ‡å®šäº† `Result` çš„å…·ä½“ç±»å‹ï¼Œä½†åœ¨åˆ›å»ºæˆåŠŸç»“æœæ—¶ï¼Œåªéœ€è¦ä¼ é€’æˆåŠŸçš„å€¼ï¼ˆåœ¨æ­¤ä¾‹ä¸­ä¸º `Void`ï¼‰ã€‚
- **å‡½æ•°å‚æ•°**ï¼š`Result.success` åªéœ€è¦æä¾›ä¸€ä¸ªå‚æ•°ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†æˆåŠŸçš„å…³è”å€¼ï¼ŒSwift ä¼šåˆ©ç”¨æ³›å‹çš„ä¸Šä¸‹æ–‡æ¥å¤„ç†ç±»å‹çš„åŒ¹é…ã€‚

è¿™ç§è®¾è®¡ä½¿å¾—åœ¨å®é™…ä½¿ç”¨æ—¶æ›´åŠ çµæ´»å’Œç®€æ´ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒäº†å¼ºå¤§çš„ç±»å‹å®‰å…¨æ€§ã€‚

ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

```
import RxSwift

// å®šä¹‰ä¸€ä¸ªé”™è¯¯ç±»å‹
enum FetchError: Error {
    case networkError
    case dataCorruption
}

// æ¨¡æ‹Ÿä¸€ä¸ª fetchData å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ª Observable<Result<Data, FetchError>>
// fetchData æ–¹æ³•è¿”å› Observable<Result<Data, FetchError>>ï¼Œè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥çš„æ•°æ®è·å–æ“ä½œï¼Œå¯èƒ½æˆåŠŸè¿”å› Dataï¼Œä¹Ÿå¯èƒ½å¤±è´¥è¿”å› FetchError
func testFetchData() -> Observable<Result<Data, FetchError>> {
	// æˆ‘ä»¬ä½¿ç”¨ Observable.create åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Observableï¼Œå¹¶åœ¨ onNext ä¸­å‘é€æ•°æ®
    return Observable.create { observer in
        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
        DispatchQueue.global().asyncAfter(deadline: .now() + 1.0) {
            let success = Bool.random()  // éšæœºæˆåŠŸæˆ–å¤±è´¥
            
            if success {
                let data = Data("Fetched Data".utf8)  // å‡è®¾è¿™æ˜¯æˆåŠŸçš„æ•°æ®
                observer.onNext(Result.success(data)) // ä½¿ç”¨ Result.success(Data)
            } else {
                observer.onNext(Result.failure(FetchError.networkError)) // ä½¿ç”¨ Result.failure(Error)
            }
            observer.onCompleted()
        }
        
        return Disposables.create()
    }
}



@objc fileprivate func signalAction00(_ sender: UIButton) {
    self.testFetchData()
        .subscribe(onNext: { result in
            switch result {
            case .success(let data):
                if let string = String(data: data, encoding: .utf8) {
                    print("æˆåŠŸæ¥æ”¶åˆ°æ•°æ®ï¼š\(string)")
                }
            case .failure(let error):
                print("å‘ç”Ÿé”™è¯¯ï¼š\(error)")
            }
        }, onError: { error in
            print("Observable é”™è¯¯ï¼š\(error)")
        }, onCompleted: {
            print("æ•°æ®è·å–æ“ä½œå®Œæˆ")
        })
        .disposed(by: disposeBag)
}
```

æ‰“å°ï¼š

```
å‘ç”Ÿé”™è¯¯ï¼šnetworkError
æ•°æ®è·å–æ“ä½œå®Œæˆ
```

<br/><br/>

**ä¸ºä»€ä¹ˆ Result.success(data) åªéœ€ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Ÿ**

- Result<Data, FetchError> ç±»å‹ä¸­ï¼ŒData æ˜¯ Success ç±»å‹ï¼ŒFetchError æ˜¯ Failure ç±»å‹ã€‚Result.success(data) åªè¦æ±‚æä¾› dataï¼Œå› ä¸º success åªéœ€ä¸€ä¸ª Data å€¼ï¼ŒSwift èƒ½æ¨æ–­å‡º Success çš„ç±»å‹ã€‚

è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œä¸­ä½¿ç”¨ Result æ¥å¤„ç†ä¸åŒçš„ç»“æœã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨ RxSwift ä¸­ä¼˜é›…åœ°ç®¡ç†æˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µã€‚





<br/>

***
<br/><br/>


> <h1 id='å¹¶å‘'>å¹¶å‘</h1>

- æ™®é€šçš„åŒæ­¥å‡½æ•°æˆ–æ–¹æ³•:
	- å®ƒä»¬åªèƒ½è¿è¡Œåˆ°å®Œæˆé—­åŒ…ã€æŠ›å‡ºé”™è¯¯æˆ–è€…æ°¸è¿œä¸è¿”å›;


<br/>

- å¼‚æ­¥å‡½æ•°å’Œæ–¹æ³•:
	- 	æ˜¯ä¸€ç§èƒ½åœ¨è¿è¡Œä¸­è¢«æŒ‚èµ·çš„ç‰¹æ®Šå‡½æ•°æˆ–æ–¹æ³•;
	- 	ä¹Ÿèƒ½è¿è¡Œåˆ°å®Œæˆé—­åŒ…ã€æŠ›å‡ºé”™è¯¯æˆ–è€…æ°¸è¿œä¸è¿”å›, ä½†åŒæ—¶ä¹Ÿå¯ä»¥åœ¨ç­‰å¾…å…¶ä»–èµ„æºçš„æ—¶å€™æŒ‚èµ·;
	- 	åœ¨å¼‚æ­¥å‡½æ•°æˆ–è€…æ–¹æ³•çš„å‡½æ•°ä½“ä¸­ï¼Œä½ å¯ä»¥æ ‡è®°å…¶ä¸­çš„ä»»æ„ä½ç½®æ˜¯å¯ä»¥è¢«æŒ‚èµ·çš„ã€‚


ä¸Šè¿°å°±æ˜¯**å¼‚æ­¥æ–¹æ³•**å’Œå‡½æ•°ä¸**æ™®é€šæ–¹æ³•**çš„åŒºåˆ«ä¸ç›¸åŒåœ°æ–¹



<br/>

<br/><br/> <h2 id='å¼‚æ­¥å‡½æ•°å®šä¹‰'>å¼‚æ­¥å‡½æ•°å®šä¹‰</h2>


&emsp; ä¸ºäº†æ ‡è®°æŸä¸ªå‡½æ•°æˆ–è€…æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œä½ å¯ä»¥åœ¨**å®ƒçš„å£°æ˜ä¸­çš„å‚æ•°åˆ—è¡¨åè¾¹åŠ ä¸Š async å…³é”®å­—**ï¼Œå’Œä½¿ç”¨ throws å…³é”®å­—æ¥æ ‡è®° **throwing å‡½æ•°(æŠ›å‡ºå¼‚å¸¸å‡½æ•°ç”¨try...catch...)** æ˜¯ç±»ä¼¼çš„ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æœ‰è¿”å›å€¼ï¼Œ**å¯ä»¥åœ¨è¿”å›ç®­å¤´ï¼ˆ->ï¼‰å‰æ·»åŠ  async å…³é”®å­—**ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢æ˜¯ä»å›¾åº“ä¸­æ‹‰å–å›¾ç‰‡åç§°çš„æ–¹æ³•ï¼š

```
func listPhotos(inGallery name: String) async -> [String] {
    let result = // çœç•¥ä¸€äº›å¼‚æ­¥ç½‘ç»œè¯·æ±‚ä»£ç 
    return result
}
```

å¯¹äºé‚£äº›æ—¢æ˜¯å¼‚æ­¥åˆæ˜¯ throwing çš„å‡½æ•°ï¼Œéœ€è¦æŠŠ async å†™åœ¨throws å…³é”®å­—å‰è¾¹ã€‚


<br/>

æé—®: ä¸ºä»€ä¹ˆè°ƒç”¨å¼‚æ­¥å‡½æ•°æ—¶,è¦å°†å¼‚æ­¥å‡½æ•°æ”¾åœ¨**do{}catch{}** çš„æ•è·å¼‚å¸¸å‡½æ•°é‡Œ?

&emsp; åœ¨Swiftä¸­ï¼Œå¼‚æ­¥å‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ï¼ˆerrorsï¼‰ã€‚å½“ä½ è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ—¶ï¼Œå¦‚æœè¯¥å‡½æ•°å¯èƒ½æŠ›å‡ºé”™è¯¯ï¼Œä½ éœ€è¦ä½¿ç”¨do-catchè¯­å¥æ¥æ•è·å’Œå¤„ç†è¿™äº›é”™è¯¯ã€‚

&emsp; ä½¿ç”¨do-catchè¯­å¥çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¥½åœ°å¤„ç†å¼‚æ­¥æ“ä½œä¸­å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œç¡®ä¿ä½ èƒ½å¤Ÿé€‚å½“åœ°å¤„ç†é”™è¯¯æƒ…å†µã€‚å¦‚æœå¼‚æ­¥å‡½æ•°å¯èƒ½æŠ›å‡ºé”™è¯¯ï¼Œè€Œä½ æ²¡æœ‰ä½¿ç”¨do-catchæ¥æ•è·é”™è¯¯ï¼Œç¼–è¯‘å™¨ä¼šäº§ç”Ÿé”™è¯¯ã€‚

```
func fetchData() async throws -> String {
    // å¼‚æ­¥æ“ä½œï¼Œå¯èƒ½æŠ›å‡ºé”™è¯¯
    throw MyError.customError
}

async {
    do {
        let result = try await fetchData()
        print(result)
    } catch {
        print("Error: \(error)")
    }
}
```

&emsp; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒfetchDataå‡½æ•°è¢«å£°æ˜ä¸ºasync throwsï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå¹¶ä¸”å¯èƒ½æŠ›å‡ºé”™è¯¯ã€‚åœ¨è°ƒç”¨fetchDataæ—¶ï¼Œä½¿ç”¨try awaitå…³é”®å­—æ¥è¡¨ç¤ºæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°å¯èƒ½æŠ›å‡ºé”™è¯¯ã€‚ç„¶åï¼Œä½¿ç”¨do-catchè¯­å¥æ¥æ•è·å¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯ã€‚

&emsp; å¦‚æœä½ çœç•¥do-catchè¯­å¥ï¼Œç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ï¼Œå› ä¸ºåœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨try awaitè€Œä¸æ•è·é”™è¯¯æ˜¯ä¸è¢«å…è®¸çš„ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿åœ¨å¼‚æ­¥ä»£ç ä¸­åŠæ—¶å¤„ç†é”™è¯¯ï¼Œä»¥é˜²æ­¢é”™è¯¯è¢«å¿½ç•¥è€Œå¯¼è‡´ç¨‹åºè¡Œä¸ºä¸å¯é¢„æµ‹ã€‚




<br/><br/>

> <h3 id='å¼‚æ­¥å‡½æ•°æ‰ç”¨æµç¨‹'>å¼‚æ­¥å‡½æ•°æ‰ç”¨æµç¨‹</h3>

&emsp; è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä¼šè¢«æŒ‚èµ·ç›´åˆ°è¿™ä¸ªå¼‚æ­¥æ–¹æ³•è¿”å›ã€‚ä½ éœ€è¦åœ¨è°ƒç”¨å‰å¢åŠ  await å…³é”®å­—æ¥æ ‡è®°æ­¤å¤„ä¸ºå¯èƒ½çš„æ‚¬ç‚¹ï¼ˆSuspension pointï¼‰ã€‚è¿™å°±åƒè°ƒç”¨ throwing å‡½æ•°éœ€è¦æ·»åŠ  try å…³é”®å­—æ¥æ ‡è®°åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ä¼šæ”¹å˜ç¨‹åºæµç¨‹ä¸€æ ·ã€‚åœ¨ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ä¸­ï¼Œæ‰§è¡Œåªä¼šåœ¨è°ƒç”¨å¦ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•çš„æ—¶å€™ä¼šè¢«æŒ‚èµ·ï¼›æŒ‚èµ·æ°¸è¿œéƒ½ä¸ä¼šæ˜¯éšå¼æˆ–è€…ä¼˜å…ˆçš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰çš„æ‚¬ç‚¹éƒ½éœ€è¦è¢«æ ‡è®°ä¸º awaitã€‚

<br/>

æ¯”å¦‚ï¼Œä¸‹é¢çš„è¿™æ®µä»£ç å¯ä»¥æ‹‰å–å›¾åº“ä¸­æ‰€æœ‰å›¾ç‰‡çš„åç§°ï¼Œç„¶åå±•ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡ï¼š

```
let photoNames = await listPhotos(inGallery: "Summer Vacation")
let sortedNames = photoNames.sorted()
let name = sortedNames[0]
let photo = await downloadPhoto(named: name)
show(photo)
```

<br/>

å› ä¸º listPhotos(inGallery:) å’Œ downloadPhoto(named:) éƒ½éœ€è¦å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œéœ€è¦èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´å®Œæˆã€‚ç»™è¿™ä¸¤ä¸ªå‡½æ•°åœ¨è¿”å›ç®­å¤´å‰åŠ ä¸Š async å¯ä»¥å°†å®ƒä»¬å®šä¹‰ä¸ºå¼‚æ­¥å‡½æ•°ï¼Œä»è€Œä½¿å¾—è¿™éƒ¨åˆ†ä»£ç åœ¨ç­‰å¾…å›¾ç‰‡çš„æ—¶å€™è®©ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ç»§ç»­è¿è¡Œã€‚

- 1.ä¸ºäº†æ›´å¥½ç†è§£ä¸Šé¢è¿™æ®µä»£ç çš„å¹¶å‘æœ¬è´¨ï¼Œä¸‹é¢åˆ—ä¸¾å‡ºè¿™æ®µç¨‹åºå¯èƒ½çš„ä¸€ä¸ªæ‰§è¡Œé¡ºåºï¼š

- 2.ä»£ç ä»ç¬¬ä¸€è¡Œå¼€å§‹æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª awaitï¼Œè°ƒç”¨ listPhotos(inGallery:) å‡½æ•°å¹¶ä¸”æŒ‚èµ·è¿™æ®µä»£ç çš„æ‰§è¡Œï¼Œç­‰å¾…è¿™ä¸ªå‡½æ•°çš„è¿”å›ã€‚

- 3.å½“è¿™æ®µä»£ç çš„æ‰§è¡Œè¢«æŒ‚èµ·æ—¶ï¼Œç¨‹åºçš„å…¶ä»–å¹¶è¡Œä»£ç ä¼šç»§ç»­æ‰§è¡Œã€‚æ¯”å¦‚ï¼Œåå°æœ‰ä¸€ä¸ªè€—æ—¶é•¿çš„ä»»åŠ¡æ›´æ–°å…¶ä»–ä¸€äº›å›¾åº“ã€‚é‚£æ®µä»£ç ä¼šæ‰§è¡Œåˆ°è¢« await çš„æ ‡è®°çš„æ‚¬ç‚¹ï¼Œæˆ–è€…æ‰§è¡Œå®Œæˆã€‚

- 4.å½“ listPhotos(inGallery:) å‡½æ•°è¿”å›ä¹‹åï¼Œä¸Šé¢è¿™æ®µä»£ç ä¼šä»ä¸Šæ¬¡çš„æ‚¬ç‚¹å¼€å§‹ç»§ç»­æ‰§è¡Œã€‚å®ƒä¼šæŠŠå‡½æ•°çš„è¿”å›èµ‹å€¼ç»™ photoNames å˜é‡ã€‚

- 5.å®šä¹‰ sortedNames å’Œ name çš„é‚£è¡Œä»£ç æ˜¯æ™®é€šçš„åŒæ­¥ä»£ç ï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¢« await æ ‡è®°ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•å¯èƒ½çš„æ‚¬ç‚¹ã€‚

- 6.æ¥ä¸‹æ¥çš„ await æ ‡è®°æ˜¯åœ¨è°ƒç”¨ downloadPhoto(named:) çš„åœ°æ–¹ã€‚è¿™é‡Œä¼šå†æ¬¡æš‚åœè¿™æ®µä»£ç çš„æ‰§è¡Œç›´åˆ°å‡½æ•°è¿”å›ï¼Œä»è€Œç»™äº†å…¶ä»–å¹¶è¡Œä»£ç æ‰§è¡Œçš„æœºä¼šã€‚

- 7.åœ¨ downloadPhoto(named:) è¿”å›åï¼Œå®ƒçš„è¿”å›å€¼ä¼šè¢«èµ‹å€¼åˆ° photo å˜é‡ä¸­ï¼Œç„¶åè¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™ show(_:)ã€‚


<br/>

åœ¨å¯èƒ½çš„æ‚¬ç‚¹ä¹‹é—´çš„ä»£ç å°†æŒ‰é¡ºåºè¿è¡Œï¼Œå¹¶ä¸å¯èƒ½è¢«å…¶å®ƒå¹¶å‘ä»£ç ä¸­æ–­ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç å°†ä¸€å¼ å›¾ç‰‡ä»ä¸€ä¸ªå›¾åº“ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå›¾åº“ï¼š

```
let firstPhoto = await listPhotos(inGallery: "Summer Vacation")[0]
add(firstPhoto, toGallery: "Road Trip")
//æ­¤æ—¶ï¼ŒfirstPhotoæš‚æ—¶åœ°åŒæ—¶å­˜åœ¨äºä¸¤ä¸ªç”»å»Šä¸­
remove(firstPhoto, fromGallery: "Summer Vacation")
```

<br/>

å…¶å®ƒä»£ç ä¸èƒ½åœ¨ add(_:toGallery:) å’Œ remove(_:fromGallery:) ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´è¿è¡Œã€‚åœ¨æ­¤æœŸé—´ï¼Œç¬¬ä¸€å¼ å›¾ç‰‡åŒæ—¶å­˜åœ¨äºä¸¤ä¸ªå›¾åº“ï¼Œæš‚æ—¶æ‰“ç ´äº†åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªä¸å˜é‡ã€‚ä¸ºäº†æ›´æ˜ç¡®åœ°è¡¨ç¤ºè¿™æ®µä»£ç ä¸èƒ½åŠ å…¥ await æ ‡è®°ï¼Œä½ å¯ä»¥å°†è¿™æ®µä»£ç é‡æ„ä¸ºä¸€ä¸ªåŒæ­¥å‡½æ•°ï¼š

```
func move(_photoName: String, from source: String, to destination: String) {
	add(photoName, to: destination)
	remove(photoName, from: source)
}
//...
let firstPhoto = await listPhotos(inGallery: "Summer Vacation")[0]
move(firstPhoto, from: "Summer Vacation", to: "Road Trip")
```
åœ¨ä¸Šä¾‹ä¸­ï¼Œç”±äº move(_:from:to:) å‡½æ•°ä¸ºåŒæ­¥å‡½æ•°ï¼Œä½ å°†èƒ½å¤Ÿä¿è¯å®ƒå°†ä¸ä¼šåŒ…å«æ½œåœ¨çš„æ‚¬ç‚¹ã€‚åœ¨æœªæ¥ï¼Œè¯•å›¾åœ¨è¯¥å‡½æ•°ä¸­å†™å…¥å¹¶å‘ä»£ç å°†å¼•å‘ç¼–è¯‘é”™è¯¯è€Œéäº§ç”Ÿbugã€‚


<br/>

å¯ä»¥å€ŸåŠ© **Task.sleep(_:)** æ–¹æ³•(ç›¸å½“äºä¸€ä¸ªå·¥å…·)è¿›è¡Œç½‘ç»œå»¶æ—¶,éå¸¸æœ‰ç”¨.

è¿™ä¸ªæ–¹æ³•ä»€ä¹ˆéƒ½æ²¡æœ‰åšï¼Œåªæ˜¯ç­‰å¾…ä¸å°‘äºæŒ‡å®šçš„æ—¶é—´ï¼ˆå•ä½çº³ç§’ï¼‰åè¿”å›ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ sleep(until:clock:) æ–¹æ³•æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚å®ç° listPhotos(inGallery:) çš„ä¸€ä¸ªç‰ˆæœ¬ï¼š

```
func listPhotos(inGallery name: String) async throws -> [String] {
	try await Task.sleep(until: .now + .seconds(2), clock: .continuous) 
	return ["IMG001", "IMG99", "IMG0404"]
}
```


<br/><br/>

> <h3 id='å¼‚æ­¥åºåˆ—'>å¼‚æ­¥åºåˆ—</h3>

ä¸Šé¢çš„æ–¹æ³•ä¸­ listPhotos(inGallery:) æ–¹æ³•ä¼šåœ¨æ‹¿åˆ°æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ åï¼Œä»¥å¼‚æ­¥çš„æ–¹å¼ä¸€æ¬¡æ€§è¿”å›æ•´ä¸ªæ•°ç»„ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å¼‚æ­¥åºåˆ—ï¼ˆasynchronous sequenceï¼‰ï¼Œæ¯æ¬¡æ”¶åˆ°ä¸€ä¸ªå…ƒç´ åå¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•éå†ä¸€ä¸ªå¼‚æ­¥åºåˆ—ï¼š

```
import Foundation

let handle = FileHandle.standardInput
for try await line in handle.bytes.lines {
    print(line)
}
```

&emsp; ä¸æ™®é€šçš„ for-in å¾ªç¯ç›¸æ¯”ï¼Œä¸Šé¢çš„ä¾‹å­åœ¨ for ä¹‹åæ·»åŠ äº† await å…³é”®å­—ã€‚å°±åƒåœ¨è°ƒç”¨å¼‚æ­¥å‡½æ•°æˆ–æ–¹æ³•æ—¶ä¸€æ ·ï¼Œawait è¡¨æ˜ä»£ç ä¸­æœ‰ä¸€ä¸ªå¯èƒ½çš„æ‚¬ç‚¹ã€‚for-await-in å¾ªç¯ä¼šåœ¨æ¯æ¬¡å¾ªç¯å¼€å§‹çš„æ—¶å€™å› ä¸ºæœ‰å¯èƒ½éœ€è¦ç­‰å¾…ä¸‹ä¸€ä¸ªå…ƒç´ è€ŒæŒ‚èµ·å½“å‰ä»£ç çš„æ‰§è¡Œã€‚


&emsp; æƒ³è®©è‡ªå·±åˆ›å»ºçš„ç±»å‹ä½¿ç”¨ for-in å¾ªç¯éœ€è¦éµå¾ª [**Sequence åè®®**](#Sequenceåè®®)ï¼Œè¿™é‡Œä¹ŸåŒç†ï¼Œå¦‚æœæƒ³è®©è‡ªå·±åˆ›å»ºçš„ç±»å‹ä½¿ç”¨ for-await-in å¾ªç¯ï¼Œå°±éœ€è¦[**éµå¾ª AsyncSequence åè®®**](#AsyncSequenceåè®®)ã€‚



<br/><br/>

> <h2 id='å¹¶è¡Œçš„è°ƒç”¨å¼‚æ­¥æ–¹æ³•'>å¹¶è¡Œçš„è°ƒç”¨å¼‚æ­¥æ–¹æ³•</h2>

è°ƒç”¨æœ‰ await æ ‡è®°çš„å¼‚æ­¥å‡½æ•°åœ¨åŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€æ®µä»£ç ã€‚åœ¨å¼‚æ­¥ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨æ–¹éœ€è¦ç­‰å¾…å¼‚æ­¥ä»£ç æ‰§è¡Œå®Œåæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç ã€‚æ¯”å¦‚ï¼Œå½“ä½ æƒ³ä»å›¾åº“ä¸­æ‹‰å–å‰ä¸‰å¼ å›¾ç‰‡ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼Œç­‰ä¸‰æ¬¡è°ƒç”¨å®Œåå†æ‰§è¡Œ downloadPhoto(named:) å‡½æ•°ï¼š

```
let firstPhoto = await downloadPhoto(named: photoNames[0])
let secondPhoto = await downloadPhoto(named: photoNames[1])
let thirdPhoto = await downloadPhoto(named: photoNames[2])

let photos = [firstPhoto, secondPhoto, thirdPhoto]
show(photos)
```

è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„ç¼ºé™·ï¼šè™½ç„¶ä¸‹è½½è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä½†æ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ª downloadPhoto(named:)ã€‚æ¯ä¸€å¼ å›¾ç‰‡åªèƒ½åœ¨ä¸Šä¸€å¼ å›¾ç‰‡ä¸‹è½½ç»“æŸäº†æ‰å¼€å§‹ä¸‹è½½ã€‚ç„¶è€Œï¼Œå¹¶æ²¡æœ‰å¿…è¦è®©è¿™äº›æ“ä½œç­‰å¾…ï¼Œæ¯å¼ å›¾ç‰‡å¯ä»¥ç‹¬ç«‹ç”šè‡³åŒæ—¶ä¸‹è½½ã€‚

ä¸ºäº†åœ¨è°ƒç”¨å¼‚æ­¥å‡½æ•°çš„æ—¶å€™è®©å®ƒé™„è¿‘çš„ä»£ç å¹¶å‘æ‰§è¡Œï¼Œå®šä¹‰ä¸€ä¸ªå¸¸é‡æ—¶ï¼Œåœ¨ let å‰æ·»åŠ  async å…³é”®å­—ï¼Œç„¶ååœ¨æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå¸¸é‡æ—¶æ·»åŠ  await æ ‡è®°ã€‚

```
async let firstPhoto = downloadPhoto(named: photoNames[0])
async let secondPhoto = downloadPhoto(named: photoNames[1])
async let thirdPhoto = downloadPhoto(named: photoNames[2])

let photos = await [firstPhoto, secondPhoto, thirdPhoto]
show(photos)
```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸‰æ¬¡è°ƒç”¨ downloadPhoto(named:) éƒ½ä¸éœ€è¦ç­‰å¾…å‰ä¸€æ¬¡è°ƒç”¨ç»“æŸã€‚å¦‚æœç³»ç»Ÿæœ‰è¶³å¤Ÿçš„èµ„æºï¼Œè¿™ä¸‰æ¬¡è°ƒç”¨ç”šè‡³éƒ½å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚

è¿™ä¸‰æ¬¡è°ƒç”¨éƒ½æ²¡æœ‰æ²¡æ ‡è®°ä¸º awaitï¼Œå› ä¸ºä»£ç ä¸éœ€è¦è¢«æŒ‚èµ·ç­‰å¾…å‡½æ•°çš„ç»“æœã€‚ç¨‹åºä¼šç»§ç»­æ‰§è¡Œç›´åˆ° photos è¢«å®šä¹‰ï¼Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ç”±äºç¨‹åºéœ€è¦ä¸Šé¢å‡ æ¬¡å¼‚æ­¥è°ƒç”¨çš„ç»“æœï¼Œæ‰€ä»¥ä½ éœ€è¦æ·»åŠ  await å…³é”®å­—æ¥æŒ‚èµ·å½“å‰ä»£ç çš„æ‰§è¡Œç›´åˆ°æ‰€æœ‰å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚


- ä¸‹é¢æ˜¯å…³äºä¸¤ç§ä¸åŒæ–¹æ³•çš„ä¸€äº›è¯´æ³•ï¼š
	- ä»£ç ä¸­æ¥ä¸‹æ¥çš„å‡ è¡Œéœ€è¦ä¾èµ–å¼‚æ­¥å‡½æ•°çš„ç»“æœæ—¶ï¼Œéœ€è¦ä½¿ç”¨ await æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°ã€‚è¿™æ ·äº§ç”Ÿçš„ç»“æœæ˜¯æœ‰åºçš„ã€‚
	- çŸ­æ—¶é—´å†…å¹¶ä¸éœ€è¦å¼‚æ­¥å‡½æ•°çš„ç»“æœæ—¶ï¼Œéœ€è¦ä½¿ç”¨ async-let æ¥è°ƒç”¨å¼‚æ­¥å‡½æ•°ã€‚è¿™æ ·äº§ç”Ÿçš„ä»»åŠ¡æ˜¯å¹¶å‘çš„ã€‚

await å’Œ async-let éƒ½å…è®¸å…¶ä»–ä»»åŠ¡åœ¨ä»–ä»¬è¢«æŒ‚èµ·çš„æ—¶å€™æ‰§è¡Œã€‚
åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½éœ€è¦ç”¨ await æ ‡è®°å¯èƒ½çš„æ‚¬ç‚¹ï¼Œä»¥è¡¨æ˜ä»£ç åœ¨è¿™äº›ç‚¹åœ¨éœ€è¦çš„æƒ…å†µä¸‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°å¼‚æ­¥å‡½æ•°æ‰§è¡Œç»“æŸã€‚



<br/><br/>

> <h2 id='ä»»åŠ¡å’Œä»»åŠ¡ç»„'>ä»»åŠ¡å’Œä»»åŠ¡ç»„</h2>

&emsp; ä»»åŠ¡ï¼ˆtask) æ˜¯ä¸€é¡¹å·¥ä½œï¼Œå¯ä»¥ä½œä¸ºç¨‹åºçš„ä¸€éƒ¨åˆ†å¹¶å‘æ‰§è¡Œã€‚æ‰€æœ‰çš„å¼‚æ­¥ä»£ç éƒ½å±äºæŸä¸ªä»»åŠ¡ã€‚ä¸Šä¸€éƒ¨åˆ†ä»‹ç»çš„ async-let è¯­æ³•å°±ä¼šäº§ç”Ÿä¸€ä¸ªå­ä»»åŠ¡ã€‚ä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªä»»åŠ¡ç»„å¹¶ä¸”ç»™å…¶ä¸­æ·»åŠ å­ä»»åŠ¡ï¼Œè¿™å¯ä»¥è®©ä½ å¯¹ä¼˜å…ˆçº§å’Œä»»åŠ¡å–æ¶ˆæœ‰äº†æ›´å¤šçš„æŒæ§åŠ›ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ã€‚

&emsp; ä»»åŠ¡æ˜¯æŒ‰å±‚çº§ç»“æ„æ’åˆ—çš„ã€‚åŒä¸€ä¸ªä»»åŠ¡ç»„ä¸­çš„ä»»åŠ¡æ‹¥æœ‰ç›¸åŒçš„çˆ¶ä»»åŠ¡ï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥æ·»åŠ å­ä»»åŠ¡ã€‚ç”±äºä»»åŠ¡å’Œä»»åŠ¡ç»„ä¹‹é—´æ˜ç¡®çš„å…³ç³»ï¼Œè¿™ç§æ–¹å¼åˆè¢«ç§°ä¸ºç»“æ„åŒ–å¹¶å‘ï¼ˆstructured concurrencyï¼‰ã€‚è™½ç„¶ä½ éœ€è¦ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ï¼Œä½†ä»»åŠ¡é—´æ˜ç¡®çš„çˆ¶å­å…³ç³»è®© Swift èƒ½æ›¿ä½ å¤„ç†ä¸€äº›å¦‚æ‰©æ•£å–æ¶ˆï¼ˆpropagating cancellationï¼‰ä¹‹ç±»çš„è¡Œä¸ºï¼Œå¹¶ä¸”èƒ½è®© Swift åœ¨ç¼–è¯‘é˜¶æ®µå‘ç°ä¸€äº›é”™è¯¯ã€‚

```
await withTaskGroup(of: Data.self) { taskGroup in
    let photoNames = await listPhotos(inGallery: "Summer Vacation")
    for name in photoNames {
        taskGroup.addTask { await downloadPhoto(named: name) }
    }
}
```



<br/>

æ¡ˆä¾‹:

```
import Foundation

// å®šä¹‰ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
func performAsyncTask(taskNumber: Int) async {
    print("Task \(taskNumber) started")
    await Task.sleep(1_000_000_000) // æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œå•ä½ä¸ºçº³ç§’
    print("Task \(taskNumber) completed")
}

// å®šä¹‰ä¸€ä¸ªä»»åŠ¡ç»„ï¼Œç”¨äºç»„ç»‡å’Œç®¡ç†å¹¶å‘ä»»åŠ¡
func performTasksConcurrently() async {
    // åˆ›å»ºä»»åŠ¡ç»„
    let taskGroup = Task.runDetached {
        // ä½¿ç”¨ä»»åŠ¡ç»„å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡
        await withTaskGroup(of: Void.self) { group in
            for i in 1...5 {
                // æ·»åŠ å¼‚æ­¥ä»»åŠ¡åˆ°ä»»åŠ¡ç»„
                group.addTask {
                    await performAsyncTask(taskNumber: i)
                }
            }
            
            // ç­‰å¾…ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆ
            for await _ in group {}
        }
        
        // ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ
        print("All tasks completed")
    }
    
    // ç­‰å¾… performTasksConcurrently å‡½æ•°æ‰§è¡Œå®Œæˆ
    await taskGroup.get()
}

// å¯åŠ¨å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡
await performTasksConcurrently()
```

&emsp; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªæ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡çš„ performAsyncTask å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ withTaskGroup åˆ›å»ºäº†ä¸€ä¸ªä»»åŠ¡ç»„ï¼Œå¹¶ä½¿ç”¨ group.addTask å°†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡ç»„ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ for await _ in group ç­‰å¾…ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚

<br/>

&emsp; è¯·æ³¨æ„ï¼Œä»»åŠ¡ç»„å†…çš„ä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œå®ƒä»¬å¯èƒ½ä»¥ä¸åŒçš„é¡ºåºå®Œæˆã€‚ä»»åŠ¡ç»„æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆï¼Œè€Œæ— éœ€æ˜¾å¼åœ°ç®¡ç†æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚


<br/>

**ç–‘é—®1:Task.runDetachedæœ‰ä»€ä¹ˆä½œç”¨?**

Task.runDetached æ˜¯ Swift Concurrency ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨åå°æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸ä¼šç­‰å¾…è¯¥ä»»åŠ¡çš„å®Œæˆã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œå¯åŠ¨å¹¶å¿˜è®°â€çš„å‡½æ•°ï¼Œå³å®ƒä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ï¼Œè®©ä»»åŠ¡ç»§ç»­æ‰§è¡Œã€‚

è¿™ä¸ªå‡½æ•°çš„å£°æ˜å¦‚ä¸‹ï¼š

```
func runDetached<T>(_ body: @escaping () async throws -> T) -> Task<T>
```

å…¶ä¸­ï¼Œbody å‚æ•°æ˜¯ä¸€ä¸ªå¼‚æ­¥é—­åŒ…ï¼Œå®ƒå®šä¹‰äº†è¦åœ¨åå°æ‰§è¡Œçš„ä»»åŠ¡ã€‚å‡½æ•°è¿”å›ä¸€ä¸ª Task<T> å¯¹è±¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥è·Ÿè¸ªä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œç­‰å¾…ä»»åŠ¡çš„å®Œæˆï¼Œæˆ–è€…å–æ¶ˆä»»åŠ¡ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºäº† Task.runDetached çš„ä½¿ç”¨ï¼š

```
import Foundation

// å¼‚æ­¥ä»»åŠ¡ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
func performAsyncTask() async {
    print("Task started")
    await Task.sleep(1_000_000_000) // æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œå•ä½ä¸ºçº³ç§’
    print("Task completed")
}

// ä½¿ç”¨ Task.runDetached å¯åŠ¨åå°ä»»åŠ¡
let detachedTask = Task.runDetached {
    await performAsyncTask()
}

// ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡
print("Main thread continues")

// åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥é€‰æ‹©ç­‰å¾… detachedTask çš„å®Œæˆ
// å¦‚æœæ‚¨ä¸ç­‰å¾…ï¼Œç¨‹åºå¯èƒ½åœ¨åå°ä»»åŠ¡å°šæœªå®Œæˆæ—¶ç»“æŸ
try? detachedTask.get()

```

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒTask.runDetached å¯åŠ¨äº†ä¸€ä¸ªåå°ä»»åŠ¡æ‰§è¡Œ performAsyncTask å‡½æ•°ï¼Œè€Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¯·æ³¨æ„ï¼Œç¨‹åºå¯èƒ½åœ¨åå°ä»»åŠ¡å®Œæˆä¹‹å‰ç»“æŸï¼Œå¦‚æœæ‚¨å¸Œæœ›ç­‰å¾…åå°ä»»åŠ¡çš„å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨ try? detachedTask.get()ã€‚è¿™é‡Œçš„ try? æ˜¯å› ä¸º get å‡½æ•°å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¿½ç•¥äº†å¼‚å¸¸ã€‚



<br/><br/>

**ç–‘é—®2:withTaskGroup å‡½æ•°æœ‰ä»€ä¹ˆç”¨å‘¢?**

withTaskGroup æ˜¯ Swift Concurrency ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨äºåˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªä»»åŠ¡ç»„ï¼ˆTask Groupï¼‰ã€‚ä»»åŠ¡ç»„æ˜¯ä¸€ç§ç»“æ„åŒ–çš„æ–¹å¼ï¼Œç”¨äºç»„ç»‡å’Œåè°ƒå¤šä¸ªç›¸å…³çš„å¹¶å‘ä»»åŠ¡ã€‚withTaskGroup æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä½¿æ‚¨å¯ä»¥æ·»åŠ ä»»åŠ¡åˆ°ä»»åŠ¡ç»„ä¸­ï¼Œå¹¶ç­‰å¾…å®ƒä»¬å…¨éƒ¨å®Œæˆï¼Œè€Œæ— éœ€æ˜¾å¼åœ°ç®¡ç†æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚

è¿™ä¸ªå‡½æ•°çš„å£°æ˜å¦‚ä¸‹ï¼š

```
func withTaskGroup<ChildTaskResult>(of resultType: ChildTaskResult.Type, body: @escaping (inout TaskGroup<ChildTaskResult>) async throws -> Void) async rethrows -> [ChildTaskResult]
```

å…¶ä¸­ï¼ŒresultType æ˜¯ä»»åŠ¡ç»„ä¸­æ¯ä¸ªä»»åŠ¡çš„ç»“æœç±»å‹ã€‚body å‚æ•°æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œæ¥å—ä¸€ä¸ª inout TaskGroup<ChildTaskResult> å‚æ•°ï¼Œè¯¥å‚æ•°è¡¨ç¤ºä»»åŠ¡ç»„ã€‚åœ¨é—­åŒ…å†…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»åŠ¡ç»„çš„æ–¹æ³•æ¥æ·»åŠ ä»»åŠ¡ï¼Œç­‰å¾…ä»»åŠ¡çš„å®Œæˆç­‰ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¼”ç¤ºäº† withTaskGroup çš„ä½¿ç”¨ï¼š

```
import Foundation

// å¼‚æ­¥ä»»åŠ¡ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
func performAsyncTask(taskNumber: Int) async -> String {
    await Task.sleep(1_000_000_000) // æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶æ“ä½œï¼Œå•ä½ä¸ºçº³ç§’
    return "Task \(taskNumber) completed"
}

// ä½¿ç”¨ withTaskGroup åˆ›å»ºä»»åŠ¡ç»„
func performTasksConcurrently() async {
    // ä½¿ç”¨ä»»åŠ¡ç»„å¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡
    await withTaskGroup(of: String.self) { group in
        for i in 1...5 {
            // æ·»åŠ å¼‚æ­¥ä»»åŠ¡åˆ°ä»»åŠ¡ç»„
            group.addTask {
                return await performAsyncTask(taskNumber: i)
            }
        }

        // ç­‰å¾…ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œå¹¶æ”¶é›†ç»“æœ
        let results = await group.reduce(into: [String]()) { acc, taskResult in
            acc.append(taskResult)
        }

        // ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ
        print("All tasks completed with results: \(results)")
    }
}

// å¯åŠ¨å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡
await performTasksConcurrently()
```


åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒwithTaskGroup åˆ›å»ºäº†ä¸€ä¸ªä»»åŠ¡ç»„ï¼Œç„¶åä½¿ç”¨ group.addTask æ·»åŠ äº†å¤šä¸ªå¼‚æ­¥ä»»åŠ¡åˆ°ä»»åŠ¡ç»„ä¸­ã€‚æœ€åï¼Œé€šè¿‡ await group.reduce ç­‰å¾…ä»»åŠ¡ç»„å†…çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œå¹¶æ”¶é›†å®ƒä»¬çš„ç»“æœã€‚withTaskGroup æä¾›äº†ä¸€ç§æ›´ç®€å•çš„æ–¹å¼æ¥ç»„ç»‡å’Œç­‰å¾…å¤šä¸ªå¹¶å‘ä»»åŠ¡çš„å®Œæˆã€‚



<br/><br/>

> <h3 id='éç»“æ„åŒ–å¹¶å‘'>éç»“æ„åŒ–å¹¶å‘</h3>




<br/>
<br/>


> <h2 id=''></h2>
