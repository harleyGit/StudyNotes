> <h4/>
- [**ç®€å•ä»‹ç»â€Œ**](#ç®€å•ä»‹ç»)
	- [**â€Œå®‰è£…**](#å®‰è£…)
	- [â€ŒåŸºæœ¬å‘½ä»¤](#åŸºæœ¬å‘½ä»¤)
		- [æœåŠ¡ç«¯å¯åŠ¨](#æœåŠ¡ç«¯å¯åŠ¨) 
		- [å¯åŠ¨rediså®¢æˆ·ç«¯](#å¯åŠ¨rediså®¢æˆ·ç«¯)
- [**åè®®**](#åè®®)
- [**æ“ä½œRedis**](#æ“ä½œRedis)
- [**åå¤§æ•°æ®ç±»å‹**](#åå¤§æ•°æ®ç±»å‹)
	- [Redisæµ(Stream)](#Redisæµ(Stream))
- [**Redisçš„MQä¸­é—´ä»¶**](#Redisçš„MQä¸­é—´ä»¶)  
	- [kafkaæ¶ˆæ¯é˜Ÿåˆ—](#kafkaæ¶ˆæ¯é˜Ÿåˆ—)
- [**ä¸“ä¸šæ¦‚å¿µè¯¦ä»‹**](#ä¸“ä¸šæ¦‚å¿µè¯¦ä»‹)
	- [Raftç®—æ³•ç™½è¯è§£é‡Š](#Raftç®—æ³•ç™½è¯è§£é‡Š)
	- [ä¸€è‡´æ€§hashå’Œhashæ§½](#ä¸€è‡´æ€§hashå’Œhashæ§½)
- **èµ„æ–™**
	- [Redisèµ„æ–™-å°šç¡…è°·](https://github.com/harleyGit/Learning-in-practice/tree/master/Redis)
	- [Redisåœ¨çº¿æµ‹è¯•](https://try.redis.io/)
	- [go-redisä½¿ç”¨å…¥é—¨](https://juejin.cn/post/7202521955366879288)


<br/><br/><br/>

***
<br/>

> <h1 id="ç®€å•ä»‹ç»"> <font color='red'>**â€Œç®€å•ä»‹ç»**</font></h1>

Redis çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ TCP è¿æ¥æ¥è¿›è¡Œæ•°æ®äº¤äº’ï¼Œ æœåŠ¡å™¨é»˜è®¤çš„ç«¯å£å·ä¸º<font color='red'>**6379**</font>


å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘é€çš„å‘½ä»¤æˆ–æ•°æ®ä¸€å¾‹ä»¥ \r\n ï¼ˆCRLFï¼‰ç»“å°¾ï¼ˆè¿™æ˜¯ä¸€æ¡çº¦å®šï¼‰


<br/><br/><br/>
> <h2 id="å®‰è£…">å®‰è£…</h2>
**å®‰è£…:**

```sh
brew install redis
```

<br/>

**éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ:**

```sh
% redis-cli -v
redis-cli 7.2.7

% redis-server -v
Redis server v=7.2.7 sha=00000000:0 malloc=libc bits=64 build=7f24f11dd7e42c58
```

<br/>

- Rediså®‰è£…å¥½åï¼Œé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨0å·åº“ï¼Œç¼–å·æ˜¯0...15ã€‚
	- æ·»åŠ key-val[set]
	- æŸ¥çœ‹å½“å‰redisçš„æ‰€æœ‰key[keys *]
	- è·å–keyå¯¹åº”çš„å€¼[get key];
	- åˆ‡æ¢redisæ•°æ®åº“[select index];
		- å¦‚ä½•æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„key-valæ•°é‡[dbsize];
	- æ¸…ç©ºå½“å‰æ•°æ®åº“çš„key-valå’Œæ¸…ç©ºæ‰€æœ‰æ•°æ®åº“çš„key-val [flushdb flushall]

<br/><br/>

å› ä¸ºé€šè¿‡brewå®‰è£…çš„redis,æ‰€ä»¥å¯ä»¥æŸ¥çœ‹redisçš„ä¿¡æ¯:

```sh
brew info redis

==> redis: stable 7.2.7 (bottled), HEAD
Persistent key-value database, with built-in net interface
https://redis.io/
Conflicts with:
  valkey (because both install `redis-*` binaries)
Installed
/opt/homebrew/Cellar/redis/7.2.7 (15 files, 2.4MB) *
  Poured from bottle using the formulae.brew.sh API on 2025-03-13 at 15:11:58
From: https://github.com/Homebrew/homebrew-core/blob/HEAD/Formula/r/redis.rb
License: BSD-3-Clause AND BSD-2-Clause AND BSL-1.0 AND MIT AND (CC0-1.0 OR BSD-2-Clause)
==> Dependencies
Required: openssl@3 âœ”
==> Options
--HEAD
	Install HEAD version
==> Caveats
To restart redis after an upgrade:
  brew services restart redis
Or, if you don't want/need a background service you can just run:
  /opt/homebrew/opt/redis/bin/redis-server /opt/homebrew/etc/redis.conf
==> Analytics
install: 20,112 (30 days), 67,377 (90 days), 278,498 (365 days)
install-on-request: 20,029 (30 days), 67,145 (90 days), 275,783 (365 days)
build-error: 40 (30 days)
```

ä¸Šè¿°rediså¹¶ä¸æ˜¯åœ¨ä¸‹è½½ Redis æœ¬èº«ï¼Œè€Œæ˜¯æ‰§è¡Œäº†ä¸€äº›è”ç½‘è¡Œä¸º**æ¥è·å–æœ€æ–°ä¿¡æ¯.**

**æŸ¥çœ‹redisçš„é…ç½®ä¿¡æ¯:**

```sh
open /opt/homebrew/etc/redis.conf
```

ä¸ºäº†é¿å…è‡ªå·±å¹³æ—¶ä¸ºäº†æ–¹ä¾¿å’Œè‡ªå®šä¹‰ä¸€äº›é…ç½®,å°†`redis.conf`é‡æ–°æ‹·è´å‡ºæ¥é‡å‘½åä¸º`myRedis.conf`,ç„¶ååœ¨`.bash_profileæ–‡ä»¶`é…ç½®å¦‚ä¸‹:

```sh
export REDIS_CONF_PATH=/Users/ganghuang/SDConfig/redis/myRedis.conf

source ~/.bash_profile
```


***
<br/><br/><br/>

># <h2 id="åŸºæœ¬å‘½ä»¤"> [åŸºæœ¬å‘½ä»¤](https://www.redis.net.cn/order/) </h2>
[**Rediså‘½ä»¤å‚è€ƒ**](http://doc.redisfans.com/index.html)

<br/><br/>
> <h3 id="æœåŠ¡ç«¯å¯åŠ¨">æœåŠ¡ç«¯å¯åŠ¨</h3>

**ä½¿ç”¨ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶`redis.conf`å¯åŠ¨æœåŠ¡å™¨å‘½ä»¤:**

```sh
% redis-server

893:C 13 Mar 2025 15:31:21.307 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
893:C 13 Mar 2025 15:31:21.307 * Redis version=7.2.7, bits=64, commit=00000000, modified=0, pid=893, just started
893:C 13 Mar 2025 15:31:21.307 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf
893:M 13 Mar 2025 15:31:21.307 * Increased maximum number of open files to 10032 (it was originally set to 2560).
893:M 13 Mar 2025 15:31:21.307 * monotonic clock: POSIX clock_gettime
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 7.2.7 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._                                  
 (    '      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 893
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           https://redis.io       
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'                                               

893:M 13 Mar 2025 15:31:21.308 # WARNING: The TCP backlog setting of 511 cannot be enforced because kern.ipc.somaxconn is set to the lower value of 128.
893:M 13 Mar 2025 15:31:21.308 * Server initialized
893:M 13 Mar 2025 15:31:21.308 * Ready to accept connections tcp



#å…³é—­
å¿«æ·é”®: Ctrl+Cå³å¯
```

<br/>

ä½¿ç”¨è‡ªå·±çš„é…ç½®çš„`myRedis.conf`å¯åŠ¨å¦‚ä¸‹:

```sh
# ç¯å¢ƒå˜é‡å¯åŠ¨ redis-server
redis-server $REDIS_CONF_PATH

#å…³é—­
å¿«æ·é”®: Ctrl+Cå³å¯
```

å½“åˆåœ¨ä½¿ç”¨è¿™ä¸ªçš„æ—¶å€™å‡ºé”™äº†,å› ä¸ºæˆ‘æ˜¯ç”¨brewå¯åŠ¨äº†,å¯¼è‡´6379ç«¯å£å ç”¨äº†,æ— æ³•å¯åŠ¨! è§£å†³å¦‚ä¸‹:

```sh

```

<br/><br/>

**ç¡®è®¤Redisæ˜¯å¦åœ¨è¿è¡Œ:**

```sh
// æ£€æŸ¥ Redis æ˜¯å¦ç›‘å¬ 6379 ç«¯å£ï¼š
% lsof -i :6379;

COMMAND   PID      USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME
redis-ser 893 ganghuang    7u  IPv4 0xf4e154464036c58d      0t0  TCP *:6379 (LISTEN)
redis-ser 893 ganghuang    8u  IPv6 0xf4e154417ddefb3d      0t0  TCP *:6379 (LISTEN)

// ç›´æ¥ä½¿ç”¨ Redis CLI æµ‹è¯•è¿æ¥, å¦‚æœè¿”å› PONGï¼Œè¯´æ˜ Redis æ­£å¸¸è¿è¡Œ
% redis-cli ping;
PONG

# è‹¥æ˜¯å‡ºç°ç«¯å£å ç”¨,å¯ä»¥ä½¿ç”¨killå‘½ä»¤å°†æ— å…³å ç”¨çš„ç«¯å£ç»™æ€æ‰
kill -9 ç«¯å£å·å ç”¨çš„PID
```

<br/>

**æŸ¥çœ‹redis-serverçš„PID(ç¡®è®¤ Redis å¯åŠ¨çŠ¶æ€)**

```sh
ps aux | grep redis
```

<br/><br/>
> <h3 id="å¯åŠ¨rediså®¢æˆ·ç«¯">å¯åŠ¨rediså®¢æˆ·ç«¯</h3> 

**æœ¬åœ°å¯åŠ¨å®¢æˆ·ç«¯:**

```sh
# å¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™è¦å…ˆå¯åŠ¨æœåŠ¡ç«¯,å¦åˆ™æ— æ³•è¿æ¥
% redis-cli

# å‡ºç°å¦‚ä¸‹: ipåœ°å€: ç«¯å£, è¡¨ç¤ºå·²ç»è¿ä¸Šäº†
127.0.0.1:6379> 


# é€€å‡º
shutdown // åœæ­¢redisæœåŠ¡ 
quit // é€€å‡ºredis-cli çš„äº¤äº’æ¨¡å¼
```

<br/>

**è¿æ¥è¿œç¨‹ Redisï¼ˆå¦‚æœæœ‰ï¼‰**

```sh
# è¿æ¥æœ¬åœ°: redis-cli -h 127.0.0.1 -p 6379
# è¿æ¥è¿œç«¯
redis-cli -h 192.168.1.100 -p 6379

// å•å®ä¾‹å…³é—­: redis-cli -a å¯†ç  shutdown
redis-cli -a 123456 shutdownï¼Œå¦‚æœåœ¨RedisæœåŠ¡å™¨é‡Œé¢å¯ä»¥ç›´æ¥ä½¿ç”¨shutdownå‘½ä»¤
shutdown // åœæ­¢redisæœåŠ¡ 
quit // é€€å‡ºredis-cli çš„äº¤äº’æ¨¡å¼


// å¤šå®ä¾‹å…³é—­,æŒ‡å®šç«¯å£å…³é—­: redis-cli -p ç«¯å£ shutdown
redis-cli -p 6379 shutdown
```

<br/>

**å¸¸ç”¨è¯­æ³•**

```redis
keys * // æŸ¥è¯¢æ‰€æœ‰key

get [key] // è·å–ä¸€æ¡

# æ…ç”¨,å¼ºçƒˆå»ºè®®ä¸è¦
flushall // åˆ é™¤æ‰€æœ‰

set [key] [value] // è®¾ç½®ä¸€æ¡
```


<br/><br/><br/>

***
<br/>

> <h1 id="åè®®">åè®®</h1>

**è¯·æ±‚åè®®**
æ ¼å¼ç¤ºä¾‹

```sh
*<å‚æ•°æ•°é‡> CR LF
$<å‚æ•° 1 çš„å­—èŠ‚æ•°é‡> CR LF
<å‚æ•° 1 çš„æ•°æ®> CR LF
...
$<å‚æ•° N çš„å­—èŠ‚æ•°é‡> CR LF
<å‚æ•° N çš„æ•°æ®> CR LF
```
åœ¨è¯¥åè®®ä¸‹æ‰€æœ‰å‘é€è‡³ Redis æœåŠ¡å™¨çš„å‚æ•°éƒ½æ˜¯äºŒè¿›åˆ¶å®‰å…¨ï¼ˆbinary safeï¼‰çš„

<br/>

**æ‰“å°ç¤ºä¾‹**

```json
*3
$3
SET
$5
mykey
$7
myvalue
```

<br/>

**å®é™…åè®®å€¼**

```sh
"*3\r\n$3\r\nSET\r\n$5\r\nmykey\r\n$7\r\nmyvalue\r\n"
```
è¿™å°±æ˜¯ Redis çš„è¯·æ±‚åè®®è§„èŒƒï¼ŒæŒ‰ç…§èŒƒä¾‹1ç¼–å†™å®¢æˆ·ç«¯é€»è¾‘ï¼Œæœ€ç»ˆå‘é€çš„æ˜¯èŒƒä¾‹3ï¼Œç›¸ä¿¡ä½ å·²ç»æœ‰å¤§è‡´çš„æ¦‚å¿µäº†ï¼ŒRedis çš„åè®®éå¸¸çš„ç®€æ´æ˜“æ‡‚ï¼Œè¿™ä¹Ÿæ˜¯å¥½ä¸Šæ‰‹çš„åŸå› ä¹‹ä¸€ï¼Œä½ å¯ä»¥æƒ³æƒ³åè®®è¿™ä¹ˆå®šä¹‰çš„å¥½å¤„åœ¨å“ªï¼Ÿ

<br/>

**å›å¤**

Redis ä¼šæ ¹æ®ä½ è¯·æ±‚åè®®çš„ä¸åŒï¼ˆæ‰§è¡Œçš„å‘½ä»¤ç»“æœä¹Ÿä¸åŒï¼‰ï¼Œè¿”å›å¤šç§ä¸åŒç±»å‹çš„å›å¤ã€‚åœ¨è¿™ä¸ªå›å¤â€œåè®®â€ä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œç¡®å®šè¿™ä¸ªå›å¤æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¦‚ä¸‹ï¼š

- çŠ¶æ€å›å¤ï¼ˆstatus replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ â€œ+â€
- é”™è¯¯å›å¤ï¼ˆerror replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ â€œ-â€
- æ•´æ•°å›å¤ï¼ˆinteger replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ â€œ:â€
- æ‰¹é‡å›å¤ï¼ˆbulk replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ â€œ$â€
- å¤šæ¡æ‰¹é‡å›å¤ï¼ˆmulti bulk replyï¼‰çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯ â€œ*â€
æœ‰äº†å›å¤çš„å¤´éƒ¨æ ‡è¯†ï¼Œç»“å°¾çš„ CRLFï¼Œä½ å¯ä»¥å¤§è‡´çŒœæƒ³å‡ºå›å¤â€œåè®®â€æ˜¯æ€ä¹ˆæ ·çš„ï¼Œä½†æ˜¯å®è·µæ‰èƒ½å¾—å‡ºçœŸç†


<br/><br/><br/>

***
<br/>

> <h1 id="æ“ä½œRedis">æ“ä½œRedis</h1>
[goè¯­è¨€-é€‰æ‹©redigo-æŸ¥çœ‹ API](https://pkg.go.dev/github.com/gomodule/redigo/redis#pkg-examples)
[Redis APIæ–‡æ¡£](https://pkg.go.dev/github.com/gomodule/redigo/redis)


**å®‰è£…ç¬¬ä¸‰æ–¹åŒ…:**

```sh
go get github.com/gomodule/redigo@latest
```


<br/><br/>

- **ä¸»è¦åˆ†ä¸º 3 ç±»ï¼š**
	- è¿æ¥æ•°æ®åº“
		- APIæ–‡æ¡£ä¸­ï¼Œæ‰€æœ‰ä»¥ Dial å¼€å¤´

	- æ“ä½œæ•°æ®åº“
		- Do() å‡½æ•°ã€æ¨èã€‘
		- Send()å‡½æ•°, éœ€è¦é…åˆFlush()ã€Receive() 3 ä¸ªå‡½æ•°ä½¿ç”¨

	- å›å¤åŠ©æ‰‹
		- ç›¸å½“äº â€œç±»å‹æ–­è¨€â€ã€‚æ ¹æ®ä½¿ç”¨çš„å…·ä½“æ•°æ®ç±»å‹ï¼Œé€‰æ‹©è°ƒç”¨
		- å°†DOå‡½æ•°è¿”å›çš„interface{}ç¡®å®šä¸ºå…·ä½“ç±»å‹


**æµ‹è¯•æ¡ˆä¾‹:**

```go

package redisexample

import (
	"fmt"

	"github.com/gomodule/redigo/redis"
)

// .intç±»å‹æ•°æ®æ’å…¥ä¸æŸ¥è¯¢, æ§åˆ¶å°å‡ºç°ï¼š9990ï¼Œå°±ä»£è¡¨æˆåŠŸäº†
func RedisExamplePractice() {
	c, err := redis.Dial("tcp", "127.0.0.1:6379")
	if err != nil {
		fmt.Println("è¿æ¥ redis å¤±è´¥ err:", err)
		return
	}

	defer c.Close()
	_, err = c.Do("Set", "abc", 9990)
	if err != nil {
		fmt.Println("redis æ“ä½œå¤±è´¥")
		return
	}

	r, err := redis.Int(c.Do("Get", "abc"))
	if err != nil {
		fmt.Println("redis get abc æ“ä½œå¤±è´¥")
		return
	}

	fmt.Println(r)
}

```

<br/><br/><br/>

***
<br/>

> <h1 id="åå¤§æ•°æ®ç±»å‹">åå¤§æ•°æ®ç±»å‹</h1>


***
<br/><br/><br/>

> <h2 id="Redisæµ(Stream)">Redisæµ(Stream)</h2>

<br/><br/><br/>

***
<br/>

> <h1 id="Redisçš„MQä¸­é—´ä»¶">Redisçš„MQä¸­é—´ä»¶</h1>

![go.0.0.181.png](./../Pictures/go.0.0.181.png)

***
<br/><br/><br/>

> <h2 id="kafkaæ¶ˆæ¯é˜Ÿåˆ—">kafkaæ¶ˆæ¯é˜Ÿåˆ—</h2>



<br/><br/><br/>

***
<br/>

> <h1 id="ä¸“ä¸šæ¦‚å¿µè¯¦ä»‹">ä¸“ä¸šæ¦‚å¿µè¯¦ä»‹</h1>


***
<br/><br/><br/>

> <h2 id="Raftç®—æ³•ç™½è¯è§£é‡Š">Raftç®—æ³•ç™½è¯è§£é‡Š</h2>

å¥½å‘€ï¼æˆ‘æ¥ç”¨**è¶…ç™½è¯**çš„æ–¹å¼ç»™ä½ è§£é‡Šä¸€ä¸‹ **Raft** ç®—æ³•ï¼ˆä¿è¯ä½ èƒ½ç§’æ‡‚ï¼Œä¸ç¡¬å•ƒç†è®º ğŸ˜‚ï¼‰ã€‚

---

# ğŸ¯ Raft æ˜¯å¹²å˜›çš„ï¼Ÿ
**Raft** æ˜¯ä¸€ç§ "**è®©ä¸€å †æœåŠ¡å™¨è¾¾æˆä¸€è‡´**" çš„ç®—æ³•ã€‚  
ä¹Ÿå°±æ˜¯è¯´ï¼Œ**å³ä½¿ç½‘ç»œå¾ˆçƒ‚ã€æœºå™¨åæ‰ï¼Œå¤§å®¶ä¹Ÿèƒ½ä¿æŒä¸€æ¡å¿ƒï¼Œä¸€èµ·è®°è´¦ã€ä¸ä¹±å¥—ã€‚**

è¿™ç§ä¸œè¥¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œè¶…çº§é‡è¦ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼æ•°æ®åº“ã€åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚

# ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ Raftï¼Ÿ
æƒ³è±¡ä¸€ä¸‹ï¼š
- ä½ æœ‰5å°æœåŠ¡å™¨ã€‚
- å®¢æˆ·ç«¯æ¥è¯·æ±‚ï¼š"ç»™æˆ‘å­˜ä¸€æ¡æ•°æ® Aï¼"
- ç»“æœå…¶ä¸­ä¸€å°æœºå™¨æ–­ç”µäº†ï¼Œæˆ–è€…ä¸¤å°æœºå™¨æ”¶åˆ°çš„æ¶ˆæ¯ä¸ä¸€æ ·ã€‚
- æ€ä¹ˆä¿è¯**å¤§å®¶æœ€ç»ˆéƒ½å­˜çš„æ˜¯åŒä¸€æ¡æ•°æ®ï¼Ÿ**  
**ä¸èƒ½å„è‡ªä¹±æ¥ï¼**

è¿™å°±æ˜¯ Raft è¦è§£å†³çš„é—®é¢˜ã€‚**ä¸€è‡´æ€§é—®é¢˜ã€‚**

---

# ğŸš€ Raft çš„åŸºæœ¬æµç¨‹ï¼ˆç”¨è¶…ç®€å•çš„æ¯”å–»ï¼‰

æƒ³è±¡ä¸€ä¸‹ï¼Œ5ä¸ªäººå¼€ä¼šï¼Œè¦åšå†³å®šï¼ˆæ¯”å¦‚åƒä»€ä¹ˆå¤–å–ï¼‰ã€‚Raftçš„æ­¥éª¤å°±åƒæ˜¯ï¼š

### 1. é€‰ä¸€ä¸ªè€å¤§ï¼ˆLeaderé€‰ä¸¾ï¼‰
- å¼€ä¼šå‰ï¼Œå¤§å®¶æŠ•ç¥¨ï¼Œå…ˆé€‰ä¸€ä¸ª**Leaderï¼ˆè€å¤§ï¼‰**ã€‚
- è°æœ€å¿«æ‹‰åˆ°å¤šæ•°äººçš„æ”¯æŒï¼Œè°å°±å½“è€å¤§ã€‚
- è€å¤§æ˜¯**å”¯ä¸€èƒ½æ‹æ¿çš„äºº**ã€‚

ğŸ‘‰ æŠ€æœ¯ä¸Šå«åš "**Leader Election**"

### 2. æœ‰äº‹æ‰¾è€å¤§ï¼ˆæ—¥å¿—å¤åˆ¶ï¼‰
- å®¢æˆ·ï¼ˆæ¯”å¦‚ä¸€ä¸ªåº”ç”¨ï¼‰æ¥æ‰¾ï¼Œ"æˆ‘è¦å­˜ä¸€æ¡æ•°æ®"ã€‚
- åªæœ‰è€å¤§æœ‰æƒåˆ©æ¥æ”¶è¯·æ±‚ã€‚
- è€å¤§æ”¶åˆ°åï¼Œå‘Šè¯‰å…¶ä»–å°å¼Ÿï¼ˆFollowersï¼‰ï¼š"è®°ä¸‹æ¥è¿™æ¡ï¼"
- å°å¼Ÿä»¬è¯´ "æ”¶åˆ°ï¼è®°å¥½äº†ï¼"  
- ç­‰**å¤§å¤šæ•°äºº**ç¡®è®¤äº†ï¼Œè€å¤§å°±å‘Šè¯‰å®¢æˆ·ç«¯ï¼š"æå®šäº†ï¼"

ğŸ‘‰ æŠ€æœ¯ä¸Šå« "**Log Replication**"

### 3. å‡ºäº‹äº†æ¢è€å¤§ï¼ˆå®¹é”™ï¼‰
- å¦‚æœè€å¤§çªç„¶æ­»äº†ï¼ˆæ¯”å¦‚æ‰çº¿ã€å®•æœºäº†ï¼‰ï¼Œé‚£å…¶ä»–äººä¼šå‘ç°ï¼š
  - "å’¦ï¼Ÿè€å¤§ä¸€æ®µæ—¶é—´æ²¡è¯´è¯äº†ã€‚"
- å¤§å®¶å°±é‡æ–°å¼€å§‹æŠ•ç¥¨ï¼Œé€‰ä¸€ä¸ªæ–°çš„è€å¤§ã€‚

ğŸ‘‰ æŠ€æœ¯ä¸Šå« "**Leader Re-Election**"

---

# ğŸ§  å°ç»†èŠ‚ï¼ˆé«˜çº§ä¸€ç‚¹ç‚¹ï¼‰
- æ¯ä¸€æ¬¡é€‰ä¸¾ã€æ¯ä¸€æ‰¹æ•°æ®ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª **ä»»æœŸï¼ˆtermï¼‰**ã€‚ç±»ä¼¼äºâ€œç¬¬å‡ å±Šè€å¤§â€ã€‚
- æ—¥å¿—æœ‰é¡ºåºï¼Œæ¯æ¡æ•°æ®éƒ½ç¼–å·ï¼Œä¿è¯å…ˆåé¡ºåºä¸€è‡´ã€‚
- å¦‚æœä¸åŒäººå­˜çš„æ•°æ®æœ‰å†²çªï¼Œæ–°çš„ Leader ä¼šå¼ºåˆ¶å¤§å®¶ç»Ÿä¸€æˆæ­£ç¡®çš„ç‰ˆæœ¬ã€‚

---

# ğŸ”¥ æ€»ç»“ä¸€æŠŠæ¢³
| æ¦‚å¿µ            | ç™½è¯è§£é‡Š                                   |
|-----------------|-------------------------------------------|
| Leader          | è€å¤§ï¼Œç»Ÿä¸€æŒ‡æŒ¥ï¼Œæ‹æ¿åšå†³å®š                  |
| Followers       | å°å¼Ÿï¼Œå¬ä»è€å¤§æŒ‡æŒ¥                         |
| Term            | ä»»æœŸï¼Œæ¯”å¦‚â€œç¬¬5å±Šé¢†å¯¼ç­å­â€                   |
| Log Replication | è€å¤§å‘å·æ–½ä»¤ï¼Œå°å¼Ÿä»¬åŒæ­¥è®°å½•                 |
| Election        | è€å¤§æ­»äº†è¦é‡æ–°æŠ•ç¥¨                         |
| Commit          | å¤§å¤šæ•°åŒæ„åï¼Œæ‰ç®—æ­£å¼è®°è´¦                  |

---

# ğŸ¯ Raft çš„è®¾è®¡ç›®æ ‡
> **â€œè®©ä¸€è‡´æ€§ç®—æ³•å®¹æ˜“ç†è§£ã€‚â€**

Raftå°±æ˜¯ä¸ºäº†æ¯”ä»¥å‰çš„Paxosç®—æ³•æ›´ç®€å•ã€æ›´å¥½æ‡‚è€Œå‘æ˜çš„ã€‚  
**æ‰€ä»¥ä½ èƒ½æ‡‚ï¼Œå¾ˆæ­£å¸¸ï¼ŒRaftæœ¬æ¥å°±æ˜¯ä¸ºè®©äººç±»çœ‹å¾—æ‡‚è®¾è®¡çš„ï¼**

---

è¦ä¸è¦æˆ‘é¡ºä¾¿å†ç”¨ä¸€ä¸ªå°åŠ¨ç”»æˆ–è€…æµç¨‹å›¾ç»™ä½ ç”»ä¸€ä¸‹ï¼Œ"é€‰è€å¤§"å’Œ"åŒæ­¥æ•°æ®"æ˜¯æ€ä¹ˆè·‘çš„ï¼Ÿä¸€å¼ å›¾å°±ç§’æ‡‚é‚£ç§ï½è¦çš„è¯å‘Šè¯‰æˆ‘ ğŸ˜



***
<br/><br/><br/>
> <h2 id="ä¸€è‡´æ€§hashå’Œhashæ§½">ä¸€è‡´æ€§hashå’Œhashæ§½</h2>
OKï¼Œæ¥å•¦ï¼å’±ä»¬ç»§ç»­ç”¨**è¶…ç™½è¯**ã€**ä¸€æ­¥æ­¥è®²æ‡‚**çš„æ–¹å¼ï¼ŒæŠŠã€Œä¸€è‡´æ€§å“ˆå¸Œã€å’Œã€Œå“ˆå¸Œæ§½ã€éƒ½è§£é‡Šæ¸…æ¥šï½ğŸš€

---

# ğŸ¯ é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯å“ˆå¸Œï¼ˆHashï¼‰ï¼Ÿ
ç®€å•ç†è§£ï¼š
- ç»™ä¸€ä¸ªä¸œè¥¿ï¼ˆæ¯”å¦‚åå­—ã€æ•°æ®ï¼‰è·‘ä¸€ä¸ªâ€œå‹ç¼©â€ç®—æ³•ï¼Œå¾—åˆ°ä¸€ä¸ªçŸ­çš„æ•°å­—/å€¼ã€‚
- æ¯”å¦‚ï¼š`"apple"` â†’ å“ˆå¸Œåå˜æˆ `2384723`
- å“ˆå¸Œçš„ç‰¹ç‚¹æ˜¯ï¼š
  - è¾“å…¥ä¸€æ ·ï¼Œè¾“å‡ºä¸€å®šä¸€æ ·ã€‚
  - æ”¹ä¸€ç‚¹ç‚¹ï¼Œç»“æœå·®å¾ˆå¤šã€‚

å°±åƒç»™æ¯ä¸ªä¸œè¥¿æ‰“ä¸Šä¸€ä¸ª**ç‹¬ç‰¹ç¼–å·**ã€‚

---

# ğŸ¯ ä¸ºä»€ä¹ˆè¦ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Ÿ
æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼š
- ä½ æœ‰3å°æœåŠ¡å™¨å­˜æ•°æ®ï¼ˆAã€Bã€Cï¼‰ã€‚
- ç”¨æˆ·æ•°æ®å¤ªå¤šäº†ï¼Œåˆ†å¼€å­˜æ‰æ‰›å¾—ä½ã€‚
- ä½ æƒ³ç”¨ Hash æŠŠæ•°æ®åˆ†åˆ°ä¸åŒæœåŠ¡å™¨ï¼Œæ¯”å¦‚ï¼š
  - `hash(å°æ˜)` % 3 = 0 â” å­˜ A
  - `hash(å°çº¢)` % 3 = 1 â” å­˜ B
  - `hash(å°å¼ )` % 3 = 2 â” å­˜ C

ä¸€å¼€å§‹æŒºå¥½ã€‚ä½†æ˜¯â€”â€”
- å¦‚æœåŠ ä¸€å°æ–°æœåŠ¡å™¨ Dï¼ˆå˜æˆ4å°äº†ï¼‰ï¼Ÿ
- å…¨éƒ¨æ•°æ®çš„ `% 4` ç»“æœå°±å˜äº†ã€‚
- å¤§é‡è€æ•°æ®è¦é‡æ–°æ¬å®¶ï¼ˆè¶…çº§ç—›è‹¦ï¼‰ã€‚

æ‰€ä»¥ï¼š**æœåŠ¡å™¨ä¸€å˜åŒ–ï¼Œæ‰€æœ‰æ•°æ®å‡ ä¹éƒ½è¦é‡æ–°åˆ†é…ï¼Œè¿™å¾ˆå‘ã€‚**

è¿™æ—¶å€™å°±éœ€è¦â€”â€”  
âœ… **ä¸€è‡´æ€§å“ˆå¸Œ**æ¥è§£å†³é—®é¢˜ï¼

---

# ğŸ¯ ä¸€è‡´æ€§å“ˆå¸Œæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿï¼ˆè¶…ç®€å•æ¯”å–»ï¼‰

å¯ä»¥æƒ³è±¡æˆï¼š

1. æŠŠæ•´ä¸ª Hash ç©ºé—´ï¼Œç”»æˆä¸€ä¸ª **åœ†åœˆ**ï¼ˆåƒæ—¶é’Ÿç›˜ï¼Œ0ç‚¹åˆ°24ç‚¹ï¼‰ã€‚
2. æ¯ä¸ªæœåŠ¡å™¨ä¹Ÿç®—ä¸€é Hashï¼Œæ”¾åˆ°åœ†åœˆçš„æŸä¸ªä½ç½®ã€‚
   - æ¯”å¦‚ A è½åœ¨ 3ç‚¹ä½ç½®ï¼ŒB è½åœ¨ 7ç‚¹ï¼ŒC è½åœ¨ 11ç‚¹ã€‚
3. å­˜æ•°æ®æ—¶ï¼Œç®—æ•°æ®çš„ Hashï¼Œçœ‹å®ƒè½åœ¨åœ†åœˆå“ªä¸ªä½ç½®ã€‚
4. æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå°±æ˜¯å­˜å®ƒçš„åœ°æ–¹ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
- æ•°æ® `å°æ˜` Hash è½åœ¨ 5ç‚¹ â” é¡ºæ—¶é’ˆç¬¬ä¸€ä¸ªæœåŠ¡å™¨æ˜¯ B â” å­˜åˆ° Bã€‚
- æ•°æ® `å°å¼ ` Hash è½åœ¨ 12ç‚¹ â” é¡ºæ—¶é’ˆå›åˆ°æœ€æ—©çš„ A â” å­˜åˆ° Aã€‚

âœ… è¿™æ ·ï¼Œå³ä½¿å¢åŠ æˆ–å‡å°‘æœåŠ¡å™¨ï¼Œåªå½±å“ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…¶ä»–æ•°æ®ä¸åŠ¨ï¼

---

# ğŸ”¥ ä¸€å¥è¯æ€»ç»“ä¸€è‡´æ€§å“ˆå¸Œï¼š
> **"ç”¨ä¸€ä¸ªåœ†åœˆ+é¡ºæ—¶é’ˆæ‰¾æœ€è¿‘æœåŠ¡å™¨ï¼Œè®©æ–°å¢/ä¸‹çº¿æœåŠ¡å™¨åªå½±å“æœ€å°çš„æ•°æ®é‡ã€‚"**

ï¼ˆè§£å†³å¤§è§„æ¨¡æ•°æ®é‡æ–°åˆ†é…çš„é—®é¢˜ï¼ï¼‰

---

# ğŸ¯ å†è¯´è¯´å“ˆå¸Œæ§½ï¼ˆHash Slotï¼‰

å“ˆå¸Œæ§½æ˜¯å¦å¤–ä¸€ç§æ›´**ç»†åˆ†**çš„ç­–ç•¥ï¼Œå¸¸è§åœ¨åƒ Redis è¿™ç§åœºæ™¯ã€‚

ç†è§£èµ·æ¥éå¸¸ç®€å•ï¼š

å¯ä»¥æŠŠå“ˆå¸Œæ§½æƒ³æˆâ€”â€”  
âœ… **å°æ ¼å­ã€å°æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´è£…ä¸€éƒ¨åˆ†æ•°æ®ã€‚**

æ¯”å¦‚ï¼š
- æ€»å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼ˆRedis Cluster è§„èŒƒå°±æ˜¯ 0 ï½ 16383ï¼‰ã€‚
- æ¯æ¡æ•°æ®æ ¹æ® Hash ç®—å‡ºæ¥ï¼Œè½åˆ°ä¸€ä¸ªå…·ä½“çš„æ§½å·ã€‚
- æ¯å°æœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰è´Ÿè´£ä¸€éƒ¨åˆ†å“ˆå¸Œæ§½ã€‚

æ¯”å¦‚åˆ†é…æ˜¯ï¼š
- æœåŠ¡å™¨ Aï¼šè´Ÿè´£ 0 ~ 5460
- æœåŠ¡å™¨ Bï¼šè´Ÿè´£ 5461 ~ 10922
- æœåŠ¡å™¨ Cï¼šè´Ÿè´£ 10923 ~ 16383

å­˜æ•°æ®æ—¶æµç¨‹å°±æ˜¯ï¼š
- æŠŠ keyï¼ˆæ¯”å¦‚ "xiaoming"ï¼‰ç®—ä¸€ä¸‹ CRC16 å“ˆå¸Œï¼Œç»“æœæ¯”å¦‚æ˜¯ 8193ã€‚
- 8193 è½åœ¨ B æœåŠ¡å™¨è´Ÿè´£çš„èŒƒå›´ï¼Œæ‰€ä»¥æŠŠ "xiaoming" å­˜åˆ° Bã€‚

---

# ğŸ† é‚£å“ˆå¸Œæ§½åˆ°åº•æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ
- **é¢„å…ˆå›ºå®šäº†åˆ†åŒºæ•°ï¼ˆ16384ä¸ªï¼‰**ï¼Œä¸ä¼šå˜æ¥å˜å»ã€‚
- æ–°åŠ /ç§»é™¤æœåŠ¡å™¨ï¼Œåªæ˜¯é‡æ–°åˆ†é…"æ§½"çš„å½’å±ï¼Œä¸æ˜¯é‡ç®—æ‰€æœ‰æ•°æ®ã€‚
- ç®¡ç†æ›´ç®€å•ï¼Œè¿ç§»æ•°æ®æ›´å¿«ï¼Œé›†ç¾¤ä¼¸ç¼©æ€§å¥½ã€‚

---

# ğŸ§  å°å¯¹æ¯”æ€»ç»“

| åå­—          | ç™½è¯ç†è§£                         | å…¸å‹åº”ç”¨                   |
|--------------|------------------------------|---------------------------|
| ä¸€è‡´æ€§å“ˆå¸Œ     | æŠŠæœåŠ¡å™¨æ”¾åœ¨åœ†åœˆä¸Šï¼Œé¡ºæ—¶é’ˆæ‰¾æœ€è¿‘çš„æœåŠ¡å™¨ | å¤§å‹å­˜å‚¨ç³»ç»Ÿã€ç¼“å­˜ç³»ç»Ÿï¼Œæ¯”å¦‚ä¸€è‡´æ€§å“ˆå¸Œè´Ÿè½½å‡è¡¡ |
| å“ˆå¸Œæ§½         | å…ˆåˆ’å¥½ä¸€å †å°æ ¼å­ï¼ˆå›ºå®šæ•°é‡ï¼‰ï¼Œæ¯å°æœåŠ¡å™¨è´Ÿè´£ä¸€äº›æ ¼å­ | Redis Cluster |

---

# ğŸ¨ æœ€å½¢è±¡çš„æ¯”å–»

| ä¸€è‡´æ€§å“ˆå¸Œ            | å“ˆå¸Œæ§½             |
|-----------------------|-------------------|
| ä¸€ç¾¤äººåœ¨é’Ÿè¡¨ä¸Šæ’æˆåœˆï¼Œé¡ºæ—¶é’ˆæ‰¾äºº | ä¸€æ ‹å¤§æ¥¼åˆ†æˆ16384ä¸ªå°æˆ¿é—´ï¼Œæ¯ä¸ªäººå®ˆä¸€äº›æˆ¿é—´ |

---

# âš¡æ€»ç»“ä¸€å¥è¯å¤§ç™½è¯ï¼š
âœ… ä¸€è‡´æ€§å“ˆå¸Œ = åœ†åœˆæ‰¾æœ€è¿‘ï¼  
âœ… å“ˆå¸Œæ§½ = å°æ ¼å­åˆ†é…ï¼

















