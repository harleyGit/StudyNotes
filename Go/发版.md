- [**Docker准备**](#Docker准备)
	- [使用DockerCompose管理项目](#使用DockerCompose管理项目)
- [**购买并登录阿里云ECS服务器**](#购买并登录阿里云ECS服务器)
	- [域名绑定ECS公网IP ](#域名绑定ECS公网IP )
- [**部署项目到服务器**](#部署项目到服务器)
- [**运行容器并开放端口**](#运行容器并开放端口)
- [**开放ECS安全组端口**](#开放ECS安全组端口)
- [**使用HTTPS（加密传输）**](#使用HTTPS（加密传输）)
- [**使用Nginx反向代理**](#使用Nginx反向代理)
- [**配置HTTPS免费证书**](#配置HTTPS免费证书)
- [**一键部署HTTPS的Go项目（Ubuntu+Docker+Nginx+Let'sEncrypt）**](#一键部署HTTPS的Go项目（Ubuntu+Docker+Nginx+Let'sEncrypt）)
- [**后续升级**](#后续升级)




<br/><br/><br/>

***
<br/>

> <h1 id="总体流程">总体流程</h1>

- **概览**
	- 1.✅ 准备本地 Go 项目并打包为可执行文件或 Docker 镜像
	- 2.🛒 购买并配置阿里云 ECS 服务器
	- 3.📦 安装 Docker 和相关工具到 ECS
	- 4.🐳 将 Go 项目部署到 ECS 并运行 Docker 容器
	- 5.🌐 开放端口、配置防火墙，外网可访问
	- 6.（可选）绑定域名 + 使用 HTTPS（后续可扩展）


<br/><br/><br/>

***
<br/>

> <h1 id="Docker准备">Docker准备</h1>

**1.本地项目结构示例：**

```
my-go-app/
├── main.go
├── go.mod
├── Dockerfile
```

<br/>

**2.编写 Dockerfile**

在你的项目根目录创建一个 `Dockerfile` 文件，内容如下：

```dockerfile
# 使用官方 Golang 镜像作为构建镜像
FROM golang:1.21 AS builder

WORKDIR /app
COPY . .

# 构建可执行文件
RUN go build -o main .

# 使用轻量级运行镜像
FROM alpine:latest

WORKDIR /app
COPY --from=builder /app/main .

# 开放端口（如你的服务监听 8080）
EXPOSE 8080

CMD ["./main"]
```

<br/>

**3.本地构建镜像（可跳过，直接在服务器上构建也行）**

```bash
docker build -t my-go-app .
```



***
<br/><br/><br/>
> <h2 id="使用DockerCompose管理项目">使用DockerCompose管理项目</h2>

如果你项目越来越复杂（如含数据库、Redis 等），推荐使用 Docker Compose。

**示例文件：`docker-compose.yml`**

```yaml
version: '3'

services:
  goapp:
    build: .
    ports:
      - "8080:8080"
    restart: always
```

然后执行：

```bash
docker compose up -d
```

这样能一键构建、运行项目，便于部署管理。



<br/><br/><br/>

***
<br/>

> <h1 id="购买并登录阿里云ECS服务器">购买并登录阿里云 ECS 服务器</h1>

- **流程：**
	- 1.访问 [阿里云 ECS 控制台](https://ecs.console.aliyun.com/)
	- 2.创建一台 ECS 实例（选择：
		- 操作系统：**Ubuntu 20.04** 或 **CentOS 7**
		- 地区：与你靠近的
		- 公网 IP：一定要有）
	- 3.创建后记录 IP 地址 + 密码/密钥
	- 4.使用 SSH 登录你的服务器：

```bash
ssh root@你的公网IP
```

<br/>

**在 ECS 上安装 Docker**

**Ubuntu 系统：**

```bash
sudo apt update
sudo apt install -y docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

<br/>

**CentOS 系统：**

```bash
yum update -y
yum install -y docker
systemctl start docker
systemctl enable docker
```

<br/>

测试：

```bash
docker --version
```



***
<br/><br/><br/>
> <h2 id="域名绑定ECS公网IP">域名绑定ECS公网IP</h2>

**目标：** 通过访问你的域名（如 `www.example.com`），自动跳转到你部署在 ECS 上的 Go 服务。

<br/>

 **操作步骤：**

- **1.购买或已有域名（阿里云、Namecheap 等）**

如果你已有域名，可跳过此步；没有的话：

* 登录 [阿里云域名注册](https://wanwang.aliyun.com/)
* 注册一个 `.com` 或 `.cn` 域名

<br/>

- **2.域名解析（设置 A 记录）**

在域名管理控制台设置：

* 记录类型：A
* 主机记录：@（或 www）
* 记录值：你的 ECS 公网 IP
* TTL：600 秒（默认）

<br/>

**3.验证解析是否生效**

使用 ping 或 dig 测试：

```bash
ping your-domain.com
# 或 dig your-domain.com
```

若显示你 ECS 的 IP，说明解析成功。




<br/><br/><br/>

***
<br/>

> <h1 id="部署项目到服务器">部署项目到服务器</h1>

**有两个选择：**

**✅方法一：在服务器上拉 Git 代码 + 构建镜像（推荐）**

1. 在 GitHub 上创建仓库，上传你的代码
2. 在 ECS 上：

```bash
apt install git -y      # 或 yum install git -y
git clone https://github.com/你的仓库.git
cd 仓库目录
docker build -t my-go-app .
```

**❌ 方法二：本地构建镜像然后上传（需要 Docker Hub 或 SCP，不推荐新手用）**

<br/><br/><br/>

***
<br/>

> <h1 id="运行容器并开放端口">运行容器并开放端口</h1>


比如你监听的是 `8080` 端口：

```bash
docker run -d -p 80:8080 --name my-go-app my-go-app
```

* `-p 80:8080`：把 ECS 的 80 端口映射到容器的 8080
* `-d`：后台运行


<br/><br/><br/>

***
<br/>

> <h1 id="开放ECS安全组端口">开放 ECS 安全组端口</h1>


阿里云 ECS 默认端口不开放！要做：

1. 打开 ECS 控制台 → 进入实例 → 网络与安全 → 安全组
2. 添加一条 **入方向规则**：

   * 端口范围：80/80
   * 授权对象：0.0.0.0/0
   * 协议类型：TCP

这样就能在浏览器打开：[http://你的公网IP](http://你的公网IP) 访问服务！

<br/> 


**✅ 示例访问测试**

```bash
curl http://your-ecs-ip/
# 或浏览器打开 http://your-ecs-ip
```



<br/><br/><br/>

***
<br/>

> <h1 id="使用HTTPS（加密传输）">使用HTTPS（加密传输）</h1>

**目标：让你的网站支持 `https://` 访问，浏览器显示绿色安全锁，保护用户数据。**

**实现方式：Let's Encrypt 免费证书 + Nginx**


<br/><br/><br/>

***
<br/>

> <h1 id="使用Nginx反向代理">使用Nginx反向代理</h1>

Nginx 接收 80/443 请求 → 转发到 Docker 容器内的 Go 服务，便于管理和部署。

**安装 Nginx（在 ECS 中）**

```bash
# Ubuntu
sudo apt update
sudo apt install nginx -y

# CentOS
sudo yum install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

<br/>

 **配置文件示例（http + 反向代理）**

编辑 `/etc/nginx/sites-enabled/default` 或 `/etc/nginx/nginx.conf`：

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8080;  # Go 项目监听端口
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

<br/>

重启 Nginx：

```bash
sudo nginx -t   # 检查配置语法
sudo systemctl restart nginx
```


<br/>

**Nginx反向代理：**

```
[用户浏览器]
      ↓
  https://your-domain.com
      ↓（80/443）
   [Nginx in ECS]
      ↓（反向代理）
  [Docker 容器：Go Web 服务]
```


<br/><br/><br/>

***
<br/>

> <h1 id="配置HTTPS免费证书">配置HTTPS免费证书（Let’s Encrypt）</h1>

**🧰 使用 Certbot 工具**

**安装 Certbot：**


```bash
# Ubuntu
sudo apt install certbot python3-certbot-nginx -y

# CentOS
sudo yum install certbot python3-certbot-nginx -y
```

<br/>

**获取证书：**

```bash
sudo certbot --nginx
```

按提示输入邮箱、域名，然后自动配置 HTTPS！

<br/>

**自动续期（已默认设置）：**

```bash
sudo certbot renew --dry-run
```

<br/>

**🧪 测试 HTTPS + 域名效果**

打开浏览器访问：

```
https://your-domain.com
```

应看到你的 Go 服务，地址栏有 🔒 安全锁。



<br/><br/><br/>

***
<br/>

> <h1 id="一键部署HTTPS的Go项目（Ubuntu+Docker+Nginx+Let'sEncrypt）">一键部署HTTPS的Go项目（Ubuntu+Docker+Nginx+Let's Encrypt）</h1>



**📦 1.一键安装所需环境（Docker + Nginx + Certbot）**

复制并粘贴以下命令在 Ubuntu 服务器上执行：

```bash
# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装 Docker
sudo apt install -y docker.io docker-compose

# 安装 Nginx
sudo apt install -y nginx

# 安装 Certbot (Let's Encrypt 工具)
sudo apt install -y certbot python3-certbot-nginx
```

<br/>

**🍔升级：脚本一键安装：`scripts/install_env.sh`**

**安装**` Docker、Docker Compose、Nginx、Certbot`

```bash
#!/bin/bash

echo "🚀 开始安装 Docker、Nginx、Certbot..."

# 更新系统
sudo apt update -y && sudo apt upgrade -y

# 安装 Docker & Compose
sudo apt install -y docker.io docker-compose

# 安装 Nginx
sudo apt install -y nginx

# 安装 Certbot（Let's Encrypt）
sudo apt install -y certbot python3-certbot-nginx

# 设置开机自启
sudo systemctl enable docker
sudo systemctl enable nginx

echo "✅ 所有环境安装完成。"
```

<br/><br/> 

**🐳 2.项目目录结构 & 文件模板**

```
my-go-project/
├── main.go
├── Dockerfile
├── docker-compose.yml
└── nginx.conf
```

<br/>

**🍔升级：文件结构（推荐的项目根目录）**

```
my-go-project/
├── main.go
├── Dockerfile
├── docker-compose.yml
├── scripts/
│   ├── install_env.sh
│   ├── deploy.sh
│   └── setup_nginx_https.sh
└── nginx/
    └── yourdomain.com.conf
```


<br/><br/>

**📝 3.Dockerfile（构建 Go 项目）**

**Dockerfile**：

```Dockerfile
FROM golang:1.21 AS builder
WORKDIR /app
COPY . .
RUN go build -o main .

FROM alpine:latest
WORKDIR /app
COPY --from=builder /app/main .
EXPOSE 8080
CMD ["./main"]
```

<br/><br/>

 **🧰 4.docker-compose.yml（一键构建&运行）**

```yaml
version: '3'

services:
  goapp:
    build: .
    container_name: go-web
    restart: always
    ports:
      - "8080:8080"
```

> 👆 容器监听 8080，Nginx 会代理请求到它。

<br/><br/>

**🌐 5.Nginx 配置（反向代理 + HTTPS）**

**Nginx 反向代理配置（将流量从 80 转发到容器）**

> 文件路径：`nginx/yourdomain.com.conf`

```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

<br/>

**创建软连接启用配置：**

```bash
sudo ln -s /etc/nginx/sites-available/yourdomain.com.conf /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

<br/><br/>

**🔐6.使用 Certbot 申请 HTTPS 证书**

运行以下命令一键申请：

```bash
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

按提示输入邮箱、接受协议，Certbot 会自动修改 Nginx 配置并重启。

<br/>

成功后，浏览器访问：

```
https://yourdomain.com
```

🔒 会显示安全锁。


<<br/>

**🍔 `scripts/setup_nginx_https.sh`**

> 🔐 配置 Nginx + HTTPS 证书（Let's Encrypt）

```bash
#!/bin/bash

DOMAIN="yourdomain.com"

echo "🔧 设置 Nginx 配置..."
sudo cp ./nginx/$DOMAIN.conf /etc/nginx/sites-available/$DOMAIN.conf
sudo ln -s /etc/nginx/sites-available/$DOMAIN.conf /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx

echo "📜 申请 HTTPS 证书（Let's Encrypt）..."
sudo certbot --nginx -d $DOMAIN -d www.$DOMAIN

echo "✅ HTTPS 配置完成，浏览器访问 https://$DOMAIN 测试。"
```

> ✅ 替换上面的 `yourdomain.com` 为你的实际域名。


<br/><br/>

**7.启动项目（本地代码推上服务器后）**

```bash
cd /home/ubuntu/my-go-project/
sudo docker-compose build
sudo docker-compose up -d
```

查看运行情况：

```bash
sudo docker ps
```

<br/>

**🍔升级：`scripts/deploy.sh`**

> 🔨 一键构建并运行你的 Go 容器

```bash
#!/bin/bash

echo "🔨 正在构建 Go 项目 Docker 镜像..."
sudo docker-compose build

echo "🚀 正在启动容器..."
sudo docker-compose up -d

echo "✅ 服务启动成功，访问 http://yourdomain.com 或容器端口。"
```


<br/><br/>

**🧼 8. 配置开机自启（Docker 和 Nginx）**

```bash
sudo systemctl enable docker
sudo systemctl enable nginx
```

<br/>

**🍔升级：使用步骤汇总:**

1. 上传整个项目到服务器（`scp` 或 `git clone`）
2. 进入目录并执行以下命令：

```bash
cd my-go-project

# 1. 安装环境
chmod +x scripts/install_env.sh
./scripts/install_env.sh

# 2. 构建并运行项目
chmod +x scripts/deploy.sh
./scripts/deploy.sh

# 3. 配置 Nginx + HTTPS（注意替换域名）
chmod +x scripts/setup_nginx_https.sh
./scripts/setup_nginx_https.sh
```

<br/><br/><br/>

***
<br/>

> <h1 id="后续升级">后续升级</h1>

- **✅ 后续你可能还会用到：**
	- 自动部署（CI/CD）：例如通过 GitHub Actions 或脚本自动更新镜像和重启服务
	
	- 容器日志监控：使用 docker logs -f go-web 实时查看服务日志
	
	- 性能优化：比如设置 Nginx 缓存、配置系统防火墙等
	
	- 服务托管：未来可考虑使用阿里云的容器服务（如 ACK）做集群管理

如果之后你要部署数据库（MySQL、Redis）、构建前后端项目联动、配置 HTTPS 证书自动续期或切换域名，可以继续补充完整流程。

