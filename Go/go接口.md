- [**æ¥å£**](#æ¥å£)
	- [ç©ºæ¥å£`interface{} `](#ç©ºæ¥å£interface{})
	- [æ¥å£çš„å®ç°](#æ¥å£çš„å®ç°)
	- [ä¾¿äºæ‰©å±•çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿ](#ä¾¿äºæ‰©å±•çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿ)
	- [æ¥å£å’Œç±»å‹é—´è½¬æ¢](#æ¥å£å’Œç±»å‹é—´è½¬æ¢)
	- [ç©ºæ¥å£ç±»å‹ï¼ˆinterface{}ï¼‰](#ç©ºæ¥å£ç±»å‹ï¼ˆinterface{}ï¼‰)
	- [ç±»å‹åˆ†æ”¯](#ç±»å‹åˆ†æ”¯)
	- [å®ç°æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰](#å®ç°æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰)



<br/><br/><br/>

***
<br/>

> <h1 id="æ¥å£">æ¥å£</h1>
&emsp; Goè¯­è¨€ä¸æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼ˆè¿™æ˜¯å› ä¸ºåœ¨Goè¯­è¨€ä¸­æ²¡æœ‰ç±»å’Œç»§æ‰¿ï¼‰â€‹ï¼Œä½†æ˜¯å®ƒæä¾›äº†æ¥å£ã€‚ä¸åŒäºé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œ**Goè¯­è¨€æä¾›çš„æ¥å£æ˜¯éšå¼æ¥å£**ã€‚é‚£ä¹ˆï¼Œåº”è¯¥å¦‚ä½•ç†è§£â€œéšå¼æ¥å£â€å‘¢ï¼Ÿåœ¨Goè¯­è¨€ç¨‹åºå¼€å‘ä¸­ï¼Œ**æ— é¡»æ ‡æ˜å…·ä½“å®ç°å“ªäº›æ¥å£ï¼Œåªè¦å®ç°æŸä¸ªæ¥å£ä¸­çš„æ‰€æœ‰å‡½æ•°å°±è¯´æ˜è¿™ä¸ªæ¥å£è¢«å®ç°äº†ã€‚**

> æ¥å£å£°æ˜æ ¼å¼

```go
type æ¥å£ç±»å‹å interface {
	æ–¹æ³•1( å‚æ•°åˆ—è¡¨1 ) è¿”å›å€¼åˆ—è¡¨1
	æ–¹æ³•2( å‚æ•°åˆ—è¡¨2 ) è¿”å›å€¼åˆ—è¡¨2

	 . . . . . 
}

```

â— æ¥å£ç±»å‹åï¼šä½¿ç”¨typeå°†æ¥å£å®šä¹‰ä¸ºè‡ªå®šä¹‰çš„ç±»å‹åã€‚Goè¯­è¨€çš„æ¥å£åœ¨å‘½åæ—¶ï¼Œä¸€èˆ¬ä¼šåœ¨å•è¯åé¢æ·»åŠ erï¼Œå¦‚æœ‰å†™æ“ä½œçš„æ¥å£å«Writerï¼Œæœ‰å­—ç¬¦ä¸²åŠŸèƒ½çš„æ¥å£å«Stringerï¼Œæœ‰å…³é—­åŠŸèƒ½çš„æ¥å£å«Closerç­‰ã€‚

â— æ–¹æ³•åï¼š**å½“æ–¹æ³•åé¦–å­—æ¯æ˜¯å¤§å†™æ—¶ï¼Œä¸”è¿™ä¸ªæ¥å£ç±»å‹åé¦–å­—æ¯ä¹Ÿæ˜¯å¤§å†™æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¢«æ¥å£æ‰€åœ¨çš„åŒ…ï¼ˆpackageï¼‰ä¹‹å¤–çš„ä»£ç è®¿é—®**ã€‚

â— å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼åˆ—è¡¨ï¼šå‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼åˆ—è¡¨ä¸­çš„å‚æ•°å˜é‡åå¯ä»¥è¢«å¿½ç•¥ï¼Œå¦‚ï¼š

```go
type writer interface {
	writer([]byte) (n int, err error)
}

// ä¸Šè¿°ä»£ç è¿˜å¯ä»¥çœç•¥å‚æ•°åˆ—è¡¨å’Œè¿”å›å€¼åˆ—è¡¨ä¸­çš„å‚æ•°å˜é‡å
type writer interface {
	writer([]byte) (int, error)
}
```


<br/><br/><br/>
><h2 id="ç©ºæ¥å£interface{}">ç©ºæ¥å£interface{}</h2>
interface{} æ˜¯ Go ä¸­çš„ä¸€ä¸ªç©ºæ¥å£ç±»å‹ã€‚å®ƒæ˜¯ Go ä¸­æœ€é€šç”¨çš„ç±»å‹ï¼Œå¯ä»¥ä»£è¡¨ä»»ä½•ç±»å‹ã€‚

- **ç‰¹ç‚¹ï¼š**
	- ç©ºæ¥å£ï¼šinterface{} è¢«ç§°ä¸ºç©ºæ¥å£ï¼Œå®ƒä¸åŒ…å«ä»»ä½•æ–¹æ³•ã€‚å› æ­¤ï¼Œä»»ä½•ç±»å‹çš„å€¼éƒ½å¯ä»¥èµ‹ç»™ç©ºæ¥å£ã€‚
	- ä½ å¯ä»¥ä½¿ç”¨ç©ºæ¥å£æ¥è¡¨ç¤ºä¸€ä¸ªæœªçŸ¥ç±»å‹æˆ–æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ã€‚

**ç¤ºä¾‹ï¼š**

```go
var a interface{}  // ç©ºæ¥å£å˜é‡
a = 42             // èµ‹å€¼ä¸ºæ•´æ•°
fmt.Println(a)      // è¾“å‡º: 42

a = "hello"         // èµ‹å€¼ä¸ºå­—ç¬¦ä¸²
fmt.Println(a)      // è¾“å‡º: hello
```
ç©ºæ¥å£çš„ä½œç”¨éå¸¸å¹¿æ³›ï¼Œå°¤å…¶æ˜¯å½“ä½ ä¸çŸ¥é“ç¡®åˆ‡ç±»å‹æ—¶ï¼Œæˆ–è€…éœ€è¦å­˜å‚¨å¤šç§ä¸åŒç±»å‹çš„æ•°æ®æ—¶ã€‚


<br/><br/>
> <h2 id='æ¥å£çš„å®ç°'>æ¥å£çš„å®ç°</h2>
è§„åˆ™1: æ¥å£çš„æ–¹æ³•ä¸å®ç°æ¥å£çš„ç±»å‹æ–¹æ³•æ ¼å¼ä¸€è‡´

&emsp; åœ¨ç±»å‹ä¸­æ·»åŠ ä¸æ¥å£ç­¾åä¸€è‡´çš„æ–¹æ³•å°±å¯ä»¥å®ç°è¯¥æ–¹æ³•ã€‚**ç­¾ååŒ…æ‹¬æ–¹æ³•ä¸­çš„åç§°ã€å‚æ•°åˆ—è¡¨ã€è¿”å›å‚æ•°åˆ—è¡¨**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦å®ç°æ¥å£ç±»å‹ä¸­çš„æ–¹æ³•çš„åç§°ã€å‚æ•°åˆ—è¡¨ã€è¿”å›å‚æ•°åˆ—è¡¨ä¸­çš„ä»»æ„ä¸€é¡¹ä¸æ¥å£è¦å®ç°çš„æ–¹æ³•ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆæ¥å£çš„è¿™ä¸ªæ–¹æ³•å°±ä¸ä¼šè¢«å®ç°ã€‚ 

```go
//å®šä¹‰ä¸€ä¸ªæ•°æ®å†™å…¥å™¨
type DataWriter interface {
	// interface{}ç±»å‹çš„dataï¼Œè¿”å›ä¸€ä¸ªerrorç»“æ„è¡¨ç¤ºå¯èƒ½å‘ç”Ÿçš„é”™è¯¯
	WriteData(data interface{}) error
}

// å®šä¹‰æ–‡ä»¶ç»“æ„ï¼Œç”¨äºå®ç°DataWriter
type file struct{}

// å®ç°DataWriteræ¥å£çš„WriteData()æ–¹æ³•
func (d *file) WriteData(data interface{}) error {
	// æ¨¡æ‹Ÿå†™å…¥æ•°æ®
	fmt.Println("Write Data:", data)
	return nil
}

/** æ¥å£çš„æ–¹æ³•ä¸å®ç°æ¥å£çš„ç±»å‹æ–¹æ³•æ ¼å¼ä¸€è‡´
 * @description:
 */
func testInterface1() {
	// å®ä¾‹åŒ–fileèµ‹å€¼ç»™fï¼Œfçš„ç±»å‹ä¸º*file
	f := new(file)
	// å£°æ˜ä¸€ä¸ªDataWriterçš„æ¥å£
	var writer DataWriter
	// å°†æ¥å£èµ‹å€¼fï¼Œä¹Ÿå°±æ˜¯ï¼Šfileç±»å‹
	writer = f
	// ä½¿ç”¨DataWriteræ¥å£è¿›è¡Œæ•°æ®å†™å…¥
	writer.WriteData("data")
}


testInterface1()
```

æ‰“å°ï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

Write Data: data


<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```


<br/>

> **æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•å‡è¢«å®ç°**


<br/><br/>
> <h2 id='ä¾¿äºæ‰©å±•çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿ'>ä¾¿äºæ‰©å±•çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿ</h2>
**æ—¥å¿—å¯¹å¤–æ¥å£**

```go
type LogWriter interface {
	Write(data interface{}) error
}

// æ—¥å¿—å™¨
type Logger struct {
	// è¿™ä¸ªæ—¥å¿—å™¨ç”¨åˆ°çš„æ—¥å¿—å†™å…¥å™¨
	writerList []LogWriter
}

// æ³¨å†Œä¸€ä¸ªæ—¥å¿—å†™å…¥å™¨
func (l *Logger) RegisterWriter(writer LogWriter) {
	l.writerList = append(l.writerList, writer)
}

// å°†ä¸€ä¸ªdataç±»å‹çš„æ•°æ®å†™å…¥æ—¥å¿—
func (l *Logger) Log(data interface{}) {
	// éå†æ‰€æœ‰æ³¨å†Œçš„å†™å…¥å™¨
	for _, writer := range l.writerList {
		// å°†æ—¥å¿—è¾“å‡ºåˆ°æ¯ä¸€ä¸ªå†™å…¥å™¨ä¸­
		writer.Write(data)
	}
}

// åˆ›å»ºæ—¥å¿—å™¨çš„å®ä¾‹ï¿¼
func NewLogger() *Logger {
	return &Logger{}
}

```


<br/>

> **æ–‡ä»¶å†™å…¥å™¨**

```
/**
 * @description: æ–‡ä»¶å†™å…¥å™¨
 * æ–‡ä»¶å†™å…¥å™¨çš„åŠŸèƒ½æ˜¯æ ¹æ®ä¸€ä¸ªæ–‡ä»¶ååˆ›å»ºæ—¥å¿—æ–‡ä»¶ï¼ˆfile Writerçš„Set Fileæ–¹æ³•ï¼‰ã€‚
 * åœ¨æœ‰æ—¥å¿—å†™å…¥æ—¶ï¼Œå°†æ—¥å¿—å†™å…¥æ–‡ä»¶ä¸­ã€‚
 */
// å£°æ˜æ–‡ä»¶å†™å…¥å™¨ï¼Œåœ¨ç»“æ„ä½“ä¸­ä¿å­˜ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œä»¥æ–¹ä¾¿æ¯æ¬¡å†™å…¥æ—¶æ“ä½œ
type fileWriter struct {
	file *os.File
}

// è®¾ç½®æ–‡ä»¶å†™å…¥å™¨å†™å…¥çš„æ–‡ä»¶å
func (f *fileWriter) SetFile(filename string) (err error) {
	// å¦‚æœæ–‡ä»¶å·²ç»æ‰“å¼€ï¼Œå…³é—­å‰ä¸€ä¸ªæ–‡ä»¶
	// è€ƒè™‘åˆ°SetFile()æ–¹æ³•å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼ˆå‡½æ•°å¯é‡å…¥æ€§ï¼‰
	// å‡è®¾ä¹‹å‰å·²ç»è°ƒç”¨è¿‡Set File()åå†æ¬¡è°ƒç”¨ï¼Œæ­¤æ—¶çš„f.fileä¸ä¸ºç©ºï¼Œå°±éœ€è¦å…³é—­ä¹‹å‰çš„æ–‡ä»¶ï¼Œé‡æ–°åˆ›å»ºæ–°çš„æ–‡ä»¶ã€‚
	if f.file != nil {
		f.file.Close()
	}
	// åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¿å­˜æ–‡ä»¶å¥æŸ„
	f.file, err = os.Create(filename)
	// å¦‚æœåˆ›å»ºçš„è¿‡ç¨‹å‡ºç°é”™è¯¯ï¼Œåˆ™è¿”å›é”™è¯¯
	return err
}

// å®ç°LogWriterçš„Write()æ–¹æ³•
func (f *fileWriter) Write(data interface{}) error {
	// å¦‚æœæ–‡ä»¶æ²¡æœ‰å‡†å¤‡å¥½ï¼Œæ–‡ä»¶å¥æŸ„ä¸ºnil
	// æ­¤æ—¶ä½¿ç”¨errorsåŒ…çš„New()å‡½æ•°è¿”å›ä¸€ä¸ªé”™è¯¯å¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²â€œfile not createdâ€
	if f.file == nil {
		// æ—¥å¿—æ–‡ä»¶æ²¡æœ‰å‡†å¤‡å¥½
		return errors.New("file not created")
	}
	// å°†æ•°æ®åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
	// ä½¿ç”¨fmt.Sprintfå°†dataè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™é‡Œä½¿ç”¨çš„æ ¼å¼åŒ–å‚æ•°æ˜¯â€œ%vâ€ï¼Œæ„æ€æ˜¯å°†dataæŒ‰å…¶æœ¬æ¥çš„å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²
	str := fmt.Sprintf("%v\n", data)
	// é€šè¿‡f.fileçš„Write()æ–¹æ³•ï¼Œå°†strå­—ç¬¦ä¸²è½¬æ¢ä¸º[]byteå­—èŠ‚æ•°ç»„ï¼Œå†å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›
	_, err := f.file.Write([]byte(str))
	return err
}

// åˆ›å»ºæ–‡ä»¶å†™å…¥å™¨å®ä¾‹
func newFileWriter() *fileWriter {
	return &fileWriter{}
}

```


&emsp; åœ¨æ“ä½œæ–‡ä»¶æ—¶ï¼Œä¼šå‡ºç°æ–‡ä»¶æ— æ³•åˆ›å»ºã€æ— æ³•å†™å…¥ç­‰é”™è¯¯ã€‚å¼€å‘ä¸­å°½é‡ä¸è¦å¿½ç•¥è¿™äº›åº•å±‚æŠ¥å‡ºçš„é”™è¯¯ï¼Œåº”è¯¥å¤„ç†å¯èƒ½å‘ç”Ÿçš„æ‰€æœ‰é”™è¯¯ã€‚

&emsp; æ–‡ä»¶ä½¿ç”¨å®Œåï¼Œè¦æ³¨æ„ä½¿ç”¨os.Fileçš„Close()æ–¹æ³•è¿›è¡ŒåŠæ—¶å…³é—­ï¼Œå¦åˆ™æ–‡ä»¶å†æ¬¡è®¿é—®æ—¶ä¼šå› ä¸ºå…¶å±æ€§å‡ºç°æ— æ³•è¯»å–ã€æ— æ³•å†™å…¥ç­‰é”™è¯¯ã€‚

&emsp; æç¤ºï¼šä¸€ä¸ªå®Œå¤‡çš„æ–‡ä»¶å†™å…¥å™¨ä¼šæä¾›å¤šç§å†™å…¥æ–‡ä»¶çš„æ¨¡å¼ï¼Œä¾‹å­ä¸­ä½¿ç”¨çš„æ¨¡å¼æ˜¯å°†æ—¥å¿—æ·»åŠ åˆ°æ—¥å¿—æ–‡ä»¶çš„å°¾éƒ¨ã€‚éšç€æ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œæ–‡ä»¶çš„è®¿é—®æ•ˆç‡å’ŒæŸ¥çœ‹ä¾¿åˆ©æ€§ä¹Ÿä¼šå¤§å¤§é™ä½ã€‚æ­¤æ—¶ï¼Œå°±éœ€è¦å¦å¤–ä¸€ç§å†™å…¥æ¨¡å¼ï¼šæ»šåŠ¨å†™å…¥æ–‡ä»¶ã€‚

- æ»šåŠ¨å†™å…¥æ–‡ä»¶æ¨¡å¼ä¹Ÿæ˜¯å°†æ—¥å¿—æ·»åŠ åˆ°æ–‡ä»¶çš„å°¾éƒ¨ï¼Œä½†å½“æ–‡ä»¶è¾¾åˆ°è®¾å®šçš„æœŸæœ›å¤§å°æ—¶ï¼Œä¼šè‡ªåŠ¨å¼€å¯ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç»§ç»­å†™å…¥æ–‡ä»¶ï¼Œæœ€ç»ˆå°†è·å¾—å¤šä¸ªæ—¥å¿—æ–‡ä»¶ã€‚

- æ—¥å¿—æ–‡ä»¶åä¸ä»…å¯ä»¥æŒ‰ç…§æ–‡ä»¶å¤§å°è¿›è¡Œåˆ†å‰²ï¼Œè¿˜å¯ä»¥æŒ‰ç…§æ—¥æœŸèŒƒå›´è¿›è¡Œåˆ†å‰²ã€‚åœ¨åˆ°è¾¾è®¾å®šçš„æ—¥æœŸèŒƒå›´ï¼Œå¦‚æ¯å¤©ã€æ¯å°æ—¶çš„å‘¨æœŸèŒƒå›´æ—¶ï¼Œæ—¥å¿—å™¨ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚è¿™ç§æ—¥å¿—æ–‡ä»¶åˆ›å»ºæ–¹æ³•ä¹Ÿèƒ½æ–¹ä¾¿å¼€å‘è€…æŒ‰æ—¥å¿—æŸ¥çœ‹æ—¥å¿—ã€‚



> å‘½ä»¤è¡Œå†™å…¥å™¨

&emsp; åœ¨UNIXçš„æ€æƒ³ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ã€‚æ–‡ä»¶åŒ…æ‹¬å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œå’Œå‘½ä»¤è¡Œç­‰ã€‚è¿™ç§æŠ½è±¡æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬è®¿é—®è¿™äº›çœ‹ä¸è§æ‘¸ä¸ç€çš„è™šæ‹Ÿèµ„æº:
- å‘½ä»¤è¡Œåœ¨Goä¸­ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶;
- os.Stdoutå¯¹åº”æ ‡å‡†è¾“å‡ºï¼Œä¸€èˆ¬è¡¨ç¤ºå±å¹•ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤è¡Œï¼Œä¹Ÿå¯ä»¥è¢«é‡å®šå‘ä¸ºæ‰“å°æœºæˆ–è€…ç£ç›˜æ–‡ä»¶ï¼›
- os.Stderrå¯¹åº”æ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œä¸€èˆ¬å°†é”™è¯¯è¾“å‡ºåˆ°æ—¥å¿—ä¸­ï¼Œä¸è¿‡å¤§å¤šæ•°æƒ…å†µï¼Œos.Stdoutä¼šä¸os.Stderråˆå¹¶è¾“å‡ºï¼›
- os.Stdinå¯¹åº”æ ‡å‡†è¾“å…¥ï¼Œä¸€èˆ¬è¡¨ç¤ºé”®ç›˜ã€‚
- os.Stdoutã€os.Stderrã€os.Stdinéƒ½æ˜¯*os.Fileç±»å‹ï¼Œå’Œæ–‡ä»¶ä¸€æ ·å®ç°äº†io.Writeræ¥å£çš„Write()æ–¹æ³•ã€‚


```
// å‘½ä»¤è¡Œå†™å…¥å™¨
type consoleWriter struct{}

// å®ç°LogWriterçš„Write()æ–¹æ³•
func (f *consoleWriter) Write(data interface{}) error {
	// å°†æ•°æ®åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²
	str := fmt.Sprintf("%v\n", data)
	// å°†æ•°æ®ä»¥å­—èŠ‚æ•°ç»„å†™å…¥å‘½ä»¤è¡Œä¸­
	_, err := os.Stdout.Write([]byte(str))
	return err
}

// åˆ›å»ºå‘½ä»¤è¡Œå†™å…¥å™¨å®ä¾‹
func newConsoleWriter() *consoleWriter {
	return &consoleWriter{}
}
```

&emsp; é™¤äº†å‘½ä»¤è¡Œå†™å…¥å™¨ï¼ˆconsole Writerï¼‰å’Œæ–‡ä»¶å†™å…¥å™¨ï¼ˆfile Writerï¼‰ï¼Œè¯»è€…è¿˜å¯ä»¥è‡ªè¡Œä½¿ç”¨netåŒ…ä¸­çš„Socketå°è£…å®ç°ç½‘ç»œå†™å…¥å™¨socket Writerï¼Œè®©æ—¥å¿—å¯ä»¥å†™å…¥è¿œç¨‹çš„æœåŠ¡å™¨ä¸­æˆ–è€…å¯ä»¥è·¨è¿›ç¨‹è¿›è¡Œæ—¥å¿—ä¿å­˜å’Œåˆ†æã€‚


<br/>

> ä½¿ç”¨æ—¥å¿—

```go
// åˆ›å»ºæ—¥å¿—å™¨
func testInterface2() {
	// åˆ›å»ºæ—¥å¿—å™¨
	l := NewLogger()
	// åˆ›å»ºå‘½ä»¤è¡Œå†™å…¥å™¨
	cw := newConsoleWriter()
	// æ³¨å†Œå‘½ä»¤è¡Œå†™å…¥å™¨åˆ°æ—¥å¿—å™¨ä¸­
	l.RegisterWriter(cw)
	// åˆ›å»ºæ–‡ä»¶å†™å…¥å™¨
	fw := newFileWriter()
	// è®¾ç½®æ–‡ä»¶å
	if err := fw.SetFile("log.log"); err != nil {
		fmt.Println(err)
	}
	// æ³¨å†Œæ–‡ä»¶å†™å…¥å™¨åˆ°æ—¥å¿—å™¨ä¸­
	l.RegisterWriter(fw)

	// å†™ä¸€ä¸ªæ—¥å¿—
	l.Log("hello")
}
```

æ‰“å°ï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

hello


<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```

&emsp; åŒæ—¶è¿˜æœ‰ä¸€ä¸ªlog.logæ–‡ä»¶ç”Ÿæˆï¼Œåœ¨`l.RegisterWriter(cw)`ä¸­ï¼Œå…¶æ„æ€æ˜¯ï¼šä½¿ç”¨æ—¥å¿—å™¨æ–¹æ³•RegisterWriter()å°†ä¸€ä¸ªæ—¥å¿—å†™å…¥å™¨ï¼ˆLogWriterï¼‰æ³¨å†Œåˆ°æ—¥å¿—å™¨ï¼ˆLoggerï¼‰ä¸­ã€‚æ³¨å†Œçš„æ„æ€å°±æ˜¯å°†æ—¥å¿—å†™å…¥å™¨çš„æ¥å£æ·»åŠ åˆ°write Listä¸­

<br/><br/>

> <h2 id='æ¥å£å’Œç±»å‹é—´è½¬æ¢'>æ¥å£å’Œç±»å‹é—´è½¬æ¢</h2>

> ç±»å‹æ–­è¨€çš„æ ¼å¼

```go
t, ok := i.(T)
```

&emsp; å¦‚æœå‘ç”Ÿæ¥å£æœªå®ç°æ—¶ï¼Œå°†ä¼šæŠŠokç½®ä¸ºfalseï¼Œtç½®ä¸ºTç±»å‹çš„0å€¼ã€‚æ­£å¸¸å®ç°æ—¶ï¼Œokä¸ºtrueã€‚è¿™é‡Œokå¯ä»¥è¢«è®¤ä¸ºæ˜¯ï¼šiæ¥å£æ˜¯å¦å®ç°Tç±»å‹çš„ç»“æœ

<br/>

> **å°†æ¥å£è½¬æ¢ä¸ºå…¶ä»–æ¥å£**

å®ç°æŸä¸ªæ¥å£çš„ç±»å‹åŒæ—¶å®ç°äº†å¦å¤–ä¸€ä¸ªæ¥å£ï¼Œæ­¤æ—¶å¯ä»¥åœ¨ä¸¤ä¸ªæ¥å£é—´è½¬æ¢ã€‚

**`interface{}ç±»å‹è¡¨ç¤ºç©ºæ¥å£ï¼Œæ„æ€å°±æ˜¯è¿™ç§æ¥å£å¯ä»¥ä¿å­˜ä¸ºä»»æ„ç±»å‹ã€‚`**


```go
// å®šä¹‰é£è¡ŒåŠ¨ç‰©æ¥å£
type Flyer interface {
	Fly()
}

// å®šä¹‰è¡Œèµ°åŠ¨ç‰©æ¥å£
type Walker interface {
	Walk()
}

// å®šä¹‰é¸Ÿç±»
type bird struct{}

// å®ç°é£è¡ŒåŠ¨ç‰©æ¥å£
func (b *bird) Fly() {
	fmt.Println("bird: fly")
}

// ä¸ºé¸Ÿæ·»åŠ Walk()æ–¹æ³•ï¼Œå®ç°è¡Œèµ°åŠ¨ç‰©æ¥å£
func (b *bird) Walk() {
	fmt.Println("bird: walk")
}

// å®šä¹‰çŒª
type pig struct{}

// ä¸ºçŒªæ·»åŠ Walk()æ–¹æ³•ï¼Œå®ç°è¡Œèµ°åŠ¨ç‰©æ¥å£
func (p *pig) Walk() {
	fmt.Println("pig: walk")
}
func testInterface3() {
	// åˆ›å»ºåŠ¨ç‰©çš„åå­—åˆ°å®ä¾‹çš„æ˜ å°„
	animals := map[string]interface{}{
		"bird": new(bird),
		"pig":  new(pig),
	}
	// éå†æ˜ å°„
	for name, obj := range animals {
		// ä½¿ç”¨ç±»å‹æ–­è¨€è·å¾—fï¼Œç±»å‹ä¸ºFlyeråŠis Flyerçš„æ–­è¨€æˆåŠŸçš„åˆ¤å®š
		f, isFlyer := obj.(Flyer)
		// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºè¡Œèµ°åŠ¨ç‰©
		w, isWalker := obj.(Walker)
		fmt.Printf("name: %s is Flyer: %v is Walker: %v\n", name, isFlyer, isWalker)
		// å¦‚æœæ˜¯é£è¡ŒåŠ¨ç‰©åˆ™è°ƒç”¨é£è¡ŒåŠ¨ç‰©æ¥å£
		if isFlyer {
			f.Fly()
		}
		// å¦‚æœæ˜¯è¡Œèµ°åŠ¨ç‰©åˆ™è°ƒç”¨è¡Œèµ°åŠ¨ç‰©æ¥å£
		if isWalker {
			w.Walk()
		}
	}
}
```

æ‰“å°ï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

name: bird is Flyer: true is Walker: true
bird: fly
bird: walk
name: pig is Flyer: false is Walker: true
pig: walk

<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```



<br/>

> å°†æ¥å£è½¬æ¢ä¸ºå…¶ä»–ç±»å‹

```
func testInterface4() {
	p1 := new(pig)

	// ç”±äºpigå®ç°äº†Walkeræ¥å£ï¼Œå› æ­¤å¯ä»¥è¢«éšå¼è½¬æ¢ä¸ºWalkeræ¥å£ç±»å‹ä¿å­˜äºaä¸­
	var a Walker = p1
	// ç”±äºaä¸­ä¿å­˜çš„æœ¬æ¥å°±æ˜¯*pigæœ¬ä½“ï¼Œå› æ­¤å¯ä»¥è½¬æ¢ä¸º*pigç±»å‹
	p2 := a.(*pig)

	fmt.Printf("p1=%p p2=%p", p1, p2)
}
```


æ‰“å°ï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

p1=0x100602af8 p2=0x100602af8

<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```

&emsp; æ¥å£æ–­è¨€ç±»ä¼¼äºæµç¨‹æ§åˆ¶ä¸­çš„ifã€‚ä½†å¤§é‡ç±»å‹æ–­è¨€å‡ºç°æ—¶ï¼Œåº”ä½¿ç”¨æ›´ä¸ºé«˜æ•ˆçš„ç±»å‹åˆ†æ”¯switchç‰¹æ€§ã€‚


<br/><br/>

> <h2 id='ç©ºæ¥å£ç±»å‹ï¼ˆinterface{}ï¼‰'>ç©ºæ¥å£ç±»å‹ï¼ˆinterface{}ï¼‰</h2>

&emspï¼› interface{} æ˜¯ä¸€ä¸ªç©ºçš„ interface ç±»å‹ï¼Œæ ¹æ®å‰æ–‡çš„å®šä¹‰ï¼šä¸€ä¸ªç±»å‹å¦‚æœå®ç°äº†ä¸€ä¸ª interface çš„æ‰€æœ‰æ–¹æ³•å°±è¯´è¯¥ç±»å‹å®ç°äº†è¿™ä¸ª interfaceï¼Œç©ºçš„ interface æ²¡æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥è®¤ä¸ºæ‰€æœ‰çš„ç±»å‹éƒ½å®ç°äº† interface{}ã€‚å¦‚æœå®šä¹‰ä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯ interface{} ç±»å‹ï¼Œè¿™ä¸ªå‡½æ•°åº”è¯¥å¯ä»¥æ¥å—ä»»ä½•ç±»å‹ä½œä¸ºå®ƒçš„å‚æ•°ã€‚

```dart
func doAnything(i interface{}){
    
}
```

&emspï¼› æç¤ºï¼šç©ºæ¥å£ç±»å‹ç±»ä¼¼äºC#æˆ–Javaè¯­è¨€ä¸­çš„Objectã€Cè¯­è¨€ä¸­çš„void*ã€C++ä¸­çš„std::anyã€‚

- åœ¨æ³›å‹å’Œæ¨¡æ¿å‡ºç°å‰ï¼Œç©ºæ¥å£æ˜¯ä¸€ç§éå¸¸çµæ´»çš„æ•°æ®æŠ½è±¡ä¿å­˜å’Œä½¿ç”¨çš„æ–¹æ³•ã€‚
- ç©ºæ¥å£çš„å†…éƒ¨å®ç°ä¿å­˜äº†å¯¹è±¡çš„ç±»å‹å’ŒæŒ‡é’ˆã€‚ä½¿ç”¨ç©ºæ¥å£ä¿å­˜ä¸€ä¸ªæ•°æ®çš„è¿‡ç¨‹ä¼šæ¯”ç›´æ¥ç”¨æ•°æ®å¯¹åº”ç±»å‹çš„å˜é‡ä¿å­˜ç¨æ…¢ã€‚å› æ­¤åœ¨å¼€å‘ä¸­ï¼Œåº”åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨ç©ºæ¥å£ï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ç©ºæ¥å£ã€‚

<br/>

ç©ºæ¥å£èµ‹å€¼å¦‚ä¸‹ï¼š

```
// å£°æ˜anyä¸ºinterface{}ç±»å‹çš„å˜é‡
var any interface{}

any = 1
// æ‰“å°anyçš„å€¼ï¼Œæä¾›ç»™fmt.Printlnçš„ç±»å‹ä¾ç„¶æ˜¯interface{}
fmt.Println(any)

any = "hello"
fmt.Println(any)
```

è¾“å‡ºï¼š

```
1
hello
```



<br/>

> ç©ºæ¥å£è·å–å€¼

ä¿å­˜åˆ°ç©ºæ¥å£çš„å€¼ï¼Œå¦‚æœç›´æ¥å–å‡ºæŒ‡å®šç±»å‹çš„å€¼æ—¶ï¼Œä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
// å£°æ˜aå˜é‡ï¼Œç±»å‹intï¼Œåˆå§‹å€¼ä¸º1â€¨var a int = 1â€¨
// å£°æ˜iå˜é‡ï¼Œç±»å‹ä¸ºinterface{}ï¼Œåˆå§‹å€¼ä¸ºaï¼Œæ­¤æ—¶içš„å€¼å˜ä¸º1â€¨var i interface{} = aâ€¨
// å£°æ˜bå˜é‡ï¼Œå°è¯•èµ‹å€¼iâ€¨var b int = i

```

ç¼–è¯‘æŠ¥é”™ï¼š

```
cannot use i (type interface {}) as type int in assignment: need type assertion
```

ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸èƒ½å°†iå˜é‡è§†ä¸ºintç±»å‹èµ‹å€¼ç»™bã€‚

&emsp; å°†açš„å€¼èµ‹å€¼ç»™iæ—¶ï¼Œè™½ç„¶iåœ¨èµ‹å€¼å®Œæˆåçš„å†…éƒ¨å€¼ä¸ºintï¼Œä½†iè¿˜æ˜¯ä¸€ä¸ªinterface{}ç±»å‹çš„å˜é‡ã€‚ç±»ä¼¼äºæ— è®ºé›†è£…ç®±è£…çš„æ˜¯èŒ¶å¶è¿˜æ˜¯çƒŸè‰ï¼Œé›†è£…ç®±ä¾ç„¶æ˜¯é‡‘å±åšçš„ï¼Œä¸ä¼šå› ä¸ºæ‰€è£…ç‰©çš„ç±»å‹æ”¹å˜è€Œæ”¹å˜ã€‚


ç¼–è¯‘å™¨æç¤ºæˆ‘ä»¬å¾—ä½¿ç”¨`type assertion`ï¼Œæ„æ€å°±æ˜¯ç±»å‹æ–­è¨€ã€‚
ä½¿ç”¨ç±»å‹æ–­è¨€ä¿®æ”¹å¦‚ä¸‹ï¼š

```goâ€¨var b int = i.(int)
```


<br/><br/>
> <h2 id='ç±»å‹åˆ†æ”¯'>ç±»å‹åˆ†æ”¯</h2>


> **ç±»å‹æ–­è¨€çš„ä¹¦å†™æ ¼å¼**

```go
switch æ¥å£å˜é‡.(type) {
	
		caseç±»å‹1:
			
			// å˜é‡æ˜¯ç±»å‹1æ—¶çš„å¤„ç†
			
		caseç±»å‹2:
			
			// å˜é‡æ˜¯ç±»å‹2æ—¶çš„å¤„ç†
			
			â€¦
		default:
			// å˜é‡ä¸æ˜¯æ‰€æœ‰caseä¸­åˆ—ä¸¾çš„ç±»å‹æ—¶çš„å¤„ç†
	}
```

â— æ¥å£å˜é‡ï¼šè¡¨ç¤ºéœ€è¦åˆ¤æ–­çš„æ¥å£ç±»å‹çš„å˜é‡ã€‚

â— ç±»å‹1ã€ç±»å‹2â€¦â€¦ï¼šè¡¨ç¤ºæ¥å£å˜é‡å¯èƒ½å…·æœ‰çš„ç±»å‹åˆ—è¡¨ï¼Œæ»¡è¶³æ—¶ï¼Œä¼šæŒ‡å®šcaseå¯¹åº”çš„åˆ†æ”¯è¿›è¡Œå¤„ç†ã€‚

<br/>

```
func printType(v interface{}) {
	switch v.(type) {
	case int:
		fmt.Println(v, "is int")
	case string:
		fmt.Println(v, "is string")
	case bool:
		fmt.Println(v, "is bool")
	}
}
func testInterface5() {
	printType(1024)
	printType("pig")
	printType(true)
}


testInterface5()
```

è¾“å‡ºï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

1024 is int
pig is string
true is bool


<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```


v.(type)å°±æ˜¯ç±»å‹åˆ†æ”¯çš„å…¸å‹å†™æ³•ã€‚

é€šè¿‡è¿™ä¸ªå†™æ³•ï¼Œåœ¨switchçš„æ¯ä¸ªcaseä¸­å†™çš„å°†æ˜¯å„ç§ç±»å‹åˆ†æ”¯ã€‚ä»£ç ç»è¿‡switchæ—¶ï¼Œä¼šåˆ¤æ–­vè¿™ä¸ªinterface{}çš„å…·ä½“ç±»å‹ä»è€Œè¿›è¡Œç±»å‹åˆ†æ”¯è·³è½¬ã€‚

switchçš„defaultä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼ŒåŠŸèƒ½å’Œå…¶ä»–çš„switchä¸€è‡´

<br/>
<br/>

> <h2 id='å®ç°æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰'>å®ç°æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰</h2>

&emsp; æœ‰é™çŠ¶æ€æœºï¼ˆFinite-State Machineï¼ŒFSMï¼‰ï¼Œè¡¨ç¤ºæœ‰é™ä¸ªçŠ¶æ€åŠåœ¨è¿™äº›çŠ¶æ€é—´çš„è½¬ç§»å’ŒåŠ¨ä½œç­‰è¡Œä¸ºçš„æ•°å­¦æ¨¡å‹ã€‚

**çŠ¶æ€çš„æ¦‚å¿µ**
- çŠ¶æ€æœºä¸­çš„çŠ¶æ€ä¸çŠ¶æ€é—´èƒ½å¤Ÿè‡ªç”±è½¬æ¢ã€‚ä½†æ˜¯ç°å®å½“ä¸­çš„çŠ¶æ€å´ä¸ä¸€å®šèƒ½å¤Ÿè‡ªç”±è½¬æ¢ï¼Œä¾‹å¦‚ï¼šäººå¯ä»¥ä»ç«™ç«‹çŠ¶æ€è½¬ç§»åˆ°å§å€’çŠ¶æ€ï¼Œå´ä¸èƒ½ä»å§å€’çŠ¶æ€ç›´æ¥è½¬ç§»åˆ°è·‘æ­¥çŠ¶æ€ï¼Œéœ€è¦å…ˆç»è¿‡ç«™ç«‹çŠ¶æ€åå†è½¬ç§»åˆ°è·‘æ­¥çŠ¶æ€ã€‚
- æ¯ä¸ªçŠ¶æ€å¯ä»¥è®¾ç½®å®ƒå¯ä»¥è½¬ç§»åˆ°çš„çŠ¶æ€ã€‚ä¸€äº›çŠ¶æ€æœºè¿˜å…è®¸åœ¨åŒä¸€ä¸ªçŠ¶æ€é—´äº’ç›¸è½¬æ¢ï¼Œè¿™ä¹Ÿéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé…ç½®ã€‚


<br/>

**è‡ªå®šä¹‰çŠ¶æ€éœ€è¦å®ç°çš„æ¥å£**

&emsp; æœ‰é™çŠ¶æ€æœºç³»ç»Ÿéœ€è¦åˆ¶å®šä¸€ä¸ªçŠ¶æ€éœ€å…·å¤‡çš„å±æ€§å’ŒåŠŸèƒ½ï¼Œç”±äºçŠ¶æ€éœ€è¦ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¸ºäº†ç»Ÿä¸€ç®¡ç†çŠ¶æ€ï¼Œå°±éœ€è¦ä½¿ç”¨æ¥å£å®šä¹‰çŠ¶æ€ã€‚çŠ¶æ€æœºä»çŠ¶æ€æ¥å£æŸ¥è¯¢åˆ°ç”¨æˆ·çš„è‡ªå®šä¹‰çŠ¶æ€åº”è¯¥å…·å¤‡çš„å±æ€§æœ‰ï¼š

â— åç§°ï¼Œå¯¹åº”Stateæ¥å£çš„Name()æ–¹æ³•ã€‚

â— çŠ¶æ€æ˜¯å¦å…è®¸åœ¨åŒçŠ¶æ€é—´è½¬ç§»ï¼Œå¯¹åº”Stateæ¥å£çš„Enable Same Transit()æ–¹æ³•ã€‚

â— èƒ½å¦ä»å½“å‰çŠ¶æ€è½¬ç§»åˆ°æŒ‡å®šçš„æŸä¸€ä¸ªçŠ¶æ€ï¼Œå¯¹åº”Stateæ¥å£çš„Can Transit To()æ–¹æ³•ã€‚


&emsp; é™¤æ­¤ä¹‹å¤–ï¼ŒçŠ¶æ€åœ¨è½¬ç§»æ—¶ä¼šå‘ç”Ÿçš„äº‹ä»¶å¯ä»¥ç”±çŠ¶æ€æœºé€šè¿‡çŠ¶æ€æ¥å£çš„æ–¹æ³•é€šçŸ¥ç”¨æˆ·è‡ªå·±çš„çŠ¶æ€ï¼Œå¯¹åº”çš„æ˜¯ä¸¤ä¸ªæ–¹æ³•OnBegin()å’ŒOnEnd()ï¼Œåˆ†åˆ«ä»£è¡¨çŠ¶æ€è½¬ç§»å‰å’ŒçŠ¶æ€è½¬ç§»åã€‚


<br/>

> **çŠ¶æ€æ¥å£**

```
// æ­¤æ¥å£ç”¨äºçŠ¶æ€ç®¡ç†å™¨å†…éƒ¨ä¿å­˜å’Œå¤–éƒ¨å®ç°
type State interface {
	// è·å–çŠ¶æ€åå­—
	Name() string
	// è¯¥çŠ¶æ€æ˜¯å¦å…è®¸åŒçŠ¶æ€è½¬ç§»
	EnableSameTransit() bool
	
	/*
	* éœ€è¦å®ç°çŠ¶æ€çš„äº‹ä»¶ï¼Œåˆ†åˆ«æ˜¯â€œçŠ¶æ€å¼€å§‹â€å’Œâ€œçŠ¶æ€ç»“æŸâ€ã€‚
	* å½“ä¸€ä¸ªçŠ¶æ€è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œå½“å‰çŠ¶æ€çš„OnEnd()æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè€Œç›®æ ‡çŠ¶æ€çš„OnBegin()æ–¹æ³•ä¹Ÿå°†è¢«è°ƒç”¨ã€‚
	*/
	// å“åº”çŠ¶æ€å¼€å§‹æ—¶
	OnBegin()
	// å“åº”çŠ¶æ€ç»“æŸæ—¶
	OnEnd()
	// åˆ¤æ–­èƒ½å¦è½¬ç§»åˆ°æŸä¸ªçŠ¶æ€
	CanTransitTo(name string) bool
}

// ä»çŠ¶æ€å®ä¾‹è·å–çŠ¶æ€å
func StateName(s State) string {
	if s == nil {
		return "none"
	}
	// ä½¿ç”¨åå°„è·å–çŠ¶æ€çš„åç§°
	return reflect.TypeOf(s).Elem().Name()
}
```



<br/>

> **çŠ¶æ€åŸºæœ¬ä¿¡æ¯**

&emsp; Stateæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œåœ¨ç”¨æˆ·è‡ªå®šä¹‰æ—¶éƒ½æ˜¯é‡å¤çš„ï¼Œä¸ºäº†é¿å…é‡å¤åœ°ç¼–å†™å¾ˆå¤šä»£ç ï¼Œä½¿ç”¨State Infoæ¥ååŠ©ç”¨æˆ·å®ç°ä¸€äº›é»˜è®¤çš„å®ç°ã€‚


&emsp; StateInfoåŒ…å«æœ‰åç§°ï¼Œåœ¨çŠ¶æ€åˆå§‹åŒ–æ—¶è¢«èµ‹å€¼ã€‚StateInfoåŒæ—¶å®ç°äº†OnBegin()ã€OnEnd()æ–¹æ³•ã€‚æ­¤å¤–ï¼ŒStateInfoçš„EnableSameTransit()æ–¹æ³•è¿˜èƒ½åˆ¤æ–­æ˜¯å¦å…è®¸çŠ¶æ€åœ¨åŒç±»çŠ¶æ€ä¸­è½¬ç§»ï¼ŒCanTransi To()æ–¹æ³•èƒ½åˆ¤æ–­æ˜¯å¦èƒ½è½¬ç§»åˆ°æŸä¸ªç›®æ ‡çŠ¶æ€

```
/**
 * @description: çŠ¶æ€åŸºæœ¬ä¿¡æ¯
 */
// çŠ¶æ€çš„åŸºç¡€ä¿¡æ¯å’Œé»˜è®¤å®ç°
type StateInfo struct {
	// çŠ¶æ€å
	name string
}

// çŠ¶æ€å
func (s *StateInfo) Name() string {
	return s.name
}

// æä¾›ç»™å†…éƒ¨è®¾ç½®åå­—
// setName()æ–¹æ³•çš„é¦–å­—æ¯å°å†™ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨åŒåŒ…å†…è¢«è°ƒç”¨ã€‚
// è¿™é‡Œæˆ‘ä»¬å¸Œæœ›setName()ä¸èƒ½è¢«ä½¿ç”¨è€…åœ¨çŠ¶æ€åˆå§‹åŒ–åéšæ„ä¿®æ”¹åç§°ï¼Œè€Œæ˜¯é€šè¿‡åé¢æåˆ°çš„çŠ¶æ€ç®¡ç†å™¨è‡ªåŠ¨èµ‹å€¼
func (s *StateInfo) setName(name string) {
	s.name = name
}

// å…è®¸åŒçŠ¶æ€è½¬ç§»
func (s *StateInfo) EnableSameTransit() bool {
	return false
}

// é»˜è®¤å°†çŠ¶æ€å¼€å¯æ—¶å®ç°
func (s *StateInfo) OnBegin() {

}

// é»˜è®¤å°†çŠ¶æ€ç»“æŸæ—¶å®ç°
func (s *StateInfo) OnEnd() {}

// é»˜è®¤å¯ä»¥è½¬ç§»åˆ°ä»»ä½•çŠ¶æ€
func (s *StateInfo) CanTransitTo(name string) bool {
	return true
}
```


<br/>

> **çŠ¶æ€ç®¡ç†**

&emsp; çŠ¶æ€ç®¡ç†å™¨ç®¡ç†å’Œç»´æŠ¤çŠ¶æ€çš„ç”Ÿå‘½æœŸã€‚ç”¨æˆ·æ ¹æ®éœ€è¦ï¼Œå°†éœ€è¦è¿›è¡ŒçŠ¶æ€è½¬ç§»å’Œæ§åˆ¶çš„çŠ¶æ€å®ç°åæ·»åŠ ï¼ˆStateManagerçš„Add()æ–¹æ³•ï¼‰åˆ°çŠ¶æ€ç®¡ç†å™¨é‡Œï¼ŒçŠ¶æ€ç®¡ç†å™¨ä½¿ç”¨åç§°å¯¹è¿™äº›çŠ¶æ€è¿›è¡Œç»´æŠ¤ï¼ŒåŒä¸€ä¸ªçŠ¶æ€åªå…è®¸ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚çŠ¶æ€ç®¡ç†å™¨å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°ï¼ˆStateManagerçš„OnChangeæˆå‘˜ï¼‰æä¾›çŠ¶æ€è½¬ç§»çš„é€šçŸ¥ã€‚

```
/**
 * @description: çŠ¶æ€ç®¡ç†å™¨
 */

type StateManager struct {
	// å·²ç»æ·»åŠ çš„çŠ¶æ€
	// å£°æ˜ä¸€ä¸ªä»¥çŠ¶æ€åä¸ºé”®ï¼Œä»¥Stateæ¥å£ä¸ºå€¼çš„map
	stateByName map[string]State
	// çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒ
	OnChange func(from, to State)
	// å½“å‰çŠ¶æ€
	curr State
}

// æ·»åŠ ä¸€ä¸ªçŠ¶æ€åˆ°ç®¡ç†å™¨ä¸­
func (sm *StateManager) Add(s State) {
	// è·å–çŠ¶æ€çš„åç§°
	name := StateName(s)
	// å°†sè½¬æ¢ä¸ºèƒ½è®¾ç½®åå­—çš„æ¥å£ï¼Œç„¶åè°ƒç”¨è¯¥æ¥å£
	// å°†sï¼ˆStateæ¥å£ï¼‰é€šè¿‡ç±»å‹æ–­è¨€è½¬æ¢ä¸ºå¸¦æœ‰set Name()æ–¹æ³•(name string)çš„æ¥å£ã€‚
	// æ¥ç€è°ƒç”¨è¿™ä¸ªæ¥å£çš„set Name()æ–¹æ³•è®¾ç½®çŠ¶æ€çš„åç§°ã€‚ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥å¿«é€Ÿè°ƒç”¨ä¸€ä¸ªæ¥å£å®ç°çš„å…¶ä»–æ–¹æ³•
	s.(interface {
		setName(name string)
	}).setName(name)
	// æ ¹æ®çŠ¶æ€åè·å–å·²ç»æ·»åŠ çš„çŠ¶æ€ï¼Œæ£€æŸ¥è¯¥çŠ¶æ€æ˜¯å¦å­˜åœ¨
	if sm.Get(name) != nil {
		panic("duplicate state:" + name)
	}
	// æ ¹æ®åå­—ä¿å­˜åˆ°mapä¸­
	sm.stateByName[name] = s
}

// æ ¹æ®åå­—è·å–æŒ‡å®šçŠ¶æ€
func (sm *StateManager) Get(name string) State {
	if v, ok := sm.stateByName[name]; ok {
		return v
	}
	return nil
}

// åˆå§‹åŒ–çŠ¶æ€ç®¡ç†å™¨
func NewStateManager() *StateManager {
	return &StateManager{
		stateByName: make(map[string]State),
	}
}

```



<br/>


> **åœ¨çŠ¶æ€é—´è½¬ç§»**


&emsp; çŠ¶æ€ç®¡ç†å™¨ä¸ä»…ç®¡ç†çŠ¶æ€çš„å®ä¾‹ï¼Œè¿˜å¯ä»¥æ§åˆ¶å½“å‰çš„çŠ¶æ€åŠè½¬ç§»åˆ°æ–°çš„çŠ¶æ€ã€‚çŠ¶æ€ç®¡ç†å™¨ä»å½“å‰çŠ¶æ€è½¬ç§»åˆ°ç»™å®šåç§°çš„çŠ¶æ€è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°çŠ¶æ€ä¸å­˜åœ¨ã€ç›®æ ‡çŠ¶æ€ä¸èƒ½è½¬ç§»åŠåŒç±»çŠ¶æ€ä¸èƒ½è½¬ç§»æ—¶ï¼Œå°†è¿”å›erroré”™è¯¯å¯¹è±¡ï¼Œè¿™äº›é”™è¯¯ä»¥Errå¼€å¤´ï¼Œåœ¨åŒ…ï¼ˆpackageï¼‰é‡Œæå‰å®šä¹‰å¥½ã€‚

æœ¬ä¾‹ä¸€å…±æ¶‰åŠ3ç§é”™è¯¯ï¼Œåˆ†åˆ«æ˜¯ï¼š

â— çŠ¶æ€æ²¡æœ‰æ‰¾åˆ°çš„é”™è¯¯ï¼Œå¯¹åº”Err State Not Foundã€‚

â— ç¦æ­¢åœ¨åŒçŠ¶æ€é—´è½¬ç§»çš„é”™è¯¯ï¼Œå¯¹åº”Err Forbid Same State Transitã€‚

â— ä¸èƒ½è½¬ç§»åˆ°æŒ‡å®šçŠ¶æ€çš„é”™è¯¯ï¼Œå¯¹åº”Err Cannot Transit To Stateã€‚çŠ¶æ€è½¬ç§»æ—¶ï¼Œè¿˜ä¼šè°ƒç”¨çŠ¶æ€ç®¡ç†å™¨çš„On Change()å‡½æ•°è¿›è¡Œå¤–éƒ¨é€šçŸ¥ã€‚

```
/**
 * @description: åœ¨çŠ¶æ€é—´è½¬ç§»
 */
// çŠ¶æ€æ²¡æœ‰æ‰¾åˆ°çš„é”™è¯¯
var ErrStateNotFound = errors.New("state not found")

// ç¦æ­¢åœ¨åŒçŠ¶æ€é—´è½¬ç§»
var ErrForbidSameStateTransit = errors.New("forbid same state transit")

// ä¸èƒ½è½¬ç§»åˆ°æŒ‡å®šçŠ¶æ€
var ErrCannotTransitToState = errors.New("cannot transit to state")

// è·å–å½“å‰çš„çŠ¶æ€
func (sm *StateManager) CurrState() State {
	return sm.curr
}

// å½“å‰çŠ¶æ€èƒ½å¦è½¬ç§»åˆ°ç›®æ ‡çŠ¶æ€
func (sm *StateManager) CanCurrTransitTo(name string) bool {
	if sm.curr == nil {
		return true
	}
	// ç›¸åŒçš„çŠ¶æ€ä¸ç”¨è½¬æ¢
	if sm.curr.Name() == name && !sm.curr.EnableSameTransit() {
		return false
	}
	// ä½¿ç”¨å½“å‰çŠ¶æ€ï¼Œæ£€æŸ¥èƒ½å¦è½¬ç§»åˆ°æŒ‡å®šåå­—çš„çŠ¶æ€
	return sm.curr.CanTransitTo(name)
}

// è½¬ç§»åˆ°æŒ‡å®šçŠ¶æ€
func (sm *StateManager) Transit(name string) error {
	// è·å–ç›®æ ‡çŠ¶æ€
	next := sm.Get(name)
	// ç›®æ ‡ä¸å­˜åœ¨
	if next == nil {
		return ErrStateNotFound
	}
	// è®°å½•è½¬ç§»å‰çš„çŠ¶æ€
	pre := sm.curr
	// å½“å‰æœ‰çŠ¶æ€
	if sm.curr != nil {
		// ç›¸åŒçš„çŠ¶æ€ä¸ç”¨è½¬æ¢
		if sm.curr.Name() == name && !sm.curr.EnableSameTransit() {
			return ErrForbidSameStateTransit
		}
		// ä¸èƒ½è½¬ç§»åˆ°ç›®æ ‡çŠ¶æ€
		if !sm.curr.CanTransitTo(name) {
			return ErrCannotTransitToState
		}
		// ç»“æŸå½“å‰çŠ¶æ€
		sm.curr.OnEnd()
	}
	// å°†å½“å‰çŠ¶æ€åˆ‡æ¢ä¸ºè¦è½¬ç§»åˆ°çš„ç›®æ ‡çŠ¶æ€
	sm.curr = next
	// è°ƒç”¨æ–°çŠ¶æ€çš„å¼€å§‹
	sm.curr.OnBegin()
	// é€šçŸ¥å›è°ƒ
	if sm.OnChange != nil {
		sm.OnChange(pre, sm.curr)
	}
	return nil
}

```



<br/>


> è‡ªå®šä¹‰çŠ¶æ€å®ç°çŠ¶æ€æ¥å£

```
/**
 * @description: è‡ªå®šä¹‰çŠ¶æ€å®ç°çŠ¶æ€æ¥å£
 */

// é—²ç½®çŠ¶æ€
type IdleState struct {
	StateInfo // ä½¿ç”¨State Infoå®ç°åŸºç¡€æ¥å£
}

// é‡æ–°å®ç°çŠ¶æ€å¼€å§‹
func (i *IdleState) OnBegin() {
	fmt.Println("Idle State begin")
}

// é‡æ–°å®ç°çŠ¶æ€ç»“æŸ
func (i *IdleState) OnEnd() {
	fmt.Println("Idle State end")
}

// ç§»åŠ¨çŠ¶æ€
type MoveState struct {
	StateInfo
}

func (m *MoveState) OnBegin() {
	fmt.Println("Move State begin")
}

// å…è®¸ç§»åŠ¨çŠ¶æ€äº’ç›¸è½¬æ¢
func (m *MoveState) EnableSameTransit() bool {
	return true
}

// è·³è·ƒçŠ¶æ€
type JumpState struct {
	StateInfo
}

func (j *JumpState) OnBegin() {
	fmt.Println("Jump State begin")
} // è·³è·ƒçŠ¶æ€ä¸èƒ½è½¬ç§»åˆ°ç§»åŠ¨çŠ¶æ€
func (j *JumpState) CanTransitTo(name string) bool {
	return name != "Move State"
}



// çŠ¶æ€æœºè°ƒç”¨
func testInterface6() {
	// å®ä¾‹åŒ–ä¸€ä¸ªçŠ¶æ€ç®¡ç†å™¨
	sm := NewStateManager()
	// å“åº”çŠ¶æ€è½¬ç§»çš„é€šçŸ¥
	sm.OnChange = func(from, to State) {
		// æ‰“å°çŠ¶æ€è½¬ç§»çš„æµå‘
		fmt.Printf("%s ---> %s\n\n", StateName(from), StateName(to))
	}
	// æ·»åŠ 3ä¸ªçŠ¶æ€
	sm.Add(new(IdleState))
	sm.Add(new(MoveState))
	sm.Add(new(JumpState))
	// åœ¨ä¸åŒçŠ¶æ€é—´è½¬ç§»
	transitAndReport(sm, "IdleState")
	transitAndReport(sm, "MoveState")
	transitAndReport(sm, "MoveState")
	transitAndReport(sm, "JumpState")
	transitAndReport(sm, "JumpState")
	transitAndReport(sm, "IdleState")
}

```

è¾“å‡ºï¼š

```
<=============== ğŸ ğŸ ğŸ ===============> 

Idle State begin
none ---> IdleState

Idle State end
Move State begin
IdleState ---> MoveState

Move State begin
MoveState ---> MoveState

Jump State begin
MoveState ---> JumpState

FAILED! JumpState --> JumpState, forbid same state transit

Idle State begin
JumpState ---> IdleState



<=============== ğŸ‘ ğŸ‘ ğŸ‘ ===============> 
```
