></h2>
- [**ä¾èµ–åŒ…å®‰è£…**](ä¾èµ–åŒ…å®‰è£…)
	- [ä¾èµ–å®‰è£…å‘½ä»¤](#ä¾èµ–å®‰è£…å‘½ä»¤)
- [**åŠ¨æ‰‹å®ç°ä¸€ä¸ªåº“**](#åŠ¨æ‰‹å®ç°ä¸€ä¸ªåº“)
	- [TravisCI](#TravisCI) 
	- [GitHub Actions](#GitHubActions) 
	- [DaoCloud](#DaoCloud)
- [**gRPCæ¡†æ¶**](#gRPCæ¡†æ¶)
	- [grpcç¯å¢ƒé…ç½®](#grpcç¯å¢ƒé…ç½®)
	- [protocä½¿ç”¨](#protocä½¿ç”¨)
	- [ç®€å•Demoæµç¨‹](#ç®€å•Demoæµç¨‹)
	- [protoç¼–è¯‘æˆgoä»£ç ](#protoç¼–è¯‘æˆgoä»£ç )	
	- [å‘½ä»¤è¡Œæ¨¡å—cmd](#å‘½ä»¤è¡Œæ¨¡å—cmd)
- [**â€ŒCLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰Cobraåº“**](#CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰Cobraåº“)
- [**â€Œgo-collyæ¡†æ¶**](#go-collyæ¡†æ¶)
	- [go-collyæ¡†æ¶çš„ç‰¹æ€§](#go-collyæ¡†æ¶çš„ç‰¹æ€§)
	- [go-collyæ¡†æ¶ä½¿ç”¨](#go-collyæ¡†æ¶ä½¿ç”¨)
	- [å°†æŠ“å–çš„ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨æ–‡ä»¶ä¸­](#å°†æŠ“å–çš„ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨æ–‡ä»¶ä¸­)
- [è¯»å†™é…ç½®æ–‡ä»¶åº“viper](#è¯»å†™é…ç½®æ–‡ä»¶åº“viper)
- [**`RESTful APIè®¾è®¡æ¨¡å¼`**](#RESTfulAPIè®¾è®¡æ¨¡å¼)
	- [**â€Œ`net/http`åº“**](#`net/http`åº“)
	- [**â€Œginæ¡†æ¶**](#â€Œginæ¡†æ¶)
		- [Ginæ„å»º `RESTful API`](#Ginæ„å»ºRESTfulAPI)
		- [æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡](#æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡)
- [**â€Œcellnetç½‘ç»œåº“**](#cellnetç½‘ç»œåº“)
- [**â€Œè®¤è¯å’ŒæˆæƒJWT**](#â€Œè®¤è¯å’ŒæˆæƒJWT)
	- [JWTä»‹ç»](#JWTä»‹ç»)  
	- [`jwt-go`åº“](#`jwt-go`åº“)
	- [JWTè®¤è¯ä¸­é—´ä»¶](#JWTè®¤è¯ä¸­é—´ä»¶)
- [**æ•°æ®éªŒè¯åº“**](#æ•°æ®éªŒè¯åº“)
	- [`beego/validationæ¡†æ¶`](#beego/validationæ¡†æ¶)
		- [æ•°æ®éªŒè¯validation](#æ•°æ®éªŒè¯validation)
	- [`govalidatoråº“`æ•°æ®éªŒè¯](#govalidatoråº“æ•°æ®éªŒè¯)
- [**â€Œå›¾è¡¨åº“â€”â€”go-chart**](#å›¾è¡¨åº“â€”â€”go-chart)
- [**å›¾è¡¨åº“go-echarts**](#å›¾è¡¨åº“go-echarts)
- [**packråº“å¤„ç†æ¨¡æ¿å¼•æ“å†…çš„æ–‡ä»¶**](#packråº“å¤„ç†æ¨¡æ¿å¼•æ“å†…çš„æ–‡ä»¶)
- [**â€ŒGJSONè§£æJSONæ•°æ®**](#GJSONè§£æJSONæ•°æ®)
- [**IrisWebæ¡†æ¶**](#IrisWebæ¡†æ¶)
	- [IrisWebæ¡†æ¶è¯¦è§£](#IrisWebæ¡†æ¶è¯¦è§£) 
	- [å¿«é€Ÿå…¥é—¨](#å¿«é€Ÿå…¥é—¨) 
	- [ä¸­é—´ä»¶](#ä¸­é—´ä»¶) 
	- [MVCæ¨¡å¼](#MVCæ¨¡å¼) 
	- [è§£æJSONè¯·æ±‚](#è§£æJSONè¯·æ±‚) 
	- [é›†æˆGORM](#é›†æˆGORM) 
	- [éƒ¨ç½²](#éƒ¨ç½²)
- **æ•°æ®åº“æ¡†æ¶**
	- [Redis](#Redis)
	- [GORMå’ŒXORMè¯¦ä»‹](#GORMå’ŒXORMè¯¦ä»‹)
		- [GORMä½¿ç”¨](#GORMä½¿ç”¨)
			- [GORMå®šä¹‰æ¨¡å‹](#GORMå®šä¹‰æ¨¡å‹) 
			- [GORMåˆå§‹åŒ–æ•°æ®åº“](#GORMåˆå§‹åŒ–æ•°æ®åº“) 
			- [GORMæ’å…¥æ•°æ®](#GORMæ’å…¥æ•°æ®) 
			- [GORMæŸ¥è¯¢æ•°æ®](#GORMæŸ¥è¯¢æ•°æ®) 
			- [GORMæ›´æ–°æ•°æ®](#GORMæ›´æ–°æ•°æ®) 
			- [GORMåˆ é™¤æ•°æ®](#GORMåˆ é™¤æ•°æ®)
	- [XORMä½¿ç”¨](#XORMä½¿ç”¨)
		- [XORMå®šä¹‰æ¨¡å‹](#XORMå®šä¹‰æ¨¡å‹) 
		- [XORMåˆå§‹åŒ–æ•°æ®åº“](#XORMåˆå§‹åŒ–æ•°æ®åº“) 
		- [XORMæ’å…¥æ•°æ®](#XORMæ’å…¥æ•°æ®) 
		- [XORMæŸ¥è¯¢æ•°æ®](#XORMæŸ¥è¯¢æ•°æ®)
			- [é¡¹ç›®å®è·µ1-JOIN(select)](#é¡¹ç›®å®è·µ1-JOIN(select))
			-  [é¡¹ç›®å®è·µ2-where(select)](#é¡¹ç›®å®è·µ2-where(select))
		- [XORMæ›´æ–°æ•°æ®](#XORMæ›´æ–°æ•°æ®) 
		- [XORMåˆ é™¤æ•°æ®](#XORMåˆ é™¤æ•°æ®)
	- [ä¸»è¦åŒºåˆ«](#ä¸»è¦åŒºåˆ«)
		- [ä»€ä¹ˆæ—¶å€™é€‰ç”¨ï¼Ÿ](#ä»€ä¹ˆæ—¶å€™é€‰ç”¨ï¼Ÿ)
	- [modelåºåˆ—åŒ–å’Œç»§æ‰¿](#modelåºåˆ—åŒ–å’Œç»§æ‰¿)
- [**å®‰å…¨**](#å®‰å…¨)
	- [cryptoåº“](#cryptoåº“)
		- [cryptoå“ˆå¸Œ](#cryptoå“ˆå¸Œ)



<br/><br/><br/>

***
<br/>

> <h1 id="ä¾èµ–åŒ…å®‰è£…">ä¾èµ–åŒ…å®‰è£…</h1>

```
$ mkdir go-gin-example && cd go-gin-example

$ go env -w GO111MODULE=on

$ go env -w GOPROXY=https://goproxy.cn,direct

$ go mod init github.com/EDDYCJY/go-gin-example
go: creating new go.mod: module github.com/EDDYCJY/go-gin-example

$ ls
go.mod
```

- mkdir xxx && cd xxxï¼šåˆ›å»ºå¹¶åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•é‡Œå»ã€‚
- go env -w GO111MODULE=onï¼šæ‰“å¼€ Go modules å¼€å…³ï¼ˆç›®å‰åœ¨ Go1.13 ä¸­é»˜è®¤å€¼ä¸º autoï¼‰ã€‚
- go env -w GOPROXY=...ï¼šè®¾ç½® GOPROXY ä»£ç†ï¼Œè¿™é‡Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªå€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯ https://goproxy.cnï¼Œå®ƒæ˜¯ç”±ä¸ƒç‰›äº‘èƒŒä¹¦çš„ä¸€ä¸ªå¼ºå¤§ç¨³å®šçš„ Go æ¨¡å—ä»£ç†ï¼Œå¯ä»¥æœ‰æ•ˆåœ°è§£å†³ä½ çš„å¤–ç½‘é—®é¢˜ï¼›ç¬¬äºŒä¸ªæ˜¯ directï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ fallback é€‰é¡¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨äºæŒ‡ç¤º Go åœ¨æ‹‰å–æ¨¡å—æ—¶é‡åˆ°é”™è¯¯ä¼šå›æºåˆ°æ¨¡å—ç‰ˆæœ¬çš„æºåœ°å€å»æŠ“å–ï¼ˆæ¯”å¦‚ GitHub ç­‰ï¼‰ã€‚
- go mod init [MODULE_PATH]ï¼šåˆå§‹åŒ– Go modulesï¼Œå®ƒå°†ä¼šç”Ÿæˆ go.mod æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ MODULE_PATH å¡«å†™çš„æ˜¯æ¨¡å—å¼•å…¥è·¯å¾„ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æƒ…å†µä¿®æ”¹è·¯å¾„ã€‚

åœ¨æ‰§è¡Œäº†ä¸Šè¿°æ­¥éª¤åï¼Œåˆå§‹åŒ–å·¥ä½œå·²å®Œæˆï¼Œæˆ‘ä»¬æ‰“å¼€ go.mod æ–‡ä»¶çœ‹çœ‹ï¼Œå¦‚ä¸‹ï¼š

```shell
module github.com/EDDYCJY/go-gin-example

go 1.13
```
é»˜è®¤çš„ go.mod æ–‡ä»¶é‡Œä¸»è¦æ˜¯ä¸¤å—å†…å®¹ï¼Œä¸€ä¸ªæ˜¯å½“å‰çš„æ¨¡å—è·¯å¾„å’Œé¢„æœŸçš„ Go è¯­è¨€ç‰ˆæœ¬ã€‚

<br/><br/><br/>
> <h2 id="ä¾èµ–å®‰è£…å‘½ä»¤"> ä¾èµ–å®‰è£…å‘½ä»¤ </h2>

- **åŸºç¡€ä½¿ç”¨:**
	- (ç”¨ `go get` æ‹‰å–æ–°çš„ä¾èµ–)
		- æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬(ä¼˜å…ˆæ‹©å– tag)ï¼š`go get golang.org/x/text@latest`
		- æ‹‰å– master åˆ†æ”¯çš„æœ€æ–° commitï¼š`go get golang.org/x/text@master`
		- æ‹‰å– tag ä¸º v0.3.2 çš„ commitï¼š`go get golang.org/x/text@v0.3.2`
		- æ‹‰å– hash ä¸º 342b231 çš„ commitï¼Œæœ€ç»ˆä¼šè¢«è½¬æ¢ä¸º v0.3.2ï¼š`go get golang.org/x/text@342b2e`
		- ç”¨ `go get -u` æ›´æ–°ç°æœ‰çš„ä¾èµ–
		- ç”¨ `go mod download` ä¸‹è½½ go.mod æ–‡ä»¶ä¸­æŒ‡æ˜çš„æ‰€æœ‰ä¾èµ–
		- ç”¨ `go mod tidy` è¿™ä¸ªå‘½ä»¤ä¼šæ¸…ç† go.mod å¹¶è‡ªåŠ¨æ·»åŠ ç¼ºå°‘çš„ä¾èµ–ã€‚
		- ç”¨ `go mod graph` æŸ¥çœ‹ç°æœ‰çš„ä¾èµ–ç»“æ„
		- ç”¨ `go mod init` ç”Ÿæˆ go.mod æ–‡ä»¶ (Go 1.13 ä¸­å”¯ä¸€ä¸€ä¸ªå¯ä»¥ç”Ÿæˆ go.mod æ–‡ä»¶çš„å­å‘½ä»¤)
	- ç”¨ `go mod edit` ç¼–è¾‘ go.mod æ–‡ä»¶
	- ç”¨ `go mod vendor` å¯¼å‡ºç°æœ‰çš„æ‰€æœ‰ä¾èµ– (äº‹å®ä¸Š Go modules æ­£åœ¨æ·¡åŒ– Vendor çš„æ¦‚å¿µ)
	- ç”¨ `go mod verify` æ ¡éªŒä¸€ä¸ªæ¨¡å—æ˜¯å¦è¢«ç¯¡æ”¹è¿‡


<br/><br/>
><h3  id="go.sumæ–‡ä»¶">go.sumæ–‡ä»¶</h3>
- **go.sum** æ–‡ä»¶è¯¦ç»†ç½—åˆ—äº†å½“å‰é¡¹ç›®ç›´æ¥æˆ–é—´æ¥ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ç‰ˆæœ¬ï¼Œå¹¶å†™æ˜äº†é‚£äº›æ¨¡å—ç‰ˆæœ¬çš„ SHA-256 å“ˆå¸Œå€¼ä»¥å¤‡ Go åœ¨ä»Šåçš„æ“ä½œä¸­ä¿è¯é¡¹ç›®æ‰€ä¾èµ–çš„é‚£äº›æ¨¡å—ç‰ˆæœ¬ä¸ä¼šè¢«ç¯¡æ”¹ã€‚

<br/><br/>
><h3  id="go.modæ–‡ä»¶">go.modæ–‡ä»¶</h3>
go.mod æ–‡ä»¶æ˜¯å¯ç”¨äº† Go modules çš„é¡¹ç›®æ‰€å¿…é¡»çš„æœ€é‡è¦çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæè¿°äº†å½“å‰é¡¹ç›®ï¼ˆä¹Ÿå°±æ˜¯å½“å‰æ¨¡å—ï¼‰çš„å…ƒä¿¡æ¯ï¼Œæ¯ä¸€è¡Œéƒ½ä»¥ä¸€ä¸ªåŠ¨è¯å¼€å¤´ï¼Œç›®å‰æœ‰ä»¥ä¸‹ 5 ä¸ªåŠ¨è¯:

- moduleï¼šç”¨äºå®šä¹‰å½“å‰é¡¹ç›®çš„æ¨¡å—è·¯å¾„ã€‚
- goï¼šç”¨äºè®¾ç½®é¢„æœŸçš„ Go ç‰ˆæœ¬ã€‚
- requireï¼šç”¨äºè®¾ç½®ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚
- excludeï¼šç”¨äºä»ä½¿ç”¨ä¸­æ’é™¤ä¸€ä¸ªç‰¹å®šçš„æ¨¡å—ç‰ˆæœ¬ã€‚
- replaceï¼šç”¨äºå°†ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬æ›¿æ¢ä¸ºå¦å¤–ä¸€ä¸ªæ¨¡å—ç‰ˆæœ¬ã€‚

ä½ å¯èƒ½è¿˜ä¼šç–‘æƒ‘ indirect æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œindirect çš„æ„æ€æ˜¯ä¼ é€’ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯éç›´æ¥ä¾èµ–ã€‚





<br/>

***
<br/><br/><br/>

> <h1 id="åŠ¨æ‰‹å®ç°ä¸€ä¸ªåº“">åŠ¨æ‰‹å®ç°ä¸€ä¸ªåº“</h1>
- **Golang æºä»£ç æŒç»­é›†æˆå·¥å…·çš„ç”¨é€”å’ŒåŠŸèƒ½**

<br/>

- è¿™äº›å·¥å…·ä¸»è¦ç”¨äº**æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­äº¤ä»˜/éƒ¨ç½²ï¼ˆCDï¼‰**ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­è‡ªåŠ¨åŒ–ä»¥ä¸‹ä»»åŠ¡ï¼š

	- **è‡ªåŠ¨åŒ–æ„å»º**ï¼šæ£€æµ‹ä»£ç æ›´æ”¹åï¼Œè‡ªåŠ¨ç¼–è¯‘å’Œæ„å»ºä»£ç ã€‚
	- **è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ï¼Œç¡®ä¿ä»£ç è´¨é‡ã€‚
	- **ä»£ç è´¨é‡æ£€æŸ¥**ï¼šæ‰§è¡Œä»£ç é™æ€åˆ†æï¼ˆå¦‚ lintï¼‰ä»¥æ£€æµ‹æ½œåœ¨é—®é¢˜ã€‚
	- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šåœ¨ä»£ç é€šè¿‡éªŒè¯åï¼Œå°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§æˆ–å…¶ä»–ç¯å¢ƒã€‚
	- **å›¢é˜Ÿåä½œ**ï¼šåœ¨ä»£ç åˆå¹¶æˆ–æäº¤åï¼Œå¿«é€Ÿè·å¾—æ„å»ºå’Œæµ‹è¯•ç»“æœï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

<br/>

ä»¥ä¸‹æ˜¯ **TravisCI**ã€**GitHub Actions** å’Œ **DaoCloud** çš„å…·ä½“ä»‹ç»å’Œç”¨é€”ã€‚


- **å·¥å…·å¯¹æ¯”æ€»ç»“**

| å·¥å…·         | ç‰¹ç‚¹                                      | é€‚ç”¨åœºæ™¯                          | ä¼˜åŠ¿                          |
|--------------|------------------------------------------|-----------------------------------|-------------------------------|
| **TravisCI** | ç»å…¸ CI æœåŠ¡ï¼Œè½»é‡çº§ï¼Œå¼€æºé¡¹ç›®å‹å¥½         | å°å‹æˆ–ä¸­å‹é¡¹ç›®çš„æŒç»­é›†æˆ          | é…ç½®ç®€å•ï¼Œæ–‡æ¡£ä¸°å¯Œ            |
| **GitHub Actions** | æ·±åº¦é›†æˆ GitHubï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»          | GitHub æ‰˜ç®¡çš„é¡¹ç›®æŒç»­é›†æˆ          | ç¤¾åŒºèµ„æºä¸°å¯Œï¼Œå¼ºå¤§çš„è§¦å‘æœºåˆ¶   |
| **DaoCloud** | å›½å†…æœåŠ¡ï¼Œæ”¯æŒå®¹å™¨åŒ–ã€äº‘åŸç”Ÿ               | å›½å†…é¡¹ç›®ï¼Œä¾èµ– Docker æˆ– Kubernetes | å›¾å½¢åŒ–ç•Œé¢ï¼Œå›½å†…æœåŠ¡ç¨³å®š       |

æ ¹æ®ä½ çš„é¡¹ç›®æ‰˜ç®¡å¹³å°ã€éœ€æ±‚å’Œå›¢é˜Ÿåä½œæ–¹å¼é€‰æ‹©åˆé€‚çš„å·¥å…·ï¼š  
- **å¼€æºé¡¹ç›®**ï¼šæ¨è TravisCI æˆ– GitHub Actionsã€‚
- **å›½å†…ç§æœ‰é¡¹ç›®**ï¼šæ¨è DaoCloudã€‚



<br/><br/><br/>

> <h2 id="TravisCI">TravisCI</h2>

- **ç”¨é€”**

TravisCI æ˜¯ä¸€æ¬¾æµè¡Œçš„æŒç»­é›†æˆæœåŠ¡ï¼Œæ”¯æŒå¤šä¸ªç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬ Goã€‚ä¸»è¦ç”¨äº GitHub ä»“åº“çš„æŒç»­é›†æˆã€‚å®ƒä¼šåœ¨ä»£ç æ¨é€æˆ–æäº¤ Pull Request æ—¶è§¦å‘è‡ªåŠ¨åŒ–æµç¨‹ã€‚

<br/>

- **åŠŸèƒ½**
	- è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚
	- æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ˆLinuxã€macOSã€Windowsï¼‰ã€‚
	- é›†æˆ Docker æ”¯æŒå¤æ‚çš„æ„å»ºç¯å¢ƒã€‚
	- ä¸ GitHub æ·±åº¦é›†æˆï¼Œå¯åœ¨ PR ä¸­æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€ã€‚

<br/>

- **ä½¿ç”¨ç¤ºä¾‹**
åœ¨é¡¹ç›®ä¸­æ·»åŠ  `.travis.yml` æ–‡ä»¶ï¼š

```yaml
language: go
go:
  - 1.19 # æŒ‡å®š Go ç‰ˆæœ¬
script:
  - go build -v ./...  # ç¼–è¯‘é¡¹ç›®
  - go test -v ./...   # è¿è¡Œæµ‹è¯•
```

<br/>

**ç”¨é€”åœºæ™¯**ï¼š
- å¿«é€Ÿè®¾ç½®å’Œè¿è¡ŒæŒç»­é›†æˆã€‚
- æ£€æµ‹ Go é¡¹ç›®ä¸­ä»£ç çš„æ„å»ºå’Œæµ‹è¯•çŠ¶æ€ã€‚


<br/><br/><br/>
> <h2 id="GitHubActions">GitHub Actions</h2>

- **ç”¨é€”**

GitHub Actions æ˜¯ GitHub è‡ªå¸¦çš„ CI/CD å·¥å…·ï¼Œä¸“é—¨ä¸º GitHub ä»“åº“è®¾è®¡ã€‚é€šè¿‡å®šä¹‰ **workflow** æ–‡ä»¶ï¼Œä½ å¯ä»¥è‡ªåŠ¨åŒ–é¡¹ç›®çš„æ•´ä¸ªå¼€å‘å‘¨æœŸï¼ŒåŒ…æ‹¬æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ã€‚

<br/>
- **åŠŸèƒ½**
	- ä½¿ç”¨ YAML æ–‡ä»¶å®šä¹‰æ„å»ºæµç¨‹ï¼ˆ`.github/workflows/*.yml`ï¼‰ã€‚
	- ä¸°å¯Œçš„ç¤¾åŒº Actionsï¼ˆå¤ç”¨å…¶ä»–å¼€å‘è€…çš„ä»»åŠ¡æ¨¡æ¿ï¼‰ã€‚
	- æ”¯æŒäº‹ä»¶è§¦å‘ï¼ˆå¦‚ Pushã€PR æˆ– Schedule å®šæ—¶ä»»åŠ¡ï¼‰ã€‚
	- æä¾›å¤šå¹³å°æ”¯æŒï¼ˆLinuxã€Windowsã€macOSï¼‰ã€‚

<br/>

- **ä½¿ç”¨ç¤ºä¾‹**

åœ¨é¡¹ç›®ä¸­æ·»åŠ  `.github/workflows/ci.yml` æ–‡ä»¶ï¼š

```yaml
name: Go CI
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.19
      - name: Install dependencies
        run: go mod tidy
      - name: Build
        run: go build ./...
      - name: Test
        run: go test ./...
```

<br/>

- **ç”¨é€”åœºæ™¯**ï¼š
	- **å¼€æºé¡¹ç›®**ï¼šé€‚åˆ GitHub æ‰˜ç®¡çš„å¼€æºé¡¹ç›®ï¼Œç¤¾åŒºç”¨æˆ·å¯ä»¥å¿«é€Ÿè´¡çŒ®ã€‚
	- **å›¢é˜Ÿåä½œ**ï¼šåœ¨ä»£ç åˆå¹¶å‰ç¡®ä¿ä»£ç è´¨é‡ã€‚

<br/><br/><br/>
> <h2 id="DaoCloud">DaoCloud</h2>

- **ç”¨é€”**
DaoCloud æ˜¯ä¸­å›½å¼€å‘è€…å¸¸ç”¨çš„ä¸€ä½“åŒ–äº‘åŸç”Ÿå·¥å…·å¹³å°ï¼Œæ”¯æŒ CI/CDã€å®¹å™¨åŒ–éƒ¨ç½²ã€DevOps ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç‰¹åˆ«é€‚åˆä¸­å›½çš„å¼€å‘è€…å’Œä¼ä¸šä½¿ç”¨ã€‚

<br/>

- **åŠŸèƒ½**
	- å›¾å½¢åŒ–ç•Œé¢ï¼Œæ“ä½œç®€å•æ˜“ç”¨ã€‚
	- æ”¯æŒä»æºç æ„å»ºã€æµ‹è¯•åˆ° Docker é•œåƒç”Ÿæˆçš„å…¨æµç¨‹ã€‚
	- ä¸å›½å†…ä»£ç æ‰˜ç®¡å¹³å°ï¼ˆå¦‚ Giteeï¼‰æ·±åº¦é›†æˆã€‚
	- æä¾›æ›´å¿«çš„å›½å†…é•œåƒåŠ é€ŸæœåŠ¡ã€‚

<br/>

- **ä½¿ç”¨ç¤ºä¾‹**

é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å®Œæˆä»¥ä¸‹é…ç½®ï¼š
	1. é€‰æ‹©ä»£ç æºï¼ˆå¦‚ GitHub æˆ– Giteeï¼‰ã€‚
	2. æ·»åŠ æ„å»ºä»»åŠ¡ï¼Œä¾‹å¦‚è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
go build ./...
go test ./...
docker build -t myapp .
```

3. é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤æˆ–å…¶ä»–ç¯å¢ƒã€‚

- **ç”¨é€”åœºæ™¯**ï¼š
	- å›½å†…é¡¹ç›®çš„æŒç»­é›†æˆå’Œäº¤ä»˜ã€‚
	- å¿«é€Ÿå®ç° CI/CD å’Œå®¹å™¨åŒ–äº¤ä»˜ã€‚

<br/><br/><br/>

***
<br/>
> <h1 id="gRPCæ¡†æ¶">gRPCæ¡†æ¶</h1>

RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰å’Œ gRPCï¼ˆåŸºäº RPC çš„ç°ä»£æ¡†æ¶ï¼‰æ˜¯ä¸¤ç§ç”¨äº **å†…éƒ¨ API é€šä¿¡** çš„æ–¹å¼ï¼Œè™½ç„¶å®ƒä»¬æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å…³é”®åŒºåˆ«ã€‚  

---

## **1. RPC ä½œä¸ºå†…éƒ¨ API é€šä¿¡**
RPCï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ç§ **åˆ†å¸ƒå¼è®¡ç®—é€šä¿¡æ–¹å¼**ï¼Œå…è®¸ä¸€ä¸ªç¨‹åºè°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–¹æ³•ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ã€‚RPC ä¸»è¦ç‰¹ç‚¹ï¼š
- **åŒæ­¥è°ƒç”¨**ï¼Œè°ƒç”¨æ–¹ç­‰å¾…è¿œç¨‹æ–¹æ³•æ‰§è¡Œå®Œæˆåè¿”å›ç»“æœã€‚
- **äºŒè¿›åˆ¶æˆ–æ–‡æœ¬æ ¼å¼ä¼ è¾“**ï¼Œæ¯”å¦‚ JSON-RPCã€XML-RPCã€Thriftã€gRPCã€è‡ªå®šä¹‰ TCP åè®®ç­‰ã€‚
- **éœ€è¦åºåˆ—åŒ–/ååºåˆ—åŒ–æ•°æ®**ï¼Œä¸åŒ RPC å®ç°æ–¹å¼ä¼šä½¿ç”¨ä¸åŒçš„æ•°æ®æ ¼å¼ã€‚

### **å¸¸è§çš„ RPC å®ç°**
| **RPC æ¡†æ¶** | **ä¼ è¾“åè®®** | **æ•°æ®æ ¼å¼** | **é€‚ç”¨åœºæ™¯** |
|-------------|------------|------------|--------------|
| JSON-RPC    | HTTP/TCP   | JSON       | è½»é‡çº§ã€ç®€å•ç³»ç»Ÿ |
| XML-RPC     | HTTP       | XML        | æ—§ç³»ç»Ÿå…¼å®¹ |
| Thrift      | TCP/HTTP   | äºŒè¿›åˆ¶/JSON | é«˜æ•ˆè·¨è¯­è¨€ RPC |
| gRPC        | HTTP/2     | Protocol Buffersï¼ˆprotobufï¼‰ | é«˜æ€§èƒ½ã€ç°ä»£å¾®æœåŠ¡ |

---

## **2. gRPC ä½œä¸ºå†…éƒ¨é€šä¿¡**
gRPC æ˜¯ Google å¼€æºçš„ **é«˜æ€§èƒ½ RPC æ¡†æ¶**ï¼Œä¸ä¼ ç»Ÿ RPC ç›¸æ¯”ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
### âœ… **åŸºäº HTTP/2**
- å¤šè·¯å¤ç”¨ï¼Œå‡å°‘è¿æ¥æ•°ï¼Œæé«˜ååé‡ã€‚
- å¤´éƒ¨å‹ç¼©ï¼ˆHPACKï¼‰ï¼Œé™ä½å¸¦å®½æ¶ˆè€—ã€‚

### âœ… **ä½¿ç”¨ Protocol Buffersï¼ˆprotobufï¼‰ä½œä¸ºæ•°æ®æ ¼å¼**
- é«˜æ•ˆçš„äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå‡å°‘å¸¦å®½å ç”¨ï¼Œè§£æé€Ÿåº¦æ¯” JSON/XML æ›´å¿«ã€‚
- ä»£ç è‡ªåŠ¨ç”Ÿæˆï¼Œå‡å°‘æ‰‹å†™ API è§£æä»£ç ã€‚

### âœ… **æ”¯æŒæµå¼é€šä¿¡**
- **æ™®é€š RPC**ï¼šè¯·æ±‚ â†’ å“åº”ï¼ˆå•æ¬¡äº¤äº’ï¼‰ã€‚
- **æœåŠ¡å™¨æµå¼ RPC**ï¼šå®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡å™¨æŒç»­è¿”å›æ•°æ®ï¼ˆé€‚åˆæ—¥å¿—æµã€è§†é¢‘æµï¼‰ã€‚
- **å®¢æˆ·ç«¯æµå¼ RPC**ï¼šå®¢æˆ·ç«¯è¿ç»­å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨ä¸€æ¬¡æ€§å“åº”ï¼ˆé€‚åˆä¸Šä¼ å¤§æ–‡ä»¶ï¼‰ã€‚
- **åŒå‘æµå¼ RPC**ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥æŒç»­å‘é€æ•°æ®ï¼ˆé€‚åˆå®æ—¶èŠå¤©ã€è¯­éŸ³é€šè¯ï¼‰ã€‚

### âœ… **å¤šè¯­è¨€æ”¯æŒ**
- gRPC å®˜æ–¹æ”¯æŒ Golangã€Pythonã€Javaã€C++ã€Node.js ç­‰ã€‚

---

## **3. RPC vs gRPC åŒºåˆ«**
| **å¯¹æ¯”é¡¹**       | **ä¼ ç»Ÿ RPCï¼ˆJSON-RPCã€Thriftï¼‰** | **gRPC** |
|-----------------|---------------------------------|---------|
| **é€šä¿¡åè®®**    | HTTP/TCP                        | **HTTP/2** |
| **æ•°æ®æ ¼å¼**    | JSON/XML/Thrift äºŒè¿›åˆ¶         | **protobufï¼ˆäºŒè¿›åˆ¶ï¼‰** |
| **åºåˆ—åŒ–é€Ÿåº¦**  | JSON/XML è¾ƒæ…¢                   | **protobuf æ›´å¿«** |
| **è¯­è¨€æ”¯æŒ**    | å–å†³äºæ¡†æ¶ï¼Œå¦‚ JSON-RPC åªæ”¯æŒéƒ¨åˆ†è¯­è¨€ | **å¤šè¯­è¨€æ”¯æŒï¼ˆGoã€Pythonã€C++ç­‰ï¼‰** |
| **æµå¼æ”¯æŒ**    | ä»…æ”¯æŒè¯·æ±‚-å“åº”                 | **æ”¯æŒæµå¼é€šä¿¡ï¼ˆå•å‘/åŒå‘ï¼‰** |
| **æ€§èƒ½**        | è§£æ JSON è¾ƒæ…¢ï¼Œå ç”¨å¸¦å®½è¾ƒå¤§     | **äºŒè¿›åˆ¶æ ¼å¼ï¼Œè§£æå¿«ï¼Œä½å¸¦å®½å ç”¨** |
| **ç”Ÿæ€**        | å–å†³äºå…·ä½“ RPC æ¡†æ¶              | **Google æ”¯æŒï¼Œç¤¾åŒºæ´»è·ƒ** |

---

## **4. é€‰æ‹© RPC è¿˜æ˜¯ gRPCï¼Ÿ**
### **ä»€ä¹ˆæ—¶å€™ç”¨ä¼ ç»Ÿ RPCï¼ˆå¦‚ JSON-RPCã€Thriftï¼‰ï¼Ÿ**
âœ… **é€‚ç”¨äºï¼š**
- **è½»é‡çº§é¡¹ç›®**ï¼ˆä¸éœ€è¦é«˜æ€§èƒ½é€šä¿¡ï¼Œç®€å• HTTP JSON API è¶³å¤Ÿï¼‰
- **å·²æœ‰ JSON/XML API**ï¼ˆä¸å‰ç«¯äº¤äº’ï¼Œå‰ç«¯ä¸æ”¯æŒ protobufï¼‰
- **ä¸æ”¯æŒ HTTP/2** çš„ç¯å¢ƒï¼ˆå¦‚è€æ—§æœåŠ¡å™¨ï¼‰

âŒ **ä¸é€‚ç”¨äºï¼š**
- é«˜ååã€ä½å»¶è¿Ÿåœºæ™¯ï¼ˆJSON è§£ææ…¢ï¼ŒHTTP/1.1 å¼€é”€å¤§ï¼‰
- å¤§è§„æ¨¡å¾®æœåŠ¡æ¶æ„ï¼ˆåè®®è®¾è®¡è¾ƒè€ï¼Œç¼ºå°‘æµå¼æ”¯æŒï¼‰

---

### **ä»€ä¹ˆæ—¶å€™ç”¨ gRPCï¼Ÿ**
âœ… **é€‚ç”¨äºï¼š**
- **å¾®æœåŠ¡æ¶æ„**ï¼ˆè·¨è¯­è¨€ã€è·¨å›¢é˜Ÿå¼€å‘ï¼Œè‡ªåŠ¨ç”Ÿæˆä»£ç ï¼‰
- **é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿé€šä¿¡**ï¼ˆprotobuf è§£æé€Ÿåº¦å¿«ï¼Œå‡å°‘ CPU å ç”¨ï¼‰
- **éœ€è¦æµå¼é€šä¿¡**ï¼ˆå¦‚æ—¥å¿—æ¨é€ã€WebSocket æ›¿ä»£æ–¹æ¡ˆï¼‰
- **Kubernetesã€Service Meshï¼ˆIstioï¼‰ç­‰äº‘åŸç”Ÿç¯å¢ƒ**

âŒ **ä¸é€‚ç”¨äºï¼š**
- éœ€è¦åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼ˆgRPC-Web éœ€è¦é¢å¤–ä»£ç†ï¼Œå¦‚ Envoyï¼‰
- éœ€è¦å…¼å®¹ RESTful APIï¼ˆJSON å‹å¥½ï¼‰

---

## **5. gRPC åœ¨ Golang å†…éƒ¨ API é€šä¿¡ç¤ºä¾‹**
### **å®šä¹‰ gRPC æœåŠ¡**
åˆ›å»º `.proto` æ–‡ä»¶ï¼š

```proto
syntax = "proto3";

package userpb;

service UserService {
  rpc GetUser (UserRequest) returns (UserResponse);
}

message UserRequest {
  int32 id = 1;
}

message UserResponse {
  int32 id = 1;
  string name = 2;
  string email = 3;
}
```

### **ç”Ÿæˆ Golang ä»£ç **

```sh
protoc --go_out=. --go-grpc_out=. user.proto
```

### **å®ç° gRPC æœåŠ¡å™¨**

```go
package main

import (
	"context"
	"log"
	"net"

	pb "example.com/userpb"
	"google.golang.org/grpc"
)

type server struct {
	pb.UnimplementedUserServiceServer
}

func (s *server) GetUser(ctx context.Context, req *pb.UserRequest) (*pb.UserResponse, error) {
	return &pb.UserResponse{Id: req.Id, Name: "Alice", Email: "alice@example.com"}, nil
}

func main() {
	lis, err := net.Listen("tcp", ":50051")
	if err != nil {
		log.Fatalf("Failed to listen: %v", err)
	}
	s := grpc.NewServer()
	pb.RegisterUserServiceServer(s, &server{})

	log.Println("gRPC server listening on port 50051")
	s.Serve(lis)
}
```

### **gRPC å®¢æˆ·ç«¯**

```go
package main

import (
	"context"
	"fmt"
	"log"
	"time"

	pb "example.com/userpb"
	"google.golang.org/grpc"
)

func main() {
	conn, err := grpc.Dial("localhost:50051", grpc.WithInsecure())
	if err != nil {
		log.Fatalf("Failed to connect: %v", err)
	}
	defer conn.Close()

	client := pb.NewUserServiceClient(conn)

	ctx, cancel := context.WithTimeout(context.Background(), time.Second)
	defer cancel()

	res, err := client.GetUser(ctx, &pb.UserRequest{Id: 1})
	if err != nil {
		log.Fatalf("Could not get user: %v", err)
	}
	fmt.Printf("User: %v\n", res)
}
```

---

## **6. æ€»ç»“**
| **é€‰æ‹©** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|
| **RESTful APIï¼ˆHTTP+JSONï¼‰** | å‰åç«¯äº¤äº’ï¼Œå…¼å®¹æ€§å¼ºï¼Œæµè§ˆå™¨å‹å¥½ |
| **ä¼ ç»Ÿ RPCï¼ˆJSON-RPCã€Thriftï¼‰** | è½»é‡çº§ RPCï¼Œé€‚åˆå°è§„æ¨¡å†…éƒ¨æœåŠ¡ |
| **gRPC** | é«˜æ€§èƒ½å¾®æœåŠ¡ï¼Œä½å»¶è¿Ÿã€æµå¼é€šä¿¡ï¼Œäº‘åŸç”Ÿæ¶æ„ |

å¦‚æœä½ çš„ç³»ç»Ÿæ˜¯**é«˜ååé‡ã€è·¨è¯­è¨€ã€å¤šå¾®æœåŠ¡æ¶æ„**ï¼Œé‚£ä¹ˆ **gRPC æ˜¯æ›´å¥½çš„é€‰æ‹©**ã€‚å¦‚æœåªæ˜¯ç®€å•çš„**å†…éƒ¨ API é€šä¿¡**ï¼Œå¯ä»¥ç”¨ **JSON-RPC/Thrift** ä»£æ›¿ã€‚


<br/><br/><br/>
> <h2 id="grpcç¯å¢ƒé…ç½®">grpcç¯å¢ƒé…ç½®</h2>

**grpcå®‰è£…**

```sh
go get -u google.golang.org/grpc
```

<br/><br/>

**Protoc Plugin(protobuf æ’ä»¶)å®‰è£…**

ä¸ºäº†åœ¨ Golang ä¸­ä½¿ç”¨ protobufï¼Œä½ éœ€è¦å®‰è£… Go çš„ protobuf æ’ä»¶ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…

```sh
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest

go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

<br/><br/>

**ç¼–è¯‘å’Œå®‰è£… Protocol Buffers (protobuf)** 
protobuf çš„å®‰è£…è¿‡ç¨‹ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… protobufï¼š

```
brew install protobuf
```

å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ protobuf æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```bash
protoc --version
```
å¦‚æœå®‰è£…æˆåŠŸï¼Œè¿™å°†è¾“å‡º protobuf çš„ç‰ˆæœ¬å·ã€‚
<br/>

**æ›´æ–°ä½ çš„ PATH**

ç¡®ä¿ä½ çš„ $GOPATH/bin æˆ– $HOME/go/bin åœ¨ä½ çš„ PATH ä¸­ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ protoc-gen-goã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å…¶æ·»åŠ åˆ°ä½ çš„ .bashrc æˆ– .zshrc æ–‡ä»¶ä¸­ï¼š

```
bash
export PATH=$PATH:$(go env GOPATH)/bin
```
ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š

```bash
source ~/.bashrc  # æˆ–è€… source ~/.zshrc
```

<br/>

**Grpc-gateway**
grpc-gatewayæ˜¯protocçš„ä¸€ä¸ªæ’ä»¶ã€‚å®ƒè¯»å–gRPCæœåŠ¡å®šä¹‰ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå°†RESTful JSON APIè½¬æ¢ä¸ºgRPCã€‚æ­¤æœåŠ¡å™¨æ˜¯æ ¹æ®gRPCå®šä¹‰ä¸­çš„è‡ªå®šä¹‰é€‰é¡¹ç”Ÿæˆçš„ã€‚

**å®‰è£…ï¼š**

```sh
go install github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway@latest
```


<br/><br/><br/>
> <h2 id="protocä½¿ç”¨">protocä½¿ç”¨</h2>
- æˆ‘ä»¬æŒ‰ç…§æƒ¯ä¾‹æ‰§è¡Œprotoc --helpï¼ˆæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬æŠ½å‡ºå‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤è¿›è¡Œè®²è§£ï¼š
	- 1ã€-IPATH, --proto_path=PATHï¼šæŒ‡å®šimportæœç´¢çš„ç›®å½•ï¼Œå¯æŒ‡å®šå¤šä¸ªï¼Œå¦‚æœä¸æŒ‡å®šåˆ™é»˜è®¤å½“å‰å·¥ä½œç›®å½•
	- 2ã€--go_outï¼šç”Ÿæˆgolangæºæ–‡ä»¶

<br/>

**å‚æ•°**
è‹¥è¦å°†é¢å¤–çš„å‚æ•°ä¼ é€’ç»™æ’ä»¶ï¼Œå¯ä½¿ç”¨ä»è¾“å‡ºç›®å½•ä¸­åˆ†ç¦»å‡ºæ¥çš„é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨:

ä½¿ç”¨ Protocol Buffers ç¼–è¯‘å™¨ï¼ˆ`protoc`ï¼‰ç”Ÿæˆ Go ä»£ç çš„å‘½ä»¤ï¼Œä¸”æ”¯æŒ gRPC æœåŠ¡ã€‚å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼š

```sh
protoc --go_out=plugins=grpc,import_path=mypackage:. *.proto
```
- import_prefix=xxxï¼šå°†æŒ‡å®šå‰ç¼€æ·»åŠ åˆ°æ‰€æœ‰importè·¯å¾„çš„å¼€å¤´
- import_path=foo/barï¼šå¦‚æœæ–‡ä»¶æ²¡æœ‰å£°æ˜go_packageï¼Œåˆ™ç”¨ä½œåŒ…ã€‚å¦‚æœå®ƒåŒ…å«æ–œæ ï¼Œé‚£ä¹ˆæœ€å³è¾¹çš„æ–œæ å°†è¢«å¿½ç•¥ã€‚
- plugins=plugin1+plugin2ï¼šæŒ‡å®šè¦åŠ è½½çš„å­æ’ä»¶åˆ—è¡¨ï¼ˆæˆ‘ä»¬æ‰€ä¸‹è½½çš„repoä¸­å”¯ä¸€çš„æ’ä»¶æ˜¯grpcï¼‰
- Mfoo/bar.proto=quux/shmeï¼š Må‚æ•°ï¼ŒæŒ‡å®š.protoæ–‡ä»¶ç¼–è¯‘åçš„åŒ…åï¼ˆfoo/bar.protoç¼–è¯‘åä¸ºåŒ…åä¸ºquux/shmeï¼‰

<br/>

***
### **å„éƒ¨åˆ†è¯¦è§£ï¼š**

1. **`protoc`**
   - è¿™æ˜¯ Protocol Buffers ç¼–è¯‘å™¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥å°† `.proto` æ–‡ä»¶ç¼–è¯‘ä¸ºæŒ‡å®šè¯­è¨€ï¼ˆå¦‚ Goã€Javaã€Pythonï¼‰çš„ä»£ç ã€‚

2. **`--go_out`**
   - `--go_out` æ˜¯æŒ‡ç¤º `protoc` ç¼–è¯‘å™¨ç”Ÿæˆ Go è¯­è¨€ä»£ç çš„æ ‡å¿—ã€‚
   - é€šè¿‡è¿™ä¸ªé€‰é¡¹ï¼Œ`protoc` ä¼šå°† `.proto` æ–‡ä»¶ç¼–è¯‘ä¸º Go ä»£ç ã€‚

3. **`plugins=grpc`**
   - `plugins=grpc` é€‰é¡¹å¯ç”¨ gRPC æ’ä»¶ã€‚gRPC æ˜¯ä¸€ç§é«˜æ•ˆçš„ RPC æ¡†æ¶ï¼Œ`protoc` ä¼šç”Ÿæˆç”¨äº gRPC æœåŠ¡çš„ Go ä»£ç ã€‚
   - ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œç”Ÿæˆçš„ Go ä»£ç ä¼šåŒ…æ‹¬ gRPC æ‰€éœ€çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç ã€‚
   
   **è§£é‡Šï¼š**
   - gRPC æœåŠ¡å’Œå®¢æˆ·ç«¯ä»£ç åŒ…å«äº†ä¸ Protocol Buffers ç›¸å…³çš„ `Client` å’Œ `Server` æ¥å£æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç”¨äºæœåŠ¡çš„é€šä¿¡ã€‚
   
4. **`import_path=mypackage`**
   - `import_path` é€‰é¡¹æŒ‡å®š Go ä»£ç ä¸­ `import` çš„åŒ…è·¯å¾„ã€‚
   - è¿™è¡¨ç¤ºç”Ÿæˆçš„ Go æ–‡ä»¶å°†åœ¨ `mypackage` åŒ…ä¸‹ã€‚ä¾‹å¦‚ï¼Œç”Ÿæˆçš„æ–‡ä»¶å°†é€šè¿‡ `import "mypackage/yourfile"` æ¥å¼•ç”¨ã€‚
   
   **æ³¨æ„ï¼š**
   - `mypackage` åº”è¯¥æ˜¯ä½ å¸Œæœ›åœ¨ Go é¡¹ç›®ä¸­ä½¿ç”¨çš„åŒ…åç§°ã€‚å®ƒé€šå¸¸æ˜¯ä½ é¡¹ç›®çš„ Go æ¨¡å—è·¯å¾„æˆ–ç›®å½•è·¯å¾„ã€‚

5. **`:.`**
   - `.` è¡¨ç¤ºå½“å‰ç›®å½•ã€‚è¿™æŒ‡å®šäº†ç”Ÿæˆçš„ Go ä»£ç åº”è¯¥æ”¾ç½®åœ¨å½“å‰ç›®å½•ä¸‹ã€‚
   - æ‰€ä»¥ï¼Œç”Ÿæˆçš„ Go æ–‡ä»¶å°†è¢«è¾“å‡ºåˆ°æ‰§è¡Œå‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•ã€‚

6. **`*.proto`**
   - `*.proto` æ˜¯ä½ è¦ç¼–è¯‘çš„ `.proto` æ–‡ä»¶çš„é€šé…ç¬¦ã€‚è¿™ä¸ªå‘½ä»¤ä¼šåŒ¹é…å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ `.proto` æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºè¾“å…¥ä¼ é€’ç»™ `protoc` ç¼–è¯‘å™¨ã€‚
   
### **æ€»ç»“**

- è¿™ä¸ªå‘½ä»¤ä¼šå°†å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ `.proto` æ–‡ä»¶ç¼–è¯‘æˆ Go ä»£ç ï¼Œå¹¶ä¸”ä¼šç”ŸæˆåŒ…å« gRPC å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°çš„ä»£ç ã€‚
- ç”Ÿæˆçš„ Go æ–‡ä»¶å°†è¢«æ”¾ç½®åœ¨å½“å‰ç›®å½•ä¸­ï¼Œå¹¶ä¸”è¿™äº›æ–‡ä»¶ä¼šè¢«åŒ…å«åœ¨ `mypackage` åŒ…ä¸­ã€‚

### **ç¤ºä¾‹ï¼š**

å‡è®¾ä½ æœ‰ä¸€ä¸ª `hello.proto` æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```proto
syntax = "proto3";

package hello;

service Greeter {
    rpc SayHello (HelloRequest) returns (HelloReply);
}

message HelloRequest {
    string name = 1;
}

message HelloReply {
    string message = 1;
}
```

è¿è¡Œå‘½ä»¤ï¼š

```bash
protoc --go_out=plugins=grpc,import_path=mypackage:. hello.proto
```

è¿™ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å« gRPC å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç çš„ Go æ–‡ä»¶ï¼Œç±»ä¼¼äºï¼š

- `hello.pb.go`ï¼šåŒ…æ‹¬ä¸æ¶ˆæ¯ç±»å‹å’Œ gRPC æœåŠ¡ç›¸å…³çš„ä»£ç ã€‚
- `hello_grpc.pb.go`ï¼šåŒ…æ‹¬ gRPC ç›¸å…³çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç ã€‚

è¿™æ ·ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ç”Ÿæˆçš„ Go ä»£ç æ¥å®ç°å’Œè°ƒç”¨ `Greeter` æœåŠ¡ã€‚

### **å¸¸è§é—®é¢˜ï¼š**
- **Go æ’ä»¶æœªå®‰è£…ï¼š**
  å¦‚æœä½ é‡åˆ° `protoc-gen-go: program not found or is not executable` é”™è¯¯ï¼Œæ„å‘³ç€ä½ æ²¡æœ‰å®‰è£… Go çš„æ’ä»¶ã€‚
  å®‰è£…å‘½ä»¤ï¼š
  ```bash
  go get google.golang.org/protobuf/cmd/protoc-gen-go
  ```

- **gRPC æ’ä»¶æœªå®‰è£…ï¼š**
  å¦‚æœæ²¡æœ‰å®‰è£… gRPC æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
  ```bash
  go get google.golang.org/grpc/cmd/protoc-gen-go-grpc
  ```
  
<br/>
**Grpcæ”¯æŒ**
å¦‚æœprotoæ–‡ä»¶æŒ‡å®šäº†RPCæœåŠ¡ï¼Œprotoc-gen-goå¯ä»¥ç”Ÿæˆä¸grpcç›¸å…¼å®¹çš„ä»£ç ï¼Œæˆ‘ä»¬ä»…éœ€è¦å°†plugins=grpcå‚æ•°ä¼ é€’ç»™--go_outï¼Œå°±å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„

```
protoc --go_out=plugins=grpc:. *.proto
```

<br/><br/><br/>
> <h2 id="ç®€å•Demoæµç¨‹">ç®€å•Demoæµç¨‹</h2>

**åˆå§‹åŒ–ç›®å½•**

```sh
grpc-hello-world/
â”œâ”€â”€ certs
â”œâ”€â”€ client
â”œâ”€â”€ cmd
â”œâ”€â”€ pkg
â”œâ”€â”€ proto
â”‚   â”œâ”€â”€ google
â”‚   â”‚   â””â”€â”€ api
â””â”€â”€ server
```
- certsï¼šè¯ä¹¦å‡­è¯
- clientï¼šå®¢æˆ·ç«¯
- cmdï¼šå‘½ä»¤è¡Œ
- pkgï¼šç¬¬ä¸‰æ–¹å…¬å…±æ¨¡å—
- protoï¼šprotobufçš„ä¸€äº›ç›¸å…³æ–‡ä»¶ï¼ˆå«.protoã€pb.goã€.pb.gw.go)ï¼Œgoogle/apiä¸­ç”¨äºå­˜æ”¾annotations.protoã€http.proto
- serverï¼šæœåŠ¡ç«¯

<br/><br/>

**åˆ¶ä½œè¯ä¹¦**
åœ¨æœåŠ¡ç«¯æ”¯æŒRpcå’ŒRestful Apiï¼Œéœ€è¦ç”¨åˆ°TLSï¼Œå› æ­¤æˆ‘ä»¬è¦å…ˆåˆ¶ä½œè¯ä¹¦

è¿›å…¥certsç›®å½•ï¼Œç”ŸæˆTLSæ‰€éœ€çš„å…¬é’¥å¯†é’¥æ–‡ä»¶

**ç§é’¥**

```sh
openssl genrsa -out server.key 2048

openssl ecparam -genkey -name secp384r1 -out server.key
```

- openssl genrsaï¼šç”ŸæˆRSAç§é’¥ï¼Œå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå°†æŒ‡å®šç”Ÿæˆå¯†é’¥çš„ä½æ•°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤512
- openssl ecparamï¼šç”ŸæˆECCç§é’¥ï¼Œå‘½ä»¤ä¸ºæ¤­åœ†æ›²çº¿å¯†é’¥å‚æ•°ç”ŸæˆåŠæ“ä½œï¼Œæœ¬æ–‡ä¸­ECCæ›²çº¿é€‰æ‹©çš„æ˜¯secp384r1

**è‡ªç­¾åå…¬é’¥**

```
openssl req -new -x509 -sha256 -key server.key -out server.pem -days 3650
```

openssl reqï¼šç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œ-newæŒ‡ç”Ÿæˆè¯ä¹¦è¯·æ±‚ã€-sha256æŒ‡ä½¿ç”¨sha256åŠ å¯†ã€-keyæŒ‡å®šç§é’¥æ–‡ä»¶ã€-x509æŒ‡è¾“å‡ºè¯ä¹¦ã€-days 3650ä¸ºæœ‰æ•ˆæœŸï¼Œæ­¤ååˆ™è¾“å…¥è¯ä¹¦æ‹¥æœ‰è€…ä¿¡æ¯

**å¡«å†™ä¿¡æ¯**

```sh
Country Name (2 letter code) [AU]:ShangHai
String too long, must be at most 2 bytes long
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:ShangHai
Locality Name (eg, city) []:ShangaHai
Organization Name (eg, company) [Internet Widgits Pty Ltd]:HuangGang
Organizational Unit Name (eg, section) []:HuangGang.dev.use 
Common Name (e.g. server FQDN or YOUR name) []:HuangGang_personalCertificate       
Email Address []:harleysor@qq.com 
```

<br/>

**æˆ–è€…ä½ ä¹Ÿå¯ä»¥è¿™æ ·åšï¼š**

æ˜¯çš„ï¼Œä½ å¯ä»¥ **ä¸åˆ›å»º `openssl.cnf` æ–‡ä»¶**ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `openssl` å‘½ä»¤æ¥ç”Ÿæˆ **å¸¦ `SAN`ï¼ˆSubject Alternative Nameï¼‰** çš„è¯ä¹¦ã€‚

 **ğŸš€ ç›´æ¥æ‰§è¡Œ OpenSSL å‘½ä»¤**

```sh
openssl req -x509 -nodes -newkey rsa:4096 -keyout server.key -out server.pem -days 365 \
-subj "/C=CN/ST=ShangHai/L=ShangHai/O=HuangGang/OU=HuangGang.dev.use/CN=dev" \
-addext "subjectAltName = DNS:dev, DNS:localhost, IP:127.0.0.1"
```
---

### **ğŸ›  å‚æ•°è§£æ**
1. **`-x509`**  â†’ ç”Ÿæˆè‡ªç­¾åè¯ä¹¦  
2. **`-nodes`**  â†’ ä¸åŠ å¯†ç§é’¥ï¼ˆæ— éœ€å¯†ç ï¼‰  
3. **`-newkey rsa:4096`**  â†’ ç”Ÿæˆ 4096-bit RSA ç§é’¥  
4. **`-keyout server.key`**  â†’ ç”Ÿæˆç§é’¥ `server.key`  
5. **`-out server.pem`**  â†’ ç”Ÿæˆè¯ä¹¦ `server.pem`  
6. **`-days 365`**  â†’ è¯ä¹¦æœ‰æ•ˆæœŸ 365 å¤©  
7. **`-subj`**  â†’ ç›´æ¥åœ¨å‘½ä»¤è¡Œè®¾ç½®è¯ä¹¦ä¿¡æ¯ï¼ˆé¿å…äº¤äº’è¾“å…¥ï¼‰  
8. **`-addext "subjectAltName = DNS:dev, DNS:localhost, IP:127.0.0.1"`**  
   - æ·»åŠ  `SAN`ï¼Œæ”¯æŒï¼š
     - `DNS:dev`
     - `DNS:localhost`
     - `IP:127.0.0.1`

---

### **âœ… è¿™æ ·ä½ ä¸éœ€è¦ `openssl.cnf`ï¼Œå°±èƒ½ç›´æ¥ç”Ÿæˆå¸¦ `SAN` çš„è¯ä¹¦ï¼**  
ç„¶åï¼Œä½ å¯ä»¥åœ¨ **Go gRPC å®¢æˆ·ç«¯** ä¸­è¿™æ ·ä½¿ç”¨ï¼š

```go
creds, err := credentials.NewClientTLSFromFile("server.pem", "dev")
```
ç¡®ä¿ `"dev"` è¿™ä¸ªåç§° **å’Œ `SAN` é‡Œçš„ `DNS:dev` åŒ¹é…**ï¼Œè¿™æ · TLS éªŒè¯å°±ä¸ä¼šå¤±è´¥äº†ï¼ ğŸš€

è¿™é‡Œçš„ "dev" éœ€è¦åŒ¹é…æœåŠ¡å™¨è¯ä¹¦çš„ CN æˆ– SANï¼Œå¦åˆ™ä¼šå¯¼è‡´ tls: failed to verify certificate é”™è¯¯ã€‚

âœ… æ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦çš„ CN å’Œ SANï¼š

```sh
openssl x509 -in ../certs/server.pem -text -noout | grep -E 'Subject:|DNS:'
```
å¦‚æœè¾“å‡ºç±»ä¼¼ï¼š

```pgsql
Subject: CN = myserver.local
X509v3 Subject Alternative Name:
    DNS:myserver.local, IP Address:127.0.0.1
```

<br/>

**server.pemè¯ä¹¦ä¿¡æ¯ï¼š**

```
openssl x509 -in ../certs/server.pem -text -noout | grep -E 'Subject:|DNS:'
  
// æˆ‘è‡ªå·±è¯ä¹¦ä¿¡æ¯
Subject: C=CN, ST=ShangHai, L=ShangaHai, O=HuangGang, OU=HuangGang.dev.use, CN=HuangGang_personalCertificate, emailAddress=harleysor@qq.com
```

<br/>

**client_server.pemè¯ä¹¦ä¿¡æ¯ï¼š**

```
openssl x509 -in ../certs/client_server.pem -text -noout | grep -E 'Subject:|DNS:'

Subject: C=CN, ST=ShangHai, L=ShangHai, O=HuangGang, OU=HuangGang.dev.use, CN=dev
        DNS:dev, DNS:localhost, IP Address:127.0.0.1
```



è¯´æ˜ è¯ä¹¦çš„ CN æˆ– SAN ä¸æ˜¯ devï¼Œä½ åº”è¯¥ä¿®æ”¹ client.goï¼š

```go
creds, err := credentials.NewClientTLSFromFile("../certs/server.pem", "myserver.local")
```
æˆ–è€…ï¼š

```go
creds, err := credentials.NewClientTLSFromFile("../certs/server.pem", "")
ï¼ˆ"" è¡¨ç¤ºä¸æ£€æŸ¥è¯ä¹¦çš„ CN/SANï¼Œä»…æ ¡éªŒè¯ä¹¦æ˜¯å¦å¯ä¿¡ï¼‰
```

<br/><br/>
> <h3 id="proto">proto</h3>
**annotations.protoæ–‡ä»¶ï¼š**

```proto
annotations.protoæ–‡ä»¶å¦‚ä¸‹ä»£ç 

syntax = "proto3";

package google.api;
option go_package = "github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor";


import "google/api/http.proto";
import "google/protobuf/descriptor.proto";

option java_multiple_files = true;
option java_outer_classname = "AnnotationsProto";
option java_package = "com.google.api";

extend google.protobuf.MethodOptions {
  // See `HttpRule`.
  HttpRule http = 72295728;
}
```

è¿™æ®µ Protobuf (`annotations.proto`) ä»£ç å®šä¹‰äº†ä¸€ä¸ª **protobuf æ‰©å±• (extension)**ï¼Œç”¨äºç»™ gRPC æ–¹æ³•æ·»åŠ  HTTP ç»‘å®šï¼Œä½¿å¾— gRPC æ–¹æ³•å¯ä»¥é€šè¿‡ RESTful API è¿›è¡Œè®¿é—®ã€‚ä¸‹é¢æ˜¯è¯¦ç»†è§£æï¼š

---

### **1. Protobuf ç‰ˆæœ¬**

```proto
syntax = "proto3";
```
è¿™è¡¨ç¤ºè¯¥æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ **Protocol Buffers v3 (proto3) è¯­æ³•**ï¼Œæ˜¯ç›®å‰ Google æ¨èçš„ç‰ˆæœ¬ã€‚

---

### **2. `package google.api;`**

```proto
package google.api;
```
- è¿™è¡¨ç¤ºè¯¥ `proto` æ–‡ä»¶å±äº `google.api` è¿™ä¸ªå‘½åç©ºé—´ã€‚
- é¿å…ä¸åŒ `proto` æ–‡ä»¶çš„æ¶ˆæ¯ç±»å‹ï¼ˆmessageï¼‰å’ŒæœåŠ¡ï¼ˆserviceï¼‰å†²çªã€‚

---

### **3. ä¾èµ–çš„ `proto` æ–‡ä»¶**

```proto
import "google/api/http.proto";
import "google/protobuf/descriptor.proto";
```
- `google/api/http.proto`
  - è¯¥æ–‡ä»¶å®šä¹‰äº† **`HttpRule`**ï¼Œç”¨äºæè¿° gRPC æ–¹æ³•å¦‚ä½•æ˜ å°„åˆ° HTTP è·¯ç”±ï¼ˆREST APIï¼‰ã€‚
  - `HttpRule` å…è®¸å°† gRPC æ–¹æ³•ç»‘å®šåˆ° `GET`ã€`POST` ç­‰ HTTP æ–¹æ³•ï¼Œä½¿å¾— gRPC æœåŠ¡å™¨å¯ä»¥ä½œä¸º RESTful API è®¿é—®ã€‚

- `google/protobuf/descriptor.proto`
  - è¯¥æ–‡ä»¶å®šä¹‰äº† **protobuf åå°„ (reflection) å’Œæ‰©å±•æœºåˆ¶**ï¼Œå…è®¸æˆ‘ä»¬æ‰©å±• protobuf è‡ªå¸¦çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š
    - æ‰©å±• `MethodOptions`ï¼Œç»™ RPC æ–¹æ³•å¢åŠ é¢å¤–çš„å…ƒä¿¡æ¯ï¼ˆmetadataï¼‰ã€‚

---

### **4. Java ç›¸å…³çš„ `option` é€‰é¡¹**

```proto
option java_multiple_files = true;
option java_outer_classname = "AnnotationsProto";
option java_package = "com.google.api";
```
- `java_multiple_files = true;`
  - ç”Ÿæˆ Java ä»£ç æ—¶ï¼Œ**æ¯ä¸ª `message` å’Œ `service` éƒ½ä¼šç”Ÿæˆç‹¬ç«‹çš„ Java ç±»**ï¼Œè€Œä¸æ˜¯å…¨éƒ¨åµŒå¥—åœ¨ä¸€ä¸ªç±»ä¸­ã€‚
  - è¿™æ ·å¯ä»¥æé«˜ Java ä»£ç çš„å¯è¯»æ€§å’Œç®¡ç†æ€§ã€‚

- `java_outer_classname = "AnnotationsProto";`
  - å¦‚æœ `java_multiple_files = false`ï¼Œåˆ™æ‰€æœ‰å®šä¹‰çš„ `message` å’Œ `service` ä¼šåµŒå¥—åœ¨ `AnnotationsProto` è¿™ä¸ªå¤–éƒ¨ç±»ä¸­ã€‚
  - ä½†è¿™é‡Œ `java_multiple_files = true`ï¼Œæ‰€ä»¥è¿™ä¸ª `option` å½±å“ä¸å¤§ã€‚

- `java_package = "com.google.api";`
  - ç”Ÿæˆçš„ Java ä»£ç ä¼šæ”¾åœ¨ `com.google.api` è¿™ä¸ª Java åŒ…ä¸‹ã€‚

---

### **5. `extend google.protobuf.MethodOptions` æ‰©å±• `MethodOptions`**

```proto
extend google.protobuf.MethodOptions {
  // See `HttpRule`.
  HttpRule http = 72295728;
}
```
è¿™ä¸€éƒ¨åˆ†æ˜¯ **protobuf çš„æ‰©å±• (extension) æœºåˆ¶**ï¼Œç”¨äºç»™ gRPC æ–¹æ³•çš„ `MethodOptions` æ·»åŠ  `http` é€‰é¡¹ï¼Œä½¿å¾— gRPC æ–¹æ³•å¯ä»¥é€šè¿‡ HTTP è®¿é—®ï¼š

- `extend google.protobuf.MethodOptions`ï¼š
  - `MethodOptions` æ˜¯ **protobuf è‡ªå¸¦çš„ RPC æ–¹æ³•å…ƒæ•°æ®**ï¼Œç”¨äºå­˜å‚¨ gRPC æ–¹æ³•çš„é¢å¤–ä¿¡æ¯ã€‚
  - `extend` å…³é”®å­—å…è®¸æˆ‘ä»¬**æ‰©å±•** `MethodOptions`ï¼Œå¢åŠ æ–°çš„å­—æ®µã€‚

- `HttpRule http = 72295728;`
  - è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª `HttpRule` ç±»å‹çš„ `http` å­—æ®µï¼Œå¹¶ä¸”å®ƒçš„**å”¯ä¸€æ ‡è¯†ç¬¦**ä¸º `72295728`ã€‚
  - è¿™ä¸ªå­—æ®µçš„ä½œç”¨æ˜¯ï¼š**å…è®¸ gRPC æ–¹æ³•æ˜ å°„åˆ° HTTP ç«¯ç‚¹ï¼ˆREST APIï¼‰**ã€‚

---

### **6. è¿™ä¸ªæ‰©å±•çš„ä½œç”¨**
è¿™ä¸ª `extend` è¯­å¥çš„ä½œç”¨æ˜¯**å…è®¸åœ¨ gRPC æ–¹æ³•ä¸Šå®šä¹‰ HTTP è§„åˆ™**ï¼Œä»¥æ”¯æŒ HTTP/REST è®¿é—®ã€‚

#### **ä½¿ç”¨ç¤ºä¾‹**
åœ¨å…¶ä»– `.proto` æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```proto
import "google/api/annotations.proto";
import "google/api/http.proto";

service MyService {
  rpc GetUserInfo (UserRequest) returns (UserResponse) {
    option (google.api.http) = {
      get: "/v1/user/{id}"
    };
  }
}
```
- `option (google.api.http) = { get: "/v1/user/{id}" }`
  - è¿™ä¸ª `option` ä½¿ç”¨äº† `annotations.proto` å®šä¹‰çš„ `http` æ‰©å±•ã€‚
  - ä½¿å¾— `GetUserInfo` è¿™ä¸ª gRPC æ–¹æ³•å¯ä»¥é€šè¿‡ **HTTP `GET /v1/user/{id}`** è®¿é—®ã€‚

**ç­‰æ•ˆäº REST APIï¼š**

```http
GET /v1/user/123
```
ä¼šè¢«è½¬æ¢ä¸º gRPC è°ƒç”¨ï¼š

```proto
rpc GetUserInfo(UserRequest) returns (UserResponse);
```

---

### **7. `72295728` è¿™ä¸ªæ•°å­—çš„æ„ä¹‰**
åœ¨ `protobuf` é‡Œï¼Œæ¯ä¸ªå­—æ®µéƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„ **æ ‡è¯†ç¬¦ (Tag Number)**ï¼Œå¦‚ï¼š

```proto
string name = 1;
int32 age = 2;
```
- è¿™é‡Œ `name` çš„ Tag æ˜¯ `1`ï¼Œ`age` çš„ Tag æ˜¯ `2`ã€‚

åœ¨ `extend google.protobuf.MethodOptions` é‡Œï¼š

```proto
HttpRule http = 72295728;
```
- `72295728` æ˜¯ **æ‰©å±•å­—æ®µçš„ Tag Number**ï¼Œç”¨äºå”¯ä¸€æ ‡è¯† `http` è¿™ä¸ªæ‰©å±•å­—æ®µã€‚
- Google é€‰æ‹©äº†ä¸€ä¸ª**é«˜ä½æ•°å­—**ï¼Œé¿å…ä¸ Protobuf å†…éƒ¨å­—æ®µå†²çªã€‚
- è¯¥ç¼–å·åœ¨ Google API è®¾è®¡æŒ‡å—é‡Œæ˜¯å›ºå®šçš„ï¼Œä¸è¦éšæ„æ›´æ”¹ã€‚

---

### **8. `HttpRule` ä½œç”¨**
`HttpRule`ï¼ˆåœ¨ `google/api/http.proto` ä¸­å®šä¹‰ï¼‰ç”¨äºæŒ‡å®š gRPC æ–¹æ³•å’Œ HTTP è¯·æ±‚ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š

```proto
message HttpRule {
  string get = 1;
  string post = 2;
  string put = 3;
  string delete = 4;
  ...
}
```
å› æ­¤ï¼Œåœ¨ `.proto` é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```proto
rpc CreateUser (UserRequest) returns (UserResponse) {
  option (google.api.http) = {
    post: "/v1/users"
    body: "*"
  };
}
```
è¿™æ„å‘³ç€ï¼š
- `CreateUser` æ–¹æ³•å¯ä»¥é€šè¿‡ **HTTP `POST /v1/users`** è®¿é—®ã€‚
- `body: "*"` è¡¨ç¤ºè¯·æ±‚çš„ body ä½œä¸º gRPC æ–¹æ³•çš„å‚æ•°ã€‚

---

### **æ€»ç»“**
1. **`extend google.protobuf.MethodOptions`** æ˜¯ Protobuf çš„æ‰©å±•æœºåˆ¶ï¼Œå…è®¸ä¸º gRPC æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰çš„ **HTTP ç»‘å®šé€‰é¡¹**ã€‚
2. `HttpRule` å…è®¸ gRPC æ–¹æ³•æ”¯æŒ RESTful API è°ƒç”¨ï¼Œä½¿å¾— gRPC æ–¹æ³•å¯ä»¥é€šè¿‡ HTTPï¼ˆ`GET`ã€`POST`ã€`PUT`ã€`DELETE`ï¼‰è®¿é—®ã€‚
3. `option (google.api.http)` è¯­æ³•ç”¨äºåœ¨ `.proto` æ–‡ä»¶ä¸­å¯ç”¨ HTTP ç»‘å®šã€‚
4. `72295728` æ˜¯ Google é¢„ç•™çš„ **å”¯ä¸€æ ‡è¯†ç¬¦ (Tag Number)**ï¼Œè¡¨ç¤º `http` è¿™ä¸ªæ‰©å±•å­—æ®µã€‚
5. åœ¨ **Google API è®¾è®¡è§„èŒƒ** é‡Œï¼Œ`annotations.proto` ä¸»è¦ç”¨äº `gRPC-Gateway`ï¼Œä½¿ gRPC æ–¹æ³•å¯ä»¥é€šè¿‡ REST è®¿é—®ã€‚

---

### **å®æˆ˜æ„ä¹‰**
- **å¦‚æœä½ ä½¿ç”¨ gRPC**ï¼Œä½†æƒ³è®©å®¢æˆ·ç«¯ç”¨ REST API è®¿é—®ï¼Œä½ å¯ä»¥ä½¿ç”¨ `google.api.http` é€‰é¡¹ã€‚
- **å¦‚æœä½ åœ¨å†™ Protobuf API**ï¼Œä½†å¸Œæœ›æ”¯æŒ `gRPC-Gateway`ï¼Œ`annotations.proto` æ˜¯å¿…ä¸å¯å°‘çš„ã€‚

---

è¿™ä¸ª `annotations.proto` æ˜¯ Google API è®¾è®¡ä¸­çš„å…³é”®éƒ¨åˆ†ï¼Œä½¿å¾— **gRPC å’Œ REST API å¯ä»¥æ— ç¼ç»“åˆ**ï¼Œåœ¨ Google Cloud å’Œå…¶ä»–å¾®æœåŠ¡æ¶æ„ä¸­å¹¿æ³›ä½¿ç”¨ã€‚

<br/><br/>

**http.protoæ–‡ä»¶ï¼š**

```proto
syntax = "proto3";

package google.api;
option go_package = "github.com/golang/protobuf/protoc-gen-go/descriptor;descriptor";

option cc_enable_arenas = true;
option java_multiple_files = true;
option java_outer_classname = "HttpProto";
option java_package = "com.google.api";

message HttpRule {
  // Selects methods to which this rule applies.
  //
  // Refer to [selector][google.api.DocumentationRule.selector] for syntax details.
  string selector = 1;

  // Determines the URL pattern is matched by this rules. This pattern can be
  // used with any of the {get|put|post|delete|patch} methods. A custom method
  // can be defined using the 'custom' field.
  oneof pattern {
    // Used for listing and getting information about resources.
    string get = 2;

    // Used for updating a resource.
    string put = 3;

    // Used for creating a resource.
    string post = 4;

    // Used for deleting a resource.
    string delete = 5;

    // Used for updating a resource.
    string patch = 6;

    // Custom pattern is used for defining custom verbs.
    CustomHttpPattern custom = 8;
  }

  // The name of the request field whose value is mapped to the HTTP body, or
  // `*` for mapping all fields not captured by the path pattern to the HTTP
  // body. NOTE: the referred field must not be a repeated field.
  string body = 7;

  // Additional HTTP bindings for the selector. Nested bindings must
  // not contain an `additional_bindings` field themselves (that is,
  // the nesting may only be one level deep).
  repeated HttpRule additional_bindings = 11;
}

// A custom pattern is used for defining custom HTTP verb.
message CustomHttpPattern {
  // The name of this custom HTTP verb.
  string kind = 1;

  // The path matched by this custom verb.
  string path = 2;
}
```

`http.proto` ä¸»è¦å®šä¹‰äº† **gRPC æ–¹æ³•ä¸ HTTP API ä¹‹é—´çš„æ˜ å°„è§„åˆ™**ï¼Œæ ¸å¿ƒæ˜¯ `HttpRule` è¿™ä¸ªæ¶ˆæ¯ï¼ˆmessageï¼‰ï¼Œå®ƒå…è®¸æˆ‘ä»¬æŠŠ gRPC æ–¹æ³•æ˜ å°„åˆ° RESTful APIï¼Œå¦‚ `GET`ã€`POST`ã€`PUT` ç­‰ HTTP æ–¹æ³•ã€‚  

---

## **1. å¤´éƒ¨é€‰é¡¹ (`option`)**

```proto
option cc_enable_arenas = true;
option java_multiple_files = true;
option java_outer_classname = "HttpProto";
option java_package = "com.google.api";
```
è¿™äº›é€‰é¡¹ç”¨äºæ§åˆ¶ä»£ç ç”Ÿæˆï¼š

- `cc_enable_arenas = true;`
  - **C++ ç›¸å…³ä¼˜åŒ–**ï¼Œå¯ç”¨ **Arena Allocation** æœºåˆ¶ï¼Œæé«˜å¯¹è±¡çš„å†…å­˜ç®¡ç†æ•ˆç‡ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œå›æ”¶çš„å¼€é”€ã€‚

- `java_multiple_files = true;`
  - ç”Ÿæˆçš„ Java ä»£ç ä¼šä¸º `HttpRule`ã€`CustomHttpPattern` ç­‰æ¯ä¸ª message å•ç‹¬åˆ›å»ºä¸€ä¸ª `.java` æ–‡ä»¶ï¼Œè€Œä¸æ˜¯å…¨éƒ¨åµŒå¥—åœ¨ `HttpProto` è¿™ä¸ªç±»é‡Œã€‚

- `java_outer_classname = "HttpProto";`
  - è®¾å®š Java ä»£ç çš„å¤–éƒ¨ç±»åä¸º `HttpProto`ï¼ˆå¦‚æœ `java_multiple_files = false`ï¼‰ã€‚

- `java_package = "com.google.api";`
  - ç”Ÿæˆçš„ Java ä»£ç æ”¾åœ¨ `com.google.api` è¿™ä¸ª Java åŒ…ä¸‹ã€‚

---

## **2. `HttpRule` ç»“æ„**

```proto
message HttpRule {
  string selector = 1;

  oneof pattern {
    string get = 2;
    string put = 3;
    string post = 4;
    string delete = 5;
    string patch = 6;
    CustomHttpPattern custom = 8;
  }

  string body = 7;

  repeated HttpRule additional_bindings = 11;
}
```
`HttpRule` ä¸»è¦ç”¨äº**å°† gRPC æ–¹æ³•æ˜ å°„åˆ° HTTP ç«¯ç‚¹**ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

### **(1) `selector`**

```proto
string selector = 1;
```
- `selector` æŒ‡å®šè¦åº”ç”¨ HTTP è§„åˆ™çš„ **gRPC æ–¹æ³•**ï¼Œå…¶å€¼æ˜¯ `package.service/method` å½¢å¼ã€‚
- ä¾‹å¦‚ï¼š

```proto
selector = "my.package.MyService.GetUserInfo";
```

### **(2) `pattern` (HTTP æ–¹æ³•ç»‘å®š)**

```proto
oneof pattern {
  string get = 2;
  string put = 3;
  string post = 4;
  string delete = 5;
  string patch = 6;
  CustomHttpPattern custom = 8;
}
```
- è¿™æ˜¯ **`oneof` å­—æ®µ**ï¼Œå³**åŒä¸€æ—¶é—´åªèƒ½é€‰å…¶ä¸­ä¸€ä¸ª**ã€‚
- å…è®¸ gRPC æ–¹æ³•æ˜ å°„åˆ°æ ‡å‡† HTTP æ–¹æ³•ï¼š
  - `get = 2;`  â†’ HTTP `GET` è¯·æ±‚
  - `put = 3;`  â†’ HTTP `PUT` è¯·æ±‚
  - `post = 4;` â†’ HTTP `POST` è¯·æ±‚
  - `delete = 5;` â†’ HTTP `DELETE` è¯·æ±‚
  - `patch = 6;` â†’ HTTP `PATCH` è¯·æ±‚
  - `custom = 8;` â†’ **è‡ªå®šä¹‰ HTTP æ–¹æ³•**ï¼ˆå¦‚ `OPTIONS`ï¼‰

#### **ç¤ºä¾‹**

```proto
rpc GetUser (GetUserRequest) returns (User) {
  option (google.api.http) = {
    get: "/v1/user/{id}"
  };
}
```
è¿™é‡Œçš„ `get: "/v1/user/{id}"` è¡¨ç¤ºï¼š
- gRPC æ–¹æ³• `GetUser` å¯ä»¥é€šè¿‡ HTTP `GET /v1/user/123` è®¿é—®ï¼Œå¹¶å°† `{id}` ç»‘å®šåˆ° `GetUserRequest` å‚æ•°ã€‚

---

### **(3) `body` (HTTP è¯·æ±‚ä½“ç»‘å®š)**

```proto
string body = 7;
```
- æŒ‡å®šå“ªä¸ªè¯·æ±‚å­—æ®µæ˜ å°„åˆ° HTTP `body` ä¸­ã€‚
- ç‰¹æ®Šå€¼ï¼š
  - `"*"` â†’ **å…¨éƒ¨å­—æ®µ** ä½œä¸º `body`
  - `""`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰â†’ **ä¸æ˜ å°„ `body`**ï¼Œå‚æ•°éœ€é€šè¿‡ URL æŸ¥è¯¢å‚æ•°ä¼ é€’ã€‚

#### **ç¤ºä¾‹**

```proto
rpc CreateUser (CreateUserRequest) returns (User) {
  option (google.api.http) = {
    post: "/v1/users"
    body: "*"
  };
}
```
ç­‰æ•ˆäº REST APIï¼š

```http
POST /v1/users
Content-Type: application/json

{
  "name": "Alice",
  "age": 25
}
```
- `body: "*"` è®©æ•´ä¸ª `CreateUserRequest` ä½œä¸º HTTP `body` ä¼ é€’ã€‚

å¦‚æœ `body: "user"`ï¼š

```proto
message CreateUserRequest {
  User user = 1;
}
```
åˆ™ HTTP `body` å˜æˆï¼š

```json
{
  "user": {
    "name": "Alice",
    "age": 25
  }
}
```

---

### **(4) `additional_bindings` (é¢å¤–çš„ HTTP è§„åˆ™)**

```proto
repeated HttpRule additional_bindings = 11;
```
- å…è®¸ä¸€ä¸ª gRPC æ–¹æ³•æœ‰ **å¤šä¸ª HTTP ç»‘å®š**ï¼ˆæ¯”å¦‚æ—¢æ”¯æŒ `GET` ä¹Ÿæ”¯æŒ `POST`ï¼‰ã€‚
- ä½†**ä¸èƒ½åµŒå¥—å¤šå±‚**ï¼ˆå³ `additional_bindings` ä¸èƒ½å†åŒ…å« `additional_bindings`ï¼‰ã€‚

#### **ç¤ºä¾‹**

```proto
rpc GetUser (GetUserRequest) returns (User) {
  option (google.api.http) = {
    get: "/v1/user/{id}"
    additional_bindings {
      post: "/v1/user"
      body: "*"
    }
  };
}
```
ç­‰æ•ˆäºï¼š
- `GET /v1/user/123` â†’ é€šè¿‡ URL æŸ¥è¯¢å‚æ•°ä¼ é€’ `id`
- `POST /v1/user` + `body: "*"` â†’ é€šè¿‡ `body` ä¼ é€’ `id`

---

## **3. `CustomHttpPattern` ç»“æ„**

```proto
message CustomHttpPattern {
  string kind = 1;
  string path = 2;
}
```
- å…è®¸ä½¿ç”¨è‡ªå®šä¹‰çš„ HTTP æ–¹æ³•ï¼ˆå¦‚ `OPTIONS`ã€`HEAD`ï¼‰ã€‚
- `kind`ï¼šè‡ªå®šä¹‰ HTTP æ–¹æ³•çš„åç§°ï¼Œå¦‚ `OPTIONS`ã€‚
- `path`ï¼šHTTP ç«¯ç‚¹ã€‚

#### **ç¤ºä¾‹**

```proto
rpc CustomOptions (Empty) returns (Empty) {
  option (google.api.http) = {
    custom {
      kind: "OPTIONS"
      path: "/v1/custom"
    }
  };
}
```
ç­‰æ•ˆäºï¼š

```http
OPTIONS /v1/custom
```

---

## **æ€»ç»“**
1. **`HttpRule` ä½œç”¨**
   - å…è®¸ gRPC æ–¹æ³•æ˜ å°„åˆ° HTTP APIï¼Œä½¿ gRPC å¯é€šè¿‡ RESTful API è®¿é—®ã€‚
   - `get`ã€`post`ã€`put`ã€`delete`ã€`patch` å®šä¹‰ HTTP æ–¹æ³•ç»‘å®šã€‚
   - `body` å†³å®šè¯·æ±‚å‚æ•°æ˜¯å¦æ”¾å…¥ `body`ï¼ˆé»˜è®¤æ”¾ URL æŸ¥è¯¢å‚æ•°ï¼‰ã€‚
   - `additional_bindings` å…è®¸ä¸€ä¸ª gRPC æ–¹æ³•æ”¯æŒå¤šç§ HTTP æ˜ å°„ã€‚
   - `custom` å…è®¸å®šä¹‰è‡ªå®šä¹‰ HTTP æ–¹æ³•ï¼ˆå¦‚ `OPTIONS`ï¼‰ã€‚

2. **ç¤ºä¾‹**

```proto
rpc CreateUser (CreateUserRequest) returns (User) {
 option (google.api.http) = {
   post: "/v1/users"
   body: "*"
 };
}
```
   - gRPC æ–¹æ³• `CreateUser` â†’ `POST /v1/users`
   - `body: "*"` è¡¨ç¤ºæ•´ä¸ªè¯·æ±‚ä½“ä½œä¸º HTTP `body`ã€‚

3. **ä¸ `annotations.proto` ç»“åˆ**
   - `annotations.proto` é€šè¿‡ `extend MethodOptions` **æŠŠ `HttpRule` ç»‘å®šåˆ° gRPC æ–¹æ³•**ã€‚
   - è®© `gRPC-Gateway` **è‡ªåŠ¨è½¬å‘** RESTful API è°ƒç”¨åˆ° gRPC æœåŠ¡ã€‚

---

è¿™å°±æ˜¯ `http.proto` çš„æ ¸å¿ƒï¼Œå®ƒæ˜¯ `gRPC-Gateway` å’Œ Google Cloud API çš„å…³é”®ç»„ä»¶ï¼Œä½¿ gRPC æ—¢èƒ½æ”¯æŒé«˜æ•ˆçš„ RPCï¼Œåˆèƒ½å…¼å®¹ RESTful API ğŸš€

<br/><br/>
> <h3 id="protoç¼–è¯‘æˆgoä»£ç ">protoç¼–è¯‘æˆgoä»£ç </h3>

```sh
# ç¼–è¯‘google.api
# é¦–å…ˆcdåˆ°protoç›®å½•
ganghuang@GangHuangs-MacBook-Pro proto% cd MLC_GO/TestNotes/PracticeGRPCExample/proto 
protoc -I . \
--go_out=Mgoogle/api/http.proto=github.com/golang/protobuf/protoc-gen-go/descriptor:. \
--go-grpc_out=Mgoogle/api/http.proto=github.com/golang/protobuf/protoc-gen-go/descriptor:. \
google/api/*.proto

# ç¼–è¯‘hello_http.protoä¸ºhello_http.pb.proto
ganghuang@GangHuangs-MacBook-Pro proto % protoc -I . \
--go_out=Mgoogle/api/annotations.proto=grpc-hello-world/proto/google/api,\
Mhello.proto=github.com/your-username/your-repo/grpc-hello-world/proto:. \
--go-grpc_out=Mgoogle/api/annotations.proto=grpc-hello-world/proto/google/api,\
Mhello.proto=github.com/your-username/your-repo/grpc-hello-world/proto:. \
./hello.proto

# ç¼–è¯‘hello_http.protoä¸ºhello_http.pb.gw.proto
protoc -I . -I ./third_party/googleapis \
--grpc-gateway_out=logtostderr=true,\
Mhello.proto=github.com/your-username/your-repo/grpc-hello-world/proto,\
Mgoogle/api/annotations.proto=github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis/google/api:. \
./hello.proto
```
æ‰§è¡Œå®Œæ¯•åå°†ç”Ÿæˆhello.pb.goå’Œhello.gw.pb.goï¼Œåˆ†åˆ«é’ˆå¯¹grpcå’Œgrpc-gatewayçš„åŠŸèƒ½æ”¯æŒ

![go.0.0.84.png](./../Pictures/go.0.0.84.png)


<br/><br/>
> <h3 id="å‘½ä»¤è¡Œæ¨¡å—cmd">å‘½ä»¤è¡Œæ¨¡å—cmd</h3>

è¿™ä¸€å°èŠ‚æˆ‘ä»¬ç¼–å†™å‘½ä»¤è¡Œæ¨¡å—ï¼Œä¸ºä»€ä¹ˆè¦ç‹¬ç«‹å‡ºæ¥å‘¢ï¼Œæ˜¯ä¸ºäº†å°†cmdå’Œserverä¸¤è€…è§£è€¦ï¼Œé¿å…æ··æ·†åœ¨ä¸€èµ·ã€‚

- æˆ‘ä»¬é‡‡ç”¨ [Cobra](#CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰Cobraåº“) æ¥å®Œæˆè¿™é¡¹åŠŸèƒ½ï¼ŒCobraæ—¢æ˜¯åˆ›å»ºå¼ºå¤§çš„ç°ä»£CLIåº”ç”¨ç¨‹åºçš„åº“ï¼Œä¹Ÿæ˜¯ç”Ÿæˆåº”ç”¨ç¨‹åºå’Œå‘½ä»¤æ–‡ä»¶çš„ç¨‹åºã€‚æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
	- ç®€æ˜“çš„å­å‘½ä»¤è¡Œæ¨¡å¼
	- å®Œå…¨å…¼å®¹posixçš„å‘½ä»¤è¡Œæ¨¡å¼(åŒ…æ‹¬çŸ­å’Œé•¿ç‰ˆæœ¬)
	- åµŒå¥—çš„å­å‘½ä»¤
	- å…¨å±€ã€æœ¬åœ°å’Œçº§è”flags
	- ä½¿ç”¨Cobraå¾ˆå®¹æ˜“çš„ç”Ÿæˆåº”ç”¨ç¨‹åºå’Œå‘½ä»¤ï¼Œä½¿ç”¨cobra create appnameå’Œcobra add cmdname
	- æ™ºèƒ½æç¤º
	- è‡ªåŠ¨ç”Ÿæˆcommandså’Œflagsçš„å¸®åŠ©ä¿¡æ¯
	- è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„helpä¿¡æ¯-hï¼Œ--helpç­‰ç­‰
	- è‡ªåŠ¨ç”Ÿæˆçš„bashè‡ªåŠ¨å®ŒæˆåŠŸèƒ½
	- ä¸ºåº”ç”¨ç¨‹åºè‡ªåŠ¨ç”Ÿæˆæ‰‹å†Œ
	- å‘½ä»¤åˆ«å
	- å®šä¹‰æ‚¨è‡ªå·±çš„å¸®åŠ©ã€ç”¨æ³•ç­‰çš„çµæ´»æ€§ã€‚
	- å¯é€‰ä¸viperç´§å¯†é›†æˆçš„apps


<br/><br/><br/>

***
<br/>

> <h1 id="CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰Cobraåº“">CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰Cobraåº“</h1>
Cobra æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¼ºå¤§ CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰

**Cobra æ˜¯ä»€ä¹ˆï¼Ÿ**
**Cobra** æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¼ºå¤§ CLIï¼ˆå‘½ä»¤è¡Œç•Œé¢ï¼‰åº”ç”¨çš„ Go è¯­è¨€åº“ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ **ç»„ç»‡å‘½ä»¤è¡Œç¨‹åºçš„ç»“æ„**ï¼Œå¹¶ä¸”**æ”¯æŒå­å‘½ä»¤ã€è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ã€flagï¼ˆæ ‡å¿—ï¼‰ã€å‘½ä»¤è¡¥å…¨ç­‰åŠŸèƒ½**ã€‚

Cobra ç”± **spf13**ï¼ˆGo ç”Ÿæ€ä¸­è‘—åçš„å¼€å‘è€…ï¼‰å¼€å‘ï¼Œå¹¿æ³›ç”¨äº Kubernetesã€Hugoã€Docker ç­‰çŸ¥åé¡¹ç›®çš„ CLI ç»„ä»¶ã€‚

---

**ä¸ºä»€ä¹ˆä½¿ç”¨ Cobraï¼Ÿ**
åœ¨ Go ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `flag` åŒ…æ¥è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œä½†å¦‚æœç¨‹åºæœ‰å¤šä¸ªå­å‘½ä»¤ï¼ˆå¦‚ `git clone`ã€`git push`ï¼‰ï¼Œä½¿ç”¨ `flag` ä¼šè®©ä»£ç å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚**Cobra æä¾›äº†ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥ç»„ç»‡ CLI ç»“æ„**ã€‚

- **Cobra çš„æ ¸å¿ƒåŠŸèƒ½**
	- âœ… **æ”¯æŒåµŒå¥—å­å‘½ä»¤**ï¼ˆå¦‚ `kubectl get pods`ï¼‰  
	- âœ… **è‡ªåŠ¨ç”Ÿæˆ CLI å¸®åŠ©æ–‡æ¡£**ï¼ˆ`myapp help`ï¼‰  
	- âœ… **æ”¯æŒ flagï¼ˆæ ‡å¿—ï¼‰ç®¡ç†**ï¼ˆ`myapp run --port=8080`ï¼‰  
	- âœ… **æ”¯æŒ Bash/Zsh/Fish ç»ˆç«¯è‡ªåŠ¨è¡¥å…¨**  
	- âœ… **ä¸ Viper åº“å…¼å®¹ï¼Œå¯ç”¨äºè§£æé…ç½®æ–‡ä»¶**  

---

- **å¦‚ä½•å®‰è£… Cobra**
åœ¨ä½ çš„ Go é¡¹ç›®ä¸­æ‰§è¡Œï¼š

```sh
go get -u github.com/spf13/cobra@latest
go get -u github.com/spf13/cobra/cobra@latest
```

å¦‚æœæƒ³è¦ç”¨ Cobra ç”Ÿæˆé¡¹ç›®éª¨æ¶ï¼š

```sh
go install github.com/spf13/cobra-cli@latest
```

ç„¶åä½¿ç”¨ï¼š

```sh
cobra-cli init myapp
cd myapp
cobra-cli add server  # æ·»åŠ ä¸€ä¸ªå­å‘½ä»¤
cobra-cli add client
```
è¿™ä¼šåœ¨ `cmd/` ç›®å½•ä¸‹ç”Ÿæˆ `server.go` å’Œ `client.go`ã€‚

---

- **Cobra ä»£ç ç¤ºä¾‹**
	- **1. åˆ›å»º CLI å…¥å£**
åœ¨ `main.go` é‡Œï¼š

```go
package main

import (
	"fmt"
	"os"
	"github.com/spf13/cobra"
)

func main() {
	var rootCmd = &cobra.Command{
		Use:   "myapp",
		Short: "MyApp æ˜¯ä¸€ä¸ªç¤ºä¾‹ CLI",
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Println("Hello from MyApp!")
		},
	}

	if err := rootCmd.Execute(); err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
}
```
è¿è¡Œï¼š

```sh
go run main.go
```
è¾“å‡ºï¼š

```sh
Hello from MyApp!
```

---

- **2. æ·»åŠ å­å‘½ä»¤**
æˆ‘ä»¬åˆ›å»º `cmd/server.go` ä½œä¸º `server` å­å‘½ä»¤ï¼š

```go
package cmd

import (
	"fmt"
	"github.com/spf13/cobra"
)

// åˆ›å»º server å‘½ä»¤
var serverCmd = &cobra.Command{
	Use:   "server",
	Short: "å¯åŠ¨æœåŠ¡å™¨",
	Run: func(cmd *cobra.Command, args []string) {
		fmt.Println("æœåŠ¡å™¨å¯åŠ¨ä¸­...")
	},
}

// åˆå§‹åŒ–å¹¶æ³¨å†Œå‘½ä»¤
func init() {
	rootCmd.AddCommand(serverCmd)
}
```

åœ¨ `main.go` é‡Œå¼•å…¥ï¼š

```go
package main

import (
	"myapp/cmd"
)

func main() {
	cmd.Execute()
}
```
è¿è¡Œï¼š

```sh
go run main.go server
```
è¾“å‡ºï¼š

```sh
æœåŠ¡å™¨å¯åŠ¨ä¸­...
```

---

## **æ€»ç»“**
Cobra è®© CLI ä»£ç æ›´åŠ æ¸…æ™°ã€æ¨¡å—åŒ–ï¼Œå¹¶ä¸”æ”¯æŒï¼š
- **å­å‘½ä»¤ç®¡ç†**
- **è‡ªåŠ¨è¡¥å…¨**
- **Flagï¼ˆé€‰é¡¹å‚æ•°ï¼‰**
- **è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£**

**é€‚ç”¨äºï¼š**
- `kubectl`ã€`docker`ã€`git` è¿™ç§**å¤šå­å‘½ä»¤å·¥å…·**
- **å¾®æœåŠ¡é¡¹ç›®çš„å‘½ä»¤è¡Œç®¡ç†å·¥å…·**
- **ä»»åŠ¡è„šæœ¬ & è‡ªåŠ¨åŒ–å·¥å…·**

åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ Cobraï¼Œå¯ä»¥æŠŠ `cmd`ï¼ˆå‘½ä»¤è¡Œå¤„ç†ï¼‰å’Œ `server`ï¼ˆæœåŠ¡é€»è¾‘ï¼‰è§£è€¦ï¼Œä¿æŒä»£ç ç»“æ„æ¸…æ™°ï¼Œæ–¹ä¾¿æ‰©å±• ğŸš€ã€‚


<br/>

***
<br/><br/><br/>

> <h1 id="go-collyæ¡†æ¶">go-collyæ¡†æ¶</h1>

go-collyæ˜¯ä½¿ç”¨Goè¯­è¨€å®ç°çš„ç½‘ç»œçˆ¬è™«æ¡†æ¶ã€‚go-collyä»¥å›è°ƒå‡½æ•°çš„å½¢å¼æä¾›äº†ä¸€ç»„æ¥å£ï¼Œé€šè¿‡è¿™äº›æ¥å£èƒ½å¤Ÿå®ç°ä»»æ„ç±»å‹çš„çˆ¬è™«ã€‚å¼€å‘è€…ä½¿ç”¨go-collyæ¡†æ¶å¯ä»¥è½»æ¾åœ°ä»Webé¡µé¢ä¸­çˆ¬å–ç»“æ„åŒ–æ•°æ®ã€‚

<br/>
**é€šè¿‡å¦‚ä¸‹å‘½ä»¤ä¸‹è½½åˆ°é¡¹ç›®ä¸­ï¼š**

```
cd cd /Users/ganghuang/HGFiles/GitHub/GoProject/MLC_GO
go get -u github.com/gocolly/colly/...
```

<br/><br/>
> <h2 id="go-collyæ¡†æ¶çš„ç‰¹æ€§">go-collyæ¡†æ¶çš„ç‰¹æ€§</h2>
- **go-collyæ¡†æ¶å…·æœ‰å¦‚ä¸‹ç‰¹æ€§ã€‚**
	- æ¸…æ™°çš„APIã€‚å¿«é€Ÿï¼ˆå•æ ¸>1kè¯·æ±‚/sï¼‰â€‹ã€‚
	- ç®¡ç†æ¯ä¸ªåŸŸçš„è¯·æ±‚å»¶è¿Ÿå’Œæœ€å¤§å¹¶å‘æ€§ã€‚
	- è‡ªåŠ¨cookieå’Œä¼šè¯å¤„ç†ã€‚
	- åŒæ­¥ï¼å¼‚æ­¥ï¼å¹¶è¡ŒæŠ“å–ã€‚é«˜é€Ÿç¼“å­˜ã€‚
	- è‡ªåŠ¨å¤„ç†éUnicodeçš„ç¼–ç ã€‚
	- æ”¯æŒRobots.txtå®šåˆ¶Agentä¿¡æ¯ã€‚
	- å®šåˆ¶æŠ“å–é¢‘æ¬¡ã€‚

<br/><br/><br/>
> <h2 id="go-collyæ¡†æ¶ä½¿ç”¨">go-collyæ¡†æ¶ä½¿ç”¨</h2>
**å¯¼å…¥æ¡†æ¶**

```go
import "github.com/gocolly/colly"
```
<br/>

&emsp; ä½¿ç”¨go-collyæ¡†æ¶çš„å…³é”®æ˜¯åˆ›å»ºCollectorå¯¹è±¡ï¼ˆå³â€œæ”¶é›†å™¨â€â€‹ï¼‰â€‹ï¼Œè¯¥å¯¹è±¡çš„ä½œç”¨æ˜¯ç®¡ç†ç½‘ç»œé€šä¿¡ï¼Œå¹¶è´Ÿè´£åœ¨æ”¶é›†ä»»åŠ¡è¿è¡Œæ—¶æ‰§è¡Œé™„åŠ çš„å›è°ƒå‡½æ•°ã€‚é€šè¿‡è°ƒç”¨collyåº“ä¸­çš„NewCollector()å‡½æ•°ï¼Œå³å¯åˆ›å»ºCollectorå¯¹è±¡ã€‚å…¶è¯­æ³•æ ¼å¼å¦‚ä¸‹ã€‚

```go
colly.NewCollector()
```
<br/>

![go.0.0.55.png](./../Pictures/go.0.0.55.png)

- **è¿™äº›å›è°ƒå‡½æ•°åœ¨æ”¶é›†ä»»åŠ¡è¿è¡Œæ—¶è¢«æœ‰åºè°ƒç”¨ï¼Œè°ƒç”¨é¡ºåºå¦‚ä¸‹ã€‚**
	- OnRequest()å‡½æ•°åœ¨è¯·æ±‚å‘å‡ºå‰è¢«è°ƒç”¨ã€‚
	- OnError()å‡½æ•°åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ã€‚
	- OnResponse()å‡½æ•°åœ¨æ”¶åˆ°å“åº”åè¢«è°ƒç”¨ã€‚
		- å¦‚æœå“åº”æ¶ˆæ¯çš„å†…å®¹æ˜¯HTMLï¼Œåˆ™åœ¨OnResponse()å‡½æ•°æ‰§è¡Œå®Œæ¯•åè°ƒç”¨OnHTML()å‡½æ•°ã€‚
		- å¦‚æœå“åº”æ¶ˆæ¯çš„å†…å®¹æ˜¯HTMLæˆ–XMLï¼Œåˆ™åœ¨OnHTML()å‡½æ•°æ‰§è¡Œå®Œæ¯•åè°ƒç”¨OnXML()å‡½æ•°ã€‚
		- OnXML()å‡½æ•°æ‰§è¡Œå®Œæ¯•åè°ƒç”¨OnScraped()å‡½æ•°ã€‚

<br/><br/>
è¿è¡Œç¨‹åºåï¼Œç¨‹åºæ ¹æ®http://news.baidu.comå¼€å§‹æŠ“å–é¡µé¢ç»“æœã€‚é€šè¿‡å›è°ƒå‡½æ•°OnHTML()ï¼Œèƒ½å¤Ÿåˆ†æé¡µé¢ä¸­çš„æ–°é—»æ ‡é¢˜åŠå…¶é“¾æ¥ã€‚ä»£ç å¦‚ä¸‹:

```go
package main

import (
	"fmt"

	"github.com/gocolly/colly"
)

func main() {
	// æ ¹æ®http://news.baidu.comå¼€å§‹æŠ“å–é¡µé¢ç»“æœ
	testCrawlerBaidu()
}

/// çˆ¬è™«ç™¾åº¦ç½‘é¡µ
func testCrawlerBaidu(){
	c := colly.NewCollector(
		// colly.AllowedDomains("news.baidu.com"),
		colly.UserAgent("Opera/9.80(Windows NT 6.1; U; zh-cn) Presto/2.9.168 Version/11.50"))
	// å‘å‡ºè¯·æ±‚æ—¶å‘ Collector å¯¹è±¡é™„åŠ çš„å›è°ƒå‡½æ•°
	c.OnRequest(func(r *colly.Request){
		// è®¾ç½®è¯·æ±‚å¤´
		r.Headers.Set("Host", "baidu.com")
		r.Headers.Set("Connection", "keep-alive")
		r.Headers.Set("Accept", "*/*")
		r.Headers.Set("Origin", "")
		r.Headers.Set("Referer", "http://www.baidu.com")
		r.Headers.Set("Accept-Encoding", "gzip, deflate")
		r.Headers.Set("Accept-Language", "zh-CN, zh;q=0.9")
		fmt.Println("æ­£åœ¨è®¿é—®ï¼š", r.URL)
	})

	// å¤„ç†HTMLä¸­çš„æ–‡æ¡£æ ‡é¢˜
	c.OnHTML("title", func (e *colly.HTMLElement)  {
		fmt.Println("æ–‡æ¡£æ ‡é¢˜ï¼š", e.Text)
	})

	// å¤„ç†HTMLä¸­çš„æ–‡æ¡£å†…å®¹
	c.OnHTML("body", func (e *colly.HTMLElement)  {
		e.ForEach(".hotnews a", func (i int, el *colly.HTMLElement)  {
			band := el.Attr("href")
			title := el.Text
			fmt.Printf("æ–‡æ¡£å†…å®¹ %d: %s\n%s\n", i+1, title, band)
		})
	})

	// è·å–æ”¶åˆ°çš„å“åº”å†…å®¹çš„æ•°é‡
	c.OnResponse(func(r *colly.Response){
		fmt.Println("æ”¶åˆ°å“åº”å†…å®¹çš„æ•°é‡ï¼š ", r.StatusCode)
	})
	
	// é™åˆ¶ visit çš„çº¿ç¨‹æ•°ï¼Œ visit å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ª
	c.Limit(&colly.LimitRule{
		Parallelism: 2,
	})

	c.Visit("http://news.baidu.com")
}
```

**Log:**

```sh
ganghuang@GangHuangs-MacBook-Pro TestCrawlerBaidu % go run test_crawler_baidu.go
æ­£åœ¨è®¿é—®ï¼š http://news.baidu.com
æ”¶åˆ°å“åº”å†…å®¹çš„æ•°é‡ï¼š  200
æ–‡æ¡£æ ‡é¢˜ï¼š ç™¾åº¦æ–°é—»â€”â€”æµ·é‡ä¸­æ–‡èµ„è®¯å¹³å°
æ–‡æ¡£å†…å®¹ 1: ä¹ è¿‘å¹³å‘å…¨å›½å„æ—äººæ°‘è‡´ä»¥æ–°æ˜¥ç¥ç¦
https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=5200598709432592760&toc_style_id=feeds_default&track_id=34D9D8BD-D879-4708-BF3E-A8D868C6C660_759409923605&share_to=copy_url
æ–‡æ¡£å†…å®¹ 2: ä¹ è¿‘å¹³æ˜¥èŠ‚å‰å¤•èµ´è¾½å®çœ‹æœ›æ…°é—®åŸºå±‚å¹²éƒ¨ç¾¤ä¼—
https://news.cctv.com/2025/01/24/ARTI6hnAgPkfUOy7vO9AAjFB250124.shtml
æ–‡æ¡£å†…å®¹ 3: æ€»ä¹¦è®°çš„å…³æ€€è®©æˆ‘ä»¬æ„Ÿåˆ°å¹¸ç¦æ¸©æš–
https://h.xinhuaxmt.com/vh512/share/12380734?newstype=1001&homeshow=1
æ–‡æ¡£å†…å®¹ 4: è½¬å‹å‡çº§ â€œæ™ºâ€é€ å¼ºä¼ ä¼ ç»Ÿé’¢ä¼ç„•å‘é’æ˜¥
https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=16973667513549662031&toc_style_id=feeds_default&track_id=3C71E229-8F36-461A-8F0A-AAD40C7030ED_759408113589&share_to=copy_url
æ–‡æ¡£å†…å®¹ 5: ä¹ è¿‘å¹³è¾½å®è¡Œï½œçƒŸç«æ°”é‡Œå¹´å‘³æµ“â€”â€”èµ°è¿›æ²ˆé˜³å¤§ä¸œå‰¯é£Ÿå“å•†åœº
https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=1274157371348255293&toc_style_id=feeds_default&track_id=25D644CD-6C11-463A-921D-8BC0F1C6B019_759329323922&share_to=copy_url
æ–‡æ¡£å†…å®¹ 6: å‘â€œæ–°â€å‘åŠ› é€â€œè´¨â€è€Œè¡Œ
https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=16224630468348415654&toc_style_id=feeds_default&share_to=copy_url&track_id=24e45dbe-d36d-4e2a-82b5-1d3700f1f9a2
æ–‡æ¡£å†…å®¹ 7: æ—¶æ”¿Vlogï½œä¸Šè”ï¼šå¹´è´§ç½®åŠä¸­ ä¸‹è”ï¼šä»Šæ—¥å®œâ€œå¤§ä¸œâ€ æ¨ªæ‰¹ï¼šè€é¦™äº†
https://content-static.cctvnews.cctv.com/snow-book/index.html?item_id=95295998088496574&channelId=1119&toc_style_id=feeds_default&track_id=D9D2124E-0D13-4872-A820-380C0AF85403_759396097754&share_to=copy_url
æ–‡æ¡£å†…å®¹ 8: å»¶å®‰è‹¹æœäº§ä¸šé‡Œçš„æ–°è´¨ç”Ÿäº§åŠ›ï¼ˆæ–°æ˜¥èµ°åŸºå±‚ï¼‰
https://www.peopleapp.com/column/30048094126-500006064834
æ–‡æ¡£å†…å®¹ 9: æ–°æ˜¥èµ°åŸºå±‚ï½œâ€œéš§é“æ¢é™©å®¶â€å‡ºæµ·è®°
https://app.people.cn/h5/detail/normal/6157882818937856
æ–‡æ¡£å†…å®¹ 10: å¤§å¸‚åœºçœ‹ä¸­å›½å¹´ï½œé€›ç™¾å¹´å¤§é›† å¯»ä¹¡æ„è®°å¿†
https://www.cnr.cn/tj/tjtp/20250124/t20250124_527050755.shtml
```

<br/><br/>
> <h2 id="æŠ“å–æŒ‡å®šè¿æ¥çš„ç½‘é¡µå†…å®¹"> æŠ“å–æŒ‡å®šè¿æ¥çš„ç½‘é¡µå†…å®¹ </h2>

æ§åˆ¶å°æ‰“å°çš„æŠ“å–ç»“æœæ˜¯çˆ¬è™«ç¨‹åºé€šè¿‡é™åˆ¶åŸŸåã€è®¾ç½®æŠ“å–æ·±åº¦ã€è¿‡æ»¤URLåå¾—åˆ°çš„ã€‚é€šè¿‡è®¿é—®http://news.baidu.comå‘ç°è¯¥é“¾æ¥çš„ç½‘é¡µå†…å®¹å¾ˆä¸°å¯Œï¼Œæ¶‰åŠæ–¹æ–¹é¢é¢çš„é¢†åŸŸã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æ‰èƒ½æŠŠhttp://news.baidu.comçš„ç½‘é¡µå†…å®¹å…¨éƒ¨æŠ“å–ä¸‹æ¥å‘¢ï¼Ÿä»£ç å¦‚ä¸‹ã€‚

```go
// è®¿é—®æŒ‡å®šç½‘å€
testCrawlerAppointWebpage("https://news.baidu.com")


/// æŠ“å–æŒ‡å®šè¿æ¥çš„ç½‘é¡µå†…å®¹ urls: æŒ‡å®šé“¾æ¥
func testCrawlerAppointWebpage(urls string) {
	// åˆ›å»º Collector å¯¹è±¡
	c := colly.NewCollector()
	/* 
	* æ˜¯å¦æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	* åˆå§‹è®¾ç½®ä¸ºä¸æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	 */
	visited := false
	// ä½¿ç”¨ Collector å¯¹è±¡æŠ“å– URL
	c.OnResponse(func (r *colly.Response)  {
		if !visited {
			visited = true
			r.Request.Visit("/get?q=2")
		}
	})

	// å¯¹æŒ‡å®šé“¾æ¥ç½‘é¡µå†…å®¹è¿›è¡Œå¤„ç†
	c.OnHTML("a[href]", func (e *colly.HTMLElement)  {
		href := e.Text	// è·å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
		fmt.Println("ğŸ ç½‘é¡µå†…å®¹ï¼š",href)	// æ‰“å°æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	})
	c.Visit(urls)	//è®¿é—®æŒ‡å®šé“¾æ¥
}
```

**Log**

```
ganghuang@GangHuangs-MacBook-Pro TestCrawlerBaidu % go run test_crawler_baidu.go
ğŸ ç½‘é¡µå†…å®¹ï¼š ç½‘é¡µ
ğŸ ç½‘é¡µå†…å®¹ï¼š è´´å§
ğŸ ç½‘é¡µå†…å®¹ï¼š çŸ¥é“
ğŸ ç½‘é¡µå†…å®¹ï¼š éŸ³ä¹
ğŸ ç½‘é¡µå†…å®¹ï¼š å›¾ç‰‡
ğŸ ç½‘é¡µå†…å®¹ï¼š è§†é¢‘
ğŸ ç½‘é¡µå†…å®¹ï¼š åœ°å›¾
ğŸ ç½‘é¡µå†…å®¹ï¼š æ–‡åº“
ğŸ ç½‘é¡µå†…å®¹ï¼š 




ğŸ ç½‘é¡µå†…å®¹ï¼š å¸®åŠ©
ğŸ ç½‘é¡µå†…å®¹ï¼š é¦–é¡µ
ğŸ ç½‘é¡µå†…å®¹ï¼š å›½å†…
ğŸ ç½‘é¡µå†…å®¹ï¼š å›½é™…
ğŸ ç½‘é¡µå†…å®¹ï¼š å†›äº‹
ğŸ ç½‘é¡µå†…å®¹ï¼š è´¢ç»
ğŸ ç½‘é¡µå†…å®¹ï¼š å¨±ä¹
ğŸ ç½‘é¡µå†…å®¹ï¼š ä½“è‚²
ğŸ ç½‘é¡µå†…å®¹ï¼š äº’è”ç½‘
ğŸ ç½‘é¡µå†…å®¹ï¼š ç§‘æŠ€
ğŸ ç½‘é¡µå†…å®¹ï¼š æ¸¸æˆ
ğŸ ç½‘é¡µå†…å®¹ï¼š å¥³äºº
ğŸ ç½‘é¡µå†…å®¹ï¼š æ±½è½¦
ğŸ ç½‘é¡µå†…å®¹ï¼š æˆ¿äº§
ğŸ ç½‘é¡µå†…å®¹ï¼š é¦–é¡µ
ğŸ ç½‘é¡µå†…å®¹ï¼š å›½å†…
ğŸ ç½‘é¡µå†…å®¹ï¼š å›½é™…
ğŸ ç½‘é¡µå†…å®¹ï¼š å†›äº‹
ğŸ ç½‘é¡µå†…å®¹ï¼š è´¢ç»
ğŸ ç½‘é¡µå†…å®¹ï¼š å¨±ä¹
ğŸ ç½‘é¡µå†…å®¹ï¼š ä½“è‚²
ğŸ ç½‘é¡µå†…å®¹ï¼š äº’è”ç½‘
ğŸ ç½‘é¡µå†…å®¹ï¼š ç§‘æŠ€
ğŸ ç½‘é¡µå†…å®¹ï¼š æ¸¸æˆ
ğŸ ç½‘é¡µå†…å®¹ï¼š å¥³äºº
ğŸ ç½‘é¡µå†…å®¹ï¼š æ±½è½¦
ğŸ ç½‘é¡µå†…å®¹ï¼š æˆ¿äº§
ğŸ ç½‘é¡µå†…å®¹ï¼š 


ç‚¹å‡»åˆ·æ–°ï¼Œå°†ä¼šæœ‰æœªè¯»æ¨è


ğŸ ç½‘é¡µå†…å®¹ï¼š çƒ­ç‚¹è¦é—»
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¹ è¿‘å¹³å‘å…¨å›½å„æ—äººæ°‘è‡´ä»¥æ–°æ˜¥ç¥ç¦
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¹ è¿‘å¹³æ˜¥èŠ‚å‰å¤•èµ´è¾½å®çœ‹æœ›æ…°é—®åŸºå±‚å¹²éƒ¨ç¾¤ä¼—
ğŸ ç½‘é¡µå†…å®¹ï¼š æ€»ä¹¦è®°çš„å…³æ€€è®©æˆ‘ä»¬æ„Ÿåˆ°å¹¸ç¦æ¸©æš–
ğŸ ç½‘é¡µå†…å®¹ï¼š è½¬å‹å‡çº§ â€œæ™ºâ€é€ å¼ºä¼ ä¼ ç»Ÿé’¢ä¼ç„•å‘é’æ˜¥
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¹ è¿‘å¹³è¾½å®è¡Œï½œçƒŸç«æ°”é‡Œå¹´å‘³æµ“â€”â€”èµ°è¿›æ²ˆé˜³å¤§ä¸œå‰¯é£Ÿå“å•†åœº
ğŸ ç½‘é¡µå†…å®¹ï¼š å‘â€œæ–°â€å‘åŠ› é€â€œè´¨â€è€Œè¡Œ
ğŸ ç½‘é¡µå†…å®¹ï¼š æ—¶æ”¿Vlogï½œä¸Šè”ï¼šå¹´è´§ç½®åŠä¸­ ä¸‹è”ï¼šä»Šæ—¥å®œâ€œå¤§ä¸œâ€ æ¨ªæ‰¹ï¼šè€é¦™äº†
ğŸ ç½‘é¡µå†…å®¹ï¼š å»¶å®‰è‹¹æœäº§ä¸šé‡Œçš„æ–°è´¨ç”Ÿäº§åŠ›ï¼ˆæ–°æ˜¥èµ°åŸºå±‚ï¼‰
ğŸ ç½‘é¡µå†…å®¹ï¼š æ–°æ˜¥èµ°åŸºå±‚ï½œâ€œéš§é“æ¢é™©å®¶â€å‡ºæµ·è®°
ğŸ ç½‘é¡µå†…å®¹ï¼š å¤§å¸‚åœºçœ‹ä¸­å›½å¹´ï½œé€›ç™¾å¹´å¤§é›† å¯»ä¹¡æ„è®°å¿†
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¸­ç»è¯„è®ºï¼š1.4ä¸‡äº¿æ–¤ï¼ä¸­å›½ç²®â€œè—â€åœ¨å“ªï¼Ÿ
ğŸ ç½‘é¡µå†…å®¹ï¼š å…±äº«ä¸­å›½å‘å±•æœºé‡ ç¾å›½ä¼ä¸šæŒç»­çœ‹å¥½ä¸­å›½å¸‚åœº
ğŸ ç½‘é¡µå†…å®¹ï¼š æˆ‘åœ¨ä¸­å›½è¿‡å¤§å¹´ï½œå½“â€œéé—ç‰ˆâ€æ˜¥èŠ‚é‡ä¸Šéé—å½ç»£
ğŸ ç½‘é¡µå†…å®¹ï¼š é¦™æ¸¯ç‚¹äº®é”¦é²¤é†’ç‹®å½©ç¯è¿æ–°æ˜¥
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¸“é¢˜ï¼šäº¬å½©æ˜¥èŠ‚çš„Nç§æ‰“å¼€æ–¹å¼
ğŸ ç½‘é¡µå†…å®¹ï¼š ä»Šæ—¥è¾Ÿè°£
ğŸ ç½‘é¡µå†…å®¹ï¼š åŒ—äº¬ç½‘ç«™è¾Ÿè°£å¹³å°
ğŸ ç½‘é¡µå†…å®¹ï¼š äº’è”ç½‘è”åˆè¾Ÿè°£å¹³å°
ğŸ ç½‘é¡µå†…å®¹ï¼š å¤šåœ°â€œç¦æ”¹é™â€æ˜ç¡®æ˜¥èŠ‚å¯ç‡ƒæ”¾çƒŸèŠ±çˆ†ç«¹
ğŸ ç½‘é¡µå†…å®¹ï¼š æš´é›ªã€å¯’æ½®ã€å¤§é›¾ä¸‰é¢„è­¦é½å‘ï¼å¤šåœ°é«˜é€Ÿå°é—­ï¼Œåˆ—è½¦åœè¿
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¼ ç»Ÿä¹ ä¿—è¿æ˜¥èŠ‚ æ¥çœ‹è¿™äº›åœ°æ–¹çš„æµ“æµ“å¹´å‘³
ğŸ ç½‘é¡µå†…å®¹ï¼š é“è·¯æ¡¥éš§å·¥å­©å­å¹´å‰åç«è½¦â€œçœ‹çˆ¸çˆ¸â€ çˆ¶äº²åœ¨å´–å£å–Šåˆ°é£™æ³ª
ğŸ ç½‘é¡µå†…å®¹ï¼š å›½å®¶è¯ç›‘å±€è¯å®¡ä¸­å¿ƒå›åº”ä¸ªåˆ«å“ç§æ•°æ®é‡å¤ï¼šç¼–è¾‘é”™è¯¯å¯¼è‡´
ğŸ ç½‘é¡µå†…å®¹ï¼š ç¾å›½æ€»ç»Ÿç‰¹æœ—æ™®ç§°å°†å†æ¬¡å’Œæœé²œé¢†å¯¼äººå–å¾—è”ç³»
ğŸ ç½‘é¡µå†…å®¹ï¼š 

ç‚¹å‡»åˆ·æ–°ï¼Œå°†ä¼šæœ‰æœªè¯»æ¨è

ğŸ ç½‘é¡µå†…å®¹ï¼š æ›´å¤šä¸ªæ€§æ¨èæ–°é—»
ğŸ ç½‘é¡µå†…å®¹ï¼š 


ğŸ ç½‘é¡µå†…å®¹ï¼š 


ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š 8
ğŸ ç½‘é¡µå†…å®¹ï¼š 7
ğŸ ç½‘é¡µå†…å®¹ï¼š 6
ğŸ ç½‘é¡µå†…å®¹ï¼š 5
ğŸ ç½‘é¡µå†…å®¹ï¼š 4
ğŸ ç½‘é¡µå†…å®¹ï¼š 3
ğŸ ç½‘é¡µå†…å®¹ï¼š 2
ğŸ ç½‘é¡µå†…å®¹ï¼š 1
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š å¹´çš„å‘³é“
ğŸ ç½‘é¡µå†…å®¹ï¼š é£å¤©é€æ¢¦æ¢è‹ç©¹
ğŸ ç½‘é¡µå†…å®¹ï¼š ä»Šå†¬ä»¥æ¥æœ€å¼ºé›¨é›ªæ¥è¢­
ğŸ ç½‘é¡µå†…å®¹ï¼š åˆç¡å¯ä»¥ä¿®å¤å…¨èº«å¤šä¸ªå™¨å®˜
ğŸ ç½‘é¡µå†…å®¹ï¼š è€å›å±±æ™¯åŒºç´§æ€¥é—­å›­
ğŸ ç½‘é¡µå†…å®¹ï¼š åŒ»ç”Ÿè¯´è¿™6ç§ç—…æ˜¯è¡°è€çš„è¡¨ç°
ğŸ ç½‘é¡µå†…å®¹ï¼š ç›‘æ§æ‹ä¸‹ç«ç®­æ®‹éª¸æ‰è½ç¬é—´
ğŸ ç½‘é¡µå†…å®¹ï¼š æ²³é‡Œé’“èµ·æ•´ç®±ç°é‡‘?è°£è¨€
ğŸ ç½‘é¡µå†…å®¹ï¼š ç¬¬ä¸€æ‰¹å¤–å›½ç½‘å‹å·²åˆ°ä¸­å›½â€œèµ¶æ˜¥è¿â€
ğŸ ç½‘é¡µå†…å®¹ï¼š ç¾æ‹¨æ¬¾25äº¿ç¾å…ƒåº”å¯¹æ´›æ‰çŸ¶å±±ç«
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š è¾Ÿè°£
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¸¾æŠ¥
ğŸ ç½‘é¡µå†…å®¹ï¼š äºŒç»´ç 
ğŸ ç½‘é¡µå†…å®¹ï¼š æ”¶è—æœ¬ç«™
ğŸ ç½‘é¡µå†…å®¹ï¼š æœç´¢
ğŸ ç½‘é¡µå†…å®¹ï¼š ç”¨æˆ·åé¦ˆ
ğŸ ç½‘é¡µå†…å®¹ï¼š 
ğŸ ç½‘é¡µå†…å®¹ï¼š Androidç‰ˆä¸‹è½½
ğŸ ç½‘é¡µå†…å®¹ï¼š iPhoneç‰ˆä¸‹è½½
ğŸ ç½‘é¡µå†…å®¹ï¼š ç”¨æˆ·åè®®
ğŸ ç½‘é¡µå†…å®¹ï¼š éšç§ç­–ç•¥
ğŸ ç½‘é¡µå†…å®¹ï¼š ä¼ä¸šæ¨å¹¿
ğŸ ç½‘é¡µå†…å®¹ï¼š æŠ•è¯‰ä¸­å¿ƒ
ğŸ ç½‘é¡µå†…å®¹ï¼š è¥ä¸šæ‰§ç…§
ğŸ ç½‘é¡µå†…å®¹ï¼š ã€Šäº’è”ç½‘æ–°é—»ä¿¡æ¯æœåŠ¡è®¸å¯ã€‹ç¼–å·ï¼š11220180008
ğŸ ç½‘é¡µå†…å®¹ï¼š ã€Šäº’è”ç½‘å®—æ•™ä¿¡æ¯æœåŠ¡è®¸å¯è¯ã€‹ç¼–å·ï¼šäº¬ï¼ˆ2022ï¼‰0000043
ğŸ ç½‘é¡µå†…å®¹ï¼š ä½¿ç”¨ç™¾åº¦å‰å¿…è¯»
ğŸ ç½‘é¡µå†…å®¹ï¼š 

ğŸ ç½‘é¡µå†…å®¹ï¼š 

ğŸ ç½‘é¡µå†…å®¹ï¼š 
```


<br/><br/>
> <h2 id="å°†æŠ“å–çš„ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨æ–‡ä»¶ä¸­">å°†æŠ“å–çš„ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨æ–‡ä»¶ä¸­</h2>

é€šè¿‡19.4èŠ‚çš„æ“ä½œå·²ç»æŠŠhttp://news.baidu.comçš„ç½‘é¡µå†…å®¹å…¨éƒ¨æŠ“å–ä¸‹æ¥ï¼Œå¹¶æŠŠè¿™äº›å†…å®¹æ‰“å°åœ¨æ§åˆ¶å°ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚ä½•æ‰èƒ½æŠŠæŠ“å–ä¸‹æ¥çš„ç½‘é¡µå†…å®¹å­˜å‚¨åœ¨æ–‡ä»¶ä¸­å‘¢ï¼Ÿä»£ç å¦‚ä¸‹ã€‚

```
// å­˜å‚¨çˆ¬è™«æ–‡ä»¶
func testCrawlerAppointWebpageAndSaveTxt(urls string) {
	// åˆ›å»º Collector å¯¹è±¡
	c := colly.NewCollector()
	/* 
	* æ˜¯å¦æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	* åˆå§‹è®¾ç½®ä¸ºä¸æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	 */
	visited := false
	// ä½¿ç”¨ Collector å¯¹è±¡æŠ“å– URL
	c.OnResponse(func (r *colly.Response)  {
		if !visited {
			visited = true
			r.Request.Visit("/get?q=2")
		}
	})

	// æ–‡ä»¶çš„åˆ›å»ºå’ŒæŒç»­å†™å…¥
	filename := "news.txt"	// æ–‡ä»¶å
	var f *os.File
	var fileErr error 
	if testCheckFileExist(filename) {	// å¦‚æœæ–‡ä»¶å­˜åœ¨
		f, fileErr = os.OpenFile(filename, os.O_APPEND | os.O_WRONLY, 0666)	// æ‰“å¼€æ–‡ä»¶
		if fileErr != nil {
			fmt.Printf("âŒ æ‰“å¼€æ–‡ä»¶ news.txt å¤±è´¥ï¼š%v\n", fileErr)
		}
	} else {
		f,_ = os.Create(filename)	// åˆ›å»ºæ–‡ä»¶
		fmt.Println("ğŸ æ–°å»ºæ–‡ä»¶ news.txt")

	}
	defer f.Close()	// å…³é—­æ–‡ä»¶
	write := bufio.NewWriter(f)
	defer write.Flush()

	// å¯¹æŒ‡å®šé“¾æ¥ç½‘é¡µå†…å®¹è¿›è¡Œå¤„ç†
	c.OnHTML("a[href]", func (e *colly.HTMLElement)  {
		href := e.Text	// è·å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
		write.WriteString("ğŸ’ "+href+"\n")
		fmt.Println("ğŸ ç½‘é¡µå†…å®¹ï¼š",href)	// æ‰“å°æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	})


	c.Visit(urls)	//è®¿é—®æŒ‡å®šé“¾æ¥
}
/* æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
* fileName æ–‡ä»¶å
 */
func testCheckFileExist(filename string) bool {
	var exist = true
	if _, err := os.Stat(filename); os.IsNotExist(err) {
		exist = false
	}
	return exist
}
```

æ•ˆæœå›¾ï¼š

![go.0.0.56.png](./../Pictures/go.0.0.56.png)


<br/><br/><br/>

***
<br/>

> <h1 id="è¯»å†™é…ç½®æ–‡ä»¶åº“viper">[è¯»å†™é…ç½®æ–‡ä»¶åº“viper](https://github.com/spf13/viper)</h1>

è¯»å†™é…ç½®æ–‡ä»¶åº“viperï¼Œç›®å‰æ˜¯æ¯”è¾ƒç«çš„ã€‚

ä½†æ˜¯æœ¬ç³»åˆ—é€‰ç”¨ [go-ini/ini](https://github.com/go-ini/ini) ï¼Œå®ƒçš„ [ä¸­æ–‡æ–‡æ¡£](https://ini.unknwon.io/)ã€‚å¤§å®¶æ˜¯å¿…é¡»éœ€è¦è¦ç®€å•é˜…è¯»å®ƒçš„æ–‡æ¡£ï¼Œå†æ¥ç€å®Œæˆåé¢çš„å†…å®¹ã€‚


<br/><br/><br/>

***
<br/>

> <h1 id="â€ŒRESTfulAPIè®¾è®¡æ¨¡å¼">â€Œ RESTful APIè®¾è®¡æ¨¡å¼ </h1>
**ä»€ä¹ˆæ˜¯RESTful APIï¼Ÿ**

RESTful APIï¼ˆRepresentational State Transfer APIï¼‰æ˜¯ä¸€ç§åŸºäº REST æ¶æ„é£æ ¼çš„ Web API è®¾è®¡æ–¹å¼ã€‚REST ç”± Roy Fielding åœ¨ 2000 å¹´çš„åšå£«è®ºæ–‡ä¸­æå‡ºï¼Œå®ƒæ˜¯ä¸€ç§è½»é‡çº§ã€æ— çŠ¶æ€çš„æ¶æ„é£æ ¼ï¼Œå¸¸ç”¨äº Web æœåŠ¡å¼€å‘ã€‚

åœ¨ RESTful API è®¾è®¡ä¸­ï¼Œæ‰€æœ‰èµ„æºï¼ˆæ¯”å¦‚ç”¨æˆ·ã€è®¢å•ã€å•†å“ç­‰ï¼‰éƒ½é€šè¿‡ URL è¿›è¡Œè®¿é—®ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ HTTP æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETEï¼‰å¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”è¿”å›çš„æ•°æ®é€šå¸¸ä½¿ç”¨ JSON æ ¼å¼ã€‚
<br/>

- **RESTful API çš„æ ¸å¿ƒæ¦‚å¿µ**
- 1.**èµ„æºï¼ˆResourceï¼‰**
REST å…³æ³¨çš„æ˜¯èµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½ä½¿ç”¨ **å”¯ä¸€çš„ URL** è¿›è¡Œæ ‡è¯†ã€‚
- ä¾‹å¦‚ï¼š`https://api.example.com/users/123` è¡¨ç¤º ID ä¸º `123` çš„ç”¨æˆ·èµ„æºã€‚
<br/>

2.**HTTP æ–¹æ³•**
ä¸åŒçš„ HTTP æ–¹æ³•è¡¨ç¤ºå¯¹èµ„æºçš„ä¸åŒæ“ä½œï¼š

| HTTP æ–¹æ³• | ä½œç”¨ | è¯´æ˜ |
|-----------|------|------|
| `GET`     | æŸ¥è¯¢ | è·å–èµ„æºæ•°æ® |
| `POST`    | åˆ›å»º | æ–°å¢èµ„æº |
| `PUT`     | æ›´æ–° | æ›´æ–°æ•´ä¸ªèµ„æº |
| `PATCH`   | æ›´æ–° | éƒ¨åˆ†æ›´æ–°èµ„æº |
| `DELETE`  | åˆ é™¤ | åˆ é™¤èµ„æº |
<br/>

- 3.**æ— çŠ¶æ€æ€§ï¼ˆStatelessï¼‰**
	- æœåŠ¡å™¨ä¸å­˜å‚¨å®¢æˆ·ç«¯çš„è¯·æ±‚çŠ¶æ€ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»åŒ…å«å®Œæˆè¯¥è¯·æ±‚æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚
	- è¿™æ ·å¯ä»¥å‡å°‘æœåŠ¡å™¨çš„å¼€é”€ï¼Œæ–¹ä¾¿æ°´å¹³æ‰©å±•ã€‚
<br/>

- 4.**æ•°æ®æ ¼å¼**
	- RESTful API ä¸»è¦ä½¿ç”¨ **JSON** ä½œä¸ºæ•°æ®æ ¼å¼ï¼Œæ˜“äºè§£æå’Œä½¿ç”¨ã€‚
	- ä¾‹å¦‚ï¼š

```json
{
"id": 123,
"name": "Alice",
"email": "alice@example.com"
}
```
---

- **åœ¨ Golang ä¸­å®ç° RESTful API**

- Golang æä¾›äº†å¤šä¸ª Web æ¡†æ¶æ¥æ„å»º RESTful APIï¼Œå¸¸è§çš„æœ‰ï¼š
	- `net/http`ï¼ˆæ ‡å‡†åº“ï¼‰
	- `gin`ï¼ˆé«˜æ€§èƒ½æ¡†æ¶ï¼‰
	- `echo`ï¼ˆè½»é‡çº§æ¡†æ¶ï¼‰

***
<br/>

**RESTful API çš„æœ€ä½³å®è·µ**
1. **ä½¿ç”¨æ­£ç¡®çš„ HTTP æ–¹æ³•**ï¼š
	- æŸ¥è¯¢æ•°æ®ç”¨ `GET`
	- åˆ›å»ºæ•°æ®ç”¨ `POST`
	- æ›´æ–°æ•°æ®ç”¨ `PUT/PATCH`
	- åˆ é™¤æ•°æ®ç”¨ `DELETE`

2. **ä¿æŒ URL è¯­ä¹‰æ¸…æ™°**ï¼š
	- `GET /users` è·å–æ‰€æœ‰ç”¨æˆ·
	- `GET /users/{id}` è·å–å•ä¸ªç”¨æˆ·
	- `POST /users` åˆ›å»ºç”¨æˆ·
	- `PUT /users/{id}` æ›´æ–°ç”¨æˆ·
	- `DELETE /users/{id}` åˆ é™¤ç”¨æˆ·

3. **ä½¿ç”¨ JSON ä½œä¸ºæ•°æ®æ ¼å¼**
	- `Content-Type: application/json`

4. **è¿”å›åˆé€‚çš„ HTTP çŠ¶æ€ç **
	- `200 OK`ï¼šæˆåŠŸè·å–èµ„æº
	- `201 Created`ï¼šèµ„æºåˆ›å»ºæˆåŠŸ
	- `400 Bad Request`ï¼šè¯·æ±‚æ ¼å¼é”™è¯¯
	- `404 Not Found`ï¼šèµ„æºä¸å­˜åœ¨
	- `500 Internal Server Error`ï¼šæœåŠ¡å™¨é”™è¯¯

5. **æ”¯æŒ CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰**

```go
w.Header().Set("Access-Control-Allow-Origin", "*")
```

---

**æ€»ç»“**
- **RESTful API** æ˜¯åŸºäº REST æ¶æ„é£æ ¼çš„ Web API è®¾è®¡æ–¹å¼ï¼Œæ ¸å¿ƒåœ¨äº **èµ„æºã€HTTP æ–¹æ³•ã€æ— çŠ¶æ€æ€§ã€JSON æ•°æ®æ ¼å¼**ã€‚
- åœ¨ **Golang** ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `net/http` æˆ– `Gin` ç­‰æ¡†æ¶æ¥å¿«é€Ÿå¼€å‘ RESTful APIã€‚
- éµå¾ª **RESTful API è®¾è®¡æœ€ä½³å®è·µ**ï¼Œå¯ä»¥æé«˜ API çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€‚

å¦‚æœä½ æƒ³å¼€å‘æ›´å®Œæ•´çš„ RESTful APIï¼Œå¯ä»¥å°è¯•ï¼š
- **æ•°æ®åº“å­˜å‚¨ï¼ˆMySQLã€PostgreSQLã€MongoDBï¼‰**
- **èº«ä»½éªŒè¯ï¼ˆJWTã€OAuthï¼‰**
- **API æ–‡æ¡£ï¼ˆSwaggerï¼‰**


<br/><br/><br/>

***
<br/>

> <h1 id="`net/http`åº“">`net/http`åº“</h1>

- **ä½¿ç”¨  `net/http`æ„å»ºç®€å• RESTful API**

```go
package main

import (
	"encoding/json"
	"fmt"
	"net/http"
	"strconv"
)

type User struct {
	ID    int    `json:"id"`
	Name  string `json:"name"`
	Email string `json:"email"`
}

var users = []User{
	{ID: 1, Name: "Alice", Email: "alice@example.com"},
	{ID: 2, Name: "Bob", Email: "bob@example.com"},
}

// è·å–æ‰€æœ‰ç”¨æˆ·
func getUsers(w http.ResponseWriter, r *http.Request) {
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(users)
}

// è·å–å•ä¸ªç”¨æˆ·
func getUser(w http.ResponseWriter, r *http.Request) {
	idStr := r.URL.Query().Get("id")
	id, err := strconv.Atoi(idStr)
	if err != nil {
		http.Error(w, "Invalid user ID", http.StatusBadRequest)
		return
	}

	for _, user := range users {
		if user.ID == id {
			w.Header().Set("Content-Type", "application/json")
			json.NewEncoder(w).Encode(user)
			return
		}
	}
	http.Error(w, "User not found", http.StatusNotFound)
}

// å¤„ç† API è¯·æ±‚
func handler() {
	http.HandleFunc("/users", getUsers)
	http.HandleFunc("/user", getUser)
	fmt.Println("Server started at :8080")
	http.ListenAndServe(":8080", nil)
}

func main() {
	handler()
}
```
- è¿è¡Œåï¼Œè®¿é—®ï¼š
  - `http://localhost:8080/users` è·å–æ‰€æœ‰ç”¨æˆ·
  - `http://localhost:8080/user?id=1` è·å–å•ä¸ªç”¨æˆ·

---

<br/><br/><br/>

***
<br/>

> <h1 id="â€Œginæ¡†æ¶">â€Œginæ¡†æ¶</h1>

è·å–ginæ¡†æ¶çš„åŒ…ï¼š

```
go get github.com/gin-gonic/gin
```
<br/>

<br/><br/><br/>
> <h2 id="Ginæ„å»º RESTfulAPI">Ginæ„å»º RESTful API</h2>

- **ä½¿ç”¨ `Gin` æ„å»º RESTful API**
ç›¸æ¯” `net/http`ï¼Œ`Gin` æ›´ç®€æ´é«˜æ•ˆï¼š

```go
package main

import (
	"net/http"
	"strconv"

	"github.com/gin-gonic/gin"
)

type User struct {
	ID    int    `json:"id"`
	Name  string `json:"name"`
	Email string `json:"email"`
}

var users = []User{
	{ID: 1, Name: "Alice", Email: "alice@example.com"},
	{ID: 2, Name: "Bob", Email: "bob@example.com"},
}

func main() {
	r := gin.Default()

	// è·å–æ‰€æœ‰ç”¨æˆ·
	r.GET("/users", func(c *gin.Context) {
		c.JSON(http.StatusOK, users)
	})

	// è·å–å•ä¸ªç”¨æˆ·
	r.GET("/users/:id", func(c *gin.Context) {
		id, err := strconv.Atoi(c.Param("id"))
		if err != nil {
			c.JSON(http.StatusBadRequest, gin.H{"error": "Invalid user ID"})
			return
		}

		for _, user := range users {
			if user.ID == id {
				c.JSON(http.StatusOK, user)
				return
			}
		}
		c.JSON(http.StatusNotFound, gin.H{"error": "User not found"})
	})

	r.Run(":8080")
}
```
- è¿è¡Œåï¼Œè®¿é—®ï¼š
  - `GET http://localhost:8080/users`
  - `GET http://localhost:8080/users/1`


<br/><br/><br/>
> <h2 id="æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡">æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡</h2>

æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡ã€‚å…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼šè¿è¡Œä¿®æ”¹åçš„çˆ¬è™«ç¨‹åºï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®â€œæœ¬æœºIPï¼šç«¯å£â€â€‹ï¼›å½“åœ¨ç½‘é¡µä¸Šçœ‹åˆ°æç¤ºä¿¡æ¯ï¼ˆâ€‹â€œå·²ç»æŠŠhttp://news.baidu.comçš„ç½‘é¡µå†…å®¹å…¨éƒ¨æŠ“å–ä¸‹æ¥ï¼Œè¯·æŸ¥çœ‹å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„news.txtæ–‡ä»¶ï¼â€â€‹ï¼‰æ—¶ï¼Œè¯´æ˜å·²ç»æŠŠhttp://news.baidu.comçš„ç½‘é¡µå†…å®¹å…¨éƒ¨æŠ“å–ä¸‹æ¥ï¼Œå¹¶å­˜å‚¨åœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„news.txtæ–‡ä»¶ä¸­ã€‚

ä¸ºäº†æ»¡è¶³ä¸Šè¿°çš„ä¿®æ”¹è¦æ±‚ï¼Œéœ€è¦ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…ginã€‚å¦‚å›¾19.8æ‰€ç¤ºï¼Œä¸‹è½½ginåŒ…çš„æ­¥éª¤å¦‚ä¸‹ã€‚

```
// æŠŠçˆ¬è™«ç¨‹åºè®¾ç½®æˆWebæœåŠ¡
func testCrawlerAppointWebpageAndSaveTxtV2() {
	// åˆå§‹åŒ–å¼•æ“
	engine := gin.Default()
	// æ³¨å†Œä¸€ä¸ªè·¯ç”±å’Œå¤„ç†å‡½æ•°
	engine.Any("/", WebRoot)
	// ç»‘å®šç«¯å£
	engine.Run(":9200")
}
// å¤„ç†è·¯ç”±å‡½æ•°
func WebRoot(context *gin.Context){
	// è°ƒç”¨ testCrawlerAppointWebpageAndSaveTxt()å‡½æ•°
	testCrawlerAppointWebpageAndSaveTxt("https://news.baidu.com")
	// è®¾ç½®ç½‘é¡µä¸Šçš„æ–‡æœ¬å†…å®¹
	context.String(http.StatusOK, "å·²ç»æŠŠhttp://news.baidu.com çš„ç½‘é¡µå†…å®¹å…¨éƒ¨æŠ“å–ä¸‹æ¥\n è¯·æŸ¥çœ‹å½“å‰é¡¹ç›®ç›®å½•ä¸‹çš„news.txtæ–‡æœ¬æ–‡ä»¶ï¼")
}

// å­˜å‚¨çˆ¬è™«æ–‡ä»¶
func testCrawlerAppointWebpageAndSaveTxt(urls string) {
	// åˆ›å»º Collector å¯¹è±¡
	c := colly.NewCollector()
	/* 
	* æ˜¯å¦æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	* åˆå§‹è®¾ç½®ä¸ºä¸æŠ“å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	 */
	visited := false
	// ä½¿ç”¨ Collector å¯¹è±¡æŠ“å– URL
	c.OnResponse(func (r *colly.Response)  {
		if !visited {
			visited = true
			r.Request.Visit("/get?q=2")
		}
	})

	// æ–‡ä»¶çš„åˆ›å»ºå’ŒæŒç»­å†™å…¥
	filename := "news.txt"	// æ–‡ä»¶å
	var f *os.File
	var fileErr error 
	if testCheckFileExist(filename) {	// å¦‚æœæ–‡ä»¶å­˜åœ¨
		f, fileErr = os.OpenFile(filename, os.O_APPEND | os.O_WRONLY, 0666)	// æ‰“å¼€æ–‡ä»¶
		if fileErr != nil {
			fmt.Printf("âŒ æ‰“å¼€æ–‡ä»¶ news.txt å¤±è´¥ï¼š%v\n", fileErr)
		}
	} else {
		f,_ = os.Create(filename)	// åˆ›å»ºæ–‡ä»¶
		fmt.Println("ğŸ æ–°å»ºæ–‡ä»¶ news.txt")

	}
	defer f.Close()	// å…³é—­æ–‡ä»¶
	write := bufio.NewWriter(f)
	defer write.Flush()

	// å¯¹æŒ‡å®šé“¾æ¥ç½‘é¡µå†…å®¹è¿›è¡Œå¤„ç†
	c.OnHTML("a[href]", func (e *colly.HTMLElement)  {
		href := e.Text	// è·å–æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
		write.WriteString("ğŸ’ "+href+"\n")
		fmt.Println("ğŸ ç½‘é¡µå†…å®¹ï¼š",href)	// æ‰“å°æŒ‡å®šé“¾æ¥çš„ç½‘é¡µå†…å®¹
	})


	c.Visit(urls)	//è®¿é—®æŒ‡å®šé“¾æ¥
}
/* æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
* fileName æ–‡ä»¶å
 */
func testCheckFileExist(filename string) bool {
	var exist = true
	if _, err := os.Stat(filename); os.IsNotExist(err) {
		exist = false
	}
	return exist
}
```

**Log:**

```
ganghuang@GangHuangs-MacBook-Pro TestCrawlerBaidu % go run test_crawler_baidu.go
ganghuang@GangHuangs-MacBook-Pro TestCrawlerBaidu % go run test_crawler_baidu.go
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /                         --> main.WebRoot (3 handlers)
[GIN-debug] POST   /                         --> main.WebRoot (3 handlers)
[GIN-debug] PUT    /                         --> main.WebRoot (3 handlers)
[GIN-debug] PATCH  /                         --> main.WebRoot (3 handlers)
[GIN-debug] HEAD   /                         --> main.WebRoot (3 handlers)
[GIN-debug] OPTIONS /                         --> main.WebRoot (3 handlers)
[GIN-debug] DELETE /                         --> main.WebRoot (3 handlers)
[GIN-debug] CONNECT /                         --> main.WebRoot (3 handlers)
[GIN-debug] TRACE  /                         --> main.WebRoot (3 handlers)
[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.
Please check https://pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.
[GIN-debug] Listening and serving HTTP on :9200
```

<br/>

æ­¤æ—¶ï¼ŒMacç³»ç»Ÿå¼¹å‡ºå¦‚å›¾19.9æ‰€ç¤ºçš„Macå®‰å…¨è­¦æŠ¥ã€‚é€‰ä¸­â€œå…¬ç”¨ç½‘ç»œâ€å¤é€‰æ¡†ï¼Œå•å‡»â€œå…è®¸è®¿é—®â€æŒ‰é’®ã€‚

æ‰“å¼€é»˜è®¤æµè§ˆå™¨ï¼ˆæ¯”å¦‚ï¼šSafariæµè§ˆå™¨ï¼‰ï¼Œè®¿é—®â€œæœ¬æœºIPï¼šç«¯å£â€â€‹ï¼ˆå³127.0.0.1:9200ï¼‰â€‹ï¼Œå³å¯çœ‹åˆ°å¦‚å›¾19.10æ‰€ç¤ºçš„æç¤ºä¿¡æ¯ã€‚è¿™æ®µç¨‹åºåœ¨å½“å‰é¡¹ç›®ç›®å½•ä¸‹ç”Ÿæˆnews.txtæ–‡ä»¶ã€‚å•å‡»news.txtï¼Œå³å¯çœ‹åˆ°æŠ“å–çš„ç½‘é¡µå†…å®¹ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚

![go.0.0.57.png](./../Pictures/go.0.0.57.png)

<br/>

***
<br/><br/><br/>

># <h1 id="cellnetç½‘ç»œåº“">[cellnetç½‘ç»œåº“](https://github.com/davyxu/cellnet)</h1>

cellnetçš„è®¾è®¡ç†å¿µæ˜¯ï¼šé«˜æ€§èƒ½ã€ç®€å•ã€æ–¹ä¾¿ã€å¼€ç®±å³ç”¨ï¼Œå¸Œæœ›å¼€å‘è€…èƒ½ä½¿ç”¨cellnetè¿…é€Ÿå¼€å±•ä¸šåŠ¡å¼€å‘ï¼Œè€Œæ— é¡»ä¸ºåº•å±‚æ€§èƒ½è°ƒä¼˜åŠæ¶æ„æ‰©å±•è€Œæ‹…å¿§ã€‚

[cellnetç½‘ç»œåº“](https://github.com/davyxu/cellnet)å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œæ— è®ºæ˜¯ä½œä¸ºåˆå­¦è€…å­¦ä¹ çš„èŒƒä¾‹ï¼Œè¿˜æ˜¯ä½œä¸ºç§ç”¨ã€å•†ç”¨é¡¹ç›®çš„åŸºç¡€æ„å»ºä¹ƒè‡³æ ¸å¿ƒæŠ€æœ¯å±‚å·²ç»åœ¨ä¸šå†…å¹¿å—äº†è§£åŠä½¿ç”¨ã€‚

- **ä¸»è¦ä½¿ç”¨é¢†åŸŸï¼š**
	- æ¸¸æˆæœåŠ¡å™¨
	- æ–¹ä¾¿å®šåˆ¶ç§æœ‰åè®®ï¼Œå¿«é€Ÿæ„å»ºé€»è¾‘æœåŠ¡å™¨ã€ç½‘å…³æœåŠ¡å™¨ã€æœåŠ¡å™¨é—´äº’è”äº’é€šã€å¯¹æ¥ç¬¬ä¸‰æ–¹SDKã€è½¬æ¢ç¼–ç åè®®ç­‰
	- ARMè®¾å¤‡
	- è®¾å¤‡é—´ç½‘ç»œé€šè®¯
	- è¯åˆ¸è½¯ä»¶
	- å†…éƒ¨RPC

<br/><br/><br/>
> <h2 id="cellnetç½‘ç»œåº“çš„æµç¨‹åŠæ¶æ„">cellnetç½‘ç»œåº“çš„æµç¨‹åŠæ¶æ„</h2>

- cellnetçš„ä¸»è¦å¤„ç†æµç¨‹å’Œç»„ä»¶ç”±ä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ç»„æˆã€‚
	- Socketè¿æ¥ç®¡ç†ï¼šcellnetç½‘ç»œåº“ä½¿ç”¨è¿æ¥å™¨å’Œæ¥å—å™¨(Connectorã€Acceptor)ç®¡ç†Socketè¿æ¥ã€‚
	- ä¼šè¯(Session)ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥ä½¿ç”¨ä¼šè¯(Session)å¤„ç†æ”¶å‘åŒ…æµç¨‹ã€‚æ”¶å‘åŒ…çš„æµç¨‹å°†äº‹ä»¶é€šè¿‡äº‹ä»¶å›è°ƒ(cellnet.EventFunc)æ´¾å‘ã€‚
	-  åŒ…å¤„ç†(packet)ï¼šcellnetä¸­çš„packetåŒ…å¤„ç†ä¼šè¯æ”¶å‘æµç¨‹æ´¾å‘çš„äº‹ä»¶ï¼Œå®ç°å˜é•¿å°åŒ…çš„è§£æã€å¤„ç†å’Œæ”¶å‘ã€‚
	-  ç¼–ç å™¨ï¼šç”¨æˆ·çš„å°åŒ…ä½¿ç”¨ç¼–ç å™¨(Codec)è´Ÿè´£åŸå§‹å°åŒ…çš„å­—èŠ‚æ•°ç»„å’Œç”¨æˆ·æ¶ˆæ¯é—´çš„è½¬æ¢ã€‚
	-  æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¯ä»¥å°†æ”¶åˆ°çš„æ¶ˆæ¯æŒ‰é¡ºåºæ’é˜Ÿå¹¶æä¾›ç»™ç”¨æˆ·è¿›è¡Œå¤„ç†ã€‚
	-  æ¶ˆæ¯å…ƒä¿¡æ¯(MessageMeta)ï¼šä¸ºæ‰€æœ‰çš„ç³»ç»Ÿæä¾›é™æ€çš„æ¶ˆæ¯æ‰©å±•ä¿¡æ¯ï¼Œå¦‚æ¶ˆæ¯çš„IDã€ç¼–ç å™¨ã€åˆ›å»ºæ–¹æ³•ç­‰ã€‚

![go.0.0.58.png](./../Pictures/go.0.0.58.png)

<br/>

***
<br/><br/><br/>

> <h1 id="å›¾è¡¨åº“â€”â€”go-chart">å›¾è¡¨åº“â€”â€”go-chart</h1>

å¸‚é¢ä¸Šæœ‰è¯¸å¤šçš„å¼€æºå›¾è¡¨åº“ï¼Œæ¯”å¦‚ç™¾åº¦å¼€æºçš„EChartsã€é˜¿é‡Œå¼€æºçš„BizChartsã€Chart.jsã€HighChartsã€G2ã€D3ã€Googleå‡ºå“çš„Google Chartsç­‰ï¼Œè¿™äº›å¼€æºçš„åº“åœ¨å…¼å®¹æ€§ã€æ‹“å±•æ€§ã€æ”¯æŒå›¾è¡¨çš„ç§ç±»ã€äº¤äº’ç­‰å±‚é¢å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œå…·ä½“çš„é€‰æ‹©è¦ç»“åˆå…·ä½“çš„æƒ…å†µï¼ˆæ¯”å¦‚å¼€å‘è€…é€‰æ‹©çš„æŠ€æœ¯æ ˆã€éœ€è¦æ”¯æŒçš„å›¾è¡¨ç§ç±»ç­‰å„æ–¹é¢ï¼‰â€‹ã€‚


å‚ç…§ä¹‹å‰çš„æ€æƒ³ï¼Œæœ¬èŠ‚å°†åŸºäºchart.jsæ„å»ºä¸€ä¸ªå®Œæ•´çš„å›¾è¡¨åº“go-chartï¼Œæ”¯æŒæŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ã€é¥¼å›¾ã€é›·è¾¾å›¾ã€æ•£ç‚¹å›¾ã€æ°”æ³¡å›¾ç­‰ã€‚

[å®Œæ•´ä»£ç åœ°å€](https://github.com/goecharts/go-chart)


<br/><br/><br/>

***
<br/>

> <h1 id="â€Œè®¤è¯å’ŒæˆæƒJWT">â€Œè®¤è¯å’ŒæˆæƒJWT</h1>
JWT (JSON Web Token) æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼ä¼ é€’å£°æ˜ï¼ˆä¿¡æ¯ï¼‰ã€‚å®ƒæ˜¯åŸºäº JSON æ ¼å¼çš„ï¼Œå¹¶ä¸”é€šå¸¸ç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒåœºæ™¯ã€‚

<br/><br/><br/>
> <h2 id="JWTä»‹ç»">JWTä»‹ç»</h2>

**JWTï¼ˆJSON Web Tokenï¼‰** æ˜¯ä¸€ä¸ªåŒ…å« JSON æ ¼å¼æ•°æ®çš„å®‰å…¨ä»¤ç‰Œï¼Œå®ƒè¢«å¹¿æ³›ç”¨äº Web åº”ç”¨ä¸­çš„è®¤è¯å’Œæˆæƒæµç¨‹ã€‚å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

1. **Headerï¼ˆå¤´éƒ¨ï¼‰**ï¼š
   - é€šå¸¸åŒ…å«ä¸¤éƒ¨åˆ†ï¼šä»¤ç‰Œç±»å‹ï¼ˆJWTï¼‰å’Œç­¾åç®—æ³•ï¼ˆå¦‚ HMAC SHA256 æˆ– RSA ç­‰ï¼‰ã€‚

ç¤ºä¾‹ï¼š

```json
{
 "alg": "HS256",
 "typ": "JWT"
}
```

2. **Payloadï¼ˆè´Ÿè½½ï¼‰**ï¼š
   - è´Ÿè½½éƒ¨åˆ†åŒ…å«äº†å£°æ˜ï¼ˆclaimsï¼‰ï¼Œå£°æ˜é€šå¸¸æ˜¯å…³äºå®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰å’Œå…¶ä»–æ•°æ®çš„å…ƒæ•°æ®ã€‚JWT å¯ä»¥åŒ…æ‹¬ä¸‰ç§ç±»å‹çš„å£°æ˜ï¼š
     - **Registered Claims**ï¼šé¢„å®šä¹‰çš„å£°æ˜ï¼Œå¦‚ `sub`ï¼ˆä¸»é¢˜ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·IDï¼‰ã€`iat`ï¼ˆç­¾å‘æ—¶é—´ï¼‰ç­‰ã€‚
     - **Public Claims**ï¼šè‡ªå®šä¹‰å£°æ˜ï¼Œå¯ä»¥åŒ…å«ä»»ä½•ç”¨æˆ·éœ€è¦çš„ä¿¡æ¯ã€‚
     - **Private Claims**ï¼šç”±ç”¨æˆ·è‡ªå®šä¹‰çš„å£°æ˜ï¼Œé€šå¸¸ç”¨äºåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’ä¿¡æ¯ã€‚

   ç¤ºä¾‹ï¼š
```json
{
 "sub": "1234567890",
 "name": "John Doe",
 "iat": 1516239022
}
```

3. **Signatureï¼ˆç­¾åï¼‰**ï¼š
   - ç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å¹¶ç¡®è®¤å‘é€æ–¹èº«ä»½ã€‚ç­¾åæ˜¯é€šè¿‡åŠ å¯†ç®—æ³•ï¼ˆå¦‚ HMAC SHA256ï¼‰å¯¹ Header å’Œ Payload è¿›è¡ŒåŠ å¯†ç”Ÿæˆçš„ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå¯†é’¥ã€‚

ç”Ÿæˆç­¾åçš„æ–¹å¼ï¼š

```plaintext
HMACSHA256(
 base64UrlEncode(header) + "." + base64UrlEncode(payload),
 secretKey
)
```

> **JWT å·¥ä½œåŸç†ï¼š**

1. **ç”Ÿæˆ JWT**ï¼š
   - å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨éªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆå¦‚ç”¨æˆ·åå’Œå¯†ç ï¼‰ã€‚éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡å™¨åˆ›å»º JWTï¼Œå°†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚ `user_id`ã€`role` ç­‰ï¼‰ä½œä¸ºå£°æ˜ï¼ˆclaimsï¼‰æ”¾å…¥è´Ÿè½½éƒ¨åˆ†ï¼Œå¹¶ä½¿ç”¨å¯†é’¥å¯¹å…¶è¿›è¡Œç­¾åã€‚ç„¶åï¼ŒJWT è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

2. **ä½¿ç”¨ JWT**ï¼š
   - å®¢æˆ·ç«¯å°† JWT ä¿å­˜åœ¨æµè§ˆå™¨çš„ localStorage æˆ– cookies ä¸­ï¼Œåœ¨åç»­è¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å°† JWT ä½œä¸º Authorization header å‘é€åˆ°æœåŠ¡å™¨ã€‚

3. **éªŒè¯ JWT**ï¼š
   - æœåŠ¡å™¨æ¥æ”¶åˆ° JWT åï¼Œé€šè¿‡å¯†é’¥éªŒè¯ JWT çš„ç­¾åï¼Œä»¥ç¡®ä¿ JWT åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚å¦‚æœç­¾åæœ‰æ•ˆï¼ŒæœåŠ¡å™¨å°±å¯ä»¥ä» JWT ä¸­æå–å‡ºç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œç›¸å…³æ“ä½œã€‚

<br/>
> **ä¸ºä»€ä¹ˆä½¿ç”¨ JWTï¼Ÿ**

1. **æ— çŠ¶æ€è®¤è¯**ï¼šJWT å…è®¸å°†æ‰€æœ‰çš„èº«ä»½éªŒè¯ä¿¡æ¯åŒ…å«åœ¨ä»¤ç‰Œä¸­ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä»»ä½•å…³äºç”¨æˆ·ä¼šè¯çš„çŠ¶æ€ä¿¡æ¯ï¼ˆæ— çŠ¶æ€è®¤è¯ï¼‰ã€‚
   
2. **è·¨å¹³å°å…¼å®¹**ï¼šJWT æ˜¯åŸºäº JSON æ ¼å¼çš„ï¼Œå› æ­¤å®ƒå¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„è¯­è¨€å’Œå¹³å°ä¹‹é—´ä¼ è¾“ã€‚

3. **å®‰å…¨æ€§**ï¼šJWT æ”¯æŒåŠ å¯†å’Œç­¾åï¼Œèƒ½ç¡®ä¿ä¿¡æ¯çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚

4. **çµæ´»æ€§**ï¼šJWT å…è®¸å­˜å‚¨è‡ªå®šä¹‰æ•°æ®ï¼Œä¸”é€šè¿‡ç­¾åéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§å’Œæ¥æºã€‚

<br/><br/><br/>
> <h2 id="`jwt-go`åº“">`jwt-go`åº“</h2>
åœ¨ Go è¯­è¨€ä¸­ï¼Œ`jwt-go` æ˜¯ä¸€ä¸ªæµè¡Œçš„åº“ï¼Œç”¨äºåˆ›å»ºå’ŒéªŒè¯ JWTã€‚ä½¿ç”¨è¿™ä¸ªåº“ï¼Œä½ å¯ä»¥è½»æ¾åœ°å®ç°èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚

**å®‰è£… `jwt-go` åº“ï¼š**

```bash
go get -u github.com/dgrijalva/jwt-go
```

<br/>

**åˆ›å»º JWT ç¤ºä¾‹ï¼š**

```go
package main

import (
	"fmt"
	"time"
	"github.com/dgrijalva/jwt-go"
)

func GenerateJWT() (string, error) {
	// åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼Œç”¨äºç­¾å
	secretKey := []byte("mySecretKey")

	// åˆ›å»ºä¸€ä¸ªæ–°çš„ token å¯¹è±¡
	token := jwt.New(jwt.SigningMethodHS256)

	// è®¾ç½® token çš„ Claims
	claims := token.Claims.(jwt.MapClaims)
	claims["sub"] = "1234567890"  // ä¾‹å¦‚ï¼Œå­˜å‚¨ç”¨æˆ·ID
	claims["name"] = "John Doe"    // å­˜å‚¨ç”¨æˆ·å
	claims["iat"] = time.Now().Unix() // ç­¾å‘æ—¶é—´
	claims["exp"] = time.Now().Add(time.Hour * 24).Unix()  // è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œ24å°æ—¶

	// ä½¿ç”¨æŒ‡å®šçš„å¯†é’¥ç”Ÿæˆ token å­—ç¬¦ä¸²
	tokenString, err := token.SignedString(secretKey)
	if err != nil {
		return "", err
	}

	return tokenString, nil
}

func main() {
	// ç”Ÿæˆ JWT
	tokenString, err := GenerateJWT()
	if err != nil {
		fmt.Println("Error generating token:", err)
		return
	}
	fmt.Println("Generated JWT:", tokenString)
}
```

<br/>

**éªŒè¯ JWT ç¤ºä¾‹ï¼š**

```go
package main

import (
	"fmt"
	"github.com/dgrijalva/jwt-go"
	"time"
)

func ValidateJWT(tokenString string) (bool, error) {
	// è®¾ç½®å¯†é’¥ï¼Œç”¨äºéªŒè¯ç­¾å
	secretKey := []byte("mySecretKey")

	// è§£æå¹¶éªŒè¯ token
	token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {
		// ç¡®ä¿ token çš„ç­¾åæ–¹æ³•æ˜¯æ­£ç¡®çš„
		if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
			return nil, fmt.Errorf("unexpected signing method")
		}
		return secretKey, nil
	})

	// æ£€æŸ¥è§£æè¿‡ç¨‹ä¸­æ˜¯å¦å‘ç”Ÿé”™è¯¯
	if err != nil {
		return false, err
	}

	// æ£€æŸ¥ token æ˜¯å¦æœ‰æ•ˆ
	if claims, ok := token.Claims.(jwt.MapClaims); ok && token.Valid {
		// ä½ å¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥ JWT çš„ Claims æ˜¯å¦ç¬¦åˆä½ çš„éœ€æ±‚
		if exp, ok := claims["exp"].(float64); ok {
			// æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸ
			if int64(exp) < time.Now().Unix() {
				return false, fmt.Errorf("token has expired")
			}
		}
		return true, nil
	}
	return false, fmt.Errorf("invalid token")
}

func main() {
	// å‡è®¾ä½ å·²ç»æœ‰ä¸€ä¸ªç”Ÿæˆçš„ token
	tokenString := "your_jwt_token_string_here"

	// éªŒè¯ JWT
	valid, err := ValidateJWT(tokenString)
	if err != nil {
		fmt.Println("Error validating token:", err)
		return
	}

	if valid {
		fmt.Println("JWT is valid.")
	} else {
		fmt.Println("JWT is invalid.")
	}
}
```

**æ€»ç»“ï¼š**
- **JWT** æ˜¯ä¸€ç§éå¸¸æµè¡Œçš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œé€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€API è®¤è¯ç­‰åœºæ™¯ã€‚
- **jwt-go** åº“æ˜¯ Go è¯­è¨€ä¸­å¸¸ç”¨çš„ JWT åº“ï¼Œç”¨äºç”Ÿæˆå’ŒéªŒè¯ JWTã€‚
- é€šè¿‡ä½¿ç”¨ JWTï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨çš„æ•°æ®ï¼Œå¹¶æ”¯æŒæ— çŠ¶æ€è®¤è¯ã€‚


<br/><br/><br/>
> <h2 id="JWTè®¤è¯ä¸­é—´ä»¶">JWTè®¤è¯ä¸­é—´ä»¶</h2>

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/dgrijalva/jwt-go"
    "net/http"
    "strings"
    "time"
)

// è‡ªå®šä¹‰ JWT ç»“æ„ä½“
type MyClaims struct {
    Username string `json:"username"`
    jwt.StandardClaims //æ˜¯ jwt-go æä¾›çš„æ ‡å‡†å­—æ®µï¼Œæ¯”å¦‚ expï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ã€iatï¼ˆç­¾å‘æ—¶é—´ï¼‰ã€issï¼ˆç­¾å‘è€…ï¼‰ç­‰
}

// JWT å¯†é’¥
// è¿™æ˜¯ JWT ç­¾åçš„å¯†é’¥ï¼Œç”¨æ¥ç¡®ä¿ Token æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚
// å¿…é¡»å’Œç­¾å‘ Token æ—¶ä½¿ç”¨çš„å¯†é’¥ä¸€è‡´ï¼Œå¦åˆ™è§£æä¼šå¤±è´¥ã€‚
var jwtSecret = []byte("my_secret_key")

// JWT ä¸­é—´ä»¶
func JWT() gin.HandlerFunc {
    return func(ctx *gin.Context) {
        var code int = http.StatusOK
        var msg string
        tokenStr := ctx.GetHeader("Authorization")

        if tokenStr == "" {
            code = http.StatusUnauthorized
            msg = "Token ä¸ºç©º"
        } else {
            tokenStr = strings.TrimPrefix(tokenStr, "Bearer ") // ç§»é™¤ Bearer å‰ç¼€
            token, err := jwt.ParseWithClaims(tokenStr, &MyClaims{}, func(token *jwt.Token) (interface{}, error) {
                return jwtSecret, nil
            })

            if err != nil || !token.Valid {
                code = http.StatusUnauthorized
                msg = "Token æ— æ•ˆ"
            } else {
                // è§£ææˆåŠŸï¼Œè·å– JWT è½½è·
                if claims, ok := token.Claims.(*MyClaims); ok {
                    ctx.Set("username", claims.Username) // å­˜å‚¨ç”¨æˆ·ååˆ°ä¸Šä¸‹æ–‡(claims.Username: å¯ä»¥è·å– JWT ä¸­å­˜å‚¨çš„ username)
                }
            }
        }

        if code != http.StatusOK {
            ctx.JSON(code, gin.H{"code": code, "message": msg})
            ctx.Abort() // ç»ˆæ­¢è¯·æ±‚
            return
        }

        ctx.Next() // ç»§ç»­å¤„ç†è¯·æ±‚
    }
}

// å¯åŠ¨ Gin æœåŠ¡å™¨
func main() {
    r := gin.Default()

    // ä½¿ç”¨ JWT ä¸­é—´ä»¶
    r.GET("/protected", JWT(), func(ctx *gin.Context) {
        username, _ := ctx.Get("username")
        ctx.JSON(http.StatusOK, gin.H{"message": "è®¿é—®æˆåŠŸ", "user": username})
    })

    r.Run(":8080") // å¯åŠ¨æœåŠ¡å™¨
}
```
<br/>
**è§£æå¹¶è®¤è¯JWTä»¤ç‰Œ**

```go
token, err := jwt.ParseWithClaims(tokenStr, &MyClaims{}, func(token *jwt.Token) (interface{}, error) {
    return jwtSecret, nil
})
```

- jwt.ParseWithClaims() æ˜¯ jwt-go åº“ä¸­çš„å‡½æ•°ï¼Œç”¨äºè§£æ JWT ä»¤ç‰Œï¼Œå¹¶å°†å…¶è§£ç ä¸ºæŒ‡å®šçš„ç»“æ„ä½“ MyClaimsã€‚
- å‚æ•°
	- tokenStrï¼šå®¢æˆ·ç«¯ä¼ æ¥çš„ JWT ä»¤ç‰Œå­—ç¬¦ä¸²ï¼ˆé€šå¸¸åœ¨ Authorization å¤´éƒ¨ï¼‰ã€‚
	- &MyClaims{}ï¼šè‡ªå®šä¹‰çš„ JWT è½½è·ï¼ˆClaimsï¼‰ç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨ Token å†…çš„æ•°æ®ã€‚
	- func(token *jwt.Token) (interface{}, error) { return jwtSecret, nil }ï¼š
	- ç”¨äºæä¾› JWT ç­¾åå¯†é’¥ï¼ˆjwtSecretï¼‰ã€‚
	- jwtSecret æ˜¯ä¸€ä¸ª []byteï¼Œç”¨äºéªŒè¯ Token æ˜¯å¦è¢«ç¯¡æ”¹ã€‚


<br/>
**è¿”å›ç­¾åå¯†é’¥**

```go
func(token *jwt.Token) (interface{}, error) {
    return jwtSecret, nil
}
```

è¿™ä¸ªå‡½æ•°æ˜¯ jwt.ParseWithClaims() çš„å›è°ƒå‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š
- æä¾›ç”¨äºéªŒè¯ Token çš„å¯†é’¥ã€‚
- ç¡®ä¿ Token ä¸æ˜¯ä¼ªé€ çš„ï¼Œå¹¶ä¸”ç­¾åæ˜¯æ­£ç¡®çš„ã€‚

<br/>

**æ€»ç»“**
| ä»£ç éƒ¨åˆ† | ä½œç”¨ |
|----------|------------------------------------------------|
| `jwt.ParseWithClaims(tokenStr, &MyClaims{}, func...)` | è§£æ JWT ä»¤ç‰Œå¹¶éªŒè¯ç­¾å |
| `&MyClaims{}` | è§£æ JWT è½½è·ï¼ˆpayloadï¼‰åˆ°è‡ªå®šä¹‰ç»“æ„ä½“ |
| `func(token *jwt.Token) (interface{}, error) { return jwtSecret, nil }` | æä¾› JWT ç­¾åå¯†é’¥ï¼Œç¡®ä¿ Token æ²¡æœ‰è¢«ç¯¡æ”¹ |
| `token.Valid` | å¦‚æœ `true`ï¼Œè¡¨ç¤º Token æ˜¯æœ‰æ•ˆçš„ |






<br/><br/><br/>

***
<br/>

> <h2 id="æ•°æ®éªŒè¯åº“">æ•°æ®éªŒè¯åº“</h2>

<br/>
> <h2 id="beego/validationæ¡†æ¶">beego/validationæ¡†æ¶</h2>

<br/>
> <h2 id="æ•°æ®éªŒè¯validation">æ•°æ®éªŒè¯validation</h2>

```
go get -u github.com/astaxie/beego/validation 
```


`github.com/astaxie/beego/validation` æ˜¯ **Beego æ¡†æ¶** æä¾›çš„ **æ•°æ®éªŒè¯**ï¼ˆvalidationï¼‰åº“ï¼Œç”¨äºå¯¹ç»“æ„ä½“å­—æ®µã€è¡¨å•æ•°æ®ç­‰è¿›è¡Œæ ¡éªŒï¼Œç±»ä¼¼äº `validator` åº“ã€‚å®ƒå¯ä»¥å¸®åŠ©å¼€å‘è€…è¿›è¡Œè¾“å…¥æ•°æ®çš„åˆæ³•æ€§æ£€æŸ¥ï¼Œæ¯”å¦‚éç©ºæ ¡éªŒã€é•¿åº¦é™åˆ¶ã€æ•°å€¼èŒƒå›´ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰ã€‚

---

**å¦‚ä½•ä½¿ç”¨ `validation` è¿›è¡Œæ•°æ®éªŒè¯ï¼Ÿ**

**1. å®‰è£… `validation`**

```sh
go get -u github.com/astaxie/beego/validation
```

**2. åŸºæœ¬ç¤ºä¾‹**

```go
package main

import (
    "fmt"
    "github.com/astaxie/beego/validation"
)

// å®šä¹‰ä¸€ä¸ª User ç»“æ„ä½“
type User struct {
    Name  string `valid:"Required;MaxSize(10)"` // å¿…å¡«ï¼Œæœ€å¤§é•¿åº¦ 10
    Age   int    `valid:"Range(1, 100)"`        // å¹´é¾„å¿…é¡»åœ¨ 1 åˆ° 100 ä¹‹é—´
    Email string `valid:"Email"`                // å¿…é¡»æ˜¯æœ‰æ•ˆçš„ Email
}

func main() {
    user := User{Name: "", Age: 150, Email: "invalid-email"}

    valid := validation.Validation{}
    passed, err := valid.Valid(&user) // å¯¹ç»“æ„ä½“è¿›è¡ŒéªŒè¯
    if err != nil {
        fmt.Println("éªŒè¯å‡ºé”™:", err)
        return
    }

    if !passed {
        for _, err := range valid.Errors {
            fmt.Println("é”™è¯¯å­—æ®µ:", err.Key, "é”™è¯¯ä¿¡æ¯:", err.Message)
        }
    } else {
        fmt.Println("æ‰€æœ‰å­—æ®µéªŒè¯é€šè¿‡ï¼")
    }
}
```
**è¿è¡Œç»“æœ**

```
é”™è¯¯å­—æ®µ: Name é”™è¯¯ä¿¡æ¯: can not be empty
é”™è¯¯å­—æ®µ: Age é”™è¯¯ä¿¡æ¯: 1 <= 100
é”™è¯¯å­—æ®µ: Email é”™è¯¯ä¿¡æ¯: must be a valid email address
```
- `Name` ä¸èƒ½ä¸ºç©º
- `Age` è¶…å‡º `1-100` çš„èŒƒå›´
- `Email` æ ¼å¼ä¸æ­£ç¡®

---

**3. ç›´æ¥å¯¹å˜é‡è¿›è¡Œæ ¡éªŒ**

é™¤äº†éªŒè¯ç»“æ„ä½“ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥å¯¹å˜é‡è¿›è¡Œå•ç‹¬éªŒè¯ï¼š

```go
valid := validation.Validation{}

email := "not-an-email"
if v := valid.Email(email, "Email"); !v.Ok {
    fmt.Println(v.Error.Key, v.Error.Message) // è¾“å‡ºï¼šEmail must be a valid email address
}
```

---

**4. è‡ªå®šä¹‰éªŒè¯è§„åˆ™**

å¦‚æœé»˜è®¤çš„æ ¡éªŒè§„åˆ™ä¸å¤Ÿç”¨ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰éªŒè¯é€»è¾‘ï¼š

```go
valid := validation.Validation{}
valid.CustomFunc(func(value interface{}) bool {
    str, ok := value.(string)
    return ok && len(str) > 5 // é•¿åº¦å¿…é¡»å¤§äº 5
}).Message("é•¿åº¦å¿…é¡»å¤§äº5")

valid.Valid("abc") // å¤±è´¥ï¼Œå› ä¸ºé•¿åº¦ä¸å¤Ÿ
```

---

**5. ç»“åˆ `gin` æ¡†æ¶ä½¿ç”¨**
åœ¨ `gin` é‡Œï¼Œä½ å¯ä»¥ç»“åˆ `beego/validation` æ¥éªŒè¯ HTTP è¯·æ±‚å‚æ•°ï¼š

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/astaxie/beego/validation"
    "net/http"
)

type LoginForm struct {
    Username string `valid:"Required"`
    Password string `valid:"Required;MinSize(6)"`
}

func login(c *gin.Context) {
    var form LoginForm
    if err := c.ShouldBindJSON(&form); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }

    valid := validation.Validation{}
    if passed, _ := valid.Valid(&form); !passed {
        errors := make(map[string]string)
        for _, err := range valid.Errors {
            errors[err.Key] = err.Message
        }
        c.JSON(http.StatusBadRequest, gin.H{"errors": errors})
        return
    }

    c.JSON(http.StatusOK, gin.H{"message": "ç™»å½•æˆåŠŸ"})
}

func main() {
    r := gin.Default()
    r.POST("/login", login)
    r.Run(":8080")
}
```
- è¿™é‡Œçš„ `login` å¤„ç†å‡½æ•°ä¼šéªŒè¯ `Username` å’Œ `Password`ï¼Œå¦‚æœä¸ç¬¦åˆè§„åˆ™ï¼Œå°±è¿”å› `400 Bad Request`ã€‚

---

**6.å¸¸è§çš„éªŒè¯è§„åˆ™**

| è§„åˆ™ | ä½œç”¨ |
|------|------|
| `Required` | ä¸èƒ½ä¸ºç©º |
| `MinSize(n)` | å­—ç¬¦ä¸²é•¿åº¦è‡³å°‘ä¸º `n` |
| `MaxSize(n)` | å­—ç¬¦ä¸²é•¿åº¦æœ€å¤šä¸º `n` |
| `Range(min, max)` | æ•°å€¼åœ¨ `[min, max]` ä¹‹é—´ |
| `Email` | å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼ |
| `IP` | å¿…é¡»æ˜¯æœ‰æ•ˆçš„ IP åœ°å€ |
| `Mobile` | å¿…é¡»æ˜¯æœ‰æ•ˆçš„æ‰‹æœºå·ç  |
| `Alpha` | åªèƒ½åŒ…å«å­—æ¯ |
| `Numeric` | åªèƒ½åŒ…å«æ•°å­— |
| `Match(pattern)` | å¿…é¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ |

---

- **7.`beego/validation` vs `go-playground/validator`**
Go é‡Œé¢æ›´å¸¸è§çš„éªŒè¯åº“æ˜¯ [`go-playground/validator`](https://github.com/go-playground/validator)ï¼Œç›¸æ¯” `beego/validation`ï¼š
	- `validator` **æ›´æµè¡Œ**ï¼Œä¸”æ”¯æŒ **åµŒå¥—ç»“æ„ä½“** å’Œ **è‡ªå®šä¹‰æ ‡ç­¾**
	- `beego/validation` **æ›´çµæ´»**ï¼Œå¯ä»¥å•ç‹¬å¯¹å˜é‡è¿›è¡ŒéªŒè¯

å¦‚æœä½ ä¸ä½¿ç”¨ `beego` æ¡†æ¶ï¼Œå»ºè®®ç”¨ `go-playground/validator` ä½œä¸ºæ›´ç°ä»£çš„é€‰æ‹©ã€‚

---

## **æ€»ç»“**
`github.com/astaxie/beego/validation` æ˜¯ä¸€ä¸ª **æ•°æ®éªŒè¯åº“**ï¼Œç”¨äºæ ¡éªŒ **ç»“æ„ä½“** æˆ– **å˜é‡**ï¼Œå¸¸ç”¨äºè¡¨å•æäº¤ã€API å‚æ•°æ ¡éªŒç­‰ã€‚å®ƒæ”¯æŒï¼š
- **ç»“æ„ä½“å­—æ®µæ ¡éªŒ**
- **ç›´æ¥å¯¹å˜é‡æ ¡éªŒ**
- **è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™**
- **ä¸ `gin` ç­‰ Web æ¡†æ¶é…åˆä½¿ç”¨**

ä½†å¦‚æœä½ ä¸ä½¿ç”¨ `beego`ï¼Œå¯ä»¥è€ƒè™‘ `go-playground/validator` ä½œä¸ºæ›´ç°ä»£çš„æ›¿ä»£æ–¹æ¡ˆã€‚


<br/><br/><br/>
> <h2 id="govalidatoråº“æ•°æ®éªŒè¯">govalidatoråº“æ•°æ®éªŒè¯</h2>

**ä»£ç è§£æ**

```go
type auth struct {
    Username string `valid:"Required; MaxSize(50)"`
}
```

- `auth` æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œè¡¨ç¤º**èº«ä»½è®¤è¯ä¿¡æ¯**ã€‚
- `Username` å­—æ®µï¼š
	- **ç±»å‹**ï¼š`string`ï¼ˆç”¨æˆ·åï¼‰
	- **æ ¡éªŒæ ‡ç­¾**ï¼š`valid:"Required; MaxSize(50)"`

---

- **1.`valid` æ ‡ç­¾**
åœ¨ Go è¯­è¨€ä¸­ï¼Œ`valid` æ˜¯ **ç¬¬ä¸‰æ–¹æ•°æ®éªŒè¯åº“** [**`govalidator`**](https://github.com/asaskevich/govalidator) æä¾›çš„æ ‡ç­¾ï¼Œç”¨äº**è‡ªåŠ¨æ ¡éªŒç»“æ„ä½“å­—æ®µ**ã€‚

è¿™æ®µä»£ç çš„ `valid` æ ‡ç­¾å®šä¹‰äº†**ä¸¤ä¸ªéªŒè¯è§„åˆ™**ï¼š
1. **`Required`**ï¼šç”¨æˆ·åæ˜¯**å¿…å¡«å­—æ®µ**ï¼Œä¸èƒ½ä¸ºç©ºã€‚
2. **`MaxSize(50)`**ï¼šç”¨æˆ·å**æœ€å¤§é•¿åº¦ä¸º 50 ä¸ªå­—ç¬¦**ï¼Œä¸èƒ½è¶…è¿‡ã€‚

---

- **2.å¦‚ä½•ä½¿ç”¨ `govalidator` éªŒè¯ `auth` ç»“æ„ä½“ï¼Ÿ**

**å®‰è£… `govalidator`**
å¦‚æœå°šæœªå®‰è£… `govalidator`ï¼Œå¯ä»¥ä½¿ç”¨ `go get` è¿›è¡Œå®‰è£…ï¼š

```sh
go get github.com/asaskevich/govalidator
```

---

**ç¤ºä¾‹ï¼šéªŒè¯ `auth` ç»“æ„ä½“**

```go
package main

import (
    "fmt"
    "github.com/asaskevich/govalidator"
)

// å®šä¹‰ auth ç»“æ„ä½“
type auth struct {
    Username string `valid:"required, stringlength(1|50)"` // è¿™é‡Œç”¨é€—å·åˆ†éš”è§„åˆ™
}

func main() {
    a := auth{Username: "Alice"}

    // è¿›è¡ŒéªŒè¯
    _, err := govalidator.ValidateStruct(a)
    
    if err != nil {
        fmt.Println("éªŒè¯å¤±è´¥:", err)
    } else {
        fmt.Println("éªŒè¯æˆåŠŸ:", a.Username)
    }
}
```

---

- **3.è¯¦ç»†è§£è¯»**
**ğŸ”¹ `govalidator.ValidateStruct(a)`**
- **`ValidateStruct(a)`** æ˜¯ `govalidator` æä¾›çš„å‡½æ•°ï¼Œç”¨äº**æ£€æŸ¥ç»“æ„ä½“æ˜¯å¦ç¬¦åˆ `valid` æ ‡ç­¾çš„è§„åˆ™**ã€‚
- å¦‚æœ **éªŒè¯å¤±è´¥**ï¼Œä¼šè¿”å› `error`ã€‚
- å¦‚æœ **éªŒè¯æˆåŠŸ**ï¼Œä¸ä¼šè¿”å›é”™è¯¯ã€‚

<br/>

**ğŸ”¹ ç»“æ„ä½“æ ¡éªŒè§„åˆ™**

| è§„åˆ™ | ä½œç”¨ |
|------|----------------------------|
| `required` | å­—æ®µ**ä¸èƒ½ä¸ºç©º** |
| `stringlength(1|50)` | **å­—ç¬¦ä¸²é•¿åº¦å¿…é¡»åœ¨ 1 åˆ° 50 ä¹‹é—´** |

---

**4. æµ‹è¯•ä¸åŒæƒ…å†µ**
**âœ… éªŒè¯æˆåŠŸ**

```go
a := auth{Username: "Alice"}  
_, err := govalidator.ValidateStruct(a) // âœ… æˆåŠŸ
```
**è¾“å‡º**

```
éªŒè¯æˆåŠŸ: Alice
```

---

**âŒ éªŒè¯å¤±è´¥ï¼ˆç”¨æˆ·åä¸ºç©ºï¼‰**

```go
a := auth{Username: ""}  
_, err := govalidator.ValidateStruct(a)
```
**è¾“å‡º**

```
éªŒè¯å¤±è´¥: Username: non zero value required
```
**åŸå› **
- `required` è§„åˆ™è§¦å‘ï¼š`Username` ä¸èƒ½ä¸ºç©ºã€‚

---

**âŒ éªŒè¯å¤±è´¥ï¼ˆç”¨æˆ·åå¤ªé•¿ï¼‰**

```go
a := auth{Username: "ThisIsAVeryLongUsernameThatExceedsFiftyCharacters12345"}  
_, err := govalidator.ValidateStruct(a)
```
**è¾“å‡º**

```
éªŒè¯å¤±è´¥: Username: the length must be between 1 and 50
```
**åŸå› **
- `MaxSize(50)` è§„åˆ™è§¦å‘ï¼šå­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡ 50ã€‚

---

**5.`valid` æ ‡ç­¾çš„å…¶ä»–ç”¨æ³•**
| æ ¡éªŒè§„åˆ™ | è¯´æ˜ |
|----------|--------------------------------|
| `required` | å¿…å¡«å­—æ®µï¼Œä¸èƒ½ä¸ºç©º |
| `stringlength(1|50)` | å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶ |
| `numeric` | åªèƒ½æ˜¯æ•°å­— |
| `email` | å¿…é¡»æ˜¯åˆæ³•çš„ Email |
| `url` | å¿…é¡»æ˜¯åˆæ³•çš„ URL |
| `alphanum` | åªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­— |
| `matches(^[A-Za-z]+$)` | å¿…é¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ |
| `in(admin,user,guest)` | åªèƒ½æ˜¯ `admin`ã€`user` æˆ– `guest` |

---

## **6. æ”¹è¿›ç‰ˆï¼šæ·»åŠ  `Password` å­—æ®µ**
å¯ä»¥æ‰©å±• `auth` ç»“æ„ä½“ï¼Œå¢åŠ  **å¯†ç éªŒè¯**ï¼š

```go
type auth struct {
    Username string `valid:"required, stringlength(1|50)"`
    Password string `valid:"required, stringlength(6|20)"`
}
```
- `Password` **å¿…å¡«**ï¼Œé•¿åº¦**6-20**ã€‚

---

## **7. æ€»ç»“**
âœ… **`valid:"Required; MaxSize(50)"`** æ˜¯ `govalidator` æä¾›çš„**æ•°æ®æ ¡éªŒæ ‡ç­¾**ã€‚  
âœ… **ç”¨äºæ ¡éªŒ `Username` å¿…å¡«ï¼Œä¸”æœ€å¤§é•¿åº¦ä¸èƒ½è¶…è¿‡ 50**ã€‚  
âœ… **`govalidator.ValidateStruct(a)` è‡ªåŠ¨éªŒè¯ç»“æ„ä½“å­—æ®µæ˜¯å¦ç¬¦åˆè§„åˆ™**ã€‚  
âœ… **å¯ä»¥æ‰©å±•ä¸º `Password`ã€`Email`ã€`URL` ç­‰å­—æ®µ**ã€‚


<br/>

***
<br/><br/><br/>

># <h1 id="å›¾è¡¨åº“go-echarts">[å›¾è¡¨åº“go-echarts](https://github.com/go-echarts/go-echarts)</h1>

åŸºäºEChartså›¾è¡¨åº“é€æ­¥è®²è§£å¦‚ä½•æ„å»ºå›¾è¡¨ï¼Œæ•´ä½“çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

- æ˜ç¡®EChartså¦‚ä½•æ„å»ºå›¾è¡¨ã€‚
- å»¶ä¼¸åˆ°ä½¿ç”¨æ¨¡æ¿å¼•æ“åŠ è½½åŠ¨æ€æ•°æ®çš„æ–¹å¼æ„å»ºå›¾è¡¨ã€‚
- æŠ½å–å…¬å…±çš„ç»“æ„ä½“ï¼Œæ–¹ä¾¿ç»„åˆå¤ç”¨ã€‚
- å„å›¾è¡¨ç±»å‹å¯¹è±¡å®ç°å®šä¹‰çš„æ¥å£(Interface)ã€‚

å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰æ¶‰åŠï¼Œä½†æ˜¯æ•´ä½“æ€æƒ³çš†æ˜¯å¦‚æ­¤ï¼Œå¦‚æœæƒ³åŸºäºEChartsæ„å»ºæ›´ä¸ºä¸°å¯Œçš„å›¾è¡¨ç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹[go-echarts](https://github.com/go-echarts/go-echarts)ï¼Œå…¶ä¸­é‡‡ç”¨çš„æ€ç»´æ–¹å¼æ˜¯ç±»ä¼¼çš„ï¼Œè€Œå®ç°çš„åŠŸèƒ½æ›´åŠ å®Œå–„ã€‚


<br/>

***
<br/><br/><br/>

> <h1 id="packråº“å¤„ç†æ¨¡æ¿å¼•æ“å†…çš„æ–‡ä»¶">packråº“å¤„ç†æ¨¡æ¿å¼•æ“å†…çš„æ–‡ä»¶</h1>

packråº“èƒ½å¤Ÿæ¯”è¾ƒä¼˜é›…åœ°å¤„ç†æ¨¡æ¿å¼•æ“å†…çš„æ–‡ä»¶ã€‚

**ä¸‹è½½å‘½ä»¤å¦‚ä¸‹ï¼š**

```
go get -u github.com/gobuffalo/packr
```

<br/>

***
<br/><br/><br/>

> <h1 id="GJSONè§£æJSONæ•°æ®">GJSONè§£æJSONæ•°æ®</h1>

GJSONæ˜¯ä¸€ä¸ªæ›´ä¾¿æ·çš„è§£æJSONæ•°æ®çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ”¯æŒé“¾å¼æ“ä½œï¼Œèƒ½è®©è¯»è€…éå¸¸æ–¹ä¾¿åœ°è·å–ä»»æ„æ•°æ®ã€‚

**ä¸‹è½½**

```
go get -u github.com/tidwall/gjson
```


<br/>

***
<br/><br/><br/>

> <h1 id="IrisWebæ¡†æ¶">Iris Webæ¡†æ¶</h1>

<br/><br/><br/>
> <h2 id="IrisWebæ¡†æ¶è¯¦è§£">Iris Webæ¡†æ¶è¯¦è§£</h2>

- **1.ä»€ä¹ˆæ˜¯ Irisï¼Ÿ**

[Iris](https://www.iris-go.com/) æ˜¯ Go è¯­è¨€ä¸­çš„ä¸€ä¸ªé«˜æ€§èƒ½ã€åŠŸèƒ½ä¸°å¯Œçš„ Web æ¡†æ¶ï¼Œæä¾›äº†å¼ºå¤§çš„è·¯ç”±ã€MVC æ”¯æŒã€ä¸­é—´ä»¶æœºåˆ¶å’Œ WebSocket å¤„ç†èƒ½åŠ›ã€‚å®ƒæ˜¯ Go ç”Ÿæ€ä¸­**æœ€å¿«**çš„ Web æ¡†æ¶ä¹‹ä¸€ï¼Œå¹¶æ”¯æŒæ‰©å±•æ€§å¼ºçš„åŠŸèƒ½ï¼Œå¦‚ä¾èµ–æ³¨å…¥ã€JWT è®¤è¯ã€å¤šç§æ¨¡æ¿å¼•æ“ã€æ•°æ®åº“é›†æˆç­‰ã€‚

<br/>

- **2.Iris çš„ç‰¹ç‚¹**
	- **é«˜æ€§èƒ½**ï¼šIris å·ç§°æ˜¯ **æœ€å¿«çš„ Go Web æ¡†æ¶**ï¼Œæ¯” `gin` æ›´å¿«ï¼ˆå®˜æ–¹ Benchmark æµ‹è¯•ï¼‰ã€‚
	- **ç®€æ´æ˜“ç”¨**ï¼šAPI è®¾è®¡æ¸…æ™°ï¼Œä»£ç é£æ ¼ç®€æ´ã€‚
	- **MVC è®¾è®¡æ¨¡å¼**ï¼šæ”¯æŒ `Model-View-Controller` æ¶æ„ï¼Œé€‚ç”¨äºå¤§å‹é¡¹ç›®ã€‚
	- **å†…ç½®ä¸­é—´ä»¶**ï¼šæ”¯æŒ `JWT`ã€`CORS`ã€`æ—¥å¿—`ã€`Gzip` å‹ç¼©ç­‰ã€‚
	- **æ”¯æŒ WebSocket**ï¼šè½»æ¾æ„å»ºå®æ—¶åº”ç”¨ï¼Œå¦‚èŠå¤©å®¤ã€æ¨é€æœåŠ¡ç­‰ã€‚
	- **å¤šç§è§†å›¾å¼•æ“**ï¼šæ”¯æŒ HTMLã€Pugã€Djangoã€Markdownã€Reactã€Vue SSR ç­‰ã€‚
	- **ä¾èµ–æ³¨å…¥**ï¼šæ”¯æŒ `DIï¼ˆDependency Injectionï¼‰`ï¼Œæ–¹ä¾¿ç®¡ç†æœåŠ¡ã€‚

<br/>

- **3. å®‰è£… Iris**

å¯ä»¥ä½¿ç”¨ `go get` å®‰è£…ï¼š

```sh
go get github.com/kataras/iris/v12
```

æˆ–è€…ä½¿ç”¨ `go mod`ï¼š

```sh
go mod init myproject
go get github.com/kataras/iris/v12
```

<br/><br/><br/>
> <h2 id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h2>

```go
package main

import (
	"fmt"
	"github.com/kataras/iris/v12"
)

func main() {
	app := iris.New()

	// å®šä¹‰è·¯ç”±
	app.Get("/", func(ctx iris.Context) {
		ctx.WriteString("Hello, Iris!")
	})

	// å¯åŠ¨æœåŠ¡å™¨
	err := app.Listen(":8080")
	if err != nil {
		fmt.Println("æœåŠ¡å™¨å¯åŠ¨å¤±è´¥:", err)
	}
}
```

**è¿è¡Œ**

```sh
go run main.go
```

æµè§ˆå™¨è®¿é—® `http://localhost:8080/`ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```
Hello, Iris!
```

<br/><br/>
æˆ–è€…å¦‚ä¸‹ï¼š

```
package main

import "github.com/kataras/iris/v12"

func main() {
	practiceIrisWebLibV0_get()
}

func practiceIrisWebLibV0_get() {
	// é»˜è®¤æœåŠ¡å¼•æ“
	app := iris.Default()
	// è·¯ç”±ï¼š /ping
	// æ§åˆ¶é€»è¾‘ï¼š è¿”å›JSONæ ¼å¼å†…å®¹
	app.Get("/ping", func (ctx iris.Context)  {
		ctx.JSON(iris.Map{
			"message": "pong",
		})
	})
	// listen and serve on http://0.0.0.0:8080
	app.Run(iris.Addr(":8080"))
}
```

æ§åˆ¶å°è¿è¡Œï¼š

```
go run PLrisWebLibV0.go
[DBUG] 2025/02/02 12:02 Log level set to "debug"
[DBUG] 2025/02/02 12:02 Using <UUID4> to identify requests
[DBUG] 2025/02/02 12:02 API: 1 registered route (1 GET)
GET: /ping (./PLrisWebLibV0.go:23)

Iris Version: 12.2.11

Now listening on: 
> Network:  http://192.168.0.105:8080
> Local:    http://localhost:8080
Application started. Press CTRL+C to shut down.
```

åœ¨æµè§ˆå™¨è¾“å…¥ï¼š

```
http://localhost:8080/ping
```

å‡ºç°ï¼š

```
{"message":"pong"}
```


<br/><br/>

å¦‚ä½•è·å–åˆ°è·¯å¾„ä¸­çš„å‚æ•°ï¼Ÿé€šè¿‡iris.Contextã€‚

```
// é»˜è®¤æœåŠ¡å¼•æ“
app := iris.Default()
// è·¯ç”±ï¼š /ping
// æ§åˆ¶é€»è¾‘ï¼š è¿”å›JSONæ ¼å¼å†…å®¹
app.Get("/ping", func (ctx iris.Context)  {
	// å…¶ä»–çš„ç±»å‹éƒ½æä¾›äº†ç›¸åº”çš„æ–¹æ³•
	ctx.Params().GetInt("id")
})
```


<br/><br/><br/>
> <h2 id="è·¯ç”±">è·¯ç”±</h2>

- **åŸºæœ¬è·¯ç”±**

```go
app.Get("/hello", func(ctx iris.Context) {
	ctx.WriteString("Hello, World!")
})
```

**åŠ¨æ€è·¯ç”±**

```go
app.Get("/user/{id:int}", func(ctx iris.Context) {
	id := ctx.Params().GetIntDefault("id", 0)
	ctx.WriteString(fmt.Sprintf("User ID: %d", id))
})
```

- è®¿é—® `http://localhost:8080/user/123` è¿”å› `User ID: 123`

<br/><br/>

**é€šé…ç¬¦è·¯ç”±**

```go
app.Get("/files/{filepath:path}", func(ctx iris.Context) {
	filepath := ctx.Params().Get("filepath")
	ctx.WriteString("File path: " + filepath)
})
```

- è®¿é—® `http://localhost:8080/files/images/photo.jpg` è¿”å› `File path: images/photo.jpg`

<br/><br/><br/>
> <h2 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h2>

- **å…¨å±€ä¸­é—´ä»¶**

```go
app.Use(func(ctx iris.Context) {
	ctx.Application().Logger().Infof("è¯·æ±‚è·¯å¾„: %s", ctx.Path())
	ctx.Next()
})
```

<br/>

**å±€éƒ¨ä¸­é—´ä»¶**

```go
app.Get("/admin", authMiddleware, func(ctx iris.Context) {
	ctx.WriteString("Welcome to Admin Panel")
})

func authMiddleware(ctx iris.Context) {
	token := ctx.GetHeader("Authorization")
	if token != "valid-token" {
		ctx.StatusCode(iris.StatusForbidden)
		ctx.WriteString("Unauthorized")
		return
	}
	ctx.Next()
}
```

- è®¿é—® `http://localhost:8080/admin`ï¼Œéœ€è¦æºå¸¦ `Authorization: valid-token` å¤´ï¼Œå¦åˆ™è¿”å› `Unauthorized`ã€‚

<br/><br/><br/>
> <h2 id="MVCæ¨¡å¼">MVC æ¨¡å¼</h2>

Iris æ”¯æŒ MVC ç»“æ„ï¼Œè®©ä»£ç æ›´æ¸…æ™°ã€‚

**åˆ›å»º MVC æ§åˆ¶å™¨**

```go
package main

import (
	"github.com/kataras/iris/v12"
)

type UserController struct{}

func (c *UserController) Get() string {
	return "Get All Users"
}

func (c *UserController) GetBy(id int) string {
	return fmt.Sprintf("User ID: %d", id)
}

func main() {
	app := iris.New()
	mvc.New(app.Party("/users")).Handle(new(UserController))
	app.Listen(":8080")
}
```

- è®¿é—® `http://localhost:8080/users` è¿”å› `Get All Users`

- è®¿é—® `http://localhost:8080/users/10` è¿”å› `User ID: 10`

<br/><br/><br/>
> <h2 id="è§£æJSONè¯·æ±‚">è§£æJSONè¯·æ±‚</h2>

```go
app.Post("/json", func(ctx iris.Context) {
	var user struct {
		Name  string `json:"name"`
		Email string `json:"email"`
	}

	if err := ctx.ReadJSON(&user); err != nil {
		ctx.StatusCode(iris.StatusBadRequest)
		ctx.WriteString("Invalid JSON")
		return
	}

	ctx.JSON(iris.Map{
		"message": "User Created",
		"user":    user,
	})
})
```
**æµ‹è¯•**

```sh
curl -X POST "http://localhost:8080/json" \
     -H "Content-Type: application/json" \
     -d '{"name": "Alice", "email": "alice@example.com"}'
```

è¿”å›ï¼š

```json
{
    "message": "User Created",
    "user": {
        "name": "Alice",
        "email": "alice@example.com"
    }
}
```

<br/><br/><br/>
> <h2 id="é›†æˆGORM">é›†æˆ GORM</h2>

```go
package main

import (
	"fmt"
	"github.com/kataras/iris/v12"
	"gorm.io/driver/mysql"
	"gorm.io/gorm"
)

type User struct {
	ID    uint   `gorm:"primaryKey"`
	Name  string `json:"name"`
	Email string `json:"email"`
}

var db *gorm.DB

func main() {
	var err error
	dsn := "root:password@tcp(127.0.0.1:3306)/test_db?charset=utf8mb4&parseTime=True&loc=Local"
	db, err = gorm.Open(mysql.Open(dsn), &gorm.Config{})
	if err != nil {
		panic("æ•°æ®åº“è¿æ¥å¤±è´¥: " + err.Error())
	}

	db.AutoMigrate(&User{})

	app := iris.New()

	app.Post("/users", func(ctx iris.Context) {
		var user User
		if err := ctx.ReadJSON(&user); err != nil {
			ctx.StatusCode(iris.StatusBadRequest)
			return
		}
		db.Create(&user)
		ctx.JSON(user)
	})

	app.Get("/users", func(ctx iris.Context) {
		var users []User
		db.Find(&users)
		ctx.JSON(users)
	})

	app.Listen(":8080")
}
```

- `POST /users` åˆ›å»ºç”¨æˆ·
- `GET /users` è·å–æ‰€æœ‰ç”¨æˆ·

<br/><br/><br/>
> <h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>

**ç¼–è¯‘**

```sh
go build -o app main.go
```

**ä½¿ç”¨ `systemd` è¿è¡Œ**

åˆ›å»º `/etc/systemd/system/iris.service`ï¼š

```ini
[Unit]
Description=Iris Web Server
After=network.target

[Service]
ExecStart=/path/to/app
Restart=always
User=root

[Install]
WantedBy=multi-user.target
```
```sh
systemctl start iris
systemctl enable iris
```

<br/><br/>

### **æ€»ç»“**

| **åŠŸèƒ½** | **Iris æ”¯æŒ** |
|----------|--------------|
| é«˜æ€§èƒ½ | âœ… |
| è·¯ç”± | âœ… |
| MVC | âœ… |
| WebSocket | âœ… |
| ä¸­é—´ä»¶ | âœ… |
| è§†å›¾æ¨¡æ¿ | âœ… |
| ä¾èµ–æ³¨å…¥ | âœ… |
| æ•°æ®åº“é›†æˆ | âœ… |

Iris é€‚ç”¨äºé«˜æ€§èƒ½ Web åº”ç”¨ï¼Œæ˜¯ `Gin` çš„æœ‰åŠ›ç«äº‰è€…ã€‚å¦‚æœä½ éœ€è¦æ›´å¼ºå¤§çš„ MVC ç»“æ„ï¼ŒIris å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ğŸš€


<br/>

***
<br/><br/><br/>

> <h1 id=""></h1>

è¦ä½¿ç”¨å¥½ORMï¼Œå…¶æ ¸å¿ƒè¿˜æ˜¯æŒæ¡å…³ç³»å‹æ•°æ®åº“çš„åŸç†ã€ä¼˜åŒ–ã€ç´¢å¼•ç­‰ã€‚å—è‡ªèº«é¡¹ç›®æ‰€é™ï¼Œè¯»è€…ä½¿ç”¨åŸºæœ¬çš„SQLåŠŸèƒ½å°±èƒ½å®Œæˆä»»åŠ¡ï¼Œå¦‚æœæ•°æ®é‡å¤§äº†ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šé‡åˆ°æŸ¥è¯¢ç¼“æ…¢çš„é—®é¢˜ï¼›å¦‚æœæœåŠ¡å¤±è”ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šé‡åˆ°æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚è¿™äº›æ‰æ˜¯å…³ç³»å‹æ•°æ®åº“ä½¿ç”¨çš„æ ¸å¿ƒï¼Œè¯»è€…éœ€è¦æ‡‚å¾—ç´¢å¼•çš„åŸç†ã€ç´¢å¼•çš„ä¼˜åŒ–ï¼Œæ‰èƒ½è®¾è®¡æ›´åŠ å¥å£®çš„æ¨¡å‹ï¼Œå®Œæˆä»»åŠ¡çš„åŒæ—¶ä½¿ç³»ç»Ÿå…·å¤‡æŒç»­è¿­ä»£çš„èƒ½åŠ›ã€‚

å»ºè®®è¯»è€…ç†Ÿç»ƒæŒæ¡ç¼–ç¨‹è¯­è¨€çš„åŒæ—¶å¤šç ”ç©¶åŸºç¡€åŸç†ï¼Œè¿™äº›åŸç†çš„æŒæ¡æ‰æ˜¯è¯»è€…åº”å¯¹ç¹å¤å˜åŒ–çš„æ ¸å¿ƒç«äº‰åŠ›ã€‚

> <h1 id="Redis">Redis</h1>

Redisï¼ˆRemote Dictionary Serviceï¼Œè¿œç¨‹å­—å…¸æœåŠ¡ï¼‰æ˜¯äº’è”ç½‘é¢†åŸŸä½¿ç”¨å¹¿æ³›çš„å­˜å‚¨ä¸­é—´ä»¶ï¼Œä»¥å…¶é«˜æ€§èƒ½å’Œä¸°å¯Œçš„å®¢æˆ·ç«¯åº“åœ¨è½¯ä»¶é¢†åŸŸå¤§æ”¾å¼‚å½©ã€‚å‡ ä¹æ‰€æœ‰çš„äº’è”ç½‘åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨Redisï¼Œè¿˜æ˜¯ä»¥ç™¾åº¦çƒ­ç‚¹äº‹ä»¶æ’è¡Œæ¦œä¸ºä¾‹ï¼Œå…¶åå°å°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ‰åºé›†åˆzsetæ¥å®ç°ï¼Œå†æŒ‰åˆ†æ•°æ’åï¼Œåˆ†æ•°é«˜çš„çƒ­ç‚¹äº‹ä»¶æ’åé å‰ï¼›å†æ¯”å¦‚å¾®åšçš„ç‚¹èµã€è½¬å‘ã€è¯„è®ºç­‰è®¡æ•°çš„åŠŸèƒ½ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„INCRè‡ªå¢åŠŸèƒ½ã€‚

- Redisæ ¸å¿ƒçš„åŸºæœ¬æ•°æ®ç»“æ„æœ‰5ç§ï¼š
	- åˆ†åˆ«ä¸ºstringï¼ˆå­—ç¬¦ä¸²ï¼‰â€‹ã€listï¼ˆåˆ—è¡¨ï¼‰â€‹ã€setï¼ˆé›†åˆï¼‰â€‹ã€hashï¼ˆå“ˆå¸Œï¼‰å’Œzsetï¼ˆæœ‰åºé›†åˆï¼‰â€‹ã€‚
	- ç†Ÿç»ƒæŒæ¡è¿™5ç§åŸºæœ¬æ•°æ®ç»“æ„çš„ä½¿ç”¨è‡³å…³é‡è¦ã€‚

Redisæä¾›äº†ä¸€å¥—æ“ä½œè¿™5ç§æ•°æ®ç»“æ„çš„å‘½ä»¤ï¼ŒåŒ…å«è¿›è¡Œæ•°æ®çš„æ–°å¢ã€åˆ é™¤ã€æ›´æ”¹ã€æŸ¥è¯¢ç­‰æ“ä½œã€‚

ä½¿ç”¨Redisé€šå¸¸é‡‡ç”¨å®¢æˆ·ç«¯/æœåŠ¡å™¨ç«¯æ¶æ„çš„æ¨¡å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¿æ¥æœ¬åœ°çš„RedisæœåŠ¡ï¼Œä¹Ÿå¯ä»¥è¿æ¥è¿œç¨‹çš„RedisæœåŠ¡ï¼Œä¸è¿‡æˆ‘ä»¬ä»ç„¶æ¨èRedisä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œã€‚

<br/>

**ä¸‹è½½ï¼š**

```
go get github.com/gomodule/redigo/redis
```

<br/><br/><br/>
> <h2 id="GORMå’ŒXORMè¯¦ä»‹">GORMå’ŒXORMè¯¦ä»‹</h2>

**GORM** å’Œ **XORM** æ˜¯ Go è¯­è¨€ä¸­å¸¸ç”¨çš„ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒä»¬éƒ½ç”¨äºæ“ä½œæ•°æ®åº“ï¼Œä½†åœ¨è®¾è®¡ç†å¿µã€æ˜“ç”¨æ€§ã€æ€§èƒ½ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒã€‚

***

- **1. GORM vs XORM æ¦‚è§ˆ**

| ç‰¹æ€§         | GORM | XORM |
|-------------|------|------|
| **æ´»è·ƒåº¦** | ğŸ”¥ éå¸¸æ´»è·ƒï¼ˆGitHub 49k+ Starï¼‰ | ğŸš€ æ´»è·ƒï¼ˆGitHub 8k+ Starï¼‰ |
| **ä½¿ç”¨éš¾åº¦** | ğŸŒŸğŸŒŸğŸŒŸğŸŒŸï¼ˆåŠŸèƒ½å¼ºå¤§ï¼Œä½†å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼‰ | ğŸŒŸğŸŒŸğŸŒŸï¼ˆAPI è®¾è®¡æ›´ç®€æ´ï¼Œæ˜“ä¸Šæ‰‹ï¼‰ |
| **æ€§èƒ½** | ğŸŸ¡ ç›¸å¯¹è¾ƒæ…¢ï¼ˆåŠŸèƒ½ä¸°å¯Œï¼Œåå°„è¾ƒå¤šï¼‰ | ğŸŸ¢ æ›´å¿«ï¼ˆåŸºäºä»£ç ç”Ÿæˆä¼˜åŒ–ï¼Œè¾ƒå°‘åå°„ï¼‰ |
| **æ•°æ®åº“æ”¯æŒ** | âœ… MySQLã€PostgreSQLã€SQLiteã€SQL Server ç­‰ | âœ… åŒæ ·æ”¯æŒ MySQLã€PostgreSQLã€SQLiteã€SQL Server |
| **è‡ªåŠ¨è¿ç§»** | âœ… å†…ç½® `AutoMigrate`ï¼ˆé€‚åˆå¿«é€Ÿå¼€å‘ï¼‰ | âŒ æ²¡æœ‰è‡ªåŠ¨è¿ç§» |
| **é¢„åŠ è½½** | âœ… `Preload()`ã€`Joins()` | âœ… `Join()` |
| **äº‹åŠ¡** | âœ… `Begin()`, `Commit()`, `Rollback()` | âœ… `Transaction()` |
| **è½¯åˆ é™¤** | âœ… `gorm.DeletedAt` | âœ… `deleted` æ–¹å¼ |
| **ç»“æ„ä½“æ ‡ç­¾** | `gorm:"column:id;primaryKey"` | `xorm:"'id' pk"` |
| **æ”¯æŒ JSON ç»“æ„** | âœ…ï¼ˆé€šè¿‡ `json` è§£æï¼‰ | âœ…ï¼ˆæ”¯æŒ `JSON` å­—æ®µå­˜å‚¨ï¼‰ |


<br/><br/>
> <h3 id="GORMä½¿ç”¨">GORMä½¿ç”¨</h4>

<br/><br/>
> <h3 id="GORMå®šä¹‰æ¨¡å‹"> GORMå®šä¹‰æ¨¡å‹</h3>

```go
type User struct {
    gorm.Model  // æä¾› IDã€CreatedAtã€UpdatedAtã€DeletedAt
    Name  string `gorm:"size:100"`
    Age   int
}
```

<br/><br/>
> <h3 id="GORMåˆå§‹åŒ–æ•°æ®åº“"> GORM åˆå§‹åŒ–æ•°æ®åº“ </h3>

```go
db, err := gorm.Open(mysql.Open("root:password@tcp(127.0.0.1:3306)/test"), &gorm.Config{})
if err != nil {
    panic(err)
}

// è‡ªåŠ¨è¿ç§»
db.AutoMigrate(&User{})
```

<br/><br/>
> <h3 id="GORMæ’å…¥æ•°æ®"> GORMæ’å…¥æ•°æ® </h3>

```go
user := User{Name: "Alice", Age: 25}
db.Create(&user)
```


<br/><br/>
> <h3 id="GORMæŸ¥è¯¢æ•°æ®"> GORMæŸ¥è¯¢æ•°æ® </h3>

```go
var user User
db.First(&user, "name = ?", "Alice")
```

<br/>

**å¤šæ¡æŸ¥è¯¢**

```go
var users []User
db.Where("age > ?", 20).Find(&users)
```

<br/><br/>
> <h3 id="GORMæ›´æ–°æ•°æ®">GORMæ›´æ–°æ•°æ®</h3>

```go
db.Model(&user).Update("age", 30)
```

<br/><br/>
> <h3 id="GORMåˆ é™¤æ•°æ®">GORMåˆ é™¤æ•°æ®</h3>

```go
db.Delete(&user)
```


<br/><br/>
> <h3 id="XORMä½¿ç”¨"> XORMä½¿ç”¨</h4>

<br/><br/>
> <h3 id="XORMå®šä¹‰æ¨¡å‹"> XORMå®šä¹‰æ¨¡å‹</h3>

```go
type User struct {
    ID    int64  `xorm:"pk autoincr"` // ä¸»é”® & è‡ªå¢
    Name  string `xorm:"varchar(100)"`
    Age   int
}
```

<br/><br/>
> <h3 id="XORMåˆå§‹åŒ–æ•°æ®åº“">XORMåˆå§‹åŒ–æ•°æ®åº“ </h3>

```go
engine, err := xorm.NewEngine("mysql", "root:password@tcp(127.0.0.1:3306)/test")
if err != nil {
    panic(err)
}

// åˆ›å»ºè¡¨
err = engine.Sync2(new(User))
```

<br/><br/>
> <h3 id="XORMæ’å…¥æ•°æ®"> XORMæ’å…¥æ•°æ® </h3>

```go
user := User{Name: "Alice", Age: 25}
_, err := engine.Insert(&user)
```


<br/><br/>
> <h3 id="XORMæŸ¥è¯¢æ•°æ®"> XORMæŸ¥è¯¢æ•°æ® </h3>

```go
var user User
_, err := engine.Where("name = ?", "Alice").Get(&user)
```

<br/>

**å¤šæ¡æ•°æ®æŸ¥è¯¢**

```go
var users []User
err := engine.Where("age > ?", 20).Find(&users)
```

<br/><br/>
> <h2 id="é¡¹ç›®å®è·µ1-JOIN(select))"> é¡¹ç›®å®è·µ1-JOIN(select)) </h2>

```
func (engine *Engine) Join(joinOperator string, tablename interface{}, condition string, args ...interface{}) *Session {
	session := engine.NewSession()
	session.isAutoClose = true
	return session.Join(joinOperator, tablename, condition, args...)
}
```

**ä¸Šè¿°ä»£ç å¦‚ä½•ä½¿ç”¨ï¼Ÿè¯¦è§£**

<br/><br/>

- **ğŸ“Œ `Join` æ–¹æ³•è¯¦è§£**

è¿™ä¸ª `Join` æ–¹æ³•å±äº **`Engine` ç»“æ„ä½“**ï¼Œç”¨äº **æ‰§è¡Œ SQL JOIN è¯­å¥**ã€‚å®ƒé€šå¸¸ç”¨äº ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰åº“ï¼Œä¾‹å¦‚ `xorm`ã€‚

<br/>

- **ğŸ”¹ ä»£ç è§£æ**

```go
func (engine *Engine) Join(joinOperator string, tablename interface{}, condition string, args ...interface{}) *Session {
	session := engine.NewSession() // åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ä¼šè¯
	session.isAutoClose = true     // è®¾ç½®ä¼šè¯è‡ªåŠ¨å…³é—­
	return session.Join(joinOperator, tablename, condition, args...) // è°ƒç”¨ Session çš„ Join æ–¹æ³•
}
```

- **1ï¸âƒ£ `engine.NewSession()`**
	- **åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ä¼šè¯**ï¼Œç”¨äºæ‰§è¡Œ SQL è¯­å¥ã€‚
	- `engine` å¯èƒ½æ˜¯ **ORM çš„æ ¸å¿ƒå¯¹è±¡**ï¼Œç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥ã€‚

<br/>

- **2ï¸âƒ£ `session.isAutoClose = true`**
	- **è‡ªåŠ¨å…³é—­æ•°æ®åº“ä¼šè¯**ï¼Œé˜²æ­¢è¿æ¥æ³„æ¼ã€‚

<br/>

- **3ï¸âƒ£ `session.Join(joinOperator, tablename, condition, args...)`**
	- **è°ƒç”¨ `Session` çš„ `Join` æ–¹æ³•**ï¼Œç”¨äºæ‰§è¡Œ SQL `JOIN` æŸ¥è¯¢ã€‚
	- `joinOperator`ï¼šæŒ‡å®š JOIN ç±»å‹ï¼ˆå¦‚ `"INNER"`, `"LEFT"`, `"RIGHT"`ï¼‰ã€‚
	- `tablename`ï¼šè¦ JOIN çš„è¡¨åï¼ˆå¯èƒ½æ˜¯ `string` æˆ– `struct`ï¼‰ã€‚
	- `condition`ï¼šJOIN æ¡ä»¶ï¼Œä¾‹å¦‚ `"a.id = b.user_id"`ã€‚
	- `args...`ï¼šæ¡ä»¶å‚æ•°ï¼ˆå¯é€‰ï¼‰ã€‚

<br/>

- **ğŸ”¹ æ¥è‡ª ORM åº“**ï¼ˆä¸€ä¸ª Go è¯­è¨€çš„ ORM åº“ï¼‰ã€‚

åœ¨ `xorm` ä¸­ï¼Œ`Join` æ–¹æ³•ç”¨äº **æ‰§è¡Œ SQL JOIN è¯­å¥**ï¼š

```go
func (session *Session) Join(joinOperator string, tablename interface{}, condition string, args ...interface{}) *Session
```

æ¥è‡ª

ğŸ“Œ **ç¤ºä¾‹ï¼šä½¿ç”¨ `xorm` æ‰§è¡Œ `JOIN`**

```go
engine := xorm.NewEngine("mysql", "user:password@/dbname")

var users []User
err := engine.Join("INNER", "order", "user.id = order.user_id").
              Where("user.age > ?", 18).
              Find(&users)

if err != nil {
    log.Fatal(err)
}
```
ğŸ”¹ **ç›¸å½“äºæ‰§è¡Œçš„ SQL**ï¼š

```sql
SELECT * FROM user
INNER JOIN order ON user.id = order.user_id
WHERE user.age > 18;
```

---

## **ğŸ“Œ ä½œç”¨**
1. **å°è£… `JOIN` é€»è¾‘**ï¼Œæ–¹ä¾¿ ORM è¿›è¡Œå…³è”æŸ¥è¯¢ã€‚
2. **åˆ›å»ºä¼šè¯å¹¶è‡ªåŠ¨å…³é—­**ï¼Œé¿å…è¿æ¥æ³„æ¼ã€‚
3. **ç”¨äº SQL å…³è”æŸ¥è¯¢**ï¼ˆ`INNER JOIN`ã€`LEFT JOIN`ã€`RIGHT JOIN` ç­‰ï¼‰ã€‚

---

## **ğŸ“Œ æ€»ç»“**
- è¿™ä¸ªæ–¹æ³•å±äº **`xorm` æˆ–ç±»ä¼¼ ORM åº“**ã€‚
- ä¸»è¦ä½œç”¨æ˜¯ **æ‰§è¡Œ SQL JOIN è¯­å¥**ï¼Œå°è£… `Session.Join()` é€»è¾‘ã€‚
- **è‡ªåŠ¨ç®¡ç†æ•°æ®åº“ä¼šè¯**ï¼Œé˜²æ­¢è¿æ¥æ³„æ¼ã€‚
- é€‚ç”¨äº **å…³è”æŸ¥è¯¢**ï¼ˆå¦‚ `user` å’Œ `order` è¡¨çš„å…³è”ï¼‰ã€‚

ğŸš€ **é€‚åˆç”¨åœ¨ ORM æŸ¥è¯¢æ—¶ï¼Œç®€åŒ– SQL JOIN é€»è¾‘ï¼**


<br/><br/>
> <h2 id="é¡¹ç›®å®è·µ2-where(select)">é¡¹ç›®å®è·µ2-where(select)</h2>

- **å…ˆçœ‹é¡¹ç›®ä¸­çš„ä¸€æ®µä»£ç ï¼š**

**database_v1.goæ–‡ä»¶**

```
var BeeQuickDatabase *xorm.Engine
```

<br/>

**controller.goæ–‡ä»¶ä½¿ç”¨**

```go

var vipMember model_v1.VipMember

_, dbErr := database_v1.BeeQuickDatabase.Where("level_name = ?", strings.ToUpper("v0")).Get(&vipMember); dbErr != nil {
		return account, error_v1.ErrorV1{
			Code:    http.StatusBadRequest,
			Message: dbErr.Error(),
			Detail:  "ä¼šå‘˜ç­‰çº§æœªå­˜åœ¨",
		}
	}
```

**`ä½œç”¨ï¼š`xorm ORM** è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œä¸»è¦ç”¨äºæŸ¥è¯¢ vipMember æ˜¯å¦å­˜åœ¨ã€‚

<br/>


- **ğŸ”¹ ä»£ç è§£æ**
	- **ğŸ“Œ `database_v1.go`**

```go
var BeeQuickDatabase *xorm.Engine
```
- ğŸ“Œ **å®šä¹‰ `BeeQuickDatabase` ä½œä¸ºå…¨å±€æ•°æ®åº“å¼•æ“**
	- **`xorm.Engine`** æ˜¯ `xorm` ORM çš„æ•°æ®åº“è¿æ¥å¯¹è±¡ã€‚
	- è¯¥å˜é‡åœ¨ **åº”ç”¨å¯åŠ¨æ—¶** è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶åœ¨å…¶ä»–æ–‡ä»¶ä¸­ **ç›´æ¥ä½¿ç”¨**ã€‚

<br/>

- **ğŸ“Œ `controller.go`**

```go
var vipMember model_v1.VipMember

_, dbErr := database_v1.BeeQuickDatabase.Where("level_name = ?", strings.ToUpper("v0")).Get(&vipMember)
if dbErr != nil {
    return account, error_v1.ErrorV1{
        Code:    http.StatusBadRequest,
        Message: dbErr.Error(),
        Detail:  "ä¼šå‘˜ç­‰çº§æœªå­˜åœ¨",
    }
}
```

- **1ï¸âƒ£ `database_v1.BeeQuickDatabase.Where("level_name = ?", strings.ToUpper("v0")).Get(&vipMember)`**
	- **æŸ¥è¯¢ `vipMember` æ˜¯å¦å­˜åœ¨**ï¼š
	  - **`Where("level_name = ?", strings.ToUpper("v0"))`**ï¼šæŸ¥è¯¢ `level_name` æ˜¯å¦ç­‰äº `"V0"`ï¼ˆè½¬å¤§å†™ï¼‰ã€‚
	  - **`Get(&vipMember)`**ï¼š
	    - **`vipMember` ç»“æ„ä½“**ä¼šè¢«å¡«å……æŸ¥è¯¢ç»“æœã€‚
	    - **è¿”å› `true/false`**ï¼šå¦‚æœæŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚
	
- **2ï¸âƒ£ `if dbErr != nil {}`**
	- **æ£€æŸ¥æ˜¯å¦å‘ç”Ÿæ•°æ®åº“é”™è¯¯**ï¼š
	  - `dbErr != nil` è¡¨ç¤º SQL æ‰§è¡Œå‡ºé”™ï¼ˆä¾‹å¦‚æ•°æ®åº“è¿æ¥å¤±è´¥ï¼‰ã€‚
	  - è¿”å› `error_v1.ErrorV1` ç»“æ„ä½“ï¼Œè¡¨ç¤º **HTTP 400 é”™è¯¯ï¼ˆBad Requestï¼‰**ã€‚

<br/>

- **ğŸ”¹ ä»£ç ç¤ºä¾‹**
	- ğŸ“Œ **å®Œæ•´çš„ `vipMember` æŸ¥è¯¢ç¤ºä¾‹**

```go
type VipMember struct {
	base      `xorm:"extends"`
	LevelName string `xorm:"varchar(2) notnull unique 'level_name'" json:"level_name"`
	Start     int    `json:"start"`
	End       int    `json:"end"`
	Points    float64
	Comment   string `xorm:"varchar(128) notnull" json:"comment"`
	Period    int    `json:"period"`
	ToValue   int    `json:"to_value"`
}

var vipMember VipMember

// æŸ¥è¯¢ level_name ä¸º "V0" çš„ä¼šå‘˜
_, dbErr := database_v1.BeeQuickDatabase.Where("level_name = ?", "V0").Get(&vipMember)

if dbErr != nil {
    fmt.Println("æŸ¥è¯¢å¤±è´¥:", dbErr)
} else {
    fmt.Println("æŸ¥è¯¢æˆåŠŸ:", vipMember)
}
```

<br/>

- **ğŸ“Œ ä»£ç ä½œç”¨**
	1. **æŸ¥è¯¢ `vipMember` æ˜¯å¦å­˜åœ¨**ï¼ˆæ ¹æ® `level_name`ï¼‰ã€‚
	2. **æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ˜¯å¦æŠ¥é”™**ï¼ˆ`dbErr`ï¼‰ã€‚
	3. **å¦‚æœå‡ºé”™ï¼Œåˆ™è¿”å› HTTP 400 + é”™è¯¯ä¿¡æ¯**ã€‚

<br/>

- **ğŸ“Œ æ€»ç»“**
	- **`BeeQuickDatabase`** æ˜¯ `xorm.Engine`ï¼Œç”¨äºæ•°æ®åº“æ“ä½œã€‚
	- **`Where(...).Get(&vipMember)`** æŸ¥è¯¢ `level_name = "V0"` çš„æ•°æ®ã€‚
	- **å¦‚æœæŸ¥è¯¢å‡ºé”™**ï¼Œè¿”å› `error_v1.ErrorV1`ï¼ŒHTTP çŠ¶æ€ç  `400`ã€‚
	- é€‚ç”¨äº **ä¼šå‘˜ç­‰çº§æ ¡éªŒ** åœºæ™¯ã€‚ ğŸš€


<br/><br/>
> <h2 id="æºç Whereæ–¹æ³•ä½¿ç”¨">æºç Whereæ–¹æ³•ä½¿ç”¨</h2>

åœ¨ `xorm` åº“ä¸­ï¼ŒğŸ“Œ `Where` æ–¹æ³•ç”¨äºæ„å»º **`SQL WHERE` æŸ¥è¯¢æ¡ä»¶**ã€‚å®ƒé€šå¸¸ä¸å…¶ä»–æŸ¥è¯¢æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨æ•°æ®åº“ä¸­æ£€ç´¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®ã€‚

```
func (engine *Engine) Where(query interface{}, args ...interface{}) *Session {
	session := engine.NewSession()
	session.isAutoClose = true
	return session.Where(query, args...)
}
```

<br/>

- **1ï¸âƒ£ `engine.NewSession()`**
	- **`NewSession()`** åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ä¼šè¯ã€‚
	- åœ¨ `xorm` ä¸­ï¼Œ`Session` å¯¹è±¡ä»£è¡¨ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œç”¨äºæ‰§è¡Œ SQL æŸ¥è¯¢å’Œäº‹åŠ¡ã€‚

- **2ï¸âƒ£ `session.isAutoClose = true`**
	- è®¾ç½® `isAutoClose` ä¸º `true`ï¼Œè¡¨ç¤ºè¿™ä¸ªä¼šè¯åœ¨ä½¿ç”¨å®Œåä¼šè‡ªåŠ¨å…³é—­ï¼Œä»¥é¿å…æ•°æ®åº“è¿æ¥æ³„æ¼ã€‚

- **3ï¸âƒ£ `session.Where(query, args...)`**
	- **è°ƒç”¨ `session.Where` æ–¹æ³•**ï¼Œç”¨äºæ„å»º **`WHERE` å­å¥**ã€‚
	- **`query`**ï¼šæ˜¯ `WHERE` æ¡ä»¶çš„å­—ç¬¦ä¸²ï¼ˆå¦‚ `"age > ?"`ï¼‰ï¼Œæˆ–è€…å¯ä»¥æ˜¯å¸¦æœ‰æ¡ä»¶å­—æ®µçš„ç»“æ„ä½“ã€‚
	- **`args...`**ï¼šæ˜¯æŸ¥è¯¢æ¡ä»¶çš„å‚æ•°ï¼ˆå¦‚ `"30"`ï¼Œä»£è¡¨æŸ¥è¯¢å¤§äº 30 çš„è®°å½•ï¼‰ã€‚

- **4ï¸âƒ£ è¿”å›å€¼ï¼š** `*Session`
	- è¿”å›ä¸€ä¸ª **`Session` å¯¹è±¡**ï¼Œä½ å¯ä»¥ç»§ç»­è°ƒç”¨ `Find`ã€`Get` ç­‰æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ã€‚

<br/>

- **ğŸ”¹ ä»£ç ç¤ºä¾‹**
	- **æŸ¥è¯¢å¤§äºæŸä¸ªå¹´é¾„çš„ä¼šå‘˜**

```go
type Member struct {
    ID   int64  `xorm:"id"`
    Name string `xorm:"name"`
    Age  int    `xorm:"age"`
}

var members []Member

// æŸ¥è¯¢å¹´é¾„å¤§äº 30 çš„ä¼šå‘˜
err := engine.Where("age > ?", 30).Find(&members)
if err != nil {
    log.Fatal(err)
}
fmt.Println(members)
```

ğŸ“Œ **ç›¸å½“äºæ‰§è¡Œçš„ SQL**ï¼š

```sql
SELECT * FROM member WHERE age > 30;
```

<br/>

- **ä½¿ç”¨ç»“æ„ä½“è¿›è¡ŒæŸ¥è¯¢**

```go
var member Member

// æ ¹æ® ID æŸ¥è¯¢ä¼šå‘˜
_, err := engine.Where("id = ?", 1).Get(&member)
if err != nil {
    log.Fatal(err)
}
fmt.Println(member)
```

---

- **ğŸ”¹ ä½œç”¨**
	1. **æ„å»º WHERE æŸ¥è¯¢æ¡ä»¶**ï¼Œç”¨äºæ•°æ®åº“æŸ¥è¯¢ã€‚
	2. **è‡ªåŠ¨åˆ›å»ºä¼šè¯**ï¼Œå¹¶ç¡®ä¿åœ¨æŸ¥è¯¢å®Œæˆåå…³é—­ä¼šè¯ï¼Œé¿å…è¿æ¥æ³„æ¼ã€‚
	3. **æ”¯æŒå‚æ•°åŒ–æŸ¥è¯¢**ï¼Œé€šè¿‡ `args...` å¯ä»¥ä¼ é€’æŸ¥è¯¢æ¡ä»¶çš„å€¼ã€‚
	4. **é“¾å¼è°ƒç”¨**ï¼Œå¯ä»¥ç»§ç»­å¯¹ `Session` å¯¹è±¡è¿›è¡Œè¿›ä¸€æ­¥çš„æŸ¥è¯¢æˆ–ä¿®æ”¹ã€‚

<br/>

- **ğŸ”¹ æ€»ç»“**
	- `Where` æ–¹æ³•ç”¨äº **æ„å»º SQL æŸ¥è¯¢ä¸­çš„ WHERE æ¡ä»¶**ã€‚
	- é€šè¿‡ **`NewSession()` åˆ›å»ºä¼šè¯**ï¼Œå¹¶é€šè¿‡ `session.Where` è¿›è¡ŒæŸ¥è¯¢ã€‚
	- **è‡ªåŠ¨å…³é—­ä¼šè¯**ï¼Œé¿å…æ•°æ®åº“è¿æ¥æ³„æ¼ã€‚
	- **æ”¯æŒç»“æ„ä½“å’Œå‚æ•°åŒ–æŸ¥è¯¢**ï¼Œç®€åŒ– SQL çš„æ„é€ è¿‡ç¨‹ã€‚




<br/><br/>
> <h3 id="XORMæ›´æ–°æ•°æ®">XORMæ›´æ–°æ•°æ®</h3>

```go
user.Age = 30
_, err := engine.ID(user.ID).Update(&user)
```


<br/><br/>
> <h3 id="XORMåˆ é™¤æ•°æ®">XORMåˆ é™¤æ•°æ®</h3>

```go
_, err := engine.ID(user.ID).Delete(&user)
```


<br/><br/><br/>
> <h2 id="ä¸»è¦åŒºåˆ«">ä¸»è¦åŒºåˆ«</h2>

- **1.GORM æ›´åŠ é¢å‘å¯¹è±¡**
	- GORM å…è®¸åŸºäº **æ¨¡å‹ç»“æ„ä½“** è‡ªåŠ¨è¿ç§»ï¼Œä½¿ç”¨ **é“¾å¼è°ƒç”¨**ï¼ˆå¦‚ `db.Model().Where().Update()`ï¼‰ã€‚
	- é€‚åˆ DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å’Œå¤æ‚æŸ¥è¯¢ã€‚

- **2.XORM æ›´è½»é‡**
	- XORM ä½¿ç”¨ **å‡½æ•°å¼ API**ï¼Œç±»ä¼¼ SQLï¼Œå†™æ³•ç›´è§‚ï¼Œæ”¯æŒ **æ•°æ®åº“åå‘ç”Ÿæˆç»“æ„ä½“**ã€‚
	- é€‚åˆ **ç®€å• CRUD**ï¼Œé€‚åˆ **é«˜æ€§èƒ½åº”ç”¨**ã€‚

- **3.æ€§èƒ½**
	- **XORM** çš„æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå®ƒå‡å°‘äº† **åå°„** å’Œ **è‡ªåŠ¨è¿ç§»** å¸¦æ¥çš„å¼€é”€ã€‚
	- **GORM** æä¾›äº†æ›´å¤šç‰¹æ€§ï¼Œä½†ç‰ºç‰²äº†ä¸€å®šçš„æ€§èƒ½ï¼ˆå¦‚ `AutoMigrate` ä¼šå½±å“æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦ï¼‰ã€‚

<br/><br/><br/>
> <h2 id="ä»€ä¹ˆæ—¶å€™é€‰ç”¨ï¼Ÿ">ä»€ä¹ˆæ—¶å€™é€‰ç”¨ï¼Ÿ</h2>

| ä½¿ç”¨åœºæ™¯ | é€‰æ‹© GORM | é€‰æ‹© XORM |
|----------|-----------|-----------|
| éœ€è¦å¤æ‚æŸ¥è¯¢ | âœ… | ğŸš« |
| éœ€è¦è‡ªåŠ¨è¿ç§» | âœ… | ğŸš« |
| è¿½æ±‚æè‡´æ€§èƒ½ | ğŸš« | âœ… |
| å¿«é€Ÿå¼€å‘ MVP | âœ… | âœ… |
| é€‚åˆæ–°æ‰‹ | ğŸš«ï¼ˆè¾ƒå¤šæ¦‚å¿µï¼‰ | âœ…ï¼ˆAPI ç›´è§‚ï¼‰ |
| éœ€è¦ JSON æ•°æ®å­˜å‚¨ | âœ… | âœ… |

---

### **. æ€»ç»“**
- **GORM** é€‚åˆ **åŠŸèƒ½ä¸°å¯Œ** çš„åœºæ™¯ï¼Œæ¯”å¦‚ Web æ¡†æ¶ï¼ˆGinã€Fiberï¼‰ï¼Œå°¤å…¶æ˜¯éœ€è¦ **è‡ªåŠ¨è¿ç§»ã€äº‹åŠ¡ç®¡ç†ã€å…³è”æŸ¥è¯¢**ã€‚
- **XORM** é€‚åˆ **é«˜æ€§èƒ½ã€è½»é‡çº§** çš„åœºæ™¯ï¼Œæ¯”å¦‚éœ€è¦ç›´æ¥æ˜ å°„æ•°æ®åº“æŸ¥è¯¢ï¼Œæˆ–è€… Golang å¾®æœåŠ¡ã€‚

å¦‚æœä½ æ˜¯ **æ–°æ‰‹**ï¼ŒXORM çš„ä¸Šæ‰‹éš¾åº¦ä½ï¼Œä½†å¦‚æœä½ éœ€è¦ **å¤æ‚ä¸šåŠ¡é€»è¾‘**ï¼ŒGORM æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ğŸš€


<br/><br/><br/>
> <h2 id="modelåºåˆ—åŒ–å’Œç»§æ‰¿">modelåºåˆ—åŒ–å’Œç»§æ‰¿</h2>

**base_model.goæ–‡ä»¶å¦‚ä¸‹ï¼š**

```type base struct {
	ID        uint      `xorm:"pk autoincr notnull 'id'" json:"id"`
	CreatedAt time.Time `xorm:"created" json:"created_at"`
	UpdatedAt time.Time `xorm:"updated" json:"updated_at"`
	DeletedAt time.Time `xorm:"deleted" json:"deleted_at"`
}
```

<br/>

**account_model.goæ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š**

```
type Account struct {
	base     `xorm:"extends"`
	Phone    string    `xorm:"varchar(11) notnull unique 'phone'" json:"phone"`
	Password string    `xorm:"varchar(128)" json:"password"`
	Token    string    `xorm:"varchar(128) 'token'" json:"token"`
	Avatar   string    `xorm:"varchar(128) 'avatar'" json:"avatar"`
	Gender   string    `xorm:"varchar(1) 'gender'" json:"gender"`
	Birthday time.Time `json:"birthday"`

	Points      int       `json:"points"`
	VipMemberID uint      `xorm:"index"`
	VipMember   VipMember `xorm:"-"`
	VipTime     time.Time `json:"vip_time"`
}

type VipMember struct {
	base      `xorm:"extends"`
	LevelName string `xorm:"varchar(2) notnull unique 'level_name'" json:"level_name"`
	Start     int    `json:"start"`
	End       int    `json:"end"`
	Points    float64
	Comment   string `xorm:"varchar(128) notnull" json:"comment"`
	Period    int    `json:"period"`
	ToValue   int    `json:"to_value"`
}

type AccountGroupVip struct {
	Account   `xorm:"extends"`
	VipMember `xorm:"extends"`
}



func (AccountGroupVip) TableName() string {
	return "beeQuick_account"
}

func (a AccountGroupVip) SerializerForGroup() 

AccountSerializer {
	result := a.Account.Serializer()
	result.VipMember = a.VipMember.Serializer()
	return result
}
```

ä¸Šè¿°ä»£ç ä½¿ç”¨ **Go è¯­è¨€** ç»“åˆ **XORM** ORM åº“å®šä¹‰äº†æ•°æ®åº“æ¨¡å‹ï¼Œå…¶ä¸­ `base_model.go` å®šä¹‰äº†åŸºç¡€æ¨¡å‹ï¼Œ`account_model.go` ä¸»è¦å®šä¹‰äº†è´¦æˆ·ç›¸å…³çš„ç»“æ„ä½“ã€‚  

<br/>

- **1.`base_model.go` (åŸºç¡€æ¨¡å‹)**

```go
type base struct {
	ID        uint      `xorm:"pk autoincr notnull 'id'" json:"id"`
	CreatedAt time.Time `xorm:"created" json:"created_at"`
	UpdatedAt time.Time `xorm:"updated" json:"updated_at"`
	DeletedAt time.Time `xorm:"deleted" json:"deleted_at"`
}
```
- **è§£æï¼š**
	- `ID`ï¼šä¸»é”®ï¼Œè‡ªåŠ¨é€’å¢ï¼Œä¸å…è®¸ä¸ºç©º (`pk autoincr notnull`)ï¼ŒXORM ä¼šå°†å…¶æ˜ å°„åˆ° `id` åˆ—ã€‚
	- `CreatedAt`ï¼šè®°å½•åˆ›å»ºæ—¶é—´ (`xorm:"created"`ï¼ŒXORM ä¼šè‡ªåŠ¨å¡«å……)ã€‚
	- `UpdatedAt`ï¼šè®°å½•æ›´æ–°æ—¶é—´ (`xorm:"updated"`ï¼ŒXORM ä¼šåœ¨æ›´æ–°æ—¶è‡ªåŠ¨å¡«å……)ã€‚
	- `DeletedAt`ï¼šè®°å½•åˆ é™¤æ—¶é—´ (`xorm:"deleted"`ï¼Œç”¨äºè½¯åˆ é™¤ï¼Œå³ä¸ä¼šçœŸæ­£åˆ é™¤è®°å½•)ã€‚

<br/>

- **2.`account_model.go` è´¦æˆ·æ¨¡å‹**
	- **2.1`Account` (ç”¨æˆ·è´¦æˆ·)**

```go
type Account struct {
	base     `xorm:"extends"`
	Phone    string    `xorm:"varchar(11) notnull unique 'phone'" json:"phone"`
	Password string    `xorm:"varchar(128)" json:"password"`
	Token    string    `xorm:"varchar(128) 'token'" json:"token"`
	Avatar   string    `xorm:"varchar(128) 'avatar'" json:"avatar"`
	Gender   string    `xorm:"varchar(1) 'gender'" json:"gender"`
	Birthday time.Time `json:"birthday"`

	Points      int       `json:"points"`
	VipMemberID uint      `xorm:"index"`
	VipMember   VipMember `xorm:"-"`  // ä»…åœ¨ Go ä»£ç ä¸­å­˜åœ¨ï¼Œä¸æ˜ å°„åˆ°æ•°æ®åº“
	VipTime     time.Time `json:"vip_time"`
}
```
- **è§£æï¼š**
	- **ç»§æ‰¿ `base`**ï¼š
		  - é€šè¿‡ `xorm:"extends"`ï¼Œ`Account` ç»“æ„ä½“ç»§æ‰¿äº† `base` ç»“æ„ä½“ä¸­çš„å­—æ®µï¼Œå¦‚ `ID`ã€`CreatedAt`ã€`UpdatedAt`ã€`DeletedAt`ã€‚
	- **è´¦æˆ·ä¿¡æ¯å­—æ®µ**ï¼š
		  - `Phone`ï¼šæ‰‹æœºå·ï¼Œ`varchar(11)`ï¼Œå¿…é¡»å”¯ä¸€ã€‚
		  - `Password`ï¼šå¯†ç ï¼Œ`varchar(128)`ï¼Œå­˜å‚¨åŠ å¯†åçš„å¯†ç ã€‚
		  - `Token`ï¼šè®¤è¯ Tokenã€‚
		  - `Avatar`ï¼šå¤´åƒ URLã€‚
		  - `Gender`ï¼šæ€§åˆ«ï¼Œ`varchar(1)`ï¼Œé€šå¸¸å­˜å‚¨ `M`ï¼ˆç”·ï¼‰æˆ– `F`ï¼ˆå¥³ï¼‰ã€‚
		  - `Birthday`ï¼šç”Ÿæ—¥ï¼Œæ—¶é—´ç±»å‹ã€‚
	- **ä¼šå‘˜ä¿¡æ¯å­—æ®µ**ï¼š
		  - `Points`ï¼šç§¯åˆ†ï¼Œ`int`ã€‚
		  - `VipMemberID`ï¼šå¤–é”®ï¼ŒæŒ‡å‘ `VipMember` çš„ `ID`ï¼Œå¹¶åˆ›å»ºç´¢å¼• (`xorm:"index"`)ã€‚
		  - `VipMember`ï¼šä¼šå‘˜ç­‰çº§ä¿¡æ¯ï¼Œ`xorm:"-"` è¯´æ˜å®ƒä¸åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯é€šè¿‡ `VipMemberID` å…³è”åå¡«å……ã€‚
		  - `VipTime`ï¼šVIP åˆ°æœŸæ—¶é—´ã€‚
	
<br/>

- **2.2`VipMember` (ä¼šå‘˜ç­‰çº§)**

```go
type VipMember struct {
	base      `xorm:"extends"`
	LevelName string  `xorm:"varchar(2) notnull unique 'level_name'" json:"level_name"`
	Start     int     `json:"start"`
	End       int     `json:"end"`
	Points    float64
	Comment   string  `xorm:"varchar(128) notnull" json:"comment"`
	Period    int     `json:"period"`
	ToValue   int     `json:"to_value"`
}
```
- **è§£æï¼š**
	- **ç»§æ‰¿ `base`**ï¼šåŒæ ·ç»§æ‰¿äº† `ID`ã€`CreatedAt`ã€`UpdatedAt`ã€`DeletedAt`ã€‚
	- **ä¼šå‘˜ç­‰çº§å­—æ®µ**ï¼š
		  - `LevelName`ï¼šç­‰çº§åç§°ï¼ˆå¦‚ `V1`ã€`V2`ï¼‰ã€‚
		  - `Start`ã€`End`ï¼šè¯¥ä¼šå‘˜ç­‰çº§çš„ç§¯åˆ†åŒºé—´ï¼Œä¾‹å¦‚ `V1` å¯èƒ½æ˜¯ `[0, 100]`ï¼Œ`V2` æ˜¯ `[101, 500]`ã€‚
		  - `Points`ï¼šè¯¥ç­‰çº§é»˜è®¤ç§¯åˆ†åŠ æˆï¼ˆå¦‚æ¶ˆè´¹ 1 å…ƒå¢åŠ çš„ç§¯åˆ†ï¼‰ã€‚
		  - `Comment`ï¼šæè¿°ä¿¡æ¯ï¼Œå¦‚ "é»„é‡‘ä¼šå‘˜"ã€"ç™½é‡‘ä¼šå‘˜"ã€‚
		  - `Period`ï¼šä¼šå‘˜æœ‰æ•ˆæœŸï¼ˆå•ä½ï¼šå¤©ï¼‰ã€‚
		  - `ToValue`ï¼šè¾¾åˆ°æ­¤å€¼åè‡ªåŠ¨å‡çº§ä¸‹ä¸€çº§ã€‚

<br/>
- **2.3 `AccountGroupVip` (è´¦æˆ·å’Œä¼šå‘˜çš„ç»„åˆ)**

```go
type AccountGroupVip struct {
	Account   `xorm:"extends"`
	VipMember `xorm:"extends"`
}
```

- **è§£æï¼š**
	- è¿™ä¸ªç»“æ„ä½“**ç»§æ‰¿**äº† `Account` å’Œ `VipMember`ï¼Œå®ƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿç»“æ„ä½“ï¼Œæ–¹ä¾¿æŸ¥è¯¢æ—¶ç›´æ¥è·å– `Account` å’Œ `VipMember` çš„æ‰€æœ‰å­—æ®µã€‚
	- é€‚ç”¨äºè”åˆæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š

```go
var results []AccountGroupVip
err := engine.Table("beeQuick_account").Find(&results)
```
  
è¿™æ ·ï¼ŒæŸ¥è¯¢å‡ºçš„ `results` æ—¢åŒ…å« `Account` ä¹ŸåŒ…å« `VipMember` ç›¸å…³ä¿¡æ¯ã€‚

<br/>

- **2.4`TableName()` æ–¹æ³•**

```go
func (AccountGroupVip) TableName() string {
	return "beeQuick_account"
}
```

- è¿™ä¸ªæ–¹æ³•å‘Šè¯‰ XORM **è¡¨åä¸æ˜¯ `account_group_vip`ï¼Œè€Œæ˜¯ `beeQuick_account`**ï¼Œé¿å…è‡ªåŠ¨ç”Ÿæˆä¸åˆé€‚çš„è¡¨åã€‚

<br/>

- **2.5`SerializerForGroup()` æ–¹æ³•**

```go
func (a AccountGroupVip) SerializerForGroup() AccountSerializer {
	result := a.Account.Serializer()
	result.VipMember = a.VipMember.Serializer()
	return result
}
```

- `SerializerForGroup()` ç”¨äºåºåˆ—åŒ– `AccountGroupVip`ï¼Œå…¶ä¸­ï¼š
	  - `a.Account.Serializer()` å¤„ç† `Account` ç»“æ„çš„åºåˆ—åŒ–ã€‚
	  - `a.VipMember.Serializer()` å¤„ç† `VipMember` ç»“æ„çš„åºåˆ—åŒ–ã€‚
	  - è¿”å› `AccountSerializer`ï¼ˆå‡è®¾ `AccountSerializer` æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä¸“é—¨ç”¨äº API å“åº”ï¼‰ã€‚

<br/>

- **æ€»ç»“**
	- **`base` ç»“æ„ä½“** æä¾›é€šç”¨çš„ ID å’Œæ—¶é—´æˆ³å­—æ®µï¼Œå¤šä¸ªæ¨¡å‹éƒ½å¯ä»¥ç»§æ‰¿å®ƒã€‚
	- **`Account` ç»“æ„ä½“** ä»£è¡¨ç”¨æˆ·è´¦æˆ·ï¼ŒåŒ…æ‹¬æ‰‹æœºå·ã€å¯†ç ã€Tokenã€ä¼šå‘˜ä¿¡æ¯ç­‰ã€‚
	- **`VipMember` ç»“æ„ä½“** ä»£è¡¨ä¼šå‘˜ç­‰çº§ï¼ŒåŒ…æ‹¬ç­‰çº§åç§°ã€ç§¯åˆ†èŒƒå›´ã€ç‰¹æƒç­‰ã€‚
	- **`AccountGroupVip` ç»“æ„ä½“** æ˜¯ `Account` å’Œ `VipMember` çš„ç»„åˆï¼Œé€‚ç”¨äºæŸ¥è¯¢è”åˆä¿¡æ¯ã€‚
	- **`SerializerForGroup()`** ç”¨äºæ ¼å¼åŒ–æŸ¥è¯¢ç»“æœï¼Œé€‚ç”¨äº API è¿”å› JSON æ•°æ®ã€‚

<br/>

- **è¿™ä¸ªè®¾è®¡æ–¹å¼ï¼š**
	1. **æé«˜äº†ä»£ç å¤ç”¨æ€§**ï¼ˆé€šè¿‡ `xorm:"extends"` ç»§æ‰¿ `base`ï¼‰ã€‚
	2. **é¿å…æ‰‹åŠ¨ç»´æŠ¤æ—¶é—´å­—æ®µ**ï¼ˆ`xorm:"created"`ã€`xorm:"updated"` è‡ªåŠ¨å¡«å……ï¼‰ã€‚
	3. **æ”¯æŒè½¯åˆ é™¤**ï¼ˆ`xorm:"deleted"`ï¼Œä¸ä¼šçœŸæ­£åˆ é™¤æ•°æ®ï¼‰ã€‚
	4. **ä½¿ç”¨ `xorm:"-"` è®© `VipMember` ä»…ç”¨äº Go ä»£ç ï¼Œä¸å½±å“æ•°æ®åº“ç»“æ„**ã€‚
	5. **ä¾¿äº JSON åºåˆ—åŒ–**ï¼ŒAPI å¯ä»¥ç›´æ¥è¿”å›æ ¼å¼åŒ–çš„æ•°æ®ã€‚

è¿™æ ·ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œ CRUD æ“ä½œï¼Œä¾‹å¦‚ï¼š

```go
var account Account
engine.Where("phone = ?", "12345678901").Get(&account)
```


<br/>

***
<br/><br/><br/>

> <h1 id="cryptoåº“"> cryptoåº“ </h1>

<br/><br/><br/>
> <h2 id="cryptoå“ˆå¸Œ">cryptoå“ˆå¸Œ</h2>

- **ğŸ“Œ `GenerateFromPassword` æ–¹æ³•è¯¦è§£**

è¿™æ˜¯ Go è¯­è¨€ä¸­ `crypto` åº“ä¸­çš„ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•ï¼Œé€šå¸¸ç”¨äº **å¯†ç çš„å“ˆå¸ŒåŠ å¯†**ã€‚åœ¨ Go æ ‡å‡†åº“ä¸­ï¼Œå®ƒå±äº `bcrypt` å¯†ç åŠ å¯†ç®—æ³•çš„ä¸€éƒ¨åˆ†ã€‚æ­¤æ–¹æ³•çš„ç›®çš„æ˜¯é€šè¿‡ä¸€ä¸ªå¯†ç å’Œå·¥ä½œå› å­ï¼ˆ`cost`ï¼‰ç”Ÿæˆå¯†ç å“ˆå¸Œã€‚

<br/>
- **`GenerateFromPassword` æ–¹æ³•æºç ï¼š**

```go
func GenerateFromPassword(password []byte, cost int) ([]byte, error) {
    p, err := newFromPassword(password, cost)
    if err != nil {
        return nil, err
    }
    return p.Hash(), nil
}
```

- **ğŸ”¹ ä»£ç è§£æ**

	- **1ï¸âƒ£ `newFromPassword(password, cost)`**

		- **`newFromPassword`** æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒå°†å¯†ç å’Œå·¥ä½œå› å­ï¼ˆ`cost`ï¼‰ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªåŠ å¯†çš„å“ˆå¸Œç»“æ„ã€‚
		- **`password []byte`**ï¼šå¾…åŠ å¯†çš„å¯†ç ã€‚
		- **`cost int`**ï¼šå·¥ä½œå› å­ï¼Œå®ƒå†³å®šäº†åŠ å¯†è¿‡ç¨‹çš„å¤æ‚åº¦ï¼ˆå³è®¡ç®—æˆæœ¬ï¼‰ã€‚è¾ƒå¤§çš„ `cost` å€¼ä¼šå¯¼è‡´æ›´é«˜çš„è®¡ç®—è´Ÿæ‹…ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ã€‚é€šå¸¸ï¼Œ`cost` çš„æ¨èå€¼æ˜¯ `10`ï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ã€‚
		  - **`cost`** å†³å®šäº† bcrypt å“ˆå¸Œè®¡ç®—çš„æ—¶é—´å¤æ‚åº¦ã€‚è¾ƒé«˜çš„ `cost` ä¼šè®©åŠ å¯†æ›´åŠ è€—æ—¶ï¼Œä»è€Œåœ¨æš´åŠ›ç ´è§£æ—¶å¢åŠ å›°éš¾ã€‚

	- **2ï¸âƒ£ `if err != nil { return nil, err }`**
		- **é”™è¯¯æ£€æŸ¥**ï¼šå¦‚æœ `newFromPassword` åœ¨ç”Ÿæˆå“ˆå¸Œæ—¶å‘ç”Ÿäº†é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œä¼ é€’äº†æ— æ•ˆçš„ `cost` å€¼ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚æ­¤æ—¶æ–¹æ³•ä¼š **è¿”å› `nil` å’Œé”™è¯¯**ã€‚

- **3ï¸âƒ£ `return p.Hash(), nil`**
	- **`p.Hash()`**ï¼š`p` æ˜¯é€šè¿‡ `newFromPassword` åˆ›å»ºçš„å“ˆå¸Œç»“æ„ï¼Œ`Hash()` æ–¹æ³•ä¼šè¿”å›æœ€ç»ˆç”Ÿæˆçš„å¯†ç å“ˆå¸Œã€‚è¿™ä¸ªå“ˆå¸Œå°†ä½œä¸ºè¿”å›å€¼ä¼ é€’å‡ºå»ã€‚
	- **è¿”å›å€¼**ï¼šç”Ÿæˆçš„å“ˆå¸Œå’Œ `nil` é”™è¯¯è¡¨ç¤ºæˆåŠŸã€‚

<br/>

- **ğŸ”¹ ä¸»è¦åŠŸèƒ½**
	- **å¯†ç å“ˆå¸Œç”Ÿæˆ**ï¼šè¯¥æ–¹æ³•ç”¨äº **ç”ŸæˆåŠ å¯†åçš„å¯†ç å“ˆå¸Œ**ã€‚ç”Ÿæˆçš„å“ˆå¸Œé€šå¸¸ç”¨äºå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ç™»å½•æ—¶å¯¹æ¯”ã€‚
	- **`cost` æ§åˆ¶å¤æ‚åº¦**ï¼š`cost` æ˜¯ä¸€ä¸ªé‡è¦çš„å‚æ•°ï¼Œå®ƒæ§åˆ¶äº† bcrypt åŠ å¯†ç®—æ³•çš„ **è®¡ç®—å¼€é”€**ï¼Œä»è€Œå½±å“åŠ å¯†çš„é€Ÿåº¦å’Œå®‰å…¨æ€§ã€‚è¾ƒé«˜çš„ `cost` å€¼å¢åŠ äº†æ”»å‡»è€…åœ¨è¿›è¡Œæš´åŠ›ç ´è§£æ—¶æ‰€éœ€çš„æ—¶é—´ã€‚

<br/>
- **ğŸ”¹ ä»£ç ç¤ºä¾‹**

å‡è®¾æˆ‘ä»¬åœ¨ Go ä¸­ä½¿ç”¨æ­¤å‡½æ•°æ¥åŠ å¯†ç”¨æˆ·å¯†ç å¹¶å­˜å‚¨å®ƒï¼š

```go
package main

import (
    "fmt"
    "golang.org/x/crypto/bcrypt"
    "log"
)

func GenerateFromPassword(password []byte, cost int) ([]byte, error) {
    p, err := newFromPassword(password, cost)
    if err != nil {
        return nil, err
    }
    return p.Hash(), nil
}

func main() {
    password := []byte("mySecretPassword")
    cost := 10 // å·¥ä½œå› å­
    
    // ç”Ÿæˆå“ˆå¸Œ
    hashedPassword, err := GenerateFromPassword(password, cost)
    if err != nil {
        log.Fatal("Error generating hash:", err)
    }
    
    fmt.Printf("Generated Hash: %s\n", hashedPassword)
    
    // ä½¿ç”¨ bcrypt å¯¹æ¯”å¯†ç ï¼ˆå‡è®¾ç”¨æˆ·è¾“å…¥çš„å¯†ç æ˜¯ "mySecretPassword"ï¼‰
    err = bcrypt.CompareHashAndPassword(hashedPassword, password)
    if err != nil {
        fmt.Println("Password mismatch")
    } else {
        fmt.Println("Password matched")
    }
}
```

- **æ‰§è¡Œç»“æœ**ï¼š
	- å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æ³¨å†Œæ—¶ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ `GenerateFromPassword` ç”Ÿæˆå“ˆå¸Œå¯†ç ï¼Œå¹¶å°†å…¶å­˜å‚¨ã€‚
	- ç”¨æˆ·ç™»å½•æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ `bcrypt.CompareHashAndPassword` æ¥æ¯”è¾ƒç”¨æˆ·è¾“å…¥çš„å¯†ç ä¸å­˜å‚¨çš„å“ˆå¸Œå¯†ç æ˜¯å¦åŒ¹é…ã€‚













